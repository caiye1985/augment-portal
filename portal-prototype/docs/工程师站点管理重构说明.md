# 工程师站点管理重构说明

## 重构背景

由于租户下新增了站点管理层级，且站点按不同城市地点设计，现在工程师负责的最小管理单元从租户变更为站点。

## 重构内容

### 1. 页面标题和描述更新

- **原标题**: "工程师租户分配"
- **新标题**: "工程师负责站点管理"
- **新描述**: "管理运维工程师负责的站点范围，基于地理位置实现精准的工单分配和就近服务"

### 2. 数据模型调整

- **分配对象**: 从租户改为站点
- **保留信息**: 租户信息作为站点的上级归属显示
- **站点数据**: 包含站点名称、所属租户、城市地点、站点类型、状态等

### 3. 界面功能重构

#### 左侧工程师列表
- 显示每个工程师负责的站点数量（而非租户数量）
- 新增覆盖城市数量统计
- 保留工单数量显示

#### 右侧分配区域
- 改为站点选择和分配界面
- 新增站点筛选功能：
  - 按城市筛选
  - 按租户筛选
  - 按站点类型筛选
- 智能推荐功能：基于地理位置就近原则
- 保持原有的分配历史记录功能

### 4. 业务逻辑更新

#### 工作负载计算
- **原逻辑**: 基于租户数量
- **新逻辑**: 基于负责的站点数量和预计工单数量

#### 分配推荐算法
- 考虑地理位置就近原则
- 优先推荐同城站点（距离≤100km）
- 次优推荐就近站点（距离≤500km）

#### 统计指标更新
- 平均负责租户 → 平均负责站点
- 覆盖率 → 站点覆盖率

### 5. 新增功能特性

#### 地理位置相关
- 距离计算和显示
- 基于工程师工作地点的智能推荐
- 覆盖城市数量统计

#### 站点筛选
- 多维度筛选：城市、租户、类型
- 实时筛选结果更新
- 筛选状态保持

#### 推荐系统
- 智能推荐按钮
- 推荐站点高亮显示
- 推荐理由说明

## 文件变更

### 新增文件
- `portal-prototype/src/views/EngineerSiteManagement.vue` - 重构后的站点管理页面
- `portal-prototype/src/views/EngineerSiteManagementDemo.vue` - 功能演示页面

### 修改文件
- `portal-frontend/src/api/engineers.js` - 新增站点分配相关API接口
- `portal-prototype/src/router/index.js` - 更新路由配置

### API接口新增
```javascript
// 工程师站点分配管理
getEngineerSiteAssignments(engineerId)
assignEngineerToSites(engineerId, siteIds)
unassignEngineerFromSites(engineerId, siteIds)
batchAssignEngineersToSites(assignments)
getEngineerSiteAssignmentHistory(engineerId, params)
getEngineerSiteAssignmentStatistics()
getRecommendedSiteAssignments(engineerId, params)
exportEngineerSiteAssignments(params)
```

## 使用说明

### 访问路径
- 主页面：`/personnel/engineer-sites`
- 演示页面：`/personnel/engineer-sites-demo`

### 主要操作流程

1. **选择工程师**
   - 在左侧工程师列表中点击选择工程师
   - 查看工程师基本信息和当前分配状态

2. **筛选站点**
   - 使用城市、租户、类型筛选器
   - 缩小站点选择范围

3. **智能推荐**
   - 点击"智能推荐"按钮
   - 系统基于地理位置推荐就近站点

4. **分配站点**
   - 勾选要分配的站点
   - 查看工作负载预估
   - 点击"保存分配"确认

5. **查看历史**
   - 点击"分配历史"查看历史记录
   - 支持历史数据导出

## 技术实现

### 核心计算逻辑

#### 距离计算
```javascript
const calculateDistance = (location1, location2) => {
  // 简化的距离计算，实际应该使用地理位置API
  const distanceMap = {
    '北京市-上海市': 1200,
    '北京市-广州市': 2100,
    // ...更多城市距离映射
  }
  return distanceMap[`${location1}-${location2}`] || 0
}
```

#### 工作负载计算
```javascript
const estimatedWorkload = computed(() => {
  const maxSites = 20 // 假设最大管理站点数
  const maxTickets = 200 // 假设最大处理工单数
  
  const siteLoad = (selectedSites.value.length / maxSites) * 50
  const ticketLoad = (estimatedTickets.value / maxTickets) * 50
  
  return Math.min(siteLoad + ticketLoad, 100)
})
```

### 数据结构

#### 站点分配记录
```javascript
{
  id: 'assign-001',
  engineerId: 'eng-001',
  engineerName: '张工程师',
  tenantId: 'tenant-001',
  tenantName: '北京科技有限公司',
  siteId: 'site-001',
  siteName: '北京总部数据中心',
  assignedAt: '2024-01-15',
  assignedBy: 'admin',
  status: 'active',
  priority: 'primary'
}
```

## 后续优化建议

1. **地理位置API集成**
   - 集成真实的地理位置计算API
   - 支持精确的距离和路径计算

2. **智能推荐算法优化**
   - 考虑工程师技能匹配
   - 考虑历史服务质量
   - 考虑当前工作负载

3. **可视化增强**
   - 添加地图视图显示站点分布
   - 工程师覆盖范围可视化
   - 工作负载热力图

4. **性能优化**
   - 大数据量下的分页和虚拟滚动
   - 筛选和搜索性能优化
   - 缓存策略优化

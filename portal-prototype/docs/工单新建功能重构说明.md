# 工单新建功能重构说明

## 重构目标

将新建工单页面中的"智能派单配置"和"分配设置"功能移除，实现职责分离，确保新建工单页面只负责工单基本信息的录入。

## 重构前的问题

1. **职责耦合**：新建工单页面包含了工单创建和派单分配两个不同的职责
2. **功能冗余**：系统中已存在独立的派单管理页面（DispatchDemo.vue），但新建工单页面仍包含派单功能
3. **用户体验混乱**：用户在创建工单时需要考虑派单相关的配置，增加了操作复杂度

## 重构内容

### 移除的功能模块

#### 1. 智能派单配置（原第 520-588 行）
- 所需技能选择器
- 技能等级要求选择
- 地理位置输入框
- 远程处理选项
- 预估工时输入
- 标签输入框

#### 2. 分配设置（原第 590-631 行）
- 分配方式选择（自动分配、手动分配、暂不分配）
- 指定工程师选择器
- 自动分配预览提示

### 新增的功能模块

#### 附件上传功能
- 替换原有的派单配置区域
- 支持拖拽上传
- 支持多文件上传
- 文件类型和大小限制

### 调整的数据结构

#### newTicket 对象简化
```javascript
// 重构前
const newTicket = ref({
  title: '',
  description: '',
  priority: '',
  category: '',
  subcategory: '',
  dueTime: null,
  contact: '',
  requiredSkills: [],
  skillLevelRequired: null,
  location: '',
  isRemote: 1,
  estimatedHours: null,
  tags: '',
  assigneeId: '',
  assignee: '',
  enableAI: true
})

// 重构后
const newTicket = ref({
  title: '',
  description: '',
  priority: '',
  category: '',
  subcategory: '',
  dueTime: null,
  contact: '',
  enableAI: true
})
```

#### 移除的数据属性
- `assignmentType`：分配方式
- `skillOptions`：技能选项列表
- `availableEngineers`：可用工程师列表

### 调整的业务逻辑

#### createTicket 方法优化
1. **状态设置**：新建工单默认状态改为"待分配"
2. **移除派单逻辑**：不再在创建时进行工程师分配
3. **用户提示优化**：创建成功后提示用户前往派单管理页面进行分配
4. **简化数据结构**：移除派单相关字段的赋值

#### resetCreateForm 方法简化
- 只重置工单基本信息字段
- 移除派单相关字段的重置逻辑

## 重构后的工作流程

### 新的工单处理流程
1. **工单创建**：用户在新建工单页面填写基本信息（标题、描述、优先级、分类等）
2. **状态设置**：工单创建后自动设置为"待分配"状态
3. **进入队列**：工单自动进入派单队列
4. **派单处理**：管理员在派单管理页面（DispatchDemo）进行工单分配
5. **状态更新**：派单完成后工单状态更新为"已分配"

### 用户操作流程
1. 点击"新建工单"按钮
2. 填写工单基本信息
3. 上传相关附件（可选）
4. 点击"创建工单"
5. 系统提示创建成功，并引导用户前往派单管理页面

## 技术实现细节

### 保留的核心功能
- 工单基本信息录入
- 分类和子分类联动
- 表单验证
- AI 分析功能
- 附件上传功能

### 与派单系统的集成
- 新建工单自动进入 DispatchDemo 的待派单队列
- 保持工单数据结构的一致性
- 确保状态流转的正确性

## 重构效果

### 职责分离
- **新建工单页面**：专注于工单信息录入
- **派单管理页面**：专注于工单分配和调度

### 用户体验提升
- 简化了新建工单的操作流程
- 减少了用户的认知负担
- 提高了界面的清晰度

### 系统架构优化
- 符合单一职责原则
- 提高了代码的可维护性
- 便于功能的独立开发和测试

## 后续建议

1. **用户引导**：在新建工单成功后，可以添加快速跳转到派单管理页面的按钮
2. **权限控制**：考虑为不同角色用户提供不同的功能访问权限
3. **工作流集成**：可以考虑将工单创建和派单流程进一步自动化
4. **数据统计**：在派单管理页面增加更多的统计和分析功能

## 文件变更记录

- **修改文件**：`portal-prototype/src/views/TicketDemo.vue`
- **变更类型**：功能重构
- **影响范围**：新建工单功能
- **兼容性**：向后兼容，不影响现有工单数据

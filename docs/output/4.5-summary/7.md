# IT运维门户系统 API 文档 v4.5

## 概述

本文档描述了IT运维门户系统的完整API接口，涵盖23个核心模块的所有功能。API遵循RESTful设计原则，使用JSON格式进行数据交换，统一前缀为`/api/v1`。

### 全局约定

- **基础URL**: `https://api.ops-portal.com/api/v1`
- **认证方式**: Bearer Token (JWT)
- **内容类型**: `application/json`
- **字符编码**: UTF-8
- **响应格式**: 统一使用 `Result<T>` 包装

### 统一响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2024-08-11T14:30:00Z",
  "trace_id": "abc123def456"
}
```

### 错误码规范

| 错误码 | 描述 | HTTP状态码 |
|--------|------|-----------|
| 200 | 成功 | 200 |
| 400 | 请求参数错误 | 400 |
| 401 | 未授权 | 401 |
| 403 | 权限不足 | 403 |
| 404 | 资源不存在 | 404 |
| 500 | 服务器内部错误 | 500 |

---

## 1. 基础架构模块 (REQ-001)

### 1.1 认证管理

#### 用户登录
- **路径**: `POST /api/v1/auth/login`
- **REQ-ID**: REQ-001-002
- **平台**: Web, Mobile
- **权限**: 无需认证
- **描述**: 用户身份认证登录

**请求参数**:
```json
{
  "username": "string",
  "password": "string", 
  "tenant_code": "string",
  "captcha": "string",
  "captcha_token": "string"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200,
    "user_info": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "张工程师",
      "tenant_id": 1,
      "roles": ["engineer"]
    }
  }
}
```

#### 刷新Token
- **路径**: `POST /api/v1/auth/refresh`
- **REQ-ID**: REQ-001-002
- **平台**: Web, Mobile
- **权限**: 需要refresh_token
- **描述**: 使用refresh_token刷新访问令牌

**请求参数**:
```json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "刷新成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200,
    "token_type": "Bearer"
  }
}
```

#### 用户登出
- **路径**: `POST /api/v1/auth/logout`
- **REQ-ID**: REQ-001-002
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 用户退出登录，清除会话信息

**请求参数**:
```json
{
  "logout_all_devices": false
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "登出成功",
  "data": {
    "logout_time": "2024-08-11T14:30:00Z"
  }
}
```

#### OAuth2认证
- **路径**: `GET /api/v1/auth/oauth2/{provider}`
- **REQ-ID**: REQ-001-009
- **平台**: Web
- **权限**: 无需认证
- **描述**: 第三方OAuth2认证登录

**路径参数**:
- `provider`: 认证提供商 (google, microsoft, dingtalk, wechat)

**查询参数**:
- `redirect_uri`: 认证成功后的回调地址
- `state`: 状态参数，用于防止CSRF攻击

**响应示例**:
```json
{
  "code": 200,
  "message": "认证成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200,
    "user_info": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "张工程师",
      "email": "engineer001@company.com",
      "tenant_id": 1,
      "roles": ["engineer"],
      "oauth_provider": "google",
      "oauth_user_id": "google_user_123"
    }
  }
}
```

### 1.2 权限管理

#### 获取用户权限
- **路径**: `GET /api/v1/auth/permissions`
- **REQ-ID**: REQ-001-003
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取当前用户的权限列表

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "user_id": 1001,
    "permissions": [
      "ticket_read",
      "ticket_create",
      "ticket_update",
      "customer_read",
      "engineer_read"
    ],
    "roles": [
      {
        "role_id": 1,
        "role_name": "运维工程师",
        "role_code": "engineer"
      }
    ],
    "tenant_permissions": {
      "tenant_id": 1,
      "tenant_code": "company_a",
      "permissions": [
        "tenant_config_read"
      ]
    }
  }
}
```
#### 权限验证
- **路径**: `POST /api/v1/auth/verify`
- **REQ-ID**: REQ-001-003
- **平台**: Web, Mobile, API
- **权限**: 需要认证
- **描述**: 验证用户是否具有指定权限

**请求参数**:
```json
{
  "permissions": ["ticket_create", "customer_read"],
  "resource_id": 12345,
  "resource_type": "ticket"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "验证完成",
  "data": {
    "has_permission": true,
    "granted_permissions": ["ticket_create", "customer_read"],
    "denied_permissions": [],
    "resource_access": {
      "resource_id": 12345,
      "resource_type": "ticket",
      "access_level": "full"
    }
  }
}

### 1.3 多租户管理

#### 获取租户信息
- **路径**: `GET /api/v1/tenants/current`
- **REQ-ID**: REQ-001-001
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取当前用户所属租户的基本信息

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "tenant_id": 1,
    "tenant_code": "company_a",
    "tenant_name": "A公司",
    "industry": "信息技术",
    "scale": "中型企业",
    "status": "active",
    "subscription": {
      "plan": "enterprise",
      "expires_at": "2025-08-11T00:00:00Z",
      "max_users": 500,
      "current_users": 156
    },
    "features": [
      "advanced_analytics",
      "workflow_engine",
      "ai_analysis"
    ],
    "contact_info": {
      "admin_name": "张总",
      "admin_email": "admin@company-a.com",
      "admin_phone": "13800138000"
    },
    "created_at": "2024-01-01T00:00:00Z"
  }
}
```
#### 租户配置管理
- **路径**: `GET /api/v1/tenants/config`
- **REQ-ID**: REQ-001-006
- **平台**: Web
- **权限**: tenant_admin
- **描述**: 获取租户级别的配置设置

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "tenant_id": 1,
    "configs": [
      {
        "config_key": "ticket.auto_assign",
        "config_value": "true",
        "description": "启用工单自动分配",
        "data_type": "boolean"
      },
      {
        "config_key": "notification.email_enabled",
        "config_value": "true",
        "description": "启用邮件通知",
        "data_type": "boolean"
      },
      {
        "config_key": "sla.default_response_time",
        "config_value": "4",
        "description": "默认响应时间(小时)",
        "data_type": "integer"
      }
    ],
    "updated_at": "2024-08-11T14:30:00Z"
  }
}
```
- **路径**: `PUT /api/v1/tenants/config`
- **REQ-ID**: REQ-001-006
- **平台**: Web
- **权限**: tenant_admin
- **描述**: 更新租户级别的配置设置

**请求参数**:
```json
{
  "configs": [
    {
      "config_key": "ticket.auto_assign",
      "config_value": "false"
    },
    {
      "config_key": "sla.default_response_time",
      "config_value": "2"
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "updated_configs": 2,
    "updated_at": "2024-08-11T15:30:00Z"
  }
}

### 1.4 系统监控

#### 系统健康检查
- **路径**: `GET /api/v1/system/health`
- **REQ-ID**: REQ-001-007
- **平台**: API
- **权限**: 无需认证
- **描述**: 检查系统各组件的健康状态

**响应示例**:
```json
{
  "status": "healthy",
  "timestamp": "2024-08-11T14:30:00Z",
  "version": "4.5.0",
  "uptime": "15天3小时",
  "components": {
    "database": {
      "status": "healthy",
      "response_time": 12,
      "connections": {
        "active": 25,
        "max": 100
      }
    },
    "redis": {
      "status": "healthy",
      "response_time": 3,
      "memory_usage": "45%"
    },
    "elasticsearch": {
      "status": "healthy",
      "response_time": 8,
      "cluster_health": "green"
    },
    "message_queue": {
      "status": "healthy",
      "queue_size": 156,
      "processing_rate": "95/min"
    }
  }
}
```
#### 获取系统指标
- **路径**: `GET /api/v1/system/metrics`
- **REQ-ID**: REQ-001-007
- **平台**: Web
- **权限**: system_monitor
- **描述**: 获取系统性能和运行指标

**查询参数**:
- `period`: 统计周期 (1h, 6h, 24h, 7d, 30d)
- `metrics`: 指标类型 (performance, usage, business)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "period": "24h",
    "timestamp": "2024-08-11T14:30:00Z",
    "system_metrics": {
      "cpu_usage": {
        "current": 45.2,
        "average": 38.5,
        "peak": 78.3
      },
      "memory_usage": {
        "current": 68.5,
        "average": 62.1,
        "peak": 85.2
      },
      "disk_usage": {
        "current": 72.1,
        "available_gb": 1024
      },
      "network": {
        "inbound_mbps": 125.6,
        "outbound_mbps": 89.3
      }
    },
    "application_metrics": {
      "active_sessions": 156,
      "api_requests_per_minute": 1250,
      "average_response_time": 185,
      "error_rate": 0.02
    },
    "business_metrics": {
      "total_tickets_today": 45,
      "resolved_tickets_today": 38,
      "active_engineers": 23,
      "customer_satisfaction": 4.6
    }
  }
}

---

## 2. 工作台与仪表板模块 (REQ-002)

### 2.1 个性化工作台

#### 获取工作台配置
- **路径**: `GET /api/v1/dashboard/config`
- **REQ-ID**: REQ-002-001
- **平台**: Web, Mobile
- **权限**: 需要认证

#### 保存工作台配置
- **路径**: `PUT /api/v1/dashboard/config`
- **REQ-ID**: REQ-002-001
- **平台**: Web
- **权限**: 需要认证

### 2.2 数据仪表板

#### 获取仪表板数据
- **路径**: `GET /api/v1/dashboard/data`
- **REQ-ID**: REQ-002-002
- **平台**: Web, Mobile
- **权限**: 需要认证

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "summary": {
      "total_tickets": 156,
      "pending_tickets": 23,
      "in_progress_tickets": 45,
      "resolved_tickets": 88
    },
    "charts": [
      {
        "type": "line",
        "title": "工单趋势",
        "data": {
          "labels": ["周一", "周二", "周三", "周四", "周五"],
          "datasets": [{
            "label": "新建工单",
            "data": [12, 19, 15, 25, 22]
          }]
        }
      }
    ]
  }
}
```
### 2.3 任务中心

#### 获取待办任务
- **路径**: `GET /api/v1/dashboard/tasks`
- **REQ-ID**: REQ-002-003
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取当前用户的待办任务列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `priority`: 优先级筛选 (high, medium, low)
- `type`: 任务类型 (ticket, workflow, approval, maintenance)
- `due_date`: 截止日期筛选

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "tasks": [
      {
        "task_id": "TASK-001",
        "task_type": "ticket",
        "title": "处理邮件服务器故障工单",
        "description": "客户反馈邮件服务器无法发送邮件",
        "priority": "high",
        "status": "pending",
        "business_id": 12345,
        "business_type": "ticket",
        "assignee_id": 1001,
        "created_at": "2024-08-11T10:30:00Z",
        "due_date": "2024-08-11T18:00:00Z",
        "estimated_duration": "2小时",
        "tags": ["紧急", "硬件故障"]
      },
      {
        "task_id": "TASK-002",
        "task_type": "workflow",
        "title": "审批设备采购申请",
        "description": "部门申请购买新的服务器设备",
        "priority": "medium",
        "status": "pending",
        "business_id": "WF-001",
        "business_type": "workflow",
        "assignee_id": 1001,
        "created_at": "2024-08-11T09:00:00Z",
        "due_date": "2024-08-12T17:00:00Z",
        "estimated_duration": "30分钟",
        "tags": ["审批", "采购"]
      }
    ],
    "summary": {
      "total_tasks": 15,
      "high_priority": 3,
      "medium_priority": 8,
      "low_priority": 4,
      "overdue_tasks": 1
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 15,
      "pages": 1
    }
  }
}
```
#### 标记任务完成
- **路径**: `PUT /api/v1/dashboard/tasks/{taskId}/complete`
- **REQ-ID**: REQ-002-003
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 标记指定任务为已完成

**路径参数**:
- `taskId`: 任务ID

**请求参数**:
```json
{
  "completion_note": "任务已完成，邮件服务器故障已修复",
  "actual_duration": "1.5小时",
  "result_data": {
    "resolution": "更换了故障硬盘",
    "next_actions": ["监控服务器状态24小时"]
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "任务完成",
  "data": {
    "task_id": "TASK-001",
    "completed_at": "2024-08-11T14:30:00Z",
    "completion_note": "任务已完成，邮件服务器故障已修复",
    "actual_duration": "1.5小时",
    "next_task": {
      "task_id": "TASK-003",
      "title": "跟进客户满意度调查"
    }
  }
}

### 2.4 快速导航

#### 获取导航菜单
- **路径**: `GET /api/v1/dashboard/navigation`
- **REQ-ID**: REQ-002-004
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取用户个性化导航菜单

**查询参数**:
- `platform`: 平台类型 (web, mobile)
- `include_shortcuts`: 是否包含快捷操作 (默认: true)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "menu_items": [
      {
        "menu_id": "dashboard",
        "title": "工作台",
        "icon": "dashboard",
        "url": "/dashboard",
        "order": 1,
        "visible": true,
        "children": []
      },
      {
        "menu_id": "tickets",
        "title": "工单管理",
        "icon": "ticket",
        "url": "/tickets",
        "order": 2,
        "visible": true,
        "badge": {
          "count": 23,
          "type": "pending"
        },
        "children": [
          {
            "menu_id": "tickets_my",
            "title": "我的工单",
            "url": "/tickets/my",
            "order": 1
          },
          {
            "menu_id": "tickets_create",
            "title": "创建工单",
            "url": "/tickets/create",
            "order": 2
          }
        ]
      },
      {
        "menu_id": "knowledge",
        "title": "知识库",
        "icon": "book",
        "url": "/knowledge",
        "order": 3,
        "visible": true,
        "children": []
      }
    ],
    "shortcuts": [
      {
        "shortcut_id": "quick_ticket",
        "title": "快速创建工单",
        "icon": "plus-circle",
        "action": "navigate",
        "target": "/tickets/create?quick=true",
        "order": 1
      },
      {
        "shortcut_id": "my_tasks",
        "title": "我的待办",
        "icon": "clipboard-list",
        "action": "navigate",
        "target": "/dashboard/tasks",
        "badge": 5,
        "order": 2
      }
    ],
    "user_preferences": {
      "collapsed_menus": ["system"],
      "pinned_shortcuts": ["quick_ticket", "my_tasks"]
    }
  }
}
```
#### 全局搜索
- **路径**: `GET /api/v1/dashboard/search`
- **REQ-ID**: REQ-002-004
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 全局智能搜索功能

**查询参数**:
- `q`: 搜索关键词 (必填)
- `type`: 搜索类型 (all, tickets, customers, knowledge, engineers)
- `limit`: 结果数量限制 (默认: 10, 最大: 50)
- `scope`: 搜索范围 (current_tenant, all_accessible)

**响应示例**:
```json
{
  "code": 200,
  "message": "搜索完成",
  "data": {
    "query": "邮件服务器",
    "total_results": 25,
    "search_time": "0.15s",
    "results": {
      "tickets": [
        {
          "type": "ticket",
          "id": 12345,
          "title": "邮件服务器故障",
          "description": "邮件服务器无法发送邮件",
          "status": "in_progress",
          "priority": 2,
          "created_at": "2024-08-11T10:30:00Z",
          "highlight": "邮件<em>服务器</em>无法发送邮件",
          "url": "/tickets/12345"
        }
      ],
      "knowledge": [
        {
          "type": "knowledge",
          "id": 1001,
          "title": "邮件服务器故障排查指南",
          "category": "故障排查",
          "author": "张工程师",
          "view_count": 156,
          "highlight": "<em>邮件服务器</em>故障排查指南",
          "url": "/knowledge/1001"
        }
      ],
      "customers": [
        {
          "type": "customer",
          "id": 5001,
          "name": "ABC科技有限公司",
          "contact_person": "张总",
          "recent_tickets": 3,
          "highlight": "使用<em>邮件服务器</em>的客户",
          "url": "/customers/5001"
        }
      ]
    },
    "suggestions": [
      "邮件服务器配置",
      "邮件服务器监控",
      "邮件服务器备份"
    ],
    "filters": {
      "available_types": ["tickets", "knowledge", "customers", "engineers"],
      "date_ranges": ["today", "week", "month", "quarter"],
      "priorities": [1, 2, 3, 4]
    }
  }
}

---

## 3. 工单管理模块 (REQ-003)

### 3.1 工单基础操作

#### 创建工单
- **路径**: `POST /api/v1/tickets`
- **REQ-ID**: REQ-003-001
- **平台**: Web, Mobile
- **权限**: ticket_create
- **描述**: 创建新的工单

**请求参数**:
```json
{
  "title": "邮件服务器故障",
  "description": "邮件服务器无法发送邮件，影响公司正常业务运营",
  "category": "硬件故障",
  "priority": 2,
  "customer_id": 12345,
  "contact_person": "张三",
  "contact_phone": "13800138000",
  "contact_email": "zhangsan@company.com",
  "urgency": "high",
  "impact": "medium",
  "source": "phone",
  "location": "北京总部机房A区",
  "tags": ["邮件", "服务器", "紧急"],
  "custom_fields": {
    "server_ip": "192.168.1.100",
    "affected_users": 50
  },
  "attachments": [
    {
      "filename": "error_log.txt",
      "url": "https://files.example.com/error_log.txt",
      "size": 1024,
      "type": "text/plain"
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "工单创建成功",
  "data": {
    "ticket_id": 12345,
    "ticket_no": "TK202408110001",
    "title": "邮件服务器故障",
    "status": "pending",
    "priority": 2,
    "created_at": "2024-08-11T10:30:00Z",
    "estimated_resolution": "2024-08-11T18:30:00Z",
    "sla_deadline": "2024-08-12T10:30:00Z"
  }
}
```
#### 获取工单详情
- **路径**: `GET /api/v1/tickets/{ticketId}`
- **REQ-ID**: REQ-003-002
- **平台**: Web, Mobile
- **权限**: ticket_read
- **描述**: 根据工单ID获取详细信息

**路径参数**:
- `ticketId`: 工单ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "ticket_id": 12345,
    "ticket_no": "TK202408110001",
    "title": "邮件服务器故障",
    "description": "邮件服务器无法发送邮件，影响公司正常业务运营",
    "category": "硬件故障",
    "priority": 2,
    "status": "in_progress",
    "urgency": "high",
    "impact": "medium",
    "source": "phone",
    "location": "北京总部机房A区",
    "customer": {
      "customer_id": 12345,
      "customer_name": "ABC科技有限公司",
      "contact_person": "张三",
      "contact_phone": "13800138000",
      "contact_email": "zhangsan@company.com"
    },
    "assignee": {
      "engineer_id": 1001,
      "engineer_name": "李工程师",
      "department": "运维部"
    },
    "creator": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "tags": ["邮件", "服务器", "紧急"],
    "custom_fields": {
      "server_ip": "192.168.1.100",
      "affected_users": 50
    },
    "sla_info": {
      "response_deadline": "2024-08-11T14:30:00Z",
      "resolution_deadline": "2024-08-12T10:30:00Z",
      "response_status": "met",
      "resolution_status": "pending"
    },
    "progress": {
      "completion_rate": 60,
      "current_step": "问题诊断",
      "next_step": "解决方案实施"
    },
    "attachments": [
      {
        "attachment_id": 1001,
        "filename": "error_log.txt",
        "url": "https://files.example.com/error_log.txt",
        "size": 1024,
        "type": "text/plain",
        "uploaded_at": "2024-08-11T10:30:00Z"
      }
    ],
    "created_at": "2024-08-11T10:30:00Z",
    "updated_at": "2024-08-11T14:30:00Z",
    "resolved_at": null,
    "closed_at": null
  }
}
```
#### 更新工单
- **路径**: `PUT /api/v1/tickets/{ticketId}`
- **REQ-ID**: REQ-003-003
- **平台**: Web, Mobile
- **权限**: ticket_update
- **描述**: 更新工单信息

**路径参数**:
- `ticketId`: 工单ID

**请求参数**:
```json
{
  "title": "邮件服务器故障（已定位问题）",
  "description": "邮件服务器硬盘故障导致无法发送邮件，已定位到具体硬盘",
  "priority": 1,
  "status": "in_progress",
  "location": "北京总部机房A区-服务器机柜03",
  "tags": ["邮件", "服务器", "硬盘故障"],
  "custom_fields": {
    "server_ip": "192.168.1.100",
    "affected_users": 50,
    "fault_disk": "/dev/sda2"
  },
  "progress_note": "已定位到硬盘故障，准备更换硬盘"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "工单更新成功",
  "data": {
    "ticket_id": 12345,
    "updated_fields": ["title", "description", "priority", "location", "tags", "custom_fields"],
    "updated_at": "2024-08-11T15:30:00Z",
    "updated_by": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "李工程师"
    }
  }
}
```
#### 删除工单
- **路径**: `DELETE /api/v1/tickets/{ticketId}`
- **REQ-ID**: REQ-003-004
- **平台**: Web
- **权限**: ticket_delete
- **描述**: 删除工单（仅限特定条件下）

**路径参数**:
- `ticketId`: 工单ID

**请求参数**:
```json
{
  "reason": "重复工单，已合并到TK202408110002",
  "force": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "工单删除成功",
  "data": {
    "ticket_id": 12345,
    "deleted_at": "2024-08-11T16:30:00Z",
    "deleted_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "reason": "重复工单，已合并到TK202408110002"
  }
}

### 3.2 工单查询

#### 工单列表查询
- **路径**: `GET /api/v1/tickets`
- **REQ-ID**: REQ-003-002
- **平台**: Web, Mobile
- **权限**: ticket_read
- **描述**: 分页查询工单列表，支持多种筛选条件

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `status`: 状态筛选 (pending, in_progress, resolved, closed)
- `priority`: 优先级筛选 (1-紧急, 2-高, 3-中, 4-低)
- `category`: 分类筛选
- `assignee`: 处理人筛选
- `customer_id`: 客户筛选
- `created_start`: 创建时间开始
- `created_end`: 创建时间结束
- `sla_status`: SLA状态筛选 (normal, warning, breach)
- `tags`: 标签筛选
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "tickets": [
      {
        "ticket_id": 12345,
        "ticket_no": "TK202408110001",
        "title": "邮件服务器故障",
        "category": "硬件故障",
        "priority": 2,
        "status": "in_progress",
        "customer_name": "ABC科技有限公司",
        "assignee_name": "李工程师",
        "created_at": "2024-08-11T10:30:00Z",
        "sla_deadline": "2024-08-12T10:30:00Z",
        "sla_status": "normal",
        "tags": ["邮件", "服务器", "紧急"]
      }
    ],
    "summary": {
      "total_count": 156,
      "pending_count": 23,
      "in_progress_count": 45,
      "resolved_count": 88,
      "overdue_count": 3
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8,
      "has_next": true,
      "has_prev": false
    }
  }
}
```
#### 工单高级搜索
- **路径**: `POST /api/v1/tickets/search`
- **REQ-ID**: REQ-003-002
- **平台**: Web
- **权限**: ticket_read
- **描述**: 高级搜索工单，支持复杂查询条件

**请求参数**:
```json
{
  "conditions": [
    {
      "field": "priority",
      "operator": "in",
      "value": [1, 2]
    },
    {
      "field": "created_at",
      "operator": "between",
      "value": ["2024-08-01T00:00:00Z", "2024-08-11T23:59:59Z"]
    },
    {
      "field": "description",
      "operator": "contains",
      "value": "服务器"
    }
  ],
  "logic": "and",
  "sort": [
    {
      "field": "created_at",
      "order": "desc"
    },
    {
      "field": "priority",
      "order": "asc"
    }
  ],
  "page": 1,
  "size": 20
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "搜索完成",
  "data": {
    "tickets": [
      {
        "ticket_id": 12345,
        "ticket_no": "TK202408110001",
        "title": "邮件服务器故障",
        "category": "硬件故障",
        "priority": 2,
        "status": "in_progress",
        "customer_name": "ABC科技有限公司",
        "assignee_name": "李工程师",
        "created_at": "2024-08-11T10:30:00Z",
        "highlight": {
          "title": "邮件<em>服务器</em>故障",
          "description": "<em>服务器</em>无法发送邮件"
        }
      }
    ],
    "search_time": "0.25s",
    "total_matches": 25,
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 25,
      "pages": 2
    }
  }
}

### 3.3 工单状态管理

#### 更新工单状态
- **路径**: `PUT /api/v1/tickets/{ticketId}/status`
- **REQ-ID**: REQ-003-005
- **平台**: Web, Mobile
- **权限**: ticket_update
- **描述**: 更新工单状态

**路径参数**:
- `ticketId`: 工单ID

**请求参数**:
```json
{
  "status": "resolved",
  "resolution": "更换了故障硬盘，邮件服务已恢复正常",
  "resolution_category": "硬件更换",
  "actual_effort": "2小时",
  "next_action": "监控24小时确保稳定",
  "attachments": [
    {
      "filename": "repair_report.pdf",
      "url": "https://files.example.com/repair_report.pdf"
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "状态更新成功",
  "data": {
    "ticket_id": 12345,
    "old_status": "in_progress",
    "new_status": "resolved",
    "updated_at": "2024-08-11T16:30:00Z",
    "updated_by": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "李工程师"
    },
    "sla_info": {
      "resolution_time": "6小时",
      "sla_met": true,
      "remaining_time": "18小时"
    }
  }
}
```
#### 工单分配
- **路径**: `PUT /api/v1/tickets/{ticketId}/assign`
- **REQ-ID**: REQ-003-006
- **平台**: Web
- **权限**: ticket_assign
- **描述**: 分配工单给指定工程师

**路径参数**:
- `ticketId`: 工单ID

**请求参数**:
```json
{
  "assignee_id": 1001,
  "assign_reason": "该工程师具有邮件服务器维护经验",
  "priority_adjustment": false,
  "notify_assignee": true,
  "expected_completion": "2024-08-11T18:00:00Z"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "工单分配成功",
  "data": {
    "ticket_id": 12345,
    "assignee": {
      "engineer_id": 1001,
      "engineer_name": "李工程师",
      "department": "运维部",
      "skills": ["Linux服务器", "邮件系统", "硬件维护"]
    },
    "assigned_at": "2024-08-11T11:00:00Z",
    "assigned_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "expected_completion": "2024-08-11T18:00:00Z"
  }
}
```
#### 工单转派
- **路径**: `PUT /api/v1/tickets/{ticketId}/transfer`
- **REQ-ID**: REQ-003-006
- **平台**: Web
- **权限**: ticket_transfer
- **描述**: 将工单转派给其他工程师

**路径参数**:
- `ticketId`: 工单ID

**请求参数**:
```json
{
  "from_engineer_id": 1001,
  "to_engineer_id": 1002,
  "transfer_reason": "原工程师临时有紧急任务，转派给有相同技能的工程师",
  "handover_notes": "已完成问题诊断，确认为硬盘故障，需要更换/dev/sda2硬盘",
  "notify_both": true,
  "priority_adjustment": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "工单转派成功",
  "data": {
    "ticket_id": 12345,
    "transfer_id": "TR202408110001",
    "from_engineer": {
      "engineer_id": 1001,
      "engineer_name": "李工程师"
    },
    "to_engineer": {
      "engineer_id": 1002,
      "engineer_name": "王工程师",
      "department": "运维部"
    },
    "transferred_at": "2024-08-11T14:00:00Z",
    "transferred_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "handover_notes": "已完成问题诊断，确认为硬盘故障，需要更换/dev/sda2硬盘"
  }
}

### 3.4 工单协作

#### 添加工单评论
- **路径**: `POST /api/v1/tickets/{ticketId}/comments`
- **REQ-ID**: REQ-003-007
- **平台**: Web, Mobile
- **权限**: ticket_comment
- **描述**: 为工单添加评论或工作日志

**路径参数**:
- `ticketId`: 工单ID

**请求参数**:
```json
{
  "content": "已完成硬盘故障诊断，确认需要更换/dev/sda2硬盘。预计1小时内完成更换。",
  "comment_type": "work_log",
  "visibility": "internal",
  "attachments": [
    {
      "filename": "diagnostic_report.txt",
      "url": "https://files.example.com/diagnostic_report.txt"
    }
  ],
  "time_spent": "30分钟",
  "progress_update": {
    "completion_rate": 60,
    "current_step": "硬件更换准备"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "评论添加成功",
  "data": {
    "comment_id": 5001,
    "ticket_id": 12345,
    "content": "已完成硬盘故障诊断，确认需要更换/dev/sda2硬盘。预计1小时内完成更换。",
    "comment_type": "work_log",
    "visibility": "internal",
    "author": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "李工程师",
      "avatar": "https://avatar.example.com/1001.jpg"
    },
    "created_at": "2024-08-11T14:30:00Z",
    "attachments": [
      {
        "attachment_id": 1002,
        "filename": "diagnostic_report.txt",
        "url": "https://files.example.com/diagnostic_report.txt"
      }
    ],
    "time_spent": "30分钟"
  }
}
```
#### 获取工单评论
- **路径**: `GET /api/v1/tickets/{ticketId}/comments`
- **REQ-ID**: REQ-003-007
- **平台**: Web, Mobile
- **权限**: ticket_read
- **描述**: 获取工单的评论和工作日志

**路径参数**:
- `ticketId`: 工单ID

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `type`: 评论类型筛选 (comment, work_log, system)
- `visibility`: 可见性筛选 (public, internal, private)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "comments": [
      {
        "comment_id": 5001,
        "content": "已完成硬盘故障诊断，确认需要更换/dev/sda2硬盘。",
        "comment_type": "work_log",
        "visibility": "internal",
        "author": {
          "user_id": 1001,
          "username": "engineer001",
          "real_name": "李工程师",
          "avatar": "https://avatar.example.com/1001.jpg"
        },
        "created_at": "2024-08-11T14:30:00Z",
        "updated_at": "2024-08-11T14:30:00Z",
        "attachments": [
          {
            "attachment_id": 1002,
            "filename": "diagnostic_report.txt",
            "url": "https://files.example.com/diagnostic_report.txt"
          }
        ],
        "time_spent": "30分钟"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 8,
      "pages": 1
    }
  }
}
```
#### 工单关联
- **路径**: `POST /api/v1/tickets/{ticketId}/relations`
- **REQ-ID**: REQ-003-008
- **平台**: Web
- **权限**: ticket_update
- **描述**: 建立工单之间的关联关系

**路径参数**:
- `ticketId`: 主工单ID

**请求参数**:
```json
{
  "related_ticket_id": 12346,
  "relation_type": "duplicate",
  "description": "重复工单，同一个邮件服务器故障",
  "direction": "bidirectional"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "关联创建成功",
  "data": {
    "relation_id": "REL-001",
    "source_ticket": {
      "ticket_id": 12345,
      "ticket_no": "TK202408110001",
      "title": "邮件服务器故障"
    },
    "target_ticket": {
      "ticket_id": 12346,
      "ticket_no": "TK202408110002",
      "title": "邮件服务器无法访问"
    },
    "relation_type": "duplicate",
    "description": "重复工单，同一个邮件服务器故障",
    "created_at": "2024-08-11T15:00:00Z",
    "created_by": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "李工程师"
    }
  }
}

---

## 4. 智能派单模块 (REQ-004)

### 4.1 自动派单

#### 触发自动派单
- **路径**: `POST /api/v1/dispatch/auto`
- **REQ-ID**: REQ-004-001
- **平台**: API
- **权限**: dispatch_auto
- **描述**: 触发工单自动派单算法

**请求参数**:
```json
{
  "ticket_id": 12345,
  "dispatch_mode": "intelligent",
  "constraints": {
    "preferred_engineers": [1001, 1002],
    "excluded_engineers": [1003],
    "max_workload": 80,
    "skill_match_required": true,
    "location_preference": "same_city"
  },
  "priority_factors": {
    "skill_match": 0.4,
    "workload_balance": 0.3,
    "response_time": 0.2,
    "customer_preference": 0.1
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "自动派单完成",
  "data": {
    "ticket_id": 12345,
    "dispatch_result": {
      "assigned_engineer": {
        "engineer_id": 1001,
        "engineer_name": "李工程师",
        "department": "运维部",
        "skill_match_score": 95,
        "current_workload": 65,
        "estimated_response_time": "15分钟"
      },
      "confidence_score": 92,
      "dispatch_reason": "技能匹配度高，工作负载适中，响应时间最优",
      "alternative_engineers": [
        {
          "engineer_id": 1002,
          "engineer_name": "王工程师",
          "score": 88,
          "reason": "技能匹配，但当前工作负载较高"
        }
      ]
    },
    "dispatch_time": "2024-08-11T11:00:00Z",
    "algorithm_version": "v2.1.0"
  }
}
```
#### 获取派单建议
- **路径**: `GET /api/v1/dispatch/suggestions/{ticketId}`
- **REQ-ID**: REQ-004-001
- **平台**: Web
- **权限**: dispatch_view
- **描述**: 获取工单的派单建议列表

**路径参数**:
- `ticketId`: 工单ID

**查询参数**:
- `limit`: 建议数量限制 (默认: 5, 最大: 10)
- `include_unavailable`: 是否包含不可用工程师 (默认: false)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "ticket_id": 12345,
    "ticket_info": {
      "title": "邮件服务器故障",
      "category": "硬件故障",
      "priority": 2,
      "required_skills": ["Linux服务器", "邮件系统", "硬件维护"],
      "location": "北京总部"
    },
    "suggestions": [
      {
        "engineer_id": 1001,
        "engineer_name": "李工程师",
        "department": "运维部",
        "overall_score": 95,
        "skill_match": {
          "score": 95,
          "matched_skills": ["Linux服务器", "邮件系统", "硬件维护"],
          "missing_skills": []
        },
        "workload": {
          "current_tickets": 3,
          "workload_percentage": 65,
          "estimated_availability": "立即可用"
        },
        "location": {
          "office": "北京总部",
          "distance": "同地点",
          "response_time": "15分钟"
        },
        "performance": {
          "avg_resolution_time": "4.2小时",
          "customer_satisfaction": 4.8,
          "success_rate": 98
        },
        "recommendation_reason": "技能完全匹配，工作负载适中，地理位置优势"
      },
      {
        "engineer_id": 1002,
        "engineer_name": "王工程师",
        "department": "运维部",
        "overall_score": 88,
        "skill_match": {
          "score": 90,
          "matched_skills": ["Linux服务器", "硬件维护"],
          "missing_skills": ["邮件系统"]
        },
        "workload": {
          "current_tickets": 5,
          "workload_percentage": 85,
          "estimated_availability": "2小时后"
        },
        "location": {
          "office": "北京总部",
          "distance": "同地点",
          "response_time": "20分钟"
        },
        "performance": {
          "avg_resolution_time": "3.8小时",
          "customer_satisfaction": 4.6,
          "success_rate": 96
        },
        "recommendation_reason": "硬件维护经验丰富，但当前工作负载较高"
      }
    ],
    "analysis_time": "2024-08-11T11:00:00Z",
    "algorithm_version": "v2.1.0"
  }
}

### 4.2 派单规则管理

#### 获取派单规则
- **路径**: `GET /api/v1/dispatch/rules`
- **REQ-ID**: REQ-004-002
- **平台**: Web
- **权限**: dispatch_rule_read
- **描述**: 获取派单规则列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `status`: 规则状态 (active, inactive, draft)
- `category`: 规则分类
- `priority`: 规则优先级

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "rules": [
      {
        "rule_id": "RULE-001",
        "rule_name": "硬件故障优先分配规则",
        "description": "硬件故障类工单优先分配给有硬件维护技能的工程师",
        "category": "硬件故障",
        "priority": 1,
        "status": "active",
        "conditions": [
          {
            "field": "ticket.category",
            "operator": "equals",
            "value": "硬件故障"
          },
          {
            "field": "ticket.priority",
            "operator": "in",
            "value": [1, 2]
          }
        ],
        "actions": [
          {
            "type": "filter_engineers",
            "criteria": {
              "required_skills": ["硬件维护"],
              "max_workload": 80
            }
          },
          {
            "type": "sort_by",
            "field": "skill_match_score",
            "order": "desc"
          }
        ],
        "created_at": "2024-08-01T10:00:00Z",
        "updated_at": "2024-08-10T15:30:00Z",
        "created_by": "admin"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 15,
      "pages": 1
    }
  }
}
```
#### 创建派单规则
- **路径**: `POST /api/v1/dispatch/rules`
- **REQ-ID**: REQ-004-002
- **平台**: Web
- **权限**: dispatch_rule_create
- **描述**: 创建新的派单规则

**请求参数**:
```json
{
  "rule_name": "VIP客户优先处理规则",
  "description": "VIP客户的工单优先分配给经验丰富的高级工程师",
  "category": "客户优先级",
  "priority": 2,
  "status": "active",
  "conditions": [
    {
      "field": "customer.level",
      "operator": "equals",
      "value": "VIP"
    },
    {
      "field": "ticket.priority",
      "operator": "in",
      "value": [1, 2, 3]
    }
  ],
  "actions": [
    {
      "type": "filter_engineers",
      "criteria": {
        "min_experience_years": 3,
        "min_customer_rating": 4.5,
        "max_workload": 70
      }
    },
    {
      "type": "boost_priority",
      "factor": 1.5
    }
  ],
  "effective_time": {
    "start_date": "2024-08-12T00:00:00Z",
    "end_date": null,
    "time_ranges": [
      {
        "start_time": "09:00",
        "end_time": "18:00",
        "days": ["monday", "tuesday", "wednesday", "thursday", "friday"]
      }
    ]
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "规则创建成功",
  "data": {
    "rule_id": "RULE-002",
    "rule_name": "VIP客户优先处理规则",
    "status": "active",
    "created_at": "2024-08-11T16:00:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 更新派单规则
- **路径**: `PUT /api/v1/dispatch/rules/{ruleId}`
- **REQ-ID**: REQ-004-002
- **平台**: Web
- **权限**: dispatch_rule_update
- **描述**: 更新现有派单规则

**路径参数**:
- `ruleId`: 规则ID

**请求参数**:
```json
{
  "rule_name": "硬件故障优先分配规则（更新版）",
  "description": "硬件故障类工单优先分配给有硬件维护技能的工程师，增加地理位置考虑",
  "priority": 1,
  "status": "active",
  "conditions": [
    {
      "field": "ticket.category",
      "operator": "equals",
      "value": "硬件故障"
    },
    {
      "field": "ticket.priority",
      "operator": "in",
      "value": [1, 2]
    }
  ],
  "actions": [
    {
      "type": "filter_engineers",
      "criteria": {
        "required_skills": ["硬件维护"],
        "max_workload": 75,
        "location_preference": "same_city"
      }
    },
    {
      "type": "sort_by",
      "field": "composite_score",
      "order": "desc"
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "规则更新成功",
  "data": {
    "rule_id": "RULE-001",
    "updated_fields": ["rule_name", "description", "actions"],
    "updated_at": "2024-08-11T16:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}

### 4.3 工程师管理

#### 获取可用工程师
- **路径**: `GET /api/v1/dispatch/engineers/available`
- **REQ-ID**: REQ-004-003
- **平台**: Web
- **权限**: dispatch_view
- **描述**: 获取当前可用的工程师列表

**查询参数**:
- `skills`: 技能要求 (逗号分隔)
- `location`: 地理位置筛选
- `max_workload`: 最大工作负载百分比 (默认: 80)
- `availability`: 可用性状态 (available, busy, offline)
- `department`: 部门筛选
- `experience_level`: 经验等级 (junior, intermediate, senior)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "available_engineers": [
      {
        "engineer_id": 1001,
        "engineer_name": "李工程师",
        "department": "运维部",
        "title": "高级运维工程师",
        "experience_years": 5,
        "skills": [
          {
            "skill_name": "Linux服务器",
            "proficiency": "expert",
            "years_experience": 5
          },
          {
            "skill_name": "邮件系统",
            "proficiency": "advanced",
            "years_experience": 3
          },
          {
            "skill_name": "硬件维护",
            "proficiency": "advanced",
            "years_experience": 4
          }
        ],
        "current_status": {
          "availability": "available",
          "current_tickets": 3,
          "workload_percentage": 65,
          "last_activity": "2024-08-11T15:30:00Z"
        },
        "location": {
          "office": "北京总部",
          "floor": "3楼",
          "contact": "13800138001"
        },
        "performance": {
          "avg_resolution_time": "4.2小时",
          "customer_satisfaction": 4.8,
          "tickets_resolved_this_month": 25
        },
        "schedule": {
          "shift": "day",
          "working_hours": "09:00-18:00",
          "timezone": "Asia/Shanghai"
        }
      },
      {
        "engineer_id": 1002,
        "engineer_name": "王工程师",
        "department": "运维部",
        "title": "运维工程师",
        "experience_years": 3,
        "skills": [
          {
            "skill_name": "Linux服务器",
            "proficiency": "advanced",
            "years_experience": 3
          },
          {
            "skill_name": "硬件维护",
            "proficiency": "intermediate",
            "years_experience": 2
          }
        ],
        "current_status": {
          "availability": "available",
          "current_tickets": 2,
          "workload_percentage": 45,
          "last_activity": "2024-08-11T15:45:00Z"
        },
        "location": {
          "office": "北京总部",
          "floor": "3楼",
          "contact": "13800138002"
        },
        "performance": {
          "avg_resolution_time": "5.1小时",
          "customer_satisfaction": 4.5,
          "tickets_resolved_this_month": 18
        },
        "schedule": {
          "shift": "day",
          "working_hours": "09:00-18:00",
          "timezone": "Asia/Shanghai"
        }
      }
    ],
    "summary": {
      "total_engineers": 15,
      "available_count": 8,
      "busy_count": 5,
      "offline_count": 2,
      "avg_workload": 62
    },
    "query_time": "2024-08-11T16:00:00Z"
  }
}
```
#### 工程师工作负载
- **路径**: `GET /api/v1/dispatch/engineers/workload`
- **REQ-ID**: REQ-004-004
- **平台**: Web
- **权限**: dispatch_view
- **描述**: 获取工程师工作负载统计信息

**查询参数**:
- `engineer_ids`: 工程师ID列表 (逗号分隔，为空则查询所有)
- `time_range`: 时间范围 (today, week, month)
- `include_forecast`: 是否包含负载预测 (默认: false)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "workload_data": [
      {
        "engineer_id": 1001,
        "engineer_name": "李工程师",
        "department": "运维部",
        "current_workload": {
          "active_tickets": 3,
          "workload_percentage": 65,
          "estimated_hours_remaining": 12,
          "priority_distribution": {
            "urgent": 1,
            "high": 1,
            "medium": 1,
            "low": 0
          }
        },
        "weekly_stats": {
          "tickets_assigned": 8,
          "tickets_completed": 5,
          "avg_resolution_time": "4.2小时",
          "total_work_hours": 32,
          "overtime_hours": 2
        },
        "capacity": {
          "max_concurrent_tickets": 5,
          "max_weekly_hours": 40,
          "current_utilization": 80,
          "available_capacity": 20
        },
        "forecast": {
          "next_week_predicted_workload": 70,
          "capacity_warning": false,
          "recommended_new_assignments": 1
        },
        "performance_trend": {
          "resolution_time_trend": "improving",
          "customer_satisfaction_trend": "stable",
          "workload_trend": "increasing"
        }
      },
      {
        "engineer_id": 1002,
        "engineer_name": "王工程师",
        "department": "运维部",
        "current_workload": {
          "active_tickets": 2,
          "workload_percentage": 45,
          "estimated_hours_remaining": 8,
          "priority_distribution": {
            "urgent": 0,
            "high": 1,
            "medium": 1,
            "low": 0
          }
        },
        "weekly_stats": {
          "tickets_assigned": 6,
          "tickets_completed": 4,
          "avg_resolution_time": "5.1小时",
          "total_work_hours": 28,
          "overtime_hours": 0
        },
        "capacity": {
          "max_concurrent_tickets": 4,
          "max_weekly_hours": 40,
          "current_utilization": 70,
          "available_capacity": 30
        },
        "forecast": {
          "next_week_predicted_workload": 55,
          "capacity_warning": false,
          "recommended_new_assignments": 2
        },
        "performance_trend": {
          "resolution_time_trend": "stable",
          "customer_satisfaction_trend": "improving",
          "workload_trend": "stable"
        }
      }
    ],
    "team_summary": {
      "total_engineers": 15,
      "avg_workload": 62,
      "total_active_tickets": 45,
      "capacity_utilization": 75,
      "workload_distribution": {
        "underutilized": 3,
        "optimal": 8,
        "overloaded": 4
      },
      "alerts": [
        {
          "type": "overload_warning",
          "engineer_id": 1003,
          "message": "工程师工作负载超过90%"
        }
      ]
    },
    "analysis_time": "2024-08-11T16:00:00Z"
  }
}

---

## 5. 知识库管理模块 (REQ-005)

### 5.1 知识文档管理

#### 创建知识文档
- **路径**: `POST /api/v1/knowledge/articles`
- **REQ-ID**: REQ-005-001
- **平台**: Web
- **权限**: kb_create
- **描述**: 创建新的知识库文档

**请求参数**:
```json
{
  "title": "邮件服务器故障排查指南",
  "content": "## 故障现象\n邮件服务器无法发送邮件...\n\n## 排查步骤\n1. 检查服务状态...",
  "category_id": 101,
  "tags": ["邮件", "服务器", "故障排查"],
  "visibility": "public",
  "author_notes": "基于实际案例总结",
  "attachments": [
    {
      "filename": "error_log_sample.txt",
      "url": "https://files.example.com/error_log_sample.txt",
      "size": 2048,
      "type": "text/plain"
    }
  ],
  "related_articles": [1002, 1003],
  "difficulty_level": "intermediate",
  "estimated_read_time": 10
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "知识文档创建成功",
  "data": {
    "article_id": 1001,
    "title": "邮件服务器故障排查指南",
    "status": "published",
    "created_at": "2024-08-11T14:30:00Z",
    "author": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "张工程师"
    },
    "view_count": 0,
    "like_count": 0
  }
}
```
#### 获取知识文档列表
- **路径**: `GET /api/v1/knowledge/articles`
- **REQ-ID**: REQ-005-002
- **平台**: Web, Mobile
- **权限**: kb_read
- **描述**: 分页查询知识库文档列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `category_id`: 分类筛选
- `tags`: 标签筛选 (逗号分隔)
- `author_id`: 作者筛选
- `visibility`: 可见性筛选 (public, internal, private)
- `difficulty_level`: 难度等级筛选
- `keyword`: 关键词搜索
- `sort`: 排序方式 (created_desc, updated_desc, view_desc, like_desc)

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "articles": [
      {
        "article_id": 1001,
        "title": "邮件服务器故障排查指南",
        "summary": "详细介绍邮件服务器常见故障的排查方法和解决方案",
        "category": {
          "category_id": 101,
          "category_name": "故障排查",
          "parent_name": "运维指南"
        },
        "author": {
          "user_id": 1001,
          "username": "engineer001",
          "real_name": "张工程师",
          "avatar": "https://avatar.example.com/1001.jpg"
        },
        "tags": ["邮件", "服务器", "故障排查"],
        "visibility": "public",
        "difficulty_level": "intermediate",
        "estimated_read_time": 10,
        "view_count": 156,
        "like_count": 23,
        "comment_count": 8,
        "created_at": "2024-08-11T14:30:00Z",
        "updated_at": "2024-08-11T16:30:00Z",
        "last_viewed_at": "2024-08-11T17:30:00Z"
      }
    ],
    "summary": {
      "total_count": 156,
      "public_count": 120,
      "internal_count": 30,
      "private_count": 6,
      "categories_count": 15
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8,
      "has_next": true,
      "has_prev": false
    }
  }
}
```
#### 获取知识文档详情
- **路径**: `GET /api/v1/knowledge/articles/{articleId}`
- **REQ-ID**: REQ-005-002
- **平台**: Web, Mobile
- **权限**: kb_read
- **描述**: 根据文档ID获取详细内容

**路径参数**:
- `articleId`: 文档ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "article_id": 1001,
    "title": "邮件服务器故障排查指南",
    "content": "## 故障现象\n邮件服务器无法发送邮件...\n\n## 排查步骤\n1. 检查服务状态...",
    "summary": "详细介绍邮件服务器常见故障的排查方法和解决方案",
    "category": {
      "category_id": 101,
      "category_name": "故障排查",
      "parent_id": 100,
      "parent_name": "运维指南",
      "path": "运维指南/故障排查"
    },
    "author": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "张工程师",
      "avatar": "https://avatar.example.com/1001.jpg",
      "department": "运维部"
    },
    "tags": ["邮件", "服务器", "故障排查"],
    "visibility": "public",
    "difficulty_level": "intermediate",
    "estimated_read_time": 10,
    "attachments": [
      {
        "attachment_id": 1001,
        "filename": "error_log_sample.txt",
        "url": "https://files.example.com/error_log_sample.txt",
        "size": 2048,
        "type": "text/plain",
        "uploaded_at": "2024-08-11T14:30:00Z"
      }
    ],
    "related_articles": [
      {
        "article_id": 1002,
        "title": "Linux系统日志分析",
        "category_name": "系统管理",
        "view_count": 89
      },
      {
        "article_id": 1003,
        "title": "网络故障诊断方法",
        "category_name": "网络管理",
        "view_count": 67
      }
    ],
    "statistics": {
      "view_count": 156,
      "like_count": 23,
      "comment_count": 8,
      "share_count": 5,
      "bookmark_count": 12
    },
    "user_interaction": {
      "is_liked": false,
      "is_bookmarked": true,
      "last_viewed_at": "2024-08-11T17:30:00Z"
    },
    "version_info": {
      "version": "1.2",
      "revision_count": 3,
      "last_editor": "李工程师"
    },
    "created_at": "2024-08-11T14:30:00Z",
    "updated_at": "2024-08-11T16:30:00Z",
    "published_at": "2024-08-11T15:00:00Z"
  }
}
```
#### 更新知识文档
- **路径**: `PUT /api/v1/knowledge/articles/{articleId}`
- **REQ-ID**: REQ-005-003
- **平台**: Web
- **权限**: kb_update
- **描述**: 更新知识库文档内容

**路径参数**:
- `articleId`: 文档ID

**请求参数**:
```json
{
  "title": "邮件服务器故障排查指南（更新版）",
  "content": "## 故障现象\n邮件服务器无法发送邮件...\n\n## 排查步骤\n1. 检查服务状态...\n\n## 新增内容\n...",
  "category_id": 101,
  "tags": ["邮件", "服务器", "故障排查", "更新"],
  "visibility": "public",
  "author_notes": "增加了新的故障案例和解决方案",
  "difficulty_level": "intermediate",
  "estimated_read_time": 12,
  "version_note": "v1.2 - 增加网络相关故障排查"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "知识文档更新成功",
  "data": {
    "article_id": 1001,
    "title": "邮件服务器故障排查指南（更新版）",
    "version": "1.2",
    "updated_at": "2024-08-11T18:30:00Z",
    "updated_by": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "张工程师"
    },
    "changes_summary": [
      "更新了标题",
      "增加了新的故障案例",
      "调整了预计阅读时间"
    ]
  }
}
```
#### 删除知识文档
- **路径**: `DELETE /api/v1/knowledge/articles/{articleId}`
- **REQ-ID**: REQ-005-004
- **平台**: Web
- **权限**: kb_delete
- **描述**: 删除知识库文档

**路径参数**:
- `articleId`: 文档ID

**请求参数**:
```json
{
  "reason": "内容过时，已有更新版本替代",
  "force": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "知识文档删除成功",
  "data": {
    "article_id": 1001,
    "title": "邮件服务器故障排查指南",
    "deleted_at": "2024-08-11T19:30:00Z",
    "deleted_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "reason": "内容过时，已有更新版本替代",
    "backup_info": {
      "backup_id": "BK-001",
      "restore_deadline": "2024-08-25T19:30:00Z"
    }
  }
}
```
### 5.2 知识搜索

#### 全文搜索
- **路径**: `GET /api/v1/knowledge/search`
- **REQ-ID**: REQ-005-005
- **平台**: Web, Mobile
- **权限**: kb_read
- **描述**: 在知识库中进行全文搜索

**查询参数**:
- `q`: 搜索关键词 (必填)
- `category_id`: 分类筛选
- `tags`: 标签筛选 (逗号分隔)
- `author_id`: 作者筛选
- `difficulty_level`: 难度等级筛选
- `date_range`: 时间范围筛选 (7d, 30d, 90d, 1y)
- `sort`: 排序方式 (relevance, created_desc, view_desc, like_desc)
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 10)

**响应示例**:
```json
{
  "code": 200,
  "message": "搜索完成",
  "data": {
    "query": "邮件服务器故障",
    "total_results": 25,
    "search_time": "0.12s",
    "results": [
      {
        "article_id": 1001,
        "title": "邮件服务器故障排查指南",
        "summary": "详细介绍邮件服务器常见故障的排查方法",
        "category_name": "故障排查",
        "author_name": "张工程师",
        "view_count": 156,
        "like_count": 23,
        "created_at": "2024-08-11T14:30:00Z",
        "highlight": {
          "title": "<em>邮件服务器故障</em>排查指南",
          "content": "详细介绍<em>邮件服务器</em>常见<em>故障</em>的排查方法和解决方案..."
        },
        "relevance_score": 95.6,
        "url": "/knowledge/articles/1001"
      },
      {
        "article_id": 1005,
        "title": "Linux邮件系统配置",
        "summary": "Linux环境下邮件系统的安装配置指南",
        "category_name": "系统配置",
        "author_name": "李工程师",
        "view_count": 89,
        "like_count": 15,
        "created_at": "2024-08-10T10:00:00Z",
        "highlight": {
          "title": "Linux<em>邮件</em>系统配置",
          "content": "Linux环境下<em>邮件</em>系统的安装配置指南..."
        },
        "relevance_score": 87.3,
        "url": "/knowledge/articles/1005"
      }
    ],
    "facets": {
      "categories": [
        {
          "category_id": 101,
          "category_name": "故障排查",
          "count": 12
        },
        {
          "category_id": 102,
          "category_name": "系统配置",
          "count": 8
        }
      ],
      "authors": [
        {
          "author_id": 1001,
          "author_name": "张工程师",
          "count": 15
        },
        {
          "author_id": 1002,
          "author_name": "李工程师",
          "count": 10
        }
      ],
      "tags": [
        {
          "tag": "邮件",
          "count": 20
        },
        {
          "tag": "服务器",
          "count": 18
        }
      ]
    },
    "suggestions": [
      "邮件服务器配置",
      "邮件服务器监控",
      "邮件服务器备份"
    ],
    "pagination": {
      "page": 1,
      "size": 10,
      "total": 25,
      "pages": 3
    }
  }
}
```
#### 智能推荐
- **路径**: `GET /api/v1/knowledge/recommendations`
- **REQ-ID**: REQ-005-006
- **平台**: Web, Mobile
- **权限**: kb_read
- **描述**: 基于用户行为和内容相似度的智能推荐

**查询参数**:
- `context`: 推荐上下文 (ticket, search, reading, profile)
- `context_id`: 上下文ID (如工单ID)
- `limit`: 推荐数量 (默认: 5, 最大: 20)
- `user_id`: 指定用户ID (管理员权限)
- `include_reasons`: 是否包含推荐理由 (默认: true)

**响应示例**:
```json
{
  "code": 200,
  "message": "推荐获取成功",
  "data": {
    "context": "ticket",
    "context_id": 12345,
    "recommendations": [
      {
        "article_id": 1001,
        "title": "邮件服务器故障排查指南",
        "summary": "详细介绍邮件服务器常见故障的排查方法",
        "category_name": "故障排查",
        "author_name": "张工程师",
        "view_count": 156,
        "like_count": 23,
        "relevance_score": 92.5,
        "recommendation_reason": "与当前工单故障类型高度匹配",
        "match_factors": [
          "关键词匹配: 邮件服务器",
          "故障类型匹配: 硬件故障",
          "历史解决方案相似度: 85%"
        ],
        "estimated_help_score": 4.6,
        "url": "/knowledge/articles/1001"
      },
      {
        "article_id": 1008,
        "title": "服务器硬件故障诊断流程",
        "summary": "系统性的服务器硬件故障诊断方法",
        "category_name": "硬件维护",
        "author_name": "王工程师",
        "view_count": 134,
        "like_count": 19,
        "relevance_score": 88.3,
        "recommendation_reason": "硬件故障诊断流程相关",
        "match_factors": [
          "故障类型匹配: 硬件故障",
          "诊断流程相似度: 78%",
          "用户历史偏好匹配"
        ],
        "estimated_help_score": 4.4,
        "url": "/knowledge/articles/1008"
      }
    ],
    "algorithm_info": {
      "version": "v2.1.0",
      "factors_used": [
        "content_similarity",
        "user_behavior",
        "collaborative_filtering",
        "context_matching"
      ],
      "confidence_score": 89.2
    },
    "user_feedback": {
      "can_rate": true,
      "feedback_url": "/api/v1/knowledge/recommendations/feedback"
    },
    "generated_at": "2024-08-11T18:00:00Z"
  }
}
```
### 5.3 知识分类

#### 获取分类树
- **路径**: `GET /api/v1/knowledge/categories`
- **REQ-ID**: REQ-005-007
- **平台**: Web, Mobile
- **权限**: kb_read
- **描述**: 获取知识库分类树结构

**查询参数**:
- `include_count`: 是否包含文档数量统计 (默认: true)
- `include_empty`: 是否包含空分类 (默认: false)
- `max_depth`: 最大层级深度 (默认: 无限制)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "categories": [
      {
        "category_id": 100,
        "category_name": "运维指南",
        "description": "运维相关的操作指南和最佳实践",
        "parent_id": null,
        "level": 1,
        "sort_order": 1,
        "icon": "guide",
        "color": "#1890ff",
        "article_count": 45,
        "total_article_count": 89,
        "children": [
          {
            "category_id": 101,
            "category_name": "故障排查",
            "description": "各类系统故障的排查方法",
            "parent_id": 100,
            "level": 2,
            "sort_order": 1,
            "icon": "bug",
            "color": "#ff4d4f",
            "article_count": 25,
            "total_article_count": 25,
            "children": []
          },
          {
            "category_id": 102,
            "category_name": "系统配置",
            "description": "系统安装配置相关文档",
            "parent_id": 100,
            "level": 2,
            "sort_order": 2,
            "icon": "setting",
            "color": "#52c41a",
            "article_count": 19,
            "total_article_count": 19,
            "children": []
          }
        ]
      },
      {
        "category_id": 200,
        "category_name": "开发文档",
        "description": "开发相关的技术文档",
        "parent_id": null,
        "level": 1,
        "sort_order": 2,
        "icon": "code",
        "color": "#722ed1",
        "article_count": 32,
        "total_article_count": 67,
        "children": [
          {
            "category_id": 201,
            "category_name": "API文档",
            "description": "系统API接口文档",
            "parent_id": 200,
            "level": 2,
            "sort_order": 1,
            "icon": "api",
            "color": "#13c2c2",
            "article_count": 35,
            "total_article_count": 35,
            "children": []
          }
        ]
      }
    ],
    "statistics": {
      "total_categories": 5,
      "max_depth": 2,
      "total_articles": 156,
      "last_updated": "2024-08-11T17:30:00Z"
    }
  }
}
```
#### 创建分类
- **路径**: `POST /api/v1/knowledge/categories`
- **REQ-ID**: REQ-005-007
- **平台**: Web
- **权限**: kb_category_manage
- **描述**: 创建新的知识库分类

**请求参数**:
```json
{
  "category_name": "网络管理",
  "description": "网络设备配置和故障处理相关文档",
  "parent_id": 100,
  "sort_order": 3,
  "icon": "network",
  "color": "#fa8c16",
  "visibility": "public",
  "permissions": {
    "read_roles": ["engineer", "admin"],
    "write_roles": ["admin"],
    "manage_roles": ["admin"]
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "分类创建成功",
  "data": {
    "category_id": 103,
    "category_name": "网络管理",
    "parent_id": 100,
    "level": 2,
    "sort_order": 3,
    "full_path": "运维指南/网络管理",
    "created_at": "2024-08-11T19:00:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 更新分类
- **路径**: `PUT /api/v1/knowledge/categories/{categoryId}`
- **REQ-ID**: REQ-005-007
- **平台**: Web
- **权限**: kb_category_manage
- **描述**: 更新知识库分类信息

**路径参数**:
- `categoryId`: 分类ID

**请求参数**:
```json
{
  "category_name": "网络管理与监控",
  "description": "网络设备配置、故障处理和监控相关文档",
  "sort_order": 3,
  "icon": "network",
  "color": "#fa8c16",
  "visibility": "public"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "分类更新成功",
  "data": {
    "category_id": 103,
    "category_name": "网络管理与监控",
    "updated_fields": ["category_name", "description"],
    "updated_at": "2024-08-11T19:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 删除分类
- **路径**: `DELETE /api/v1/knowledge/categories/{categoryId}`
- **REQ-ID**: REQ-005-007
- **平台**: Web
- **权限**: kb_category_manage
- **描述**: 删除知识库分类

**路径参数**:
- `categoryId`: 分类ID

**请求参数**:
```json
{
  "move_articles_to": 101,
  "reason": "分类重组，合并到故障排查分类",
  "force": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "分类删除成功",
  "data": {
    "category_id": 103,
    "category_name": "网络管理与监控",
    "deleted_at": "2024-08-11T20:00:00Z",
    "deleted_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "affected_articles": {
      "moved_count": 8,
      "target_category": {
        "category_id": 101,
        "category_name": "故障排查"
      }
    },
    "reason": "分类重组，合并到故障排查分类"
  }
}
```
---

## 6. 资产管理模块 (REQ-006)

### 6.1 工程师档案管理

#### 创建工程师档案
- **路径**: `POST /api/v1/engineers`
- **REQ-ID**: REQ-006-001
- **平台**: Web
- **权限**: engineer_create
- **描述**: 创建新的工程师档案信息

**请求参数**:
```json
{
  "employee_no": "ENG001",
  "real_name": "张三",
  "gender": 1,
  "birth_date": "1990-05-15",
  "phone": "13800138000",
  "email": "zhangsan@company.com",
  "department_id": 101,
  "position": "运维工程师",
  "level": 2,
  "hire_date": "2024-08-01",
  "work_location": "北京总部",
  "skills": [
    {
      "skill_code": "linux",
      "skill_level": 3,
      "experience_years": 3.5
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "engineer_id": 1001,
    "employee_no": "ENG001",
    "real_name": "张三",
    "status": "active",
    "created_at": "2024-08-11T14:30:00Z"
  }
}
```
#### 获取工程师档案
- **路径**: `GET /api/v1/engineers/{engineerId}`
- **REQ-ID**: REQ-006-001
- **平台**: Web, Mobile
- **权限**: engineer_read
- **描述**: 根据工程师ID获取详细档案信息

**路径参数**:
- `engineerId`: 工程师ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "engineer_id": 1001,
    "employee_no": "ENG001",
    "real_name": "张三",
    "gender": 1,
    "birth_date": "1990-05-15",
    "age": 34,
    "phone": "13800138000",
    "email": "zhangsan@company.com",
    "department": {
      "department_id": 101,
      "department_name": "运维部",
      "parent_name": "技术部"
    },
    "position": "运维工程师",
    "level": 2,
    "level_name": "中级工程师",
    "hire_date": "2024-08-01",
    "work_years": 0.5,
    "work_location": "北京总部",
    "status": "active",
    "avatar": "https://avatar.example.com/1001.jpg",
    "skills": [
      {
        "skill_id": 1,
        "skill_code": "linux",
        "skill_name": "Linux系统管理",
        "skill_level": 3,
        "skill_level_name": "熟练",
        "experience_years": 3.5,
        "certification": "RHCE",
        "last_updated": "2024-08-11T14:30:00Z"
      },
      {
        "skill_id": 2,
        "skill_code": "docker",
        "skill_name": "Docker容器技术",
        "skill_level": 2,
        "skill_level_name": "一般",
        "experience_years": 1.5,
        "certification": null,
        "last_updated": "2024-08-11T14:30:00Z"
      }
    ],
    "current_status": {
      "work_status": "available",
      "location": {
        "latitude": 39.9042,
        "longitude": 116.4074,
        "address": "北京市朝阳区",
        "updated_at": "2024-08-11T09:00:00Z"
      },
      "workload": {
        "active_tickets": 3,
        "workload_percentage": 65,
        "last_updated": "2024-08-11T18:00:00Z"
      }
    },
    "performance": {
      "total_tickets_resolved": 156,
      "avg_resolution_time": "4.2小时",
      "customer_satisfaction": 4.8,
      "this_month_tickets": 25,
      "last_performance_review": "2024-07-01T00:00:00Z"
    },
    "contact_info": {
      "emergency_contact": "李四",
      "emergency_phone": "13900139000",
      "address": "北京市海淀区xxx小区"
    },
    "created_at": "2024-08-01T10:00:00Z",
    "updated_at": "2024-08-11T14:30:00Z",
    "last_login": "2024-08-11T08:30:00Z"
  }
}
```
#### 更新工程师档案
- **路径**: `PUT /api/v1/engineers/{engineerId}`
- **REQ-ID**: REQ-006-001
- **平台**: Web
- **权限**: engineer_update
- **描述**: 更新工程师档案信息

**路径参数**:
- `engineerId`: 工程师ID

**请求参数**:
```json
{
  "real_name": "张三丰",
  "phone": "13800138001",
  "email": "zhangsanfeng@company.com",
  "department_id": 102,
  "position": "高级运维工程师",
  "level": 3,
  "work_location": "北京总部3楼",
  "contact_info": {
    "emergency_contact": "李四",
    "emergency_phone": "13900139000",
    "address": "北京市海淀区xxx小区xxx号"
  },
  "update_reason": "职位晋升"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "档案更新成功",
  "data": {
    "engineer_id": 1001,
    "updated_fields": ["real_name", "phone", "department_id", "position", "level", "work_location", "contact_info"],
    "updated_at": "2024-08-11T20:00:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "update_reason": "职位晋升",
    "approval_required": false
  }
}
```
#### 工程师列表查询
- **路径**: `GET /api/v1/engineers`
- **REQ-ID**: REQ-006-001
- **平台**: Web
- **权限**: engineer_read
- **描述**: 分页查询工程师档案列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `department_id`: 部门筛选
- `skill_code`: 技能筛选
- `status`: 状态筛选 (active, inactive, on_leave)
- `level`: 级别筛选 (1-初级, 2-中级, 3-高级, 4-专家)
- `work_location`: 工作地点筛选
- `keyword`: 关键词搜索 (姓名、工号、邮箱)
- `sort`: 排序方式 (name_asc, hire_date_desc, level_desc)

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "engineers": [
      {
        "engineer_id": 1001,
        "employee_no": "ENG001",
        "real_name": "张三",
        "avatar": "https://avatar.example.com/1001.jpg",
        "department": {
          "department_id": 101,
          "department_name": "运维部"
        },
        "position": "运维工程师",
        "level": 2,
        "level_name": "中级工程师",
        "work_location": "北京总部",
        "status": "active",
        "phone": "13800138000",
        "email": "zhangsan@company.com",
        "hire_date": "2024-08-01",
        "work_years": 0.5,
        "primary_skills": ["Linux系统管理", "Docker容器技术"],
        "current_workload": 65,
        "performance_score": 4.8,
        "last_login": "2024-08-11T08:30:00Z"
      },
      {
        "engineer_id": 1002,
        "employee_no": "ENG002",
        "real_name": "李四",
        "avatar": "https://avatar.example.com/1002.jpg",
        "department": {
          "department_id": 101,
          "department_name": "运维部"
        },
        "position": "高级运维工程师",
        "level": 3,
        "level_name": "高级工程师",
        "work_location": "北京总部",
        "status": "active",
        "phone": "13800138001",
        "email": "lisi@company.com",
        "hire_date": "2023-05-15",
        "work_years": 1.3,
        "primary_skills": ["Kubernetes", "云平台管理", "自动化运维"],
        "current_workload": 78,
        "performance_score": 4.9,
        "last_login": "2024-08-11T09:15:00Z"
      }
    ],
    "summary": {
      "total_count": 25,
      "active_count": 23,
      "inactive_count": 1,
      "on_leave_count": 1,
      "department_distribution": {
        "运维部": 15,
        "开发部": 8,
        "测试部": 2
      },
      "level_distribution": {
        "初级": 8,
        "中级": 12,
        "高级": 4,
        "专家": 1
      }
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 25,
      "pages": 2,
      "has_next": true,
      "has_prev": false
    }
  }
}
```
### 6.2 技能管理

#### 获取技能列表
- **路径**: `GET /api/v1/engineers/skills`
- **REQ-ID**: REQ-006-002
- **平台**: Web
- **权限**: skill_read
- **描述**: 获取系统技能字典

**查询参数**:
- `category`: 技能分类筛选 (system, network, database, cloud, security)
- `level`: 技能等级筛选 (1-入门, 2-一般, 3-熟练, 4-精通, 5-专家)
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "skills": [
      {
        "skill_id": 1,
        "skill_code": "linux",
        "skill_name": "Linux系统管理",
        "category": "system",
        "category_name": "系统管理",
        "description": "Linux操作系统的安装、配置、维护和故障排查",
        "required_certifications": ["RHCE", "LPIC"],
        "learning_resources": [
          {
            "type": "book",
            "title": "Linux系统管理技术手册",
            "url": "https://example.com/linux-book"
          },
          {
            "type": "course",
            "title": "Linux运维实战课程",
            "url": "https://example.com/linux-course"
          }
        ],
        "skill_levels": [
          {
            "level": 1,
            "level_name": "入门",
            "description": "了解基本命令和操作"
          },
          {
            "level": 2,
            "level_name": "一般",
            "description": "能够进行日常维护操作"
          },
          {
            "level": 3,
            "level_name": "熟练",
            "description": "能够独立解决常见问题"
          },
          {
            "level": 4,
            "level_name": "精通",
            "description": "能够进行系统优化和高级配置"
          },
          {
            "level": 5,
            "level_name": "专家",
            "description": "能够解决复杂问题并指导他人"
          }
        ],
        "engineer_count": 18,
        "avg_level": 2.8,
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-08-01T10:00:00Z"
      }
    ],
    "categories": [
      {
        "category": "system",
        "category_name": "系统管理",
        "skill_count": 8,
        "description": "操作系统相关技能"
      },
      {
        "category": "network",
        "category_name": "网络管理",
        "skill_count": 6,
        "description": "网络设备和协议相关技能"
      }
    ],
    "statistics": {
      "total_skills": 45,
      "active_skills": 42,
      "most_popular_skills": [
        {
          "skill_name": "Linux系统管理",
          "engineer_count": 18
        },
        {
          "skill_name": "Docker容器技术",
          "engineer_count": 15
        }
      ]
    }
  }
}
```
#### 更新工程师技能
- **路径**: `PUT /api/v1/engineers/{engineerId}/skills`
- **REQ-ID**: REQ-006-002
- **平台**: Web, Mobile
- **权限**: skill_update
- **描述**: 更新工程师技能信息

**路径参数**:
- `engineerId`: 工程师ID

**请求参数**:
```json
{
  "skills": [
    {
      "skill_code": "linux",
      "skill_level": 4,
      "experience_years": 5.0,
      "certification": "RHCE",
      "certification_date": "2023-06-15",
      "notes": "通过RHCE认证，具备高级系统管理能力"
    },
    {
      "skill_code": "docker",
      "skill_level": 3,
      "experience_years": 2.5,
      "certification": null,
      "notes": "在多个项目中使用Docker进行容器化部署"
    },
    {
      "skill_code": "kubernetes",
      "skill_level": 2,
      "experience_years": 1.0,
      "certification": null,
      "notes": "正在学习K8s集群管理"
    }
  ],
  "update_reason": "技能评估更新"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "技能更新成功",
  "data": {
    "engineer_id": 1001,
    "updated_skills": [
      {
        "skill_code": "linux",
        "old_level": 3,
        "new_level": 4,
        "level_change": "+1"
      },
      {
        "skill_code": "kubernetes",
        "old_level": null,
        "new_level": 2,
        "level_change": "新增"
      }
    ],
    "skill_summary": {
      "total_skills": 3,
      "avg_level": 3.0,
      "certifications_count": 1,
      "skill_score": 85.5
    },
    "updated_at": "2024-08-11T21:00:00Z",
    "updated_by": {
      "user_id": 1001,
      "username": "engineer001",
      "real_name": "张三"
    },
    "update_reason": "技能评估更新",
    "next_evaluation_date": "2025-02-11T00:00:00Z"
  }
}
```
### 6.3 排班管理

#### 获取排班计划
- **路径**: `GET /api/v1/engineers/schedules`
- **REQ-ID**: REQ-006-003
- **平台**: Web, Mobile
- **权限**: schedule_read
- **描述**: 获取工程师排班计划

**查询参数**:
- `engineer_id`: 工程师ID (为空则查询所有)
- `date_start`: 开始日期 (YYYY-MM-DD)
- `date_end`: 结束日期 (YYYY-MM-DD)
- `shift_type`: 班次类型 (day, night, standby)
- `department_id`: 部门筛选
- `view_type`: 视图类型 (calendar, list)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "schedules": [
      {
        "schedule_id": "SCH-001",
        "engineer": {
          "engineer_id": 1001,
          "real_name": "张三",
          "employee_no": "ENG001",
          "department_name": "运维部",
          "phone": "13800138000"
        },
        "date": "2024-08-12",
        "shift_type": "day",
        "shift_name": "白班",
        "start_time": "09:00",
        "end_time": "18:00",
        "work_hours": 8,
        "location": "北京总部",
        "status": "confirmed",
        "responsibilities": [
          "系统监控",
          "故障处理",
          "日常维护"
        ],
        "backup_engineer": {
          "engineer_id": 1002,
          "real_name": "李四"
        },
        "notes": "负责邮件服务器维护",
        "created_at": "2024-08-01T10:00:00Z",
        "created_by": "调度员"
      },
      {
        "schedule_id": "SCH-002",
        "engineer": {
          "engineer_id": 1002,
          "real_name": "李四",
          "employee_no": "ENG002",
          "department_name": "运维部",
          "phone": "13800138001"
        },
        "date": "2024-08-12",
        "shift_type": "night",
        "shift_name": "夜班",
        "start_time": "22:00",
        "end_time": "06:00",
        "work_hours": 8,
        "location": "北京总部",
        "status": "confirmed",
        "responsibilities": [
          "夜间监控",
          "紧急故障处理"
        ],
        "backup_engineer": {
          "engineer_id": 1003,
          "real_name": "王五"
        },
        "notes": "夜间值班",
        "created_at": "2024-08-01T10:00:00Z",
        "created_by": "调度员"
      }
    ],
    "summary": {
      "total_schedules": 45,
      "date_range": {
        "start_date": "2024-08-12",
        "end_date": "2024-08-18"
      },
      "shift_distribution": {
        "day": 25,
        "night": 15,
        "standby": 5
      },
      "coverage_rate": 98.5,
      "conflicts": []
    },
    "calendar_view": {
      "weeks": [
        {
          "week_start": "2024-08-12",
          "days": [
            {
              "date": "2024-08-12",
              "day_name": "周一",
              "shifts": [
                {
                  "shift_type": "day",
                  "engineers": ["张三", "王五"],
                  "coverage": "full"
                },
                {
                  "shift_type": "night",
                  "engineers": ["李四"],
                  "coverage": "full"
                }
              ]
            }
          ]
        }
      ]
    }
  }
}
#### 创建排班计划
- **路径**: `POST /api/v1/engineers/schedules`
- **REQ-ID**: REQ-006-003
- **平台**: Web
- **权限**: schedule_create
- **描述**: 创建工程师排班计划

**请求参数**:
```json
{
  "schedules": [
    {
      "engineer_id": 1001,
      "date": "2024-08-15",
      "shift_type": "day",
      "start_time": "09:00",
      "end_time": "18:00",
      "location": "北京总部",
      "responsibilities": ["系统监控", "故障处理"],
      "backup_engineer_id": 1002,
      "notes": "负责核心系统维护"
    },
    {
      "engineer_id": 1002,
      "date": "2024-08-15",
      "shift_type": "night",
      "start_time": "22:00",
      "end_time": "06:00",
      "location": "北京总部",
      "responsibilities": ["夜间监控", "紧急故障处理"],
      "backup_engineer_id": 1003,
      "notes": "夜间值班"
    }
  ],
  "effective_date": "2024-08-15",
  "created_reason": "月度排班计划"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "排班计划创建成功",
  "data": {
    "batch_id": "BATCH-001",
    "created_schedules": [
      {
        "schedule_id": "SCH-003",
        "engineer_id": 1001,
        "engineer_name": "张三",
        "date": "2024-08-15",
        "shift_type": "day",
        "status": "confirmed"
      },
      {
        "schedule_id": "SCH-004",
        "engineer_id": 1002,
        "engineer_name": "李四",
        "date": "2024-08-15",
        "shift_type": "night",
        "status": "confirmed"
      }
    ],
    "conflicts": [],
    "warnings": [
      {
        "type": "workload_warning",
        "engineer_id": 1001,
        "message": "该工程师本周工作时间已达40小时"
      }
    ],
    "created_at": "2024-08-11T22:00:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "调度员"
    }
  }
}
```
#### 申请调班
- **路径**: `POST /api/v1/engineers/schedules/swap`
- **REQ-ID**: REQ-006-003
- **平台**: Web, Mobile
- **权限**: schedule_swap
- **描述**: 工程师申请调班

**请求参数**:
```json
{
  "original_schedule_id": "SCH-003",
  "target_engineer_id": 1002,
  "target_schedule_id": "SCH-004",
  "swap_type": "exchange",
  "reason": "个人事务需要调整班次",
  "notes": "希望与李四交换8月15日的班次",
  "urgent": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "调班申请提交成功",
  "data": {
    "swap_request_id": "SWAP-001",
    "status": "pending_approval",
    "original_schedule": {
      "schedule_id": "SCH-003",
      "engineer_name": "张三",
      "date": "2024-08-15",
      "shift_type": "day"
    },
    "target_schedule": {
      "schedule_id": "SCH-004",
      "engineer_name": "李四",
      "date": "2024-08-15",
      "shift_type": "night"
    },
    "approval_required": true,
    "approvers": [
      {
        "user_id": 3001,
        "real_name": "部门主管",
        "role": "department_manager"
      }
    ],
    "estimated_approval_time": "2024-08-12T10:00:00Z",
    "created_at": "2024-08-11T22:30:00Z"
  }
}
```
### 6.4 状态跟踪

#### 更新工程师状态
- **路径**: `PUT /api/v1/engineers/{engineerId}/status`
- **REQ-ID**: REQ-006-004
- **平台**: Web, Mobile
- **权限**: engineer_status
- **描述**: 更新工程师工作状态

**路径参数**:
- `engineerId`: 工程师ID

**请求参数**:
```json
{
  "work_status": "available",
  "location": {
    "latitude": 39.9042,
    "longitude": 116.4074,
    "address": "北京市朝阳区建国门外大街",
    "accuracy": 10
  },
  "notes": "准备接单，当前在客户现场",
  "estimated_available_until": "2024-08-11T18:00:00Z"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "状态更新成功",
  "data": {
    "engineer_id": 1001,
    "work_status": "available",
    "previous_status": "busy",
    "location": {
      "latitude": 39.9042,
      "longitude": 116.4074,
      "address": "北京市朝阳区建国门外大街",
      "accuracy": 10,
      "updated_at": "2024-08-11T16:30:00Z"
    },
    "status_duration": "2小时15分钟",
    "notes": "准备接单，当前在客户现场",
    "estimated_available_until": "2024-08-11T18:00:00Z",
    "updated_at": "2024-08-11T16:30:00Z",
    "next_scheduled_task": {
      "task_id": "TASK-005",
      "scheduled_time": "2024-08-11T19:00:00Z",
      "description": "定期巡检"
    }
  }
}
```
#### 获取工程师状态
- **路径**: `GET /api/v1/engineers/{engineerId}/status`
- **REQ-ID**: REQ-006-004
- **平台**: Web, Mobile
- **权限**: engineer_read
- **描述**: 获取工程师当前状态

**路径参数**:
- `engineerId`: 工程师ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "engineer_id": 1001,
    "real_name": "张三",
    "current_status": {
      "work_status": "available",
      "status_name": "可接单",
      "status_since": "2024-08-11T16:30:00Z",
      "status_duration": "2小时15分钟"
    },
    "location": {
      "latitude": 39.9042,
      "longitude": 116.4074,
      "address": "北京市朝阳区建国门外大街",
      "accuracy": 10,
      "last_updated": "2024-08-11T16:30:00Z",
      "distance_from_office": "5.2公里"
    },
    "workload": {
      "active_tickets": 2,
      "pending_tasks": 1,
      "workload_percentage": 45,
      "estimated_free_time": "2024-08-11T20:00:00Z"
    },
    "schedule": {
      "current_shift": {
        "shift_type": "day",
        "start_time": "09:00",
        "end_time": "18:00",
        "remaining_hours": 1.5
      },
      "next_shift": {
        "date": "2024-08-12",
        "shift_type": "day",
        "start_time": "09:00"
      }
    },
    "contact_info": {
      "phone": "13800138000",
      "last_contact": "2024-08-11T15:45:00Z",
      "response_rate": 98
    },
    "notes": "准备接单，当前在客户现场",
    "last_activity": "2024-08-11T16:30:00Z"
  }
}
```
### 6.5 考勤管理

#### 工程师签到
- **路径**: `POST /api/v1/engineers/attendance/checkin`
- **REQ-ID**: REQ-006-006
- **平台**: Mobile
- **权限**: attendance_checkin
- **描述**: 工程师签到打卡

**请求参数**:
```json
{
  "location": {
    "latitude": 39.9042,
    "longitude": 116.4074,
    "address": "北京市朝阳区公司总部",
    "accuracy": 5
  },
  "checkin_type": "normal",
  "device_info": {
    "device_id": "DEVICE-001",
    "device_type": "mobile",
    "app_version": "1.2.0"
  },
  "notes": "正常上班打卡"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "签到成功",
  "data": {
    "attendance_id": "ATT-001",
    "engineer_id": 1001,
    "engineer_name": "张三",
    "checkin_time": "2024-08-12T09:05:00Z",
    "checkin_type": "normal",
    "location": {
      "latitude": 39.9042,
      "longitude": 116.4074,
      "address": "北京市朝阳区公司总部",
      "distance_from_office": "50米"
    },
    "status": "on_time",
    "scheduled_time": "09:00",
    "late_minutes": 5,
    "work_day_info": {
      "date": "2024-08-12",
      "shift_type": "day",
      "expected_work_hours": 8
    },
    "notes": "正常上班打卡"
  }
}
```
#### 工程师签退
- **路径**: `POST /api/v1/engineers/attendance/checkout`
- **REQ-ID**: REQ-006-006
- **平台**: Mobile
- **权限**: attendance_checkout
- **描述**: 工程师签退打卡

**请求参数**:
```json
{
  "location": {
    "latitude": 39.9042,
    "longitude": 116.4074,
    "address": "北京市朝阳区公司总部",
    "accuracy": 5
  },
  "checkout_type": "normal",
  "work_summary": "完成了2个工单处理，参与了1次技术讨论",
  "overtime_reason": null,
  "notes": "正常下班"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "签退成功",
  "data": {
    "attendance_id": "ATT-001",
    "engineer_id": 1001,
    "engineer_name": "张三",
    "checkout_time": "2024-08-12T18:10:00Z",
    "checkout_type": "normal",
    "work_duration": "9小时5分钟",
    "scheduled_duration": "8小时",
    "overtime_duration": "1小时5分钟",
    "location": {
      "latitude": 39.9042,
      "longitude": 116.4074,
      "address": "北京市朝阳区公司总部",
      "distance_from_office": "30米"
    },
    "work_summary": "完成了2个工单处理，参与了1次技术讨论",
    "daily_stats": {
      "tickets_completed": 2,
      "meetings_attended": 1,
      "break_time": "1小时",
      "productivity_score": 85
    },
    "notes": "正常下班"
  }
}
```
#### 考勤记录查询
- **路径**: `GET /api/v1/engineers/attendance`
- **REQ-ID**: REQ-006-006
- **平台**: Web, Mobile
- **权限**: attendance_read
- **描述**: 查询考勤记录

**查询参数**:
- `engineer_id`: 工程师ID (为空则查询所有)
- `date_start`: 开始日期 (YYYY-MM-DD)
- `date_end`: 结束日期 (YYYY-MM-DD)
- `status`: 考勤状态 (on_time, late, early_leave, absent, overtime)
- `department_id`: 部门筛选
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "attendance_records": [
      {
        "attendance_id": "ATT-001",
        "engineer": {
          "engineer_id": 1001,
          "real_name": "张三",
          "employee_no": "ENG001",
          "department_name": "运维部"
        },
        "date": "2024-08-12",
        "shift_info": {
          "shift_type": "day",
          "scheduled_start": "09:00",
          "scheduled_end": "18:00",
          "scheduled_hours": 8
        },
        "checkin": {
          "time": "2024-08-12T09:05:00Z",
          "status": "late",
          "late_minutes": 5,
          "location": "北京市朝阳区公司总部"
        },
        "checkout": {
          "time": "2024-08-12T18:10:00Z",
          "status": "overtime",
          "overtime_minutes": 10,
          "location": "北京市朝阳区公司总部"
        },
        "work_duration": "9小时5分钟",
        "break_duration": "1小时",
        "effective_work_hours": 8.08,
        "overtime_hours": 1.08,
        "status": "normal",
        "work_summary": "完成了2个工单处理，参与了1次技术讨论",
        "productivity_score": 85,
        "notes": "正常工作日"
      },
      {
        "attendance_id": "ATT-002",
        "engineer": {
          "engineer_id": 1001,
          "real_name": "张三",
          "employee_no": "ENG001",
          "department_name": "运维部"
        },
        "date": "2024-08-11",
        "shift_info": {
          "shift_type": "day",
          "scheduled_start": "09:00",
          "scheduled_end": "18:00",
          "scheduled_hours": 8
        },
        "checkin": {
          "time": "2024-08-11T08:55:00Z",
          "status": "on_time",
          "early_minutes": 5,
          "location": "北京市朝阳区公司总部"
        },
        "checkout": {
          "time": "2024-08-11T18:00:00Z",
          "status": "on_time",
          "location": "北京市朝阳区公司总部"
        },
        "work_duration": "9小时5分钟",
        "break_duration": "1小时",
        "effective_work_hours": 8.0,
        "overtime_hours": 0,
        "status": "perfect",
        "work_summary": "处理紧急故障，完成系统维护",
        "productivity_score": 92,
        "notes": "表现优秀"
      }
    ],
    "summary": {
      "total_records": 22,
      "date_range": {
        "start_date": "2024-08-01",
        "end_date": "2024-08-12"
      },
      "statistics": {
        "total_work_days": 10,
        "on_time_days": 8,
        "late_days": 2,
        "absent_days": 0,
        "total_work_hours": 82.5,
        "total_overtime_hours": 8.5,
        "avg_daily_hours": 8.25,
        "attendance_rate": 100,
        "punctuality_rate": 80
      },
      "status_distribution": {
        "perfect": 6,
        "normal": 3,
        "late": 1,
        "early_leave": 0,
        "absent": 0
      }
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 22,
      "pages": 2,
      "has_next": true,
      "has_prev": false
    }
  }
}
```
---

## 6B. 工程师高级管理模块 (REQ-006B)

### 6B.1 绩效评估管理

#### 创建绩效评估
- **路径**: `POST /api/v1/hr/performance-evaluations`
- **REQ-ID**: REQ-006B-001
- **平台**: Web
- **权限**: hr_performance_create
- **描述**: 创建工程师绩效评估

**请求参数**:
```json
{
  "employee_id": 1001,
  "evaluation_period": "2024Q3",
  "evaluation_type": 2,
  "evaluation_criteria": [
    {
      "criteria_name": "工作质量",
      "weight": 30,
      "description": "工单处理质量和客户满意度"
    },
    {
      "criteria_name": "工作效率",
      "weight": 25,
      "description": "工单处理速度和响应时间"
    },
    {
      "criteria_name": "团队协作",
      "weight": 20,
      "description": "团队合作和沟通能力"
    },
    {
      "criteria_name": "技术能力",
      "weight": 25,
      "description": "专业技能和学习能力"
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "绩效评估创建成功",
  "data": {
    "evaluation_id": 12345,
    "employee_name": "张工程师",
    "evaluation_period": "2024Q3",
    "status": "in_progress",
    "deadline": "2024-10-15T23:59:59Z",
    "evaluation_url": "/hr/evaluations/12345"
  }
}
```
#### 获取绩效评估列表
- **路径**: `GET /api/v1/hr/performance-evaluations`
- **REQ-ID**: REQ-006B-001
- **平台**: Web
- **权限**: hr_performance_read
- **描述**: 分页查询绩效评估列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `employee_id`: 员工筛选
- `evaluation_period`: 评估周期筛选
- `evaluation_type`: 评估类型筛选 (1-年度, 2-季度, 3-月度)
- `status`: 状态筛选 (1-进行中, 2-已完成)
- `performance_level`: 绩效等级筛选

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "evaluations": [
      {
        "evaluation_id": 12345,
        "employee_info": {
          "employee_id": 1001,
          "employee_name": "张工程师",
          "department": "运维部",
          "position": "高级运维工程师"
        },
        "evaluation_period": "2024Q3",
        "evaluation_type": 2,
        "evaluation_type_name": "季度评估",
        "final_score": 88.5,
        "performance_level": "优秀",
        "status": 2,
        "status_name": "已完成",
        "evaluator": {
          "evaluator_id": 2001,
          "evaluator_name": "李经理"
        },
        "created_at": "2024-08-01T10:00:00Z",
        "completed_at": "2024-08-15T16:30:00Z"
      }
    ],
    "summary": {
      "total_count": 156,
      "in_progress_count": 23,
      "completed_count": 133,
      "avg_score": 85.2,
      "performance_distribution": {
        "优秀": 45,
        "良好": 78,
        "一般": 28,
        "待改进": 5
      }
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
#### 获取绩效评估详情
- **路径**: `GET /api/v1/hr/performance-evaluations/{evaluationId}`
- **REQ-ID**: REQ-006B-001
- **平台**: Web
- **权限**: hr_performance_read
- **描述**: 获取绩效评估详细信息

**路径参数**:
- `evaluationId`: 评估ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "evaluation_id": 12345,
    "employee_info": {
      "employee_id": 1001,
      "employee_name": "张工程师",
      "department": "运维部",
      "position": "高级运维工程师",
      "hire_date": "2023-01-15",
      "work_years": 1.6
    },
    "evaluation_period": "2024Q3",
    "evaluation_type": 2,
    "evaluation_type_name": "季度评估",
    "criteria_scores": [
      {
        "criteria_name": "工作质量",
        "weight": 30,
        "self_score": 85,
        "supervisor_score": 88,
        "peer_score": 87,
        "final_score": 87.2,
        "weighted_score": 26.16
      },
      {
        "criteria_name": "工作效率",
        "weight": 25,
        "self_score": 90,
        "supervisor_score": 92,
        "peer_score": 89,
        "final_score": 90.5,
        "weighted_score": 22.63
      }
    ],
    "final_score": 88.5,
    "performance_level": "优秀",
    "strengths": "技术能力强，工作效率高，团队协作良好",
    "improvements": "需要加强项目管理能力，提升沟通技巧",
    "goals_next_period": "完成项目管理培训，承担更多技术指导工作",
    "evaluator": {
      "evaluator_id": 2001,
      "evaluator_name": "李经理",
      "department": "运维部"
    },
    "status": 2,
    "status_name": "已完成",
    "created_at": "2024-08-01T10:00:00Z",
    "completed_at": "2024-08-15T16:30:00Z"
  }
}
```
### 6B.2 培训管理

#### 创建培训计划
- **路径**: `POST /api/v1/hr/training-programs`
- **REQ-ID**: REQ-006B-002
- **平台**: Web
- **权限**: hr_training_create
- **描述**: 创建培训计划

**请求参数**:
```json
{
  "program_name": "Kubernetes容器编排技术培训",
  "program_type": "技术培训",
  "description": "深入学习Kubernetes容器编排技术，提升云原生应用部署和管理能力",
  "target_audience": "运维工程师",
  "required_skills": ["Docker基础", "Linux系统管理"],
  "learning_objectives": [
    "掌握Kubernetes核心概念和架构",
    "能够独立部署和管理Kubernetes集群",
    "具备容器化应用的运维能力"
  ],
  "duration_hours": 40,
  "start_date": "2024-09-01",
  "end_date": "2024-09-15",
  "max_participants": 20,
  "instructor": "王技术专家",
  "cost_per_person": 3000,
  "certification_available": true,
  "materials": [
    {
      "type": "document",
      "title": "Kubernetes官方文档",
      "url": "https://kubernetes.io/docs/"
    },
    {
      "type": "video",
      "title": "Kubernetes实战视频教程",
      "url": "https://training.example.com/k8s-video"
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "培训计划创建成功",
  "data": {
    "program_id": 5001,
    "program_name": "Kubernetes容器编排技术培训",
    "program_code": "TRAIN-K8S-202409",
    "status": "draft",
    "created_at": "2024-08-11T14:30:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "hr_admin",
      "real_name": "HR管理员"
    },
    "enrollment_url": "/hr/training/5001/enroll"
  }
}
```
#### 获取培训计划列表
- **路径**: `GET /api/v1/hr/training-programs`
- **REQ-ID**: REQ-006B-002
- **平台**: Web
- **权限**: hr_training_read
- **描述**: 分页查询培训计划列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `program_type`: 培训类型筛选
- `status`: 状态筛选 (draft, published, in_progress, completed, cancelled)
- `target_audience`: 目标受众筛选
- `start_date_from`: 开始日期范围筛选
- `start_date_to`: 结束日期范围筛选

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "programs": [
      {
        "program_id": 5001,
        "program_name": "Kubernetes容器编排技术培训",
        "program_type": "技术培训",
        "duration_hours": 40,
        "start_date": "2024-09-01",
        "end_date": "2024-09-15",
        "instructor": "王技术专家",
        "max_participants": 20,
        "enrolled_count": 15,
        "status": "published",
        "cost_per_person": 3000,
        "certification_available": true
      }
    ],
    "summary": {
      "total_programs": 25,
      "active_programs": 8,
      "completed_programs": 15,
      "total_participants": 456,
      "avg_satisfaction": 4.6
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 25,
      "pages": 2
    }
  }
}
```
### 6B.3 职业发展管理

#### 创建职业发展计划
- **路径**: `POST /api/v1/hr/career-development-plans`
- **REQ-ID**: REQ-006B-003
- **平台**: Web
- **权限**: hr_career_create
- **描述**: 为工程师创建职业发展计划

**请求参数**:
```json
{
  "employee_id": 1001,
  "plan_name": "高级运维工程师发展计划",
  "current_position": "中级运维工程师",
  "target_position": "高级运维工程师",
  "target_timeline": "12个月",
  "development_goals": [
    {
      "goal_name": "技术能力提升",
      "description": "掌握云原生技术栈",
      "target_date": "2024-12-31",
      "priority": 1,
      "required_skills": ["Kubernetes", "Docker", "微服务架构"],
      "training_programs": [5001, 5002],
      "success_criteria": "能够独立设计和实施云原生解决方案"
    },
    {
      "goal_name": "团队领导能力",
      "description": "培养团队管理和项目协调能力",
      "target_date": "2024-10-31",
      "priority": 2,
      "required_skills": ["项目管理", "团队协作", "沟通技巧"],
      "training_programs": [5003],
      "success_criteria": "能够带领3-5人技术团队完成项目"
    }
  ],
  "mentor_id": 2001,
  "review_frequency": "monthly"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "职业发展计划创建成功",
  "data": {
    "plan_id": 3001,
    "employee_name": "张工程师",
    "plan_name": "高级运维工程师发展计划",
    "status": "active",
    "created_at": "2024-08-11T14:30:00Z",
    "next_review_date": "2024-09-11T00:00:00Z"
  }
}
```
#### 获取职业发展计划列表
- **路径**: `GET /api/v1/hr/career-development-plans`
- **REQ-ID**: REQ-006B-003
- **平台**: Web
- **权限**: hr_career_read
- **描述**: 分页查询职业发展计划列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `employee_id`: 员工筛选
- `mentor_id`: 导师筛选
- `status`: 状态筛选 (active, completed, suspended)
- `target_position`: 目标职位筛选

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "plans": [
      {
        "plan_id": 3001,
        "employee_info": {
          "employee_id": 1001,
          "employee_name": "张工程师",
          "current_position": "中级运维工程师",
          "department": "运维部"
        },
        "plan_name": "高级运维工程师发展计划",
        "target_position": "高级运维工程师",
        "target_timeline": "12个月",
        "progress_percentage": 65,
        "status": "active",
        "mentor": {
          "mentor_id": 2001,
          "mentor_name": "李经理"
        },
        "next_review_date": "2024-09-11T00:00:00Z",
        "created_at": "2024-08-11T14:30:00Z"
      }
    ],
    "summary": {
      "total_plans": 45,
      "active_plans": 32,
      "completed_plans": 10,
      "suspended_plans": 3,
      "avg_progress": 72.5
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 45,
      "pages": 3
    }
  }
}
```
### 6B.4 薪酬福利管理

#### 获取薪酬结构
- **路径**: `GET /api/v1/hr/salary-structures`
- **REQ-ID**: REQ-006B-004
- **平台**: Web
- **权限**: hr_salary_read
- **描述**: 获取薪酬结构信息

**查询参数**:
- `position_level`: 职位级别筛选
- `department_id`: 部门筛选
- `effective_date`: 生效日期

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "salary_structures": [
      {
        "structure_id": 1001,
        "position_level": "高级运维工程师",
        "department": "运维部",
        "base_salary_range": {
          "min": 15000,
          "max": 25000,
          "currency": "CNY"
        },
        "performance_bonus_rate": {
          "min": 10,
          "max": 30,
          "unit": "percentage"
        },
        "benefits": [
          {
            "benefit_type": "五险一金",
            "description": "按国家标准缴纳",
            "company_contribution": "基本工资的35%"
          },
          {
            "benefit_type": "补充医疗保险",
            "description": "覆盖家属的商业医疗保险",
            "annual_limit": 50000
          }
        ],
        "allowances": [
          {
            "allowance_type": "交通补贴",
            "amount": 500,
            "frequency": "monthly"
          },
          {
            "allowance_type": "通讯补贴",
            "amount": 200,
            "frequency": "monthly"
          }
        ],
        "effective_date": "2024-01-01T00:00:00Z"
      }
    ]
  }
}
```
---

## 7. 甲方管理与报表系统 (REQ-007)

### 7.1 甲方服务概览

#### 获取服务概览
- **路径**: `GET /api/v1/client/dashboard/overview`
- **REQ-ID**: REQ-007-001
- **平台**: Web, Mobile
- **权限**: client_overview
- **描述**: 获取甲方客户的服务状态概览

**查询参数**:
- `customer_id`: 客户ID (必填)
- `time_range`: 时间范围 (today, week, month, quarter)

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "customer_info": {
      "customer_id": 12345,
      "customer_name": "ABC科技有限公司",
      "contract_status": "active",
      "service_level": "premium",
      "contract_start": "2024-01-01T00:00:00Z",
      "contract_end": "2024-12-31T23:59:59Z"
    },
    "service_summary": {
      "total_tickets": 156,
      "pending_tickets": 12,
      "in_progress_tickets": 18,
      "resolved_tickets": 126,
      "sla_compliance": 95.6,
      "avg_resolution_time": "4.2小时",
      "customer_satisfaction": 4.8,
      "service_availability": 99.8
    },
    "key_metrics": {
      "mttr": "2.5小时",
      "mtbf": "720小时",
      "first_response_time": "15分钟",
      "resolution_rate": 98.5
    },
    "recent_activities": [
      {
        "activity_type": "ticket_resolved",
        "ticket_id": "TKT-001",
        "title": "邮件服务器故障处理",
        "priority": 2,
        "resolved_at": "2024-08-11T14:30:00Z",
        "resolution_time": "3.5小时"
      },
      {
        "activity_type": "maintenance_completed",
        "maintenance_id": "MAINT-001",
        "title": "数据库定期维护",
        "completed_at": "2024-08-11T02:00:00Z",
        "duration": "2小时"
      }
    ],
    "alerts": [
      {
        "alert_type": "sla_warning",
        "message": "工单TKT-002即将超出SLA时限",
        "severity": "warning",
        "created_at": "2024-08-11T16:00:00Z"
      }
    ],
    "updated_at": "2024-08-11T18:00:00Z"
  }
}
```
#### 获取实时监控数据
- **路径**: `GET /api/v1/client/monitoring/realtime`
- **REQ-ID**: REQ-007-002
- **平台**: Web
- **权限**: client_monitor
- **描述**: 获取实时系统监控数据

**查询参数**:
- `customer_id`: 客户ID (必填)
- `service_types`: 服务类型筛选 (逗号分隔)
- `metrics`: 指标类型筛选 (cpu, memory, disk, network)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "monitoring_data": [
      {
        "service_id": "SRV-001",
        "service_name": "邮件服务器",
        "service_type": "email",
        "status": "running",
        "health_score": 95,
        "metrics": {
          "cpu_usage": 45.6,
          "memory_usage": 68.2,
          "disk_usage": 72.1,
          "network_io": {
            "in": "125.6 MB/s",
            "out": "89.3 MB/s"
          }
        },
        "alerts": [],
        "last_updated": "2024-08-11T18:00:00Z"
      }
    ],
    "summary": {
      "total_services": 25,
      "healthy_services": 23,
      "warning_services": 2,
      "critical_services": 0,
      "overall_health": 96.8
    }
  }
}
```
### 7.2 工单跟踪管理

#### 获取工单跟踪信息
- **路径**: `GET /api/v1/client/tickets/tracking`
- **REQ-ID**: REQ-007-003
- **平台**: Web, Mobile
- **权限**: client_ticket_read
- **描述**: 甲方客户查看工单处理进度

**查询参数**:
- `customer_id`: 客户ID (必填)
- `ticket_id`: 工单ID
- `status`: 工单状态筛选
- `priority`: 优先级筛选
- `date_range`: 时间范围筛选 (today, week, month)
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "tickets": [
      {
        "ticket_id": 12345,
        "ticket_no": "TK202408110001",
        "title": "邮件服务器故障处理",
        "description": "邮件服务器无法发送邮件，影响公司正常业务运营",
        "status": "in_progress",
        "status_name": "处理中",
        "priority": 2,
        "priority_name": "高",
        "category": "硬件故障",
        "assigned_engineer": {
          "engineer_id": 1001,
          "engineer_name": "张工程师",
          "phone": "13800138000",
          "email": "zhangsan@company.com"
        },
        "created_at": "2024-08-11T10:30:00Z",
        "sla_deadline": "2024-08-12T10:30:00Z",
        "estimated_resolution": "2024-08-11T18:30:00Z",
        "progress_percentage": 75,
        "time_spent": "6.5小时",
        "remaining_time": "2小时",
        "last_update": {
          "update_time": "2024-08-11T16:30:00Z",
          "update_content": "已完成故障硬盘更换，正在进行系统恢复测试",
          "updated_by": "张工程师"
        },
        "timeline": [
          {
            "timestamp": "2024-08-11T10:30:00Z",
            "action": "工单创建",
            "description": "客户报告邮件服务器故障",
            "operator": "系统"
          },
          {
            "timestamp": "2024-08-11T10:45:00Z",
            "action": "工单分配",
            "description": "分配给张工程师处理",
            "operator": "调度系统"
          },
          {
            "timestamp": "2024-08-11T11:00:00Z",
            "action": "开始处理",
            "description": "工程师开始现场排查",
            "operator": "张工程师"
          }
        ]
      }
    ],
    "summary": {
      "total_tickets": 156,
      "pending_tickets": 12,
      "in_progress_tickets": 18,
      "resolved_tickets": 126,
      "avg_resolution_time": "4.2小时",
      "sla_compliance": 95.6
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
### 7.3 SLA监控管理

#### 获取SLA监控数据
- **路径**: `GET /api/v1/client/sla/monitoring`
- **REQ-ID**: REQ-007-004
- **平台**: Web
- **权限**: client_sla_read
- **描述**: 获取SLA达成情况和监控数据

**查询参数**:
- `customer_id`: 客户ID (必填)
- `period`: 统计周期 (monthly, quarterly, yearly)
- `service_type`: 服务类型筛选
- `sla_type`: SLA类型筛选 (availability, response_time, resolution_time)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "sla_overview": {
      "overall_compliance": 96.8,
      "target_compliance": 99.0,
      "period": "2024年8月",
      "total_incidents": 8,
      "sla_breaches": 2
    },
    "sla_metrics": [
      {
        "sla_type": "availability",
        "sla_name": "服务可用性",
        "target_value": 99.5,
        "actual_value": 99.2,
        "compliance": 99.7,
        "status": "warning",
        "unit": "percentage",
        "trend": "stable"
      },
      {
        "sla_type": "response_time",
        "sla_name": "首次响应时间",
        "target_value": 30,
        "actual_value": 15,
        "compliance": 100,
        "status": "good",
        "unit": "minutes",
        "trend": "improving"
      },
      {
        "sla_type": "resolution_time",
        "sla_name": "问题解决时间",
        "target_value": 8,
        "actual_value": 4.2,
        "compliance": 100,
        "status": "excellent",
        "unit": "hours",
        "trend": "improving"
      }
    ],
    "breach_details": [
      {
        "breach_id": "BR-001",
        "incident_id": "INC-001",
        "sla_type": "availability",
        "breach_duration": "45分钟",
        "impact": "medium",
        "root_cause": "硬件故障",
        "occurred_at": "2024-08-15T14:30:00Z"
      }
    ]
  }
}
```
#### SLA告警通知
- **路径**: `GET /api/v1/client/sla/alerts`
- **REQ-ID**: REQ-007-004
- **平台**: Web, Mobile
- **权限**: client_sla_read
- **描述**: 获取SLA相关告警信息

**查询参数**:
- `customer_id`: 客户ID (必填)
- `alert_level`: 告警级别筛选 (info, warning, critical)
- `status`: 告警状态筛选 (active, acknowledged, resolved)
- `date_range`: 时间范围筛选

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "alerts": [
      {
        "alert_id": "ALT-001",
        "alert_type": "sla_warning",
        "alert_level": "warning",
        "title": "工单TKT-002即将超出SLA时限",
        "description": "工单TKT-002距离SLA截止时间还有30分钟",
        "ticket_id": "TKT-002",
        "sla_type": "resolution_time",
        "remaining_time": "30分钟",
        "status": "active",
        "created_at": "2024-08-11T16:00:00Z"
      }
    ],
    "summary": {
      "total_alerts": 5,
      "active_alerts": 2,
      "warning_alerts": 3,
      "critical_alerts": 0
    }
  }
}
```
### 7.4 统计报表管理

#### 生成服务报表
- **路径**: `POST /api/v1/client/reports/generate`
- **REQ-ID**: REQ-007-005
- **平台**: Web
- **权限**: client_report_generate
- **描述**: 生成甲方客户服务统计报表

**请求参数**:
```json
{
  "customer_id": 12345,
  "report_type": "monthly_service",
  "report_name": "2024年8月服务报表",
  "date_range": {
    "start_date": "2024-08-01",
    "end_date": "2024-08-31"
  },
  "include_sections": [
    "service_overview",
    "sla_performance",
    "ticket_statistics",
    "satisfaction_analysis",
    "cost_analysis"
  ],
  "output_format": "pdf",
  "language": "zh_CN",
  "template_id": "TPL-001",
  "custom_filters": {
    "service_types": ["email", "database", "network"],
    "priority_levels": [1, 2, 3]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "报表生成任务已创建",
  "data": {
    "task_id": "RPT-TASK-001",
    "report_id": "RPT-202408-001",
    "report_name": "2024年8月服务报表",
    "status": "generating",
    "estimated_completion": "2024-08-11T19:00:00Z",
    "progress_url": "/api/v1/client/reports/tasks/RPT-TASK-001/progress",
    "download_url": "/api/v1/client/reports/RPT-202408-001/download"
  }
}
```
#### 获取报表列表
- **路径**: `GET /api/v1/client/reports`
- **REQ-ID**: REQ-007-005
- **平台**: Web
- **权限**: client_report_read
- **描述**: 获取已生成的报表列表

**查询参数**:
- `customer_id`: 客户ID (必填)
- `report_type`: 报表类型筛选
- `status`: 状态筛选 (generating, completed, failed)
- `date_range`: 时间范围筛选
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "reports": [
      {
        "report_id": "RPT-202408-001",
        "report_name": "2024年8月服务报表",
        "report_type": "monthly_service",
        "status": "completed",
        "file_size": "2.5MB",
        "output_format": "pdf",
        "generated_at": "2024-08-11T19:00:00Z",
        "expires_at": "2024-09-11T19:00:00Z",
        "download_count": 3,
        "download_url": "/api/v1/client/reports/RPT-202408-001/download"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 25,
      "pages": 2
    }
  }
}
```
#### 下载报表
- **路径**: `GET /api/v1/client/reports/{reportId}/download`
- **REQ-ID**: REQ-007-005
- **平台**: Web
- **权限**: client_report_download
- **描述**: 下载指定报表文件

**路径参数**:
- `reportId`: 报表ID

**响应示例**:
```
HTTP/1.1 200 OK
Content-Type: application/pdf
Content-Disposition: attachment; filename="2024年8月服务报表.pdf"
Content-Length: 2621440

[PDF文件二进制内容]
```
### 7.5 满意度管理

#### 创建满意度调查
- **路径**: `POST /api/v1/client/satisfaction/surveys`
- **REQ-ID**: REQ-007-006
- **平台**: Web
- **权限**: client_survey_create
- **描述**: 创建客户满意度调查

**请求参数**:
```json
{
  "customer_id": 12345,
  "survey_name": "2024年8月服务满意度调查",
  "survey_type": "monthly",
  "target_tickets": [12345, 12346, 12347],
  "survey_questions": [
    {
      "question_id": "Q001",
      "question_text": "对整体服务质量的满意度",
      "question_type": "rating",
      "scale": 5,
      "required": true
    },
    {
      "question_id": "Q002",
      "question_text": "对响应时间的满意度",
      "question_type": "rating",
      "scale": 5,
      "required": true
    },
    {
      "question_id": "Q003",
      "question_text": "其他建议和意见",
      "question_type": "text",
      "required": false
    }
  ],
  "deadline": "2024-08-25T23:59:59Z",
  "send_notification": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "满意度调查创建成功",
  "data": {
    "survey_id": "SUR-001",
    "survey_name": "2024年8月服务满意度调查",
    "status": "active",
    "target_count": 3,
    "response_url": "/client/surveys/SUR-001/respond",
    "created_at": "2024-08-11T14:30:00Z"
  }
}
```
#### 提交满意度评价
- **路径**: `POST /api/v1/client/satisfaction/surveys/{surveyId}/responses`
- **REQ-ID**: REQ-007-006
- **平台**: Web, Mobile
- **权限**: client_survey_respond
- **描述**: 提交满意度评价

**路径参数**:
- `surveyId`: 调查ID

**请求参数**:
```json
{
  "ticket_id": 12345,
  "respondent_info": {
    "name": "张经理",
    "email": "zhangmanager@abc.com",
    "department": "IT部"
  },
  "responses": [
    {
      "question_id": "Q001",
      "rating": 4
    },
    {
      "question_id": "Q002",
      "rating": 5
    },
    {
      "question_id": "Q003",
      "text": "服务及时，解决方案有效，希望能提供更详细的故障分析报告"
    }
  ],
  "overall_comments": "整体服务质量很好，工程师专业素质高"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "满意度评价提交成功",
  "data": {
    "response_id": "RSP-001",
    "survey_id": "SUR-001",
    "ticket_id": 12345,
    "overall_score": 4.5,
    "submitted_at": "2024-08-11T16:30:00Z"
  }
}
```
#### 获取满意度统计
- **路径**: `GET /api/v1/client/satisfaction/statistics`
- **REQ-ID**: REQ-007-006
- **平台**: Web
- **权限**: client_survey_read
- **描述**: 获取满意度统计数据

**查询参数**:
- `customer_id`: 客户ID (必填)
- `period`: 统计周期 (monthly, quarterly, yearly)
- `date_range`: 时间范围筛选
- `survey_type`: 调查类型筛选

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "overall_statistics": {
      "total_surveys": 12,
      "total_responses": 156,
      "response_rate": 78.5,
      "avg_overall_score": 4.6,
      "satisfaction_trend": "improving"
    },
    "dimension_scores": [
      {
        "dimension": "整体服务质量",
        "avg_score": 4.6,
        "score_distribution": {
          "5": 45,
          "4": 78,
          "3": 28,
          "2": 4,
          "1": 1
        }
      },
      {
        "dimension": "响应时间",
        "avg_score": 4.8,
        "score_distribution": {
          "5": 89,
          "4": 52,
          "3": 12,
          "2": 2,
          "1": 1
        }
      }
    ],
    "trend_analysis": {
      "monthly_scores": [
        {
          "month": "2024-06",
          "avg_score": 4.2
        },
        {
          "month": "2024-07",
          "avg_score": 4.4
        },
        {
          "month": "2024-08",
          "avg_score": 4.6
        }
      ]
    },
    "improvement_suggestions": [
      "加强故障预防措施",
      "提升技术文档质量",
      "优化沟通流程"
    ]
  }
}
```
### 7.6 成本分析管理

#### 获取服务成本分析
- **权限**: client_cost_read
- **描述**: 获取服务成本分析数据

**查询参数**:
- `customer_id`: 客户ID (必填)
- `period`: 分析周期 (monthly, quarterly, yearly)
- `cost_type`: 成本类型筛选 (labor, material, overhead, total)
- `breakdown_by`: 分解维度 (service, department, engineer, ticket_type)
- `date_range`: 时间范围筛选

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "cost_overview": {
      "total_cost": 156800.00,
      "period": "2024年8月",
      "currency": "CNY",
      "cost_per_ticket": 1005.13,
      "cost_trend": "stable"
    },
    "cost_breakdown": [
      {
        "cost_type": "labor",
        "cost_name": "人工成本",
        "amount": 98500.00,
        "percentage": 62.8,
        "details": [
          {
            "item": "工程师工时",
            "amount": 85600.00,
            "hours": 428,
            "avg_hourly_rate": 200.00
          },
          {
            "item": "管理成本",
            "amount": 12900.00,
            "hours": 64.5,
            "avg_hourly_rate": 200.00
          }
        ]
      },
      {
        "cost_type": "material",
        "cost_name": "材料成本",
        "amount": 45200.00,
        "percentage": 28.8,
        "details": [
          {
            "item": "硬件更换",
            "amount": 32500.00,
            "quantity": 5
          },
          {
            "item": "软件许可",
            "amount": 12700.00,
            "quantity": 3
          }
        ]
      },
      {
        "cost_type": "overhead",
        "cost_name": "管理费用",
        "amount": 13100.00,
        "percentage": 8.4,
        "details": [
          {
            "item": "交通费用",
            "amount": 8600.00
          },
          {
            "item": "通讯费用",
            "amount": 4500.00
          }
        ]
      }
    ],
    "service_cost_analysis": [
      {
        "service_type": "硬件维护",
        "ticket_count": 45,
        "total_cost": 89600.00,
        "avg_cost_per_ticket": 1991.11
      },
      {
        "service_type": "软件支持",
        "ticket_count": 78,
        "total_cost": 45200.00,
        "avg_cost_per_ticket": 579.49
      }
    ],
    "cost_optimization_suggestions": [
      "优化硬件采购流程，降低材料成本",
      "提升工程师技能，减少处理时间",
      "建立预防性维护计划，减少故障发生"
    ]
  }
}
```
### 7.7 自定义报表管理

#### 创建自定义报表模板
- **路径**: `POST /api/v1/client/reports/templates`
- **REQ-ID**: REQ-007-008
- **平台**: Web
- **权限**: client_template_create
- **描述**: 创建自定义报表模板

**请求参数**:
```json
{
  "template_name": "月度运维服务报表",
  "template_type": "custom",
  "description": "包含服务概览、SLA达成情况和成本分析的综合报表",
  "sections": [
    {
      "section_name": "服务概览",
      "section_type": "overview",
      "data_sources": ["tickets", "sla_metrics"],
      "charts": [
        {
          "chart_type": "pie",
          "title": "工单状态分布",
          "data_field": "ticket_status"
        },
        {
          "chart_type": "line",
          "title": "月度工单趋势",
          "data_field": "monthly_tickets"
        }
      ]
    },
    {
      "section_name": "SLA分析",
      "section_type": "sla_analysis",
      "data_sources": ["sla_metrics"],
      "charts": [
        {
          "chart_type": "gauge",
          "title": "SLA达成率",
          "data_field": "sla_compliance"
        }
      ]
    }
  ],
  "output_formats": ["pdf", "excel"],
  "schedule": {
    "frequency": "monthly",
    "day_of_month": 1,
    "auto_send": true,
    "recipients": ["manager@abc.com"]
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "报表模板创建成功",
  "data": {
    "template_id": "TPL-CUSTOM-001",
    "template_name": "月度运维服务报表",
    "status": "active",
    "created_at": "2024-08-11T14:30:00Z",
    "preview_url": "/client/reports/templates/TPL-CUSTOM-001/preview"
  }
}
```
#### 获取报表模板列表
- **路径**: `GET /api/v1/client/reports/templates`
- **REQ-ID**: REQ-007-008
- **平台**: Web
- **权限**: client_template_read
- **描述**: 获取可用的报表模板列表

**查询参数**:
- `customer_id`: 客户ID (必填)
- `template_type`: 模板类型筛选 (standard, custom)
- `status`: 状态筛选 (active, inactive)

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "templates": [
      {
        "template_id": "TPL-CUSTOM-001",
        "template_name": "月度运维服务报表",
        "template_type": "custom",
        "description": "包含服务概览、SLA达成情况和成本分析的综合报表",
        "status": "active",
        "output_formats": ["pdf", "excel"],
        "last_used": "2024-08-01T10:00:00Z",
        "usage_count": 12,
        "created_at": "2024-08-11T14:30:00Z"
      }
    ],
    "summary": {
      "total_templates": 8,
      "custom_templates": 3,
      "standard_templates": 5
    }
  }
}
```
---

## 8. 系统设置模块 (REQ-008)

### 8.1 系统参数配置

#### 获取系统配置列表
- **路径**: `GET /api/v1/system/config`
- **REQ-ID**: REQ-008-001
- **平台**: Web
- **权限**: system_config_read
- **描述**: 获取系统配置参数列表

**查询参数**:
- `scope`: 配置范围 (global, module, feature)
- `category`: 配置分类 (security, performance, business, notification)
- `tenant_id`: 租户ID (仅租户级配置)
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "configs": [
      {
        "config_id": 1001,
        "config_key": "session.timeout",
        "config_value": "3600",
        "scope": "global",
        "category": "security",
        "description": "用户会话超时时间(秒)",
        "data_type": "integer",
        "is_encrypted": false,
        "effective_mode": "immediate",
        "version": 1,
        "created_by": "admin",
        "updated_at": "2024-08-11T14:30:00Z"
      },
      {
        "config_id": 1002,
        "config_key": "ticket.auto_assign",
        "config_value": "true",
        "scope": "module",
        "category": "business",
        "description": "启用工单自动分配",
        "data_type": "boolean",
        "is_encrypted": false,
        "effective_mode": "immediate",
        "version": 2,
        "created_by": "admin",
        "updated_at": "2024-08-11T15:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
#### 更新系统配置
- **路径**: `PUT /api/v1/system/config/{configKey}`
- **REQ-ID**: REQ-008-001
- **平台**: Web
- **权限**: system_config_update
- **描述**: 更新系统配置参数

**路径参数**:
- `configKey`: 配置键名

**请求参数**:
```json
{
  "config_value": "7200",
  "scope": "global",
  "effective_mode": "immediate",
  "reason": "调整会话超时时间以提升安全性"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "配置更新成功",
  "data": {
    "config_id": 1001,
    "config_key": "session.timeout",
    "old_value": "3600",
    "new_value": "7200",
    "version": 2,
    "updated_at": "2024-08-11T16:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 批量更新配置
- **路径**: `PUT /api/v1/system/config/batch`
- **REQ-ID**: REQ-008-001
- **平台**: Web
- **权限**: system_config_batch
- **描述**: 批量更新系统配置

**请求参数**:
```json
{
  "configs": [
    {
      "config_key": "session.timeout",
      "config_value": "7200"
    },
    {
      "config_key": "notification.email_enabled",
      "config_value": "true"
    }
  ],
  "effective_mode": "immediate",
  "reason": "批量调整系统配置"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "批量更新成功",
  "data": {
    "updated_count": 2,
    "failed_count": 0,
    "updated_configs": [
      {
        "config_key": "session.timeout",
        "status": "success",
        "version": 2
      },
      {
        "config_key": "notification.email_enabled",
        "status": "success",
        "version": 1
      }
    ],
    "updated_at": "2024-08-11T16:30:00Z"
  }
}
```
### 8.2 租户配置管理

#### 获取租户设置配置
- **路径**: `GET /api/v1/system/tenant-config`
- **REQ-ID**: REQ-008-002
- **平台**: Web
- **权限**: tenant_config_read
- **描述**: 获取当前租户的设置配置

**查询参数**:
- `category`: 配置分类 (business, notification, security)
- `include_inherited`: 是否包含继承的全局配置 (默认: true)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "tenant_id": 1,
    "tenant_name": "A公司",
    "configs": [
      {
        "config_key": "ticket.auto_assign",
        "config_value": "true",
        "description": "启用工单自动分配",
        "data_type": "boolean",
        "is_inherited": false,
        "updated_at": "2024-08-11T14:30:00Z"
      },
      {
        "config_key": "notification.email_enabled",
        "config_value": "true",
        "description": "启用邮件通知",
        "data_type": "boolean",
        "is_inherited": true,
        "updated_at": "2024-08-11T14:30:00Z"
      }
    ]
  }
}
```
#### 更新租户设置配置
- **路径**: `PUT /api/v1/system/tenant-config`
- **REQ-ID**: REQ-008-002
- **平台**: Web
- **权限**: tenant_config_update
- **描述**: 更新租户级别设置配置

**请求参数**:
```json
{
  "configs": [
    {
      "config_key": "ticket.auto_assign",
      "config_value": "false",
      "description": "禁用工单自动分配"
    },
    {
      "config_key": "sla.default_response_time",
      "config_value": "2",
      "description": "默认响应时间(小时)"
    }
  ]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "租户配置更新成功",
  "data": {
    "tenant_id": 1,
    "updated_configs": 2,
    "updated_at": "2024-08-11T16:30:00Z",
    "updated_by": {
      "user_id": 1001,
      "username": "tenant_admin",
      "real_name": "租户管理员"
    }
  }
}
```
### 8.3 业务规则配置

#### 获取业务规则
- **路径**: `GET /api/v1/system/business-rules`
- **REQ-ID**: REQ-008-003
- **平台**: Web
- **权限**: business_rule_read
- **描述**: 获取业务规则配置

**查询参数**:
- `rule_type`: 规则类型 (ticket, dispatch, sla, notification)
- `status`: 规则状态 (active, inactive, draft)
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "rules": [
      {
        "rule_id": "RULE-001",
        "rule_name": "高优先级工单自动升级",
        "rule_type": "ticket",
        "status": "active",
        "priority": 1,
        "conditions": [
          {
            "field": "priority",
            "operator": "equals",
            "value": 1
          },
          {
            "field": "status",
            "operator": "equals",
            "value": "pending"
          },
          {
            "field": "created_hours_ago",
            "operator": "greater_than",
            "value": 2
          }
        ],
        "actions": [
          {
            "action_type": "escalate",
            "parameters": {
              "escalate_to": "manager",
              "notification": true
            }
          }
        ],
        "created_at": "2024-08-11T10:00:00Z",
        "updated_at": "2024-08-11T14:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 15,
      "pages": 1
    }
  }
}
```
#### 创建业务规则
- **路径**: `POST /api/v1/system/business-rules`
- **REQ-ID**: REQ-008-003
- **平台**: Web
- **权限**: business_rule_create
- **描述**: 创建新的业务规则

**请求参数**:
```json
{
  "rule_name": "VIP客户工单优先处理",
  "rule_type": "ticket",
  "description": "VIP客户的工单自动设置为高优先级",
  "priority": 2,
  "conditions": [
    {
      "field": "customer.level",
      "operator": "equals",
      "value": "VIP"
    }
  ],
  "actions": [
    {
      "action_type": "set_priority",
      "parameters": {
        "priority": 1
      }
    },
    {
      "action_type": "notify",
      "parameters": {
        "notify_type": "email",
        "recipients": ["manager@company.com"]
      }
    }
  ],
  "is_active": true,
  "effective_time": {
    "start_date": "2024-08-12T00:00:00Z",
    "end_date": null
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "业务规则创建成功",
  "data": {
    "rule_id": "RULE-002",
    "rule_name": "VIP客户工单优先处理",
    "status": "active",
    "created_at": "2024-08-11T16:30:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 更新业务规则
- **路径**: `PUT /api/v1/system/business-rules/{ruleId}`
- **REQ-ID**: REQ-008-003
- **平台**: Web
- **权限**: business_rule_update
- **描述**: 更新业务规则配置

**路径参数**:
- `ruleId`: 规则ID

**请求参数**:
```json
{
  "rule_name": "高优先级工单自动升级（更新版）",
  "description": "增加了时间条件的高优先级工单升级规则",
  "priority": 1,
  "conditions": [
    {
      "field": "priority",
      "operator": "in",
      "value": [1, 2]
    },
    {
      "field": "status",
      "operator": "equals",
      "value": "pending"
    },
    {
      "field": "created_hours_ago",
      "operator": "greater_than",
      "value": 1
    }
  ],
  "actions": [
    {
      "action_type": "escalate",
      "parameters": {
        "escalate_to": "manager",
        "notification": true,
        "escalate_level": 2
      }
    }
  ],
  "is_active": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "业务规则更新成功",
  "data": {
    "rule_id": "RULE-001",
    "updated_fields": ["rule_name", "description", "conditions", "actions"],
    "updated_at": "2024-08-11T17:00:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
### 8.4 功能开关管理

#### 获取功能开关列表
- **路径**: `GET /api/v1/system/feature-flags`
- **REQ-ID**: REQ-008-009
- **平台**: Web
- **权限**: feature_flag_read
- **描述**: 获取系统功能开关状态

**查询参数**:
- `module`: 模块筛选 (ticket, dispatch, knowledge, report)
- `status`: 开关状态 (enabled, disabled, partial)
- `rollout_type`: 发布类型 (all, percentage, tenant, user)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "feature_flags": [
      {
        "flag_key": "ai_analysis",
        "flag_name": "AI智能分析",
        "module": "ticket",
        "description": "启用工单AI智能分析功能",
        "enabled": true,
        "rollout_strategy": {
          "type": "percentage",
          "percentage": 80,
          "target_tenants": [1001, 1002],
          "target_users": []
        },
        "effective_time": "2024-08-11T16:00:00Z",
        "created_at": "2024-08-01T10:00:00Z",
        "updated_at": "2024-08-11T14:30:00Z"
      },
      {
        "flag_key": "advanced_search",
        "flag_name": "高级搜索",
        "module": "knowledge",
        "description": "启用知识库高级搜索功能",
        "enabled": false,
        "rollout_strategy": {
          "type": "all"
        },
        "effective_time": null,
        "created_at": "2024-08-01T10:00:00Z",
        "updated_at": "2024-08-10T15:30:00Z"
      }
    ]
  }
}
```
#### 更新功能开关
- **路径**: `PUT /api/v1/system/feature-flags/{flagKey}`
- **REQ-ID**: REQ-008-009
- **平台**: Web
- **权限**: feature_flag_update
- **描述**: 启用或禁用系统功能

**路径参数**:
- `flagKey`: 功能开关键名

**请求参数**:
```json
{
  "enabled": true,
  "rollout_strategy": {
    "type": "percentage",
    "percentage": 100
  },
  "target_tenants": [],
  "target_users": [],
  "effective_time": "2024-08-11T18:00:00Z",
  "reason": "功能测试完成，全量发布"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "功能开关更新成功",
  "data": {
    "flag_key": "ai_analysis",
    "old_status": "partial",
    "new_status": "enabled",
    "rollout_percentage": 100,
    "effective_time": "2024-08-11T18:00:00Z",
    "updated_at": "2024-08-11T17:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
### 8.5 安全策略配置

#### 获取安全策略
- **路径**: `GET /api/v1/system/security-policies`
- **REQ-ID**: REQ-008-011
- **平台**: Web
- **权限**: security_policy_read
- **描述**: 获取系统安全策略配置

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "password_policy": {
      "min_length": 8,
      "require_uppercase": true,
      "require_lowercase": true,
      "require_numbers": true,
      "require_special_chars": true,
      "password_history": 5,
      "max_age_days": 90,
      "lockout_attempts": 5,
      "lockout_duration_minutes": 30
    },
    "session_policy": {
      "timeout_minutes": 60,
      "max_concurrent_sessions": 3,
      "idle_timeout_minutes": 30,
      "require_reauth_for_sensitive": true
    },
    "ip_whitelist": {
      "enabled": true,
      "allowed_ips": [
        "192.168.1.0/24",
        "10.0.0.0/8",
        "172.16.0.0/12"
      ],
      "block_unknown_ips": false
    },
    "updated_at": "2024-08-11T14:30:00Z"
  }
}
```
#### 更新密码策略
- **路径**: `PUT /api/v1/system/security-policies/password`
- **REQ-ID**: REQ-008-011
- **平台**: Web
- **权限**: security_policy_update
- **描述**: 更新密码复杂度策略

**请求参数**:
```json
{
  "min_length": 10,
  "require_uppercase": true,
  "require_lowercase": true,
  "require_numbers": true,
  "require_special_chars": true,
  "password_history": 8,
  "max_age_days": 60,
  "lockout_attempts": 3,
  "lockout_duration_minutes": 60
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "密码策略更新成功",
  "data": {
    "updated_fields": ["min_length", "password_history", "max_age_days", "lockout_attempts", "lockout_duration_minutes"],
    "updated_at": "2024-08-11T17:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 更新会话策略
- **路径**: `PUT /api/v1/system/security-policies/session`
- **REQ-ID**: REQ-008-011
- **平台**: Web
- **权限**: security_policy_update
- **描述**: 更新会话安全策略

**请求参数**:
```json
{
  "timeout_minutes": 120,
  "max_concurrent_sessions": 5,
  "idle_timeout_minutes": 60,
  "require_reauth_for_sensitive": true,
  "force_logout_on_ip_change": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "会话策略更新成功",
  "data": {
    "updated_fields": ["timeout_minutes", "max_concurrent_sessions", "idle_timeout_minutes", "force_logout_on_ip_change"],
    "updated_at": "2024-08-11T17:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 管理IP白名单
- **路径**: `PUT /api/v1/system/security-policies/ip-whitelist`
- **REQ-ID**: REQ-008-011
- **平台**: Web
- **权限**: security_policy_update
- **描述**: 管理IP访问白名单

**请求参数**:
```json
{
  "enabled": true,
  "allowed_ips": [
    "192.168.1.0/24",
    "10.0.0.0/8",
    "172.16.0.0/12",
    "203.0.113.0/24"
  ],
  "block_unknown_ips": true,
  "whitelist_description": "公司内网和合作伙伴IP段"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "IP白名单更新成功",
  "data": {
    "total_ips": 4,
    "added_ips": ["203.0.113.0/24"],
    "removed_ips": [],
    "block_unknown_ips": true,
    "updated_at": "2024-08-11T17:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
### 8.6 配置版本管理

#### 获取配置变更历史
- **路径**: `GET /api/v1/system/config/history`
- **REQ-ID**: REQ-008-013
- **平台**: Web
- **权限**: config_history_read
- **描述**: 获取配置变更历史记录

**查询参数**:
- `config_key`: 配置键名筛选
- `operator_id`: 操作人筛选
- `operation_type`: 操作类型 (CREATE, UPDATE, DELETE)
- `date_start`: 开始时间
- `date_end`: 结束时间
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "history": [
      {
        "log_id": 10001,
        "config_key": "session.timeout",
        "operation_type": "UPDATE",
        "old_value": "3600",
        "new_value": "7200",
        "operator": {
          "user_id": 2001,
          "username": "admin",
          "real_name": "管理员"
        },
        "operation_time": "2024-08-11T16:30:00Z",
        "ip_address": "192.168.1.100",
        "reason": "调整会话超时时间以提升安全性",
        "version": 2
      },
      {
        "log_id": 10002,
        "config_key": "notification.email_enabled",
        "operation_type": "UPDATE",
        "old_value": "false",
        "new_value": "true",
        "operator": {
          "user_id": 1001,
          "username": "tenant_admin",
          "real_name": "租户管理员"
        },
        "operation_time": "2024-08-11T15:00:00Z",
        "ip_address": "192.168.1.101",
        "reason": "启用邮件通知功能",
        "version": 1
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
#### 配置回滚
- **路径**: `POST /api/v1/system/config/rollback`
- **REQ-ID**: REQ-008-013
- **平台**: Web
- **权限**: config_rollback
- **描述**: 回滚配置到指定版本

**请求参数**:
```json
{
  "target_version": "v1.2.3",
  "config_keys": ["session.timeout", "notification.email_enabled"],
  "reason": "回滚到稳定版本",
  "force_rollback": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "配置回滚成功",
  "data": {
    "rollback_id": "RB-001",
    "target_version": "v1.2.3",
    "rollback_count": 2,
    "rollback_configs": [
      {
        "config_key": "session.timeout",
        "old_value": "7200",
        "new_value": "3600",
        "status": "success"
      },
      {
        "config_key": "notification.email_enabled",
        "old_value": "true",
        "new_value": "false",
        "status": "success"
      }
    ],
    "rollback_time": "2024-08-11T18:00:00Z",
    "rollback_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
### 8.7 配置导入导出

#### 导出配置
- **路径**: `GET /api/v1/system/config/export`
- **REQ-ID**: REQ-008-014
- **平台**: Web
- **权限**: config_export
- **描述**: 导出系统配置

**查询参数**:
- `format`: 导出格式 (json, excel, yaml)
- `scope`: 导出范围 (global, tenant, all)
- `categories`: 配置分类列表 (逗号分隔)
- `include_sensitive`: 是否包含敏感配置 (默认: false)

**响应示例**:
```json
{
  "code": 200,
  "message": "配置导出成功",
  "data": {
    "export_id": "EXP-001",
    "file_name": "system_config_20240811.json",
    "file_url": "https://files.example.com/exports/system_config_20240811.json",
    "file_size": 2048,
    "export_count": 156,
    "export_time": "2024-08-11T18:00:00Z",
    "exported_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 导入配置
- **路径**: `POST /api/v1/system/config/import`
- **REQ-ID**: REQ-008-014
- **平台**: Web
- **权限**: config_import
- **描述**: 导入系统配置

**请求参数**:
```json
{
  "file_url": "https://files.example.com/imports/system_config.json",
  "import_mode": "merge",
  "overwrite_existing": false,
  "validate_before_import": true,
  "dry_run": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "配置导入成功",
  "data": {
    "import_id": "IMP-001",
    "total_configs": 50,
    "imported_count": 45,
    "skipped_count": 3,
    "failed_count": 2,
    "import_results": [
      {
        "config_key": "session.timeout",
        "status": "imported",
        "old_value": "3600",
        "new_value": "7200"
      },
      {
        "config_key": "invalid.config",
        "status": "failed",
        "error": "配置键名不存在"
      }
    ],
    "import_time": "2024-08-11T18:30:00Z",
    "imported_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 验证配置文件
- **路径**: `POST /api/v1/system/config/validate`
- **REQ-ID**: REQ-008-014
- **平台**: Web
- **权限**: config_validate
- **描述**: 验证配置文件格式和内容

**请求参数**:
```json
{
  "file_url": "https://files.example.com/imports/system_config.json",
  "validation_level": "strict"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "配置文件验证完成",
  "data": {
    "validation_id": "VAL-001",
    "is_valid": false,
    "total_configs": 50,
    "valid_count": 45,
    "invalid_count": 5,
    "validation_errors": [
      {
        "config_key": "invalid.timeout",
        "error_type": "invalid_key",
        "error_message": "配置键名不存在"
      },
      {
        "config_key": "session.timeout",
        "error_type": "invalid_value",
        "error_message": "配置值必须为正整数"
      }
    ],
    "validation_warnings": [
      {
        "config_key": "old.config",
        "warning_message": "该配置项已废弃，建议使用新的配置项"
      }
    ],
    "validation_time": "2024-08-11T18:00:00Z"
  }
}
```
---

## 9. 运维管理模块 (REQ-009)

### 9.1 运维资产管理

#### 获取资产列表
- **路径**: `GET /api/v1/ops/assets`
- **REQ-ID**: REQ-009-009
- **平台**: Web
- **权限**: ops_asset_read
- **描述**: 获取运维资产列表，支持与Netbox同步

**查询参数**:
- `type`: 资产类型 (server, network, storage, application)
- `status`: 资产状态 (active, inactive, maintenance)
- `location`: 资产位置
- `tenant_id`: 租户ID
- `netbox_sync`: 是否同步Netbox数据 (默认: false)
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "assets": [
      {
        "asset_id": "AST-001",
        "asset_name": "Web服务器01",
        "asset_type": "server",
        "status": "active",
        "ip_address": "192.168.1.100",
        "location": "机房A-01",
        "specifications": {
          "cpu": "Intel Xeon E5-2680",
          "memory": "32GB",
          "storage": "1TB SSD",
          "os": "CentOS 7.9"
        },
        "netbox_id": "NB-SRV-001",
        "last_sync_at": "2024-08-11T14:30:00Z",
        "monitoring_status": "normal",
        "created_at": "2024-08-01T10:00:00Z",
        "updated_at": "2024-08-11T14:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    },
    "sync_info": {
      "last_sync": "2024-08-11T14:30:00Z",
      "sync_status": "success",
      "netbox_total": 160,
      "local_total": 156
    }
  }
}
```
#### 创建资产记录
- **路径**: `POST /api/v1/ops/assets`
- **REQ-ID**: REQ-009-009
- **平台**: Web
- **权限**: ops_asset_create
- **描述**: 创建新的运维资产记录

**请求参数**:
```json
{
  "asset_name": "数据库服务器02",
  "asset_type": "server",
  "ip_address": "192.168.1.101",
  "location": "机房A-02",
  "specifications": {
    "cpu": "Intel Xeon E5-2690",
    "memory": "64GB",
    "storage": "2TB SSD",
    "os": "Ubuntu 20.04"
  },
  "netbox_id": "NB-SRV-002",
  "description": "MySQL主数据库服务器",
  "owner": "DBA团队",
  "maintenance_window": "周日 02:00-04:00"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "资产创建成功",
  "data": {
    "asset_id": "AST-002",
    "asset_name": "数据库服务器02",
    "status": "active",
    "created_at": "2024-08-11T16:30:00Z",
    "created_by": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    }
  }
}
```
#### 更新资产信息
- **路径**: `PUT /api/v1/ops/assets/{assetId}`
- **REQ-ID**: REQ-009-009
- **平台**: Web
- **权限**: ops_asset_update
- **描述**: 更新资产信息

**路径参数**:
- `assetId`: 资产ID

**请求参数**:
```json
{
  "asset_name": "Web服务器01（升级版）",
  "status": "maintenance",
  "specifications": {
    "cpu": "Intel Xeon E5-2680",
    "memory": "64GB",
    "storage": "2TB SSD",
    "os": "CentOS 8.4"
  },
  "location": "机房A-01",
  "maintenance_note": "内存升级维护"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "资产更新成功",
  "data": {
    "asset_id": "AST-001",
    "updated_fields": ["asset_name", "status", "specifications", "maintenance_note"],
    "updated_at": "2024-08-11T17:00:00Z",
    "updated_by": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    }
  }
}
```
#### 资产状态监控
- **路径**: `GET /api/v1/ops/assets/{assetId}/monitoring`
- **REQ-ID**: REQ-009-001
- **平台**: Web, Mobile
- **权限**: ops_asset_monitor
- **描述**: 获取资产实时监控数据

**路径参数**:
- `assetId`: 资产ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "asset_id": "AST-001",
    "asset_name": "Web服务器01",
    "monitoring_status": "normal",
    "metrics": {
      "cpu_usage": 45.2,
      "memory_usage": 68.5,
      "disk_usage": 72.1,
      "network_in": 125.6,
      "network_out": 89.3,
      "load_average": 1.25
    },
    "alerts": [
      {
        "alert_id": "ALT-001",
        "severity": "warning",
        "message": "磁盘使用率超过70%",
        "created_at": "2024-08-11T16:00:00Z"
      }
    ],
    "last_check": "2024-08-11T17:30:00Z",
    "uptime": "15天3小时25分钟"
  }
}
```
### 9.2 运维剧本管理

#### 获取运维剧本列表
- **路径**: `GET /api/v1/ops/playbooks`
- **REQ-ID**: REQ-009-012
- **平台**: Web
- **权限**: ops_playbook_read
- **描述**: 获取运维自动化剧本列表，支持Orion-Ops集成

**查询参数**:
- `category`: 剧本分类 (deployment, maintenance, troubleshooting, monitoring)
- `status`: 剧本状态 (active, draft, archived)
- `keyword`: 关键词搜索
- `orion_sync`: 是否同步Orion-Ops剧本 (默认: false)
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "playbooks": [
      {
        "playbook_id": "PB-001",
        "playbook_name": "Web服务器重启剧本",
        "category": "maintenance",
        "description": "标准化的Web服务器重启流程",
        "status": "active",
        "orion_ops_id": "ORION-PB-001",
        "target_asset_types": ["server"],
        "required_permissions": ["sudo"],
        "estimated_duration": "5分钟",
        "success_rate": 98.5,
        "last_execution": "2024-08-11T15:30:00Z",
        "created_at": "2024-08-01T10:00:00Z",
        "updated_at": "2024-08-10T14:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 45,
      "pages": 3
    }
  }
}
```
#### 创建运维剧本
- **路径**: `POST /api/v1/ops/playbooks`
- **REQ-ID**: REQ-009-012
- **平台**: Web
- **权限**: ops_playbook_create
- **描述**: 创建新的运维剧本

**请求参数**:
```json
{
  "playbook_name": "数据库备份剧本",
  "category": "maintenance",
  "description": "MySQL数据库自动备份流程",
  "steps": [
    {
      "step_order": 1,
      "step_name": "检查数据库连接",
      "step_type": "command",
      "command": "mysqladmin ping -h localhost",
      "timeout": 30,
      "retry_count": 3
    },
    {
      "step_order": 2,
      "step_name": "创建备份目录",
      "step_type": "command",
      "command": "mkdir -p /backup/mysql/$(date +%Y%m%d)",
      "timeout": 10
    },
    {
      "step_order": 3,
      "step_name": "执行数据库备份",
      "step_type": "command",
      "command": "mysqldump --all-databases > /backup/mysql/$(date +%Y%m%d)/backup.sql",
      "timeout": 1800
    },
    {
      "step_order": 4,
      "step_name": "压缩备份文件",
      "step_type": "command",
      "command": "gzip /backup/mysql/$(date +%Y%m%d)/backup.sql",
      "timeout": 300
    }
  ],
  "target_asset_types": ["server"],
  "required_permissions": ["mysql", "sudo"],
  "schedule": {
    "enabled": true,
    "cron_expression": "0 2 * * *",
    "timezone": "Asia/Shanghai"
  },
  "notification": {
    "on_success": true,
    "on_failure": true,
    "recipients": ["dba@company.com"]
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "运维剧本创建成功",
  "data": {
    "playbook_id": "PB-002",
    "playbook_name": "数据库备份剧本",
    "status": "active",
    "orion_ops_id": "ORION-PB-002",
    "created_at": "2024-08-11T17:00:00Z",
    "created_by": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    }
  }
}
```
#### 执行运维剧本
- **路径**: `POST /api/v1/ops/playbooks/{playbookId}/execute`
- **REQ-ID**: REQ-009-012
- **平台**: Web
- **权限**: ops_playbook_execute
- **描述**: 执行指定的运维剧本

**路径参数**:
- `playbookId`: 剧本ID

**请求参数**:
```json
{
  "target_assets": ["AST-001", "AST-002"],
  "execution_mode": "sequential",
  "parameters": {
    "service_name": "nginx",
    "backup_retention_days": 7
  },
  "scheduled_time": null,
  "notification_enabled": true,
  "dry_run": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "剧本执行启动成功",
  "data": {
    "task_id": "TSK-001",
    "playbook_id": "PB-001",
    "playbook_name": "Web服务器重启剧本",
    "execution_mode": "sequential",
    "target_assets": ["AST-001", "AST-002"],
    "status": "running",
    "start_time": "2024-08-11T17:30:00Z",
    "estimated_completion": "2024-08-11T17:35:00Z",
    "executor": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    }
  }
}
```
### 9.3 告警处理

#### 获取告警列表
- **路径**: `GET /api/v1/ops/alerts`
- **REQ-ID**: REQ-009-010
- **平台**: Web, Mobile
- **权限**: ops_alert_read
- **描述**: 获取运维告警列表，支持夜莺监控集成

**查询参数**:
- `severity`: 告警级别 (critical, warning, info)
- `status`: 处理状态 (new, acknowledged, resolved, suppressed)
- `asset_id`: 资产ID
- `source`: 告警来源 (nightingale, manual, system)
- `date_start`: 开始时间
- `date_end`: 结束时间
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "alerts": [
      {
        "alert_id": "ALT-001",
        "alert_title": "CPU使用率过高",
        "severity": "warning",
        "status": "new",
        "source": "nightingale",
        "asset_id": "AST-001",
        "asset_name": "Web服务器01",
        "metric_name": "cpu_usage",
        "metric_value": "85%",
        "threshold": "80%",
        "rule_id": "RULE-CPU-001",
        "description": "服务器CPU使用率持续超过阈值5分钟",
        "first_occurrence": "2024-08-11T14:30:00Z",
        "last_occurrence": "2024-08-11T17:30:00Z",
        "occurrence_count": 12,
        "auto_resolution": {
          "enabled": true,
          "playbook_id": "PB-003",
          "executed": false
        },
        "created_at": "2024-08-11T14:30:00Z"
      },
      {
        "alert_id": "ALT-002",
        "alert_title": "磁盘空间不足",
        "severity": "critical",
        "status": "acknowledged",
        "source": "nightingale",
        "asset_id": "AST-002",
        "asset_name": "数据库服务器02",
        "metric_name": "disk_usage",
        "metric_value": "92%",
        "threshold": "90%",
        "rule_id": "RULE-DISK-001",
        "description": "数据库服务器磁盘使用率超过90%",
        "acknowledged_by": {
          "user_id": 1001,
          "username": "ops_admin",
          "real_name": "运维管理员"
        },
        "acknowledged_at": "2024-08-11T15:00:00Z",
        "auto_resolution": {
          "enabled": true,
          "playbook_id": "PB-004",
          "executed": true,
          "execution_result": "success"
        },
        "created_at": "2024-08-11T14:45:00Z"
      }
    ],
    "summary": {
      "total_alerts": 156,
      "critical_count": 5,
      "warning_count": 23,
      "info_count": 128,
      "new_count": 45,
      "acknowledged_count": 67,
      "resolved_count": 44
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
#### 确认告警
- **路径**: `PUT /api/v1/ops/alerts/{alertId}/acknowledge`
- **REQ-ID**: REQ-009-011
- **平台**: Web, Mobile
- **权限**: ops_alert_handle
- **描述**: 确认告警并开始处理

**路径参数**:
- `alertId`: 告警ID

**请求参数**:
```json
{
  "acknowledge_note": "已确认告警，正在调查原因",
  "estimated_resolution_time": "2024-08-11T18:30:00Z",
  "assign_to": 1002,
  "trigger_playbook": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "告警确认成功",
  "data": {
    "alert_id": "ALT-001",
    "status": "acknowledged",
    "acknowledged_by": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    },
    "acknowledged_at": "2024-08-11T17:45:00Z",
    "acknowledge_note": "已确认告警，正在调查原因",
    "assigned_to": {
      "user_id": 1002,
      "username": "engineer001",
      "real_name": "张工程师"
    }
  }
}
```
#### 解决告警
- **路径**: `PUT /api/v1/ops/alerts/{alertId}/resolve`
- **REQ-ID**: REQ-009-011
- **平台**: Web, Mobile
- **权限**: ops_alert_handle
- **描述**: 标记告警为已解决

**路径参数**:
- `alertId`: 告警ID

**请求参数**:
```json
{
  "resolution_note": "已重启服务，CPU使用率恢复正常",
  "resolution_method": "manual",
  "playbook_executed": "PB-003",
  "root_cause": "应用程序内存泄漏导致CPU占用过高",
  "preventive_actions": ["增加内存监控", "优化应用程序代码"],
  "create_ticket": true,
  "ticket_category": "系统优化"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "告警解决成功",
  "data": {
    "alert_id": "ALT-001",
    "status": "resolved",
    "resolved_by": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    },
    "resolved_at": "2024-08-11T18:00:00Z",
    "resolution_note": "已重启服务，CPU使用率恢复正常",
    "resolution_duration": "3小时30分钟",
    "created_ticket": {
      "ticket_id": 12346,
      "ticket_no": "TK202408110003",
      "title": "Web服务器CPU使用率过高问题优化"
    }
  }
}
```
### 9.4 任务执行管理

#### 获取执行任务列表
- **路径**: `GET /api/v1/ops/tasks`
- **REQ-ID**: REQ-009-013
- **平台**: Web
- **权限**: ops_task_read
- **描述**: 获取运维任务执行列表

**查询参数**:
- `status`: 任务状态 (pending, running, success, failed, cancelled)
- `playbook_id`: 剧本ID
- `executor_id`: 执行人ID
- `asset_id`: 目标资产ID
- `date_start`: 开始时间
- `date_end`: 结束时间
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "tasks": [
      {
        "task_id": "TSK-001",
        "playbook_id": "PB-001",
        "playbook_name": "Web服务器重启剧本",
        "status": "success",
        "progress": 100,
        "start_time": "2024-08-11T17:30:00Z",
        "end_time": "2024-08-11T17:35:00Z",
        "duration": "5分钟",
        "target_assets": ["AST-001", "AST-002"],
        "executor": {
          "user_id": 1001,
          "username": "ops_admin",
          "real_name": "运维管理员"
        },
        "trigger_source": "manual",
        "success_count": 2,
        "failed_count": 0
      }
    ],
    "summary": {
      "total_tasks": 156,
      "pending_count": 5,
      "running_count": 3,
      "success_count": 135,
      "failed_count": 13
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
#### 查询任务执行状态
- **路径**: `GET /api/v1/ops/tasks/{taskId}/status`
- **REQ-ID**: REQ-009-013
- **平台**: Web, Mobile
- **权限**: ops_task_read
- **描述**: 查询任务执行状态和结果

**路径参数**:
- `taskId`: 任务ID

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "task_id": "TSK-001",
    "playbook_id": "PB-001",
    "playbook_name": "Web服务器重启剧本",
    "status": "running",
    "progress": 60,
    "start_time": "2024-08-11T17:30:00Z",
    "estimated_completion": "2024-08-11T17:35:00Z",
    "current_step": "启动服务",
    "target_assets": ["AST-001", "AST-002"],
    "execution_mode": "sequential",
    "step_results": [
      {
        "step_order": 1,
        "step_name": "检查服务状态",
        "status": "success",
        "start_time": "2024-08-11T17:30:00Z",
        "end_time": "2024-08-11T17:30:05Z",
        "duration": 5,
        "output": "nginx is running",
        "asset_results": [
          {
            "asset_id": "AST-001",
            "status": "success",
            "output": "nginx (pid 1234) is running..."
          },
          {
            "asset_id": "AST-002",
            "status": "success",
            "output": "nginx (pid 5678) is running..."
          }
        ]
      },
      {
        "step_order": 2,
        "step_name": "停止服务",
        "status": "success",
        "start_time": "2024-08-11T17:30:05Z",
        "end_time": "2024-08-11T17:30:15Z",
        "duration": 10,
        "output": "Service stopped successfully",
        "asset_results": [
          {
            "asset_id": "AST-001",
            "status": "success",
            "output": "Stopping nginx: [OK]"
          },
          {
            "asset_id": "AST-002",
            "status": "success",
            "output": "Stopping nginx: [OK]"
          }
        ]
      },
      {
        "step_order": 3,
        "step_name": "启动服务",
        "status": "running",
        "start_time": "2024-08-11T17:30:15Z",
        "output": "Starting services...",
        "asset_results": [
          {
            "asset_id": "AST-001",
            "status": "running",
            "output": "Starting nginx..."
          },
          {
            "asset_id": "AST-002",
            "status": "pending",
            "output": ""
          }
        ]
      }
    ],
    "executor": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    }
  }
}
```
#### 停止任务执行
- **路径**: `PUT /api/v1/ops/tasks/{taskId}/stop`
- **REQ-ID**: REQ-009-013
- **平台**: Web
- **权限**: ops_task_control
- **描述**: 停止正在执行的运维任务

**路径参数**:
- `taskId`: 任务ID

**请求参数**:
```json
{
  "stop_reason": "紧急维护需要，手动停止任务",
  "force_stop": false,
  "cleanup_required": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "任务停止成功",
  "data": {
    "task_id": "TSK-001",
    "status": "cancelled",
    "stopped_at": "2024-08-11T17:32:00Z",
    "stopped_by": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    },
    "stop_reason": "紧急维护需要，手动停止任务",
    "completed_steps": 2,
    "total_steps": 4,
    "cleanup_status": "completed"
  }
}
```
### 9.5 运维日志管理

#### 获取运维日志
- **路径**: `GET /api/v1/ops/logs`
- **REQ-ID**: REQ-009-014
- **平台**: Web
- **权限**: ops_log_read
- **描述**: 获取运维操作日志

**查询参数**:
- `operation_type`: 操作类型 (playbook_execution, alert_handling, asset_management, manual_operation)
- `operator_id`: 操作人ID
- `asset_id`: 资产ID
- `severity`: 日志级别 (info, warning, error)
- `date_start`: 开始时间
- `date_end`: 结束时间
- `keyword`: 关键词搜索
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "logs": [
      {
        "log_id": "LOG-001",
        "operation_type": "playbook_execution",
        "operation_name": "执行Web服务器重启剧本",
        "operator": {
          "user_id": 1001,
          "username": "ops_admin",
          "real_name": "运维管理员"
        },
        "target_assets": ["AST-001", "AST-002"],
        "severity": "info",
        "status": "success",
        "duration": "5分钟",
        "details": {
          "task_id": "TSK-001",
          "playbook_id": "PB-001",
          "steps_completed": 4,
          "steps_total": 4
        },
        "ip_address": "192.168.1.200",
        "user_agent": "Mozilla/5.0...",
        "created_at": "2024-08-11T17:30:00Z"
      },
      {
        "log_id": "LOG-002",
        "operation_type": "alert_handling",
        "operation_name": "处理CPU使用率告警",
        "operator": {
          "user_id": 1002,
          "username": "engineer001",
          "real_name": "张工程师"
        },
        "target_assets": ["AST-001"],
        "severity": "warning",
        "status": "success",
        "duration": "30分钟",
        "details": {
          "alert_id": "ALT-001",
          "resolution_method": "manual",
          "root_cause": "应用程序内存泄漏"
        },
        "ip_address": "192.168.1.201",
        "user_agent": "Mozilla/5.0...",
        "created_at": "2024-08-11T16:00:00Z"
      }
    ],
    "summary": {
      "total_logs": 1256,
      "info_count": 1100,
      "warning_count": 120,
      "error_count": 36,
      "success_operations": 1180,
      "failed_operations": 76
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 1256,
      "pages": 63
    }
  }
}
```
#### 导出运维日志
- **路径**: `GET /api/v1/ops/logs/export`
- **REQ-ID**: REQ-009-014
- **平台**: Web
- **权限**: ops_log_export
- **描述**: 导出运维日志数据

**查询参数**:
- `format`: 导出格式 (csv, excel, json)
- `operation_type`: 操作类型筛选
- `date_start`: 开始时间
- `date_end`: 结束时间
- `include_details`: 是否包含详细信息 (默认: true)

**响应示例**:
```json
{
  "code": 200,
  "message": "日志导出成功",
  "data": {
    "export_id": "EXP-LOG-001",
    "file_name": "ops_logs_20240811.csv",
    "file_url": "https://files.example.com/exports/ops_logs_20240811.csv",
    "file_size": 5120,
    "record_count": 1256,
    "export_time": "2024-08-11T18:00:00Z",
    "exported_by": {
      "user_id": 1001,
      "username": "ops_admin",
      "real_name": "运维管理员"
    },
    "expires_at": "2024-08-18T18:00:00Z"
  }
}
```
---

## 10. 系统管理模块 (REQ-010)

### 10.1 组织架构管理

#### 获取部门树结构
- **路径**: `GET /api/v1/system/departments/tree`
- **REQ-ID**: REQ-010-003
- **平台**: Web
- **权限**: dept_read
- **描述**: 获取组织架构部门树结构

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "departments": [
      {
        "dept_id": 1,
        "dept_name": "技术部",
        "dept_code": "TECH",
        "parent_id": null,
        "level": 1,
        "sort_order": 1,
        "manager_id": 1001,
        "manager_name": "张总监",
        "member_count": 25,
        "status": "active",
        "description": "负责技术研发和运维工作",
        "created_at": "2024-01-01T00:00:00Z",
        "children": [
          {
            "dept_id": 11,
            "dept_name": "运维组",
            "dept_code": "OPS",
            "parent_id": 1,
            "level": 2,
            "sort_order": 1,
            "manager_id": 1002,
            "manager_name": "李经理",
            "member_count": 8,
            "status": "active",
            "description": "负责系统运维和监控",
            "created_at": "2024-01-01T00:00:00Z",
            "children": []
          }
        ]
      }
    ],
    "total_departments": 15,
    "total_members": 156
  }
}
```
#### 创建部门
- **路径**: `POST /api/v1/system/departments`
- **REQ-ID**: REQ-010-003
- **平台**: Web
- **权限**: dept_create
- **描述**: 创建新部门

**请求参数**:
```json
{
  "dept_name": "安全组",
  "dept_code": "SEC",
  "parent_id": 1,
  "manager_id": 1003,
  "description": "负责系统安全和风险管控",
  "sort_order": 3,
  "contact_info": {
    "phone": "010-12345678",
    "email": "security@company.com",
    "location": "北京总部5楼"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "部门创建成功",
  "data": {
    "dept_id": 15,
    "dept_name": "安全组",
    "dept_code": "SEC",
    "parent_id": 1,
    "level": 2,
    "status": "active",
    "created_at": "2024-08-11T14:30:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 更新部门信息
- **路径**: `PUT /api/v1/system/departments/{deptId}`
- **REQ-ID**: REQ-010-003
- **平台**: Web
- **权限**: dept_update
- **描述**: 更新部门信息

**路径参数**:
- `deptId`: 部门ID

**请求参数**:
```json
{
  "dept_name": "信息安全部",
  "manager_id": 1004,
  "description": "负责信息安全、风险管控和合规审计",
  "sort_order": 2,
  "contact_info": {
    "phone": "010-12345679",
    "email": "infosec@company.com",
    "location": "北京总部5楼501室"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "部门更新成功",
  "data": {
    "dept_id": 15,
    "updated_fields": ["dept_name", "manager_id", "description", "contact_info"],
    "updated_at": "2024-08-11T15:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 删除部门
- **路径**: `DELETE /api/v1/system/departments/{deptId}`
- **REQ-ID**: REQ-010-003
- **平台**: Web
- **权限**: dept_delete
- **描述**: 删除部门（需确保部门下无人员）

**路径参数**:
- `deptId`: 部门ID

**请求参数**:
```json
{
  "transfer_members_to": 1,
  "reason": "部门重组，合并到技术部",
  "force": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "部门删除成功",
  "data": {
    "dept_id": 15,
    "dept_name": "安全组",
    "deleted_at": "2024-08-11T16:00:00Z",
    "deleted_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "transferred_members": {
      "count": 3,
      "target_dept": {
        "dept_id": 1,
        "dept_name": "技术部"
      }
    },
    "reason": "部门重组，合并到技术部"
  }
}
```
### 10.2 角色权限管理

#### 获取角色列表
- **路径**: `GET /api/v1/system/roles`
- **REQ-ID**: REQ-010-002
- **平台**: Web
- **权限**: role_read
- **描述**: 获取系统角色列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `status`: 角色状态 (active, inactive)
- `type`: 角色类型 (system, custom)
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "roles": [
      {
        "role_id": 1,
        "role_name": "系统管理员",
        "role_code": "admin",
        "description": "系统最高权限管理员",
        "type": "system",
        "status": "active",
        "permission_count": 156,
        "user_count": 3,
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-08-01T10:00:00Z"
      },
      {
        "role_id": 2,
        "role_name": "运维工程师",
        "role_code": "engineer",
        "description": "负责系统运维和故障处理",
        "type": "custom",
        "status": "active",
        "permission_count": 45,
        "user_count": 25,
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-08-01T10:00:00Z"
      }
    ],
    "summary": {
      "total_count": 8,
      "system_roles": 3,
      "custom_roles": 5,
      "active_roles": 7,
      "inactive_roles": 1
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 8,
      "pages": 1
    }
  }
}
```
#### 创建角色
- **路径**: `POST /api/v1/system/roles`
- **REQ-ID**: REQ-010-002
- **平台**: Web
- **权限**: role_create
- **描述**: 创建新角色

**请求参数**:
```json
{
  "role_name": "高级运维工程师",
  "role_code": "senior_engineer",
  "description": "具有高级运维权限的工程师角色",
  "permissions": [
    "ticket_read",
    "ticket_create",
    "ticket_update",
    "ticket_assign",
    "asset_read",
    "asset_update",
    "ops_playbook_execute",
    "knowledge_create",
    "knowledge_update"
  ],
  "is_system_role": false,
  "data_scope": "dept",
  "dept_ids": [1, 11]
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "角色创建成功",
  "data": {
    "role_id": 9,
    "role_name": "高级运维工程师",
    "role_code": "senior_engineer",
    "type": "custom",
    "status": "active",
    "permission_count": 9,
    "created_at": "2024-08-11T14:30:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 更新角色权限
- **路径**: `PUT /api/v1/system/roles/{roleId}/permissions`
- **REQ-ID**: REQ-010-002
- **平台**: Web
- **权限**: role_permission
- **描述**: 更新角色权限配置

**路径参数**:
- `roleId`: 角色ID

**请求参数**:
```json
{
  "permissions": [
    "ticket_read",
    "ticket_create",
    "ticket_update",
    "ticket_assign",
    "ticket_close",
    "asset_read",
    "asset_update",
    "ops_playbook_execute",
    "knowledge_create",
    "knowledge_update",
    "report_read"
  ],
  "data_scope": "all",
  "dept_ids": []
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "权限更新成功",
  "data": {
    "role_id": 9,
    "role_name": "高级运维工程师",
    "permission_changes": {
      "added": ["ticket_close", "report_read"],
      "removed": [],
      "total_count": 11
    },
    "updated_at": "2024-08-11T15:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 获取权限列表
- **路径**: `GET /api/v1/system/permissions`
- **REQ-ID**: REQ-010-002
- **平台**: Web
- **权限**: permission_read
- **描述**: 获取系统所有权限列表

**查询参数**:
- `module`: 模块筛选 (ticket, asset, knowledge, system)
- `type`: 权限类型 (read, write, delete, admin)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "permissions": [
      {
        "permission_id": 1,
        "permission_code": "ticket_read",
        "permission_name": "工单查看",
        "module": "ticket",
        "type": "read",
        "description": "查看工单信息的权限",
        "parent_permission": null,
        "sort_order": 1
      },
      {
        "permission_id": 2,
        "permission_code": "ticket_create",
        "permission_name": "工单创建",
        "module": "ticket",
        "type": "write",
        "description": "创建新工单的权限",
        "parent_permission": "ticket_read",
        "sort_order": 2
      }
    ],
    "modules": [
      {
        "module": "ticket",
        "module_name": "工单管理",
        "permission_count": 8,
        "description": "工单相关操作权限"
      },
      {
        "module": "asset",
        "module_name": "资产管理",
        "permission_count": 6,
        "description": "资产相关操作权限"
      }
    ],
    "total_permissions": 156
  }
}
```
### 10.3 用户账号管理

#### 获取用户列表
- **路径**: `GET /api/v1/system/users`
- **REQ-ID**: REQ-010-001
- **平台**: Web
- **权限**: user_read
- **描述**: 获取系统用户列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `dept_id`: 部门ID筛选
- `role_id`: 角色ID筛选
- `status`: 用户状态 (active, inactive, locked)
- `keyword`: 关键词搜索 (用户名、姓名、邮箱)
- `sort`: 排序方式 (created_desc, name_asc, last_login_desc)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "users": [
      {
        "user_id": 1001,
        "username": "zhangsan",
        "real_name": "张三",
        "email": "zhangsan@company.com",
        "phone": "13800138000",
        "avatar": "https://avatar.example.com/1001.jpg",
        "department": {
          "dept_id": 11,
          "dept_name": "运维组",
          "parent_name": "技术部"
        },
        "position": "运维工程师",
        "roles": [
          {
            "role_id": 2,
            "role_name": "运维工程师",
            "role_code": "engineer"
          }
        ],
        "status": "active",
        "last_login": "2024-08-11T08:30:00Z",
        "login_count": 156,
        "created_at": "2024-01-15T10:00:00Z",
        "updated_at": "2024-08-11T14:30:00Z"
      }
    ],
    "summary": {
      "total_count": 156,
      "active_count": 145,
      "inactive_count": 8,
      "locked_count": 3,
      "department_distribution": {
        "技术部": 89,
        "业务部": 45,
        "管理部": 22
      }
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
#### 创建用户账号
- **路径**: `POST /api/v1/system/users`
- **REQ-ID**: REQ-010-001
- **平台**: Web
- **权限**: user_create
- **描述**: 创建新用户账号

**请求参数**:
```json
{
  "username": "zhangsan",
  "real_name": "张三",
  "email": "zhangsan@company.com",
  "phone": "13800138000",
  "dept_id": 11,
  "position": "运维工程师",
  "roles": ["engineer"],
  "password": "TempPassword123!",
  "force_password_change": true,
  "send_welcome_email": true,
  "employee_no": "EMP001",
  "hire_date": "2024-08-11",
  "manager_id": 1002
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "用户创建成功",
  "data": {
    "user_id": 1156,
    "username": "zhangsan",
    "real_name": "张三",
    "email": "zhangsan@company.com",
    "status": "active",
    "temp_password": "TempPassword123!",
    "force_password_change": true,
    "welcome_email_sent": true,
    "created_at": "2024-08-11T14:30:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 重置用户密码
- **路径**: `PUT /api/v1/system/users/{userId}/password/reset`
- **REQ-ID**: REQ-010-001
- **平台**: Web
- **权限**: user_password_reset
- **描述**: 重置用户密码

**路径参数**:
- `userId`: 用户ID

**请求参数**:
```json
{
  "new_password": "NewPassword123!",
  "force_change": true,
  "send_notification": true,
  "reason": "用户忘记密码"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "密码重置成功",
  "data": {
    "user_id": 1001,
    "username": "zhangsan",
    "temp_password": "NewPassword123!",
    "force_change": true,
    "notification_sent": true,
    "reset_at": "2024-08-11T15:30:00Z",
    "reset_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "expires_at": "2024-08-18T15:30:00Z"
  }
}
```
#### 锁定/解锁用户
- **路径**: `PUT /api/v1/system/users/{userId}/status`
- **REQ-ID**: REQ-010-001
- **平台**: Web
- **权限**: user_status_manage
- **描述**: 锁定或解锁用户账号

**路径参数**:
- `userId`: 用户ID

**请求参数**:
```json
{
  "status": "locked",
  "reason": "多次登录失败，安全锁定",
  "duration": 24,
  "notify_user": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "用户状态更新成功",
  "data": {
    "user_id": 1001,
    "username": "zhangsan",
    "old_status": "active",
    "new_status": "locked",
    "reason": "多次登录失败，安全锁定",
    "locked_until": "2024-08-12T15:30:00Z",
    "updated_at": "2024-08-11T15:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "notification_sent": true
  }
}
```
### 10.4 系统监控管理

#### 获取系统状态
- **路径**: `GET /api/v1/system/status`
- **REQ-ID**: REQ-010-007
- **平台**: Web
- **权限**: system_monitor
- **描述**: 获取系统运行状态

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "system_info": {
      "version": "v4.5.0",
      "uptime": "15天3小时",
      "environment": "production",
      "server_time": "2024-08-11T16:00:00Z",
      "timezone": "Asia/Shanghai"
    },
    "performance": {
      "cpu_usage": 45.2,
      "memory_usage": 68.5,
      "disk_usage": 72.1,
      "network_io": {
        "inbound_mbps": 125.6,
        "outbound_mbps": 89.3
      },
      "active_connections": 156,
      "active_sessions": 89
    },
    "services": [
      {
        "service_name": "database",
        "status": "healthy",
        "response_time": 12,
        "connections": {
          "active": 25,
          "max": 100
        }
      },
      {
        "service_name": "redis",
        "status": "healthy",
        "response_time": 3,
        "memory_usage": "45%"
      },
      {
        "service_name": "elasticsearch",
        "status": "healthy",
        "response_time": 8,
        "cluster_health": "green"
      }
    ],
    "alerts": [
      {
        "level": "warning",
        "message": "磁盘使用率超过70%",
        "timestamp": "2024-08-11T15:30:00Z"
      }
    ]
  }
}
```
#### 获取系统日志
- **路径**: `GET /api/v1/system/logs`
- **REQ-ID**: REQ-010-007
- **平台**: Web
- **权限**: system_log_read
- **描述**: 获取系统运行日志

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 50)
- `level`: 日志级别 (error, warn, info, debug)
- `module`: 模块名称
- `start_time`: 开始时间
- `end_time`: 结束时间
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "logs": [
      {
        "log_id": "log_001",
        "timestamp": "2024-08-11T15:30:00Z",
        "level": "error",
        "module": "ticket",
        "message": "工单分配失败：工程师不可用",
        "details": {
          "ticket_id": 12345,
          "engineer_id": 1001,
          "error_code": "ENGINEER_UNAVAILABLE"
        },
        "trace_id": "trace_abc123",
        "user_id": 2001,
        "ip_address": "192.168.1.100"
      }
    ],
    "summary": {
      "total_count": 1256,
      "error_count": 23,
      "warn_count": 156,
      "info_count": 1077
    },
    "pagination": {
      "page": 1,
      "size": 50,
      "total": 1256,
      "pages": 26
    }
  }
}
```
#### 系统性能监控
- **路径**: `GET /api/v1/system/performance`
- **REQ-ID**: REQ-010-007
- **平台**: Web
- **权限**: system_monitor
- **描述**: 获取系统性能监控数据

**查询参数**:
- `period`: 统计周期 (1h, 6h, 24h, 7d, 30d)
- `metrics`: 指标类型 (cpu, memory, disk, network, database)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "period": "24h",
    "timestamp": "2024-08-11T16:00:00Z",
    "metrics": {
      "cpu": {
        "current": 45.2,
        "average": 38.5,
        "peak": 78.3,
        "trend": "stable"
      },
      "memory": {
        "current": 68.5,
        "average": 62.1,
        "peak": 85.2,
        "available_gb": 32.5
      },
      "disk": {
        "current": 72.1,
        "available_gb": 1024,
        "io_read_mbps": 45.6,
        "io_write_mbps": 23.4
      },
      "network": {
        "inbound_mbps": 125.6,
        "outbound_mbps": 89.3,
        "connections": 156
      },
      "database": {
        "connections": 25,
        "queries_per_second": 156,
        "slow_queries": 3,
        "response_time": 12
      }
    },
    "alerts": [
      {
        "metric": "disk_usage",
        "threshold": 70,
        "current_value": 72.1,
        "level": "warning",
        "message": "磁盘使用率超过阈值"
      }
    ]
  }
}
```
### 10.5 数据备份管理

#### 创建数据备份
- **路径**: `POST /api/v1/system/backup`
- **REQ-ID**: REQ-010-005
- **平台**: Web
- **权限**: backup_create
- **描述**: 创建系统数据备份

**请求参数**:
```json
{
  "backup_type": "full",
  "backup_scope": ["user_data", "config_data", "log_data", "knowledge_data"],
  "description": "月度全量备份",
  "schedule_time": "2024-08-11T02:00:00Z",
  "retention_days": 90,
  "compression": true,
  "encryption": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "备份任务创建成功",
  "data": {
    "backup_id": "backup_001",
    "backup_type": "full",
    "status": "scheduled",
    "schedule_time": "2024-08-11T02:00:00Z",
    "estimated_duration": "2小时",
    "estimated_size": "15GB",
    "created_at": "2024-08-11T16:00:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
#### 获取备份列表
- **路径**: `GET /api/v1/system/backup`
- **REQ-ID**: REQ-010-005
- **平台**: Web
- **权限**: backup_read
- **描述**: 获取数据备份列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `type`: 备份类型 (full, incremental)
- `status`: 备份状态 (scheduled, running, completed, failed)
- `date_range`: 时间范围

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "backups": [
      {
        "backup_id": "backup_001",
        "backup_type": "full",
        "description": "月度全量备份",
        "status": "completed",
        "file_size": "14.5GB",
        "file_path": "/backups/2024/08/backup_001.tar.gz",
        "start_time": "2024-08-11T02:00:00Z",
        "end_time": "2024-08-11T03:45:00Z",
        "duration": "1小时45分钟",
        "retention_until": "2024-11-09T02:00:00Z",
        "created_by": "admin"
      }
    ],
    "summary": {
      "total_count": 25,
      "completed_count": 23,
      "failed_count": 2,
      "total_size": "356GB"
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 25,
      "pages": 2
    }
  }
}
```
#### 恢复数据备份
- **路径**: `POST /api/v1/system/backup/{backupId}/restore`
- **REQ-ID**: REQ-010-005
- **平台**: Web
- **权限**: backup_restore
- **描述**: 从备份恢复数据

**路径参数**:
- `backupId`: 备份ID

**请求参数**:
```json
{
  "restore_scope": ["user_data", "config_data"],
  "target_time": "2024-08-11T02:00:00Z",
  "confirm_restore": true,
  "reason": "系统故障恢复"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "恢复任务启动成功",
  "data": {
    "restore_id": "restore_001",
    "backup_id": "backup_001",
    "status": "running",
    "estimated_duration": "30分钟",
    "restore_scope": ["user_data", "config_data"],
    "started_at": "2024-08-11T16:30:00Z",
    "started_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "warning": "恢复过程中系统将暂时不可用"
  }
}
```
### 10.6 系统配置管理

#### 获取系统管理配置
- **路径**: `GET /api/v1/system/management/config`
- **REQ-ID**: REQ-010-004
- **平台**: Web
- **权限**: system_config_read
- **描述**: 获取系统管理全局配置

**查询参数**:
- `category`: 配置分类 (system, security, notification, integration)
- `level`: 配置级别 (global, tenant)
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "configs": [
      {
        "config_id": 1,
        "config_key": "system.name",
        "config_value": "IT运维门户系统",
        "category": "system",
        "level": "global",
        "data_type": "string",
        "description": "系统名称",
        "is_sensitive": false,
        "updated_at": "2024-08-01T10:00:00Z",
        "updated_by": "admin"
      },
      {
        "config_id": 2,
        "config_key": "security.password_policy.min_length",
        "config_value": "8",
        "category": "security",
        "level": "global",
        "data_type": "integer",
        "description": "密码最小长度",
        "is_sensitive": false,
        "updated_at": "2024-08-01T10:00:00Z",
        "updated_by": "admin"
      }
    ],
    "categories": [
      {
        "category": "system",
        "category_name": "系统设置",
        "config_count": 15
      },
      {
        "category": "security",
        "category_name": "安全策略",
        "config_count": 12
      }
    ]
  }
}
```
#### 更新系统管理配置
- **路径**: `PUT /api/v1/system/management/config`
- **REQ-ID**: REQ-010-004
- **平台**: Web
- **权限**: system_config_update
- **描述**: 更新系统管理全局配置

**请求参数**:
```json
{
  "configs": [
    {
      "config_key": "system.name",
      "config_value": "IT运维门户系统 v4.5",
      "description": "系统名称"
    },
    {
      "config_key": "system.timezone",
      "config_value": "Asia/Shanghai",
      "description": "系统时区"
    },
    {
      "config_key": "security.session_timeout",
      "config_value": "7200",
      "description": "会话超时时间(秒)"
    }
  ],
  "reason": "系统升级配置更新"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "配置更新成功",
  "data": {
    "updated_configs": 3,
    "changes": [
      {
        "config_key": "system.name",
        "old_value": "IT运维门户系统",
        "new_value": "IT运维门户系统 v4.5"
      },
      {
        "config_key": "security.session_timeout",
        "old_value": "3600",
        "new_value": "7200"
      }
    ],
    "updated_at": "2024-08-11T16:30:00Z",
    "updated_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    },
    "reason": "系统升级配置更新"
  }
}
```
---

## 11. 通知消息模块 (REQ-011)

### 11.1 消息发送

#### 发送通知消息
- **路径**: `POST /api/v1/notifications/send`
- **REQ-ID**: REQ-011-001
- **平台**: API
- **权限**: notification_send
- **描述**: 发送单个或多个通知消息

**请求参数**:
```json
{
  "recipient_type": "user",
  "recipient_ids": [1001, 1002],
  "message_type": "ticket_assigned",
  "title": "新工单分配通知",
  "content": "您有一个新的工单需要处理：邮件服务器故障",
  "channels": ["in_app", "email", "sms"],
  "priority": "high",
  "template_code": "ticket_assignment",
  "template_data": {
    "ticket_id": 12345,
    "ticket_title": "邮件服务器故障",
    "assignee_name": "张工程师",
    "deadline": "2024-08-12T18:00:00Z"
  },
  "scheduled_time": null,
  "expire_time": "2024-08-18T18:00:00Z"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "通知发送成功",
  "data": {
    "notification_id": "notif_001",
    "batch_id": "batch_001",
    "recipient_count": 2,
    "channels_used": ["in_app", "email", "sms"],
    "send_results": [
      {
        "recipient_id": 1001,
        "channels": {
          "in_app": "sent",
          "email": "sent",
          "sms": "sent"
        }
      },
      {
        "recipient_id": 1002,
        "channels": {
          "in_app": "sent",
          "email": "sent",
          "sms": "failed"
        }
      }
    ],
    "sent_at": "2024-08-11T16:30:00Z",
    "success_rate": 83.3
  }
}
```
#### 批量发送通知
- **路径**: `POST /api/v1/notifications/batch`
- **REQ-ID**: REQ-011-002
- **平台**: API
- **权限**: notification_send
- **描述**: 批量发送多种类型的通知消息

**请求参数**:
```json
{
  "notifications": [
    {
      "recipient_type": "user",
      "recipient_ids": [1001, 1002],
      "message_type": "ticket_assigned",
      "title": "新工单分配",
      "content": "您有新的工单需要处理",
      "channels": ["in_app", "email"],
      "priority": "high",
      "template_code": "ticket_assignment"
    },
    {
      "recipient_type": "role",
      "recipient_ids": ["admin"],
      "message_type": "system_alert",
      "title": "系统告警",
      "content": "磁盘使用率超过阈值",
      "channels": ["in_app", "sms"],
      "priority": "urgent",
      "template_code": "system_alert"
    }
  ],
  "batch_name": "工单分配和系统告警",
  "scheduled_time": null
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "批量通知发送成功",
  "data": {
    "batch_id": "batch_002",
    "total_notifications": 2,
    "total_recipients": 5,
    "send_summary": {
      "success_count": 4,
      "failed_count": 1,
      "success_rate": 80.0
    },
    "notifications": [
      {
        "notification_id": "notif_002",
        "message_type": "ticket_assigned",
        "recipient_count": 2,
        "status": "sent"
      },
      {
        "notification_id": "notif_003",
        "message_type": "system_alert",
        "recipient_count": 3,
        "status": "sent"
      }
    ],
    "sent_at": "2024-08-11T16:35:00Z"
  }
}
```
### 11.2 消息查询

#### 获取用户消息
- **路径**: `GET /api/v1/notifications`
- **REQ-ID**: REQ-011-003
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取当前用户的通知消息列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `read_status`: 读取状态 (all, read, unread)
- `message_type`: 消息类型筛选
- `priority`: 优先级筛选 (urgent, high, normal, low)
- `channel`: 渠道筛选 (in_app, email, sms, push)
- `date_range`: 时间范围

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "notifications": [
      {
        "notification_id": "notif_001",
        "title": "新工单分配通知",
        "content": "您有一个新的工单需要处理：邮件服务器故障",
        "message_type": "ticket_assigned",
        "priority": "high",
        "channel": "in_app",
        "read_status": "unread",
        "sender": {
          "user_id": 2001,
          "username": "admin",
          "real_name": "管理员"
        },
        "data": {
          "ticket_id": 12345,
          "ticket_title": "邮件服务器故障"
        },
        "sent_time": "2024-08-11T16:30:00Z",
        "read_time": null,
        "expire_time": "2024-08-18T18:00:00Z",
        "actions": [
          {
            "action": "view_ticket",
            "label": "查看工单",
            "url": "/tickets/12345"
          },
          {
            "action": "accept_assignment",
            "label": "接受分配",
            "url": "/tickets/12345/accept"
          }
        ]
      }
    ],
    "summary": {
      "total_count": 156,
      "unread_count": 23,
      "urgent_count": 2,
      "high_count": 8,
      "normal_count": 13
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
#### 标记消息已读
- **路径**: `PUT /api/v1/notifications/{notificationId}/read`
- **REQ-ID**: REQ-011-003
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 标记指定消息为已读

**路径参数**:
- `notificationId`: 通知ID

**请求参数**:
```json
{
  "read_time": "2024-08-11T17:00:00Z",
  "action_taken": "view_ticket"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "消息已标记为已读",
  "data": {
    "notification_id": "notif_001",
    "read_status": "read",
    "read_time": "2024-08-11T17:00:00Z",
    "action_taken": "view_ticket"
  }
}
```
#### 批量标记已读
- **路径**: `PUT /api/v1/notifications/batch/read`
- **REQ-ID**: REQ-011-003
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 批量标记消息为已读

**请求参数**:
```json
{
  "notification_ids": ["notif_001", "notif_002", "notif_003"],
  "mark_all": false,
  "filter": {
    "message_type": "ticket_assigned",
    "before_time": "2024-08-11T17:00:00Z"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "批量标记成功",
  "data": {
    "marked_count": 3,
    "failed_count": 0,
    "updated_at": "2024-08-11T17:00:00Z"
  }
}
```
### 11.3 通知配置

#### 获取通知设置
- **路径**: `GET /api/v1/notifications/settings`
- **REQ-ID**: REQ-011-005
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取用户个人通知偏好设置

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "user_id": 1001,
    "global_settings": {
      "enabled": true,
      "do_not_disturb": {
        "enabled": true,
        "start_time": "22:00",
        "end_time": "08:00",
        "timezone": "Asia/Shanghai"
      },
      "language": "zh-CN",
      "max_daily_notifications": 100
    },
    "notification_types": [
      {
        "type": "ticket_assigned",
        "type_name": "工单分配",
        "enabled": true,
        "channels": {
          "in_app": true,
          "email": true,
          "sms": false,
          "push": true
        },
        "priority_filter": ["urgent", "high", "normal"],
        "frequency": "immediate"
      },
      {
        "type": "ticket_status_change",
        "type_name": "工单状态变更",
        "enabled": true,
        "channels": {
          "in_app": true,
          "email": false,
          "sms": false,
          "push": true
        },
        "priority_filter": ["urgent", "high"],
        "frequency": "immediate"
      },
      {
        "type": "system_maintenance",
        "type_name": "系统维护通知",
        "enabled": true,
        "channels": {
          "in_app": true,
          "email": true,
          "sms": true,
          "push": true
        },
        "priority_filter": ["urgent", "high", "normal", "low"],
        "frequency": "immediate"
      }
    ],
    "channel_settings": {
      "email": {
        "address": "zhangsan@company.com",
        "verified": true,
        "format": "html"
      },
      "sms": {
        "phone": "13800138000",
        "verified": true,
        "country_code": "+86"
      },
      "push": {
        "device_tokens": ["token_001", "token_002"],
        "enabled": true
      }
    },
    "updated_at": "2024-08-11T14:30:00Z"
  }
}
```
#### 更新通知设置
- **路径**: `PUT /api/v1/notifications/settings`
- **REQ-ID**: REQ-011-005
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 更新用户个人通知偏好设置

**请求参数**:
```json
{
  "global_settings": {
    "enabled": true,
    "do_not_disturb": {
      "enabled": true,
      "start_time": "23:00",
      "end_time": "07:00"
    },
    "max_daily_notifications": 80
  },
  "notification_types": [
    {
      "type": "ticket_assigned",
      "enabled": true,
      "channels": {
        "in_app": true,
        "email": true,
        "sms": true,
        "push": true
      },
      "priority_filter": ["urgent", "high", "normal"],
      "frequency": "immediate"
    },
    {
      "type": "ticket_status_change",
      "enabled": false,
      "channels": {
        "in_app": true,
        "email": false,
        "sms": false,
        "push": false
      }
    }
  ],
  "channel_settings": {
    "email": {
      "format": "text"
    },
    "sms": {
      "phone": "13800138001"
    }
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "通知设置更新成功",
  "data": {
    "user_id": 1001,
    "updated_settings": [
      "do_not_disturb.start_time",
      "do_not_disturb.end_time",
      "max_daily_notifications",
      "ticket_assigned.channels.sms",
      "ticket_status_change.enabled",
      "email.format",
      "sms.phone"
    ],
    "updated_at": "2024-08-11T17:30:00Z",
    "verification_required": {
      "sms": {
        "phone": "13800138001",
        "verification_code_sent": true,
        "expires_at": "2024-08-11T17:40:00Z"
      }
    }
  }
}
```
### 11.4 消息模板管理

#### 获取消息模板列表
- **路径**: `GET /api/v1/notifications/templates`
- **REQ-ID**: REQ-011-008
- **平台**: Web
- **权限**: template_read
- **描述**: 获取消息模板列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `type`: 模板类型筛选
- `channel`: 渠道筛选 (email, sms, in_app, push)
- `status`: 状态筛选 (active, inactive)
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "templates": [
      {
        "template_id": 1,
        "template_code": "ticket_assignment",
        "template_name": "工单分配通知模板",
        "template_type": "ticket_assigned",
        "channel": "email",
        "subject_template": "新工单分配：{{ticket_title}}",
        "content_template": "尊敬的{{assignee_name}}，您有一个新的工单需要处理：\n\n工单编号：{{ticket_no}}\n工单标题：{{ticket_title}}\n优先级：{{priority}}\n截止时间：{{deadline}}\n\n请及时处理。",
        "variables": [
          {
            "name": "assignee_name",
            "type": "string",
            "description": "分配人姓名",
            "required": true
          },
          {
            "name": "ticket_no",
            "type": "string",
            "description": "工单编号",
            "required": true
          },
          {
            "name": "ticket_title",
            "type": "string",
            "description": "工单标题",
            "required": true
          }
        ],
        "status": "active",
        "usage_count": 156,
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-08-01T10:00:00Z"
      }
    ],
    "summary": {
      "total_count": 25,
      "active_count": 23,
      "inactive_count": 2,
      "channel_distribution": {
        "email": 10,
        "sms": 8,
        "in_app": 5,
        "push": 2
      }
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 25,
      "pages": 2
    }
  }
}
```
#### 创建消息模板
- **路径**: `POST /api/v1/notifications/templates`
- **REQ-ID**: REQ-011-008
- **平台**: Web
- **权限**: template_create
- **描述**: 创建新的消息模板

**请求参数**:
```json
{
  "template_code": "sla_warning",
  "template_name": "SLA预警通知模板",
  "template_type": "sla_warning",
  "channel": "email",
  "subject_template": "SLA预警：{{ticket_title}}",
  "content_template": "工单{{ticket_no}}即将超过SLA时限：\n\n工单标题：{{ticket_title}}\n当前状态：{{status}}\nSLA截止时间：{{sla_deadline}}\n剩余时间：{{remaining_time}}\n\n请尽快处理。",
  "variables": [
    {
      "name": "ticket_no",
      "type": "string",
      "description": "工单编号",
      "required": true
    },
    {
      "name": "ticket_title",
      "type": "string",
      "description": "工单标题",
      "required": true
    },
    {
      "name": "status",
      "type": "string",
      "description": "当前状态",
      "required": true
    },
    {
      "name": "sla_deadline",
      "type": "datetime",
      "description": "SLA截止时间",
      "required": true
    },
    {
      "name": "remaining_time",
      "type": "string",
      "description": "剩余时间",
      "required": true
    }
  ],
  "status": "active"
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "模板创建成功",
  "data": {
    "template_id": 26,
    "template_code": "sla_warning",
    "template_name": "SLA预警通知模板",
    "status": "active",
    "created_at": "2024-08-11T17:30:00Z",
    "created_by": {
      "user_id": 2001,
      "username": "admin",
      "real_name": "管理员"
    }
  }
}
```
---

## 12. 系统集成模块 (REQ-012)

### 12.1 第三方系统集成

#### 获取集成配置列表
- **路径**: `GET /api/v1/integrations`
- **REQ-ID**: REQ-012-001
- **平台**: Web
- **权限**: integration_read
- **描述**: 获取第三方系统集成配置列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `type`: 集成类型 (api, database, message_queue, file_transfer, monitoring)
- `status`: 集成状态 (active, inactive, error)
- `provider`: 服务提供商 (netbox, prometheus, grafana, zabbix)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "integrations": [
      {
        "integration_id": 1001,
        "integration_name": "Netbox资产管理集成",
        "integration_type": "api",
        "source_system": "netbox",
        "target_system": "ops_portal",
        "status": "active",
        "connection_config": {
          "endpoint": "https://netbox.company.com/api",
          "auth_type": "token",
          "version": "v2.8"
        },
        "sync_config": {
          "sync_type": "incremental",
          "sync_interval": 3600,
          "batch_size": 100
        },
        "last_sync": "2024-08-11T14:30:00Z",
        "sync_status": "success",
        "created_at": "2024-08-01T10:00:00Z"
      },
      {
        "integration_id": 1002,
        "integration_name": "Prometheus监控集成",
        "integration_type": "api",
        "source_system": "prometheus",
        "target_system": "ops_portal",
        "status": "active",
        "connection_config": {
          "endpoint": "http://prometheus:9090/api/v1",
          "auth_type": "basic"
        },
        "mapping_rules": {
          "alert_name": "ticket_title",
          "alert_severity": "ticket_priority",
          "instance": "affected_asset"
        },
        "last_sync": "2024-08-11T14:25:00Z",
        "sync_status": "success",
        "created_at": "2024-08-01T11:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 15,
      "pages": 1
    }
  }
}
```
#### 创建集成配置
- **路径**: `POST /api/v1/integrations`
- **REQ-ID**: REQ-012-001
- **平台**: Web
- **权限**: integration_create
- **描述**: 创建新的第三方系统集成配置

**请求参数**:
```json
{
  "integration_name": "夜莺监控系统集成",
  "integration_type": "api",
  "source_system": "nightingale",
  "target_system": "ops_portal",
  "connection_config": {
    "endpoint": "https://n9e.company.com/api/v1",
    "auth_type": "bearer",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "timeout": 30,
    "verify_ssl": true
  },
  "mapping_rules": {
    "alert_name": "ticket_title",
    "alert_level": "ticket_priority",
    "alert_time": "created_at",
    "instance_ip": "affected_asset"
  },
  "sync_config": {
    "sync_type": "realtime",
    "sync_interval": 60,
    "batch_size": 50,
    "retry_count": 3
  },
  "retry_config": {
    "max_retries": 5,
    "retry_interval": 300,
    "backoff_factor": 2
  },
  "enabled": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "集成配置创建成功",
  "data": {
    "integration_id": 1003,
    "integration_name": "夜莺监控系统集成",
    "status": "active",
    "test_result": {
      "connection_status": "success",
      "response_time": 156,
      "test_time": "2024-08-11T15:30:00Z"
    },
    "created_at": "2024-08-11T15:30:00Z"
  }
}
```
#### 更新集成配置
- **路径**: `PUT /api/v1/integrations/{integrationId}`
- **REQ-ID**: REQ-012-001
- **平台**: Web
- **权限**: integration_update
- **描述**: 更新集成配置

**路径参数**:
- `integrationId`: 集成配置ID

**请求参数**:
```json
{
  "integration_name": "夜莺监控系统集成（更新版）",
  "connection_config": {
    "endpoint": "https://n9e.company.com/api/v2",
    "auth_type": "bearer",
    "token": "new_token_here",
    "timeout": 45
  },
  "sync_config": {
    "sync_interval": 30,
    "batch_size": 100
  },
  "enabled": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "集成配置更新成功",
  "data": {
    "integration_id": 1003,
    "updated_fields": ["connection_config", "sync_config"],
    "updated_at": "2024-08-11T16:30:00Z",
    "test_result": {
      "connection_status": "success",
      "response_time": 142
    }
  }
}
```
#### 测试集成连接
- **路径**: `POST /api/v1/integrations/{integrationId}/test`
- **REQ-ID**: REQ-012-001
- **平台**: Web
- **权限**: integration_test
- **描述**: 测试第三方系统连接

**路径参数**:
- `integrationId`: 集成配置ID

**响应示例**:
```json
{
  "code": 200,
  "message": "连接测试完成",
  "data": {
    "test_result": {
      "connection_status": "success",
      "response_time": 156,
      "api_version": "v2.8",
      "available_endpoints": [
        "/devices",
        "/alerts",
        "/metrics"
      ],
      "test_time": "2024-08-11T15:45:00Z",
      "error_details": null
    }
  }
}
```
### 12.2 数据同步管理

#### 触发数据同步
- **路径**: `POST /api/v1/integrations/{integrationId}/sync`
- **REQ-ID**: REQ-012-002
- **平台**: Web, API
- **权限**: integration_sync
- **描述**: 手动触发数据同步

**路径参数**:
- `integrationId`: 集成配置ID

**请求参数**:
```json
{
  "sync_type": "incremental",
  "sync_scope": ["devices", "alerts", "metrics"],
  "data_filter": {
    "start_time": "2024-08-11T00:00:00Z",
    "end_time": "2024-08-11T23:59:59Z",
    "device_types": ["server", "switch", "router"]
  },
  "force_update": false,
  "async_mode": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "同步任务启动成功",
  "data": {
    "sync_task_id": "SYNC_20240811_001",
    "sync_type": "incremental",
    "estimated_duration": "5分钟",
    "status": "running",
    "progress_url": "/api/v1/integrations/sync/progress/SYNC_20240811_001",
    "started_at": "2024-08-11T16:00:00Z"
  }
}
```
#### 获取同步历史
- **路径**: `GET /api/v1/integrations/{integrationId}/sync/history`
- **REQ-ID**: REQ-012-002
- **平台**: Web
- **权限**: integration_read
- **描述**: 获取数据同步历史记录

**路径参数**:
- `integrationId`: 集成配置ID

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `status`: 同步状态 (success, failed, running, cancelled)
- `sync_type`: 同步类型 (full, incremental, manual)
- `start_date`: 开始日期
- `end_date`: 结束日期

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "sync_records": [
      {
        "sync_id": "SYNC_20240811_001",
        "sync_type": "incremental",
        "status": "success",
        "start_time": "2024-08-11T14:00:00Z",
        "end_time": "2024-08-11T14:05:00Z",
        "duration": "5分钟",
        "records_processed": 156,
        "records_updated": 12,
        "records_created": 3,
        "records_deleted": 1,
        "errors": [],
        "data_summary": {
          "devices": {
            "processed": 120,
            "updated": 8,
            "created": 2
          },
          "alerts": {
            "processed": 36,
            "updated": 4,
            "created": 1
          }
        }
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 45,
      "pages": 3
    }
  }
}
```
#### 获取同步状态
- **路径**: `GET /api/v1/integrations/{integrationId}/sync/status`
- **REQ-ID**: REQ-012-002
- **平台**: Web, API
- **权限**: integration_read
- **描述**: 获取当前同步任务状态

**路径参数**:
- `integrationId`: 集成配置ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "current_sync": {
      "sync_task_id": "SYNC_20240811_002",
      "status": "running",
      "progress": 65,
      "start_time": "2024-08-11T16:00:00Z",
      "estimated_completion": "2024-08-11T16:08:00Z",
      "current_step": "同步设备信息",
      "records_processed": 98,
      "total_records": 150
    },
    "last_sync": {
      "sync_id": "SYNC_20240811_001",
      "status": "success",
      "end_time": "2024-08-11T14:05:00Z",
      "records_processed": 156
    },
    "next_scheduled_sync": "2024-08-11T17:00:00Z"
  }
}
```
### 12.3 API接口管理

#### 获取API接口列表
- **路径**: `GET /api/v1/integrations/apis`
- **REQ-ID**: REQ-012-003
- **平台**: Web
- **权限**: api_read
- **描述**: 获取对外API接口列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `status`: 接口状态 (active, inactive, deprecated)
- `auth_type`: 认证类型 (api_key, oauth, jwt)
- `category`: 接口分类 (ticket, asset, knowledge, report)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "apis": [
      {
        "api_id": 2001,
        "api_name": "工单查询接口",
        "api_path": "/external/v1/tickets",
        "method": "GET",
        "category": "ticket",
        "description": "提供给第三方系统查询工单信息",
        "auth_type": "api_key",
        "status": "active",
        "rate_limit": {
          "requests_per_minute": 100,
          "requests_per_hour": 1000,
          "requests_per_day": 10000
        },
        "allowed_ips": ["192.168.1.0/24", "10.0.0.0/8"],
        "usage_stats": {
          "total_calls": 15680,
          "calls_today": 156,
          "avg_response_time": 245,
          "error_rate": 0.02
        },
        "created_at": "2024-08-01T10:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 8,
      "pages": 1
    }
  }
}
```
#### 创建API接口
- **路径**: `POST /api/v1/integrations/apis`
- **REQ-ID**: REQ-012-003
- **平台**: Web
- **权限**: api_create
- **描述**: 创建新的API接口

**请求参数**:
```json
{
  "api_name": "资产信息查询接口",
  "api_path": "/external/v1/assets",
  "method": "GET",
  "category": "asset",
  "description": "提供给第三方系统查询资产信息",
  "auth_type": "api_key",
  "rate_limit": {
    "requests_per_minute": 200,
    "requests_per_hour": 2000,
    "requests_per_day": 20000
  },
  "allowed_ips": ["192.168.1.0/24"],
  "request_schema": {
    "type": "object",
    "properties": {
      "asset_type": {"type": "string"},
      "status": {"type": "string"},
      "location": {"type": "string"}
    }
  },
  "response_schema": {
    "type": "object",
    "properties": {
      "assets": {"type": "array"},
      "total": {"type": "integer"}
    }
  },
  "is_active": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "API接口创建成功",
  "data": {
    "api_id": 2002,
    "api_name": "资产信息查询接口",
    "api_key": "ak_1234567890abcdef",
    "api_secret": "sk_abcdef1234567890",
    "endpoint_url": "https://api.ops-portal.com/external/v1/assets",
    "documentation_url": "/docs/api/external/assets",
    "created_at": "2024-08-11T16:30:00Z"
  }
}
```
#### API访问统计
- **路径**: `GET /api/v1/integrations/apis/{apiId}/statistics`
- **REQ-ID**: REQ-012-003
- **平台**: Web
- **权限**: api_read
- **描述**: 获取API接口访问统计

**路径参数**:
- `apiId`: API接口ID

**查询参数**:
- `period`: 统计周期 (1h, 6h, 24h, 7d, 30d)
- `metrics`: 指标类型 (calls, response_time, errors, rate_limit)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "api_id": 2001,
    "period": "24h",
    "statistics": {
      "total_calls": 1560,
      "successful_calls": 1528,
      "failed_calls": 32,
      "error_rate": 0.021,
      "avg_response_time": 245,
      "max_response_time": 1200,
      "min_response_time": 89,
      "rate_limit_hits": 5,
      "unique_clients": 12
    },
    "hourly_breakdown": [
      {
        "hour": "2024-08-11T00:00:00Z",
        "calls": 45,
        "avg_response_time": 230,
        "errors": 1
      }
    ],
    "top_clients": [
      {
        "client_ip": "192.168.1.100",
        "calls": 456,
        "error_rate": 0.01
      }
    ]
  }
}
```
### 12.4 Webhook管理

#### 获取Webhook列表
- **路径**: `GET /api/v1/integrations/webhooks`
- **REQ-ID**: REQ-012-004
- **平台**: Web
- **权限**: webhook_read
- **描述**: 获取Webhook配置列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `status`: Webhook状态 (active, inactive, error)
- `event_type`: 事件类型 (ticket, asset, alert, user)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "webhooks": [
      {
        "webhook_id": 3001,
        "name": "工单状态变更通知",
        "url": "https://external-system.com/webhook/ticket-status",
        "events": ["ticket.created", "ticket.updated", "ticket.resolved"],
        "status": "active",
        "headers": {
          "Authorization": "Bearer token123",
          "Content-Type": "application/json",
          "X-Webhook-Source": "ops-portal"
        },
        "retry_policy": {
          "max_retries": 3,
          "retry_interval": 300,
          "backoff_factor": 2
        },
        "last_triggered": "2024-08-11T15:30:00Z",
        "success_rate": 98.5,
        "created_at": "2024-08-01T10:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 6,
      "pages": 1
    }
  }
}
```
#### 创建Webhook
- **路径**: `POST /api/v1/integrations/webhooks`
- **REQ-ID**: REQ-012-004
- **平台**: Web
- **权限**: webhook_create
- **描述**: 创建新的Webhook配置

**请求参数**:
```json
{
  "name": "资产变更通知",
  "url": "https://cmdb.company.com/webhook/asset-change",
  "events": ["asset.created", "asset.updated", "asset.deleted"],
  "headers": {
    "Authorization": "Bearer cmdb_token_123",
    "Content-Type": "application/json",
    "X-Source": "ops-portal"
  },
  "retry_policy": {
    "max_retries": 5,
    "retry_interval": 300,
    "backoff_factor": 2,
    "timeout": 30
  },
  "filter_conditions": {
    "asset_type": ["server", "network"],
    "location": ["datacenter_a", "datacenter_b"]
  },
  "payload_template": {
    "event_type": "{{event}}",
    "asset_id": "{{asset.id}}",
    "asset_name": "{{asset.name}}",
    "timestamp": "{{timestamp}}"
  },
  "is_active": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "Webhook创建成功",
  "data": {
    "webhook_id": 3002,
    "name": "资产变更通知",
    "secret": "whsec_1234567890abcdef",
    "created_at": "2024-08-11T16:45:00Z",
    "test_url": "/api/v1/integrations/webhooks/3002/test"
  }
}
```
#### 测试Webhook
- **路径**: `POST /api/v1/integrations/webhooks/{webhookId}/test`
- **REQ-ID**: REQ-012-004
- **平台**: Web
- **权限**: webhook_test
- **描述**: 测试Webhook配置

**路径参数**:
- `webhookId`: Webhook ID

**请求参数**:
```json
{
  "test_event": "asset.updated",
  "test_payload": {
    "asset_id": 12345,
    "asset_name": "Web服务器01",
    "asset_type": "server",
    "status": "maintenance"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "Webhook测试完成",
  "data": {
    "test_result": {
      "status": "success",
      "response_code": 200,
      "response_time": 156,
      "response_body": "{\"status\":\"received\",\"id\":\"evt_123\"}",
      "test_time": "2024-08-11T17:00:00Z"
    }
  }
}
```
#### Webhook执行日志
- **路径**: `GET /api/v1/integrations/webhooks/{webhookId}/logs`
- **REQ-ID**: REQ-012-004
- **平台**: Web
- **权限**: webhook_read
- **描述**: 获取Webhook执行日志

**路径参数**:
- `webhookId`: Webhook ID

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `status`: 执行状态 (success, failed, retry)
- `start_date`: 开始日期
- `end_date`: 结束日期

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "logs": [
      {
        "log_id": "LOG_20240811_001",
        "event_type": "ticket.created",
        "status": "success",
        "request_payload": {
          "event": "ticket.created",
          "ticket_id": 12345,
          "title": "邮件服务器故障"
        },
        "response_code": 200,
        "response_time": 156,
        "retry_count": 0,
        "triggered_at": "2024-08-11T15:30:00Z",
        "completed_at": "2024-08-11T15:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
### 12.5 消息队列集成

#### 获取消息队列配置
- **路径**: `GET /api/v1/integrations/message-queues`
- **REQ-ID**: REQ-012-003
- **平台**: Web
- **权限**: mq_read
- **描述**: 获取消息队列集成配置

**查询参数**:
- `type`: 队列类型 (rabbitmq, kafka, activemq, redis)
- `status`: 连接状态 (connected, disconnected, error)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "message_queues": [
      {
        "queue_id": 4001,
        "name": "工单事件队列",
        "type": "rabbitmq",
        "connection_config": {
          "host": "rabbitmq.company.com",
          "port": 5672,
          "vhost": "/ops",
          "exchange": "ticket.events",
          "routing_key": "ticket.*"
        },
        "status": "connected",
        "queue_stats": {
          "messages_pending": 12,
          "messages_sent_today": 456,
          "consumers": 3,
          "last_activity": "2024-08-11T16:45:00Z"
        },
        "created_at": "2024-08-01T10:00:00Z"
      }
    ]
  }
}
```
#### 发送消息到队列
- **路径**: `POST /api/v1/integrations/message-queues/{queueId}/send`
- **REQ-ID**: REQ-012-003
- **平台**: API
- **权限**: mq_send
- **描述**: 发送消息到指定队列

**路径参数**:
- `queueId`: 消息队列ID

**请求参数**:
```json
{
  "message": {
    "event_type": "ticket.created",
    "event_id": "evt_20240811_001",
    "timestamp": "2024-08-11T16:30:00Z",
    "data": {
      "ticket_id": 12345,
      "title": "邮件服务器故障",
      "priority": 2,
      "customer_id": 1001,
      "assignee_id": 2001
    }
  },
  "routing_key": "ticket.created",
  "priority": 1,
  "delivery_mode": "persistent",
  "expiration": 3600
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "消息发送成功",
  "data": {
    "message_id": "msg_20240811_001",
    "queue_name": "ticket.events",
    "routing_key": "ticket.created",
    "sent_at": "2024-08-11T16:30:00Z",
    "delivery_status": "confirmed"
  }
}
```
#### 获取队列状态
- **路径**: `GET /api/v1/integrations/message-queues/{queueId}/status`
- **REQ-ID**: REQ-012-003
- **平台**: Web
- **权限**: mq_read
- **描述**: 获取消息队列状态信息

**路径参数**:
- `queueId`: 消息队列ID

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "queue_id": 4001,
    "connection_status": "connected",
    "queue_stats": {
      "messages_pending": 12,
      "messages_ready": 8,
      "messages_unacknowledged": 4,
      "consumers": 3,
      "consumer_utilisation": 0.85,
      "message_rate": {
        "publish": 15.6,
        "deliver": 14.2,
        "ack": 14.2
      }
    },
    "performance_metrics": {
      "avg_processing_time": 245,
      "throughput_per_second": 14.2,
      "error_rate": 0.01
    },
    "last_updated": "2024-08-11T16:45:00Z"
  }
}
```
### 12.6 文件传输集成

#### 配置FTP/SFTP连接
- **路径**: `POST /api/v1/integrations/file-transfer`
- **REQ-ID**: REQ-012-005
- **平台**: Web
- **权限**: file_transfer_config
- **描述**: 配置文件传输连接

**请求参数**:
```json
{
  "name": "备份文件传输",
  "protocol": "sftp",
  "connection_config": {
    "host": "backup.company.com",
    "port": 22,
    "username": "backup_user",
    "password": "secure_password",
    "private_key": "-----BEGIN RSA PRIVATE KEY-----\n...",
    "timeout": 30,
    "passive_mode": true
  },
  "transfer_config": {
    "remote_path": "/backup/ops-portal",
    "local_path": "/data/backup",
    "file_pattern": "*.tar.gz",
    "compression": true,
    "encryption": true
  },
  "schedule": {
    "enabled": true,
    "cron_expression": "0 2 * * *",
    "timezone": "Asia/Shanghai"
  },
  "is_active": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "文件传输配置创建成功",
  "data": {
    "config_id": 5001,
    "name": "备份文件传输",
    "status": "active",
    "test_result": {
      "connection_status": "success",
      "test_file_transfer": "success",
      "response_time": 1200
    },
    "created_at": "2024-08-11T17:00:00Z"
  }
}
```
#### 上传文件
- **路径**: `POST /api/v1/integrations/file-transfer/{configId}/upload`
- **REQ-ID**: REQ-012-005
- **平台**: Web, API
- **权限**: file_transfer_upload
- **描述**: 上传文件到第三方系统

**路径参数**:
- `configId`: 文件传输配置ID

**请求参数**:
```json
{
  "files": [
    {
      "local_path": "/data/reports/daily_report_20240811.pdf",
      "remote_path": "/reports/daily/daily_report_20240811.pdf",
      "overwrite": false
    }
  ],
  "transfer_options": {
    "compression": true,
    "encryption": true,
    "verify_checksum": true
  },
  "notification": {
    "on_success": true,
    "on_failure": true,
    "recipients": ["admin@company.com"]
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "文件上传任务启动成功",
  "data": {
    "transfer_id": "UPLOAD_20240811_001",
    "status": "running",
    "files": [
      {
        "local_path": "/data/reports/daily_report_20240811.pdf",
        "remote_path": "/reports/daily/daily_report_20240811.pdf",
        "file_size": 2048576,
        "status": "uploading",
        "progress": 45
      }
    ],
    "started_at": "2024-08-11T17:15:00Z",
    "estimated_completion": "2024-08-11T17:18:00Z"
  }
}
```
#### 下载文件
- **路径**: `GET /api/v1/integrations/file-transfer/{configId}/download`
- **REQ-ID**: REQ-012-005
- **平台**: Web, API
- **权限**: file_transfer_download
- **描述**: 从第三方系统下载文件

**路径参数**:
- `configId`: 文件传输配置ID

**查询参数**:
- `remote_path`: 远程文件路径
- `local_path`: 本地保存路径
- `verify_checksum`: 是否验证校验和 (默认: true)

**响应示例**:
```json
{
  "code": 200,
  "message": "文件下载任务启动成功",
  "data": {
    "transfer_id": "DOWNLOAD_20240811_001",
    "status": "running",
    "file_info": {
      "remote_path": "/backup/database_backup_20240811.sql.gz",
      "local_path": "/data/restore/database_backup_20240811.sql.gz",
      "file_size": 104857600,
      "progress": 25
    },
    "started_at": "2024-08-11T17:20:00Z",
    "estimated_completion": "2024-08-11T17:25:00Z"
  }
}
```
### 12.7 集成监控

#### 获取集成监控概览
- **路径**: `GET /api/v1/integrations/monitoring/overview`
- **REQ-ID**: REQ-012-006
- **平台**: Web
- **权限**: integration_monitor
- **描述**: 获取所有集成的监控概览

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "summary": {
      "total_integrations": 15,
      "active_integrations": 12,
      "error_integrations": 2,
      "inactive_integrations": 1,
      "avg_response_time": 245,
      "success_rate": 98.5
    },
    "health_status": [
      {
        "integration_id": 1001,
        "integration_name": "Netbox资产管理集成",
        "status": "healthy",
        "last_check": "2024-08-11T17:25:00Z",
        "response_time": 156,
        "success_rate": 99.2,
        "error_count": 2
      },
      {
        "integration_id": 1002,
        "integration_name": "Prometheus监控集成",
        "status": "warning",
        "last_check": "2024-08-11T17:25:00Z",
        "response_time": 1200,
        "success_rate": 95.8,
        "error_count": 12,
        "warning_reason": "响应时间超过阈值"
      }
    ],
    "alerts": [
      {
        "alert_id": "ALT_20240811_001",
        "integration_id": 1003,
        "alert_type": "connection_failed",
        "severity": "high",
        "message": "夜莺监控系统连接失败",
        "created_at": "2024-08-11T17:20:00Z"
      }
    ]
  }
}
```
#### 获取集成性能指标
- **路径**: `GET /api/v1/integrations/{integrationId}/metrics`
- **REQ-ID**: REQ-012-006
- **平台**: Web
- **权限**: integration_monitor
- **描述**: 获取特定集成的性能指标

**路径参数**:
- `integrationId`: 集成配置ID

**查询参数**:
- `period`: 时间周期 (1h, 6h, 24h, 7d, 30d)
- `metrics`: 指标类型 (response_time, success_rate, throughput, errors)

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "integration_id": 1001,
    "period": "24h",
    "metrics": {
      "response_time": {
        "avg": 156,
        "min": 89,
        "max": 450,
        "p95": 280,
        "p99": 380
      },
      "success_rate": 99.2,
      "throughput": {
        "requests_per_minute": 25.6,
        "data_transfer_mb": 12.5
      },
      "errors": {
        "total_count": 8,
        "error_rate": 0.008,
        "error_types": {
          "timeout": 3,
          "connection_failed": 2,
          "auth_failed": 1,
          "data_format_error": 2
        }
      }
    },
    "time_series": [
      {
        "timestamp": "2024-08-11T00:00:00Z",
        "response_time": 145,
        "success_rate": 100,
        "requests": 156
      }
    ]
  }
}
```
### 12.8 错误处理与恢复

#### 获取集成错误列表
- **路径**: `GET /api/v1/integrations/errors`
- **REQ-ID**: REQ-012-008
- **平台**: Web
- **权限**: integration_error_read
- **描述**: 获取集成错误列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `size`: 每页大小 (默认: 20)
- `integration_id`: 集成ID筛选
- `error_type`: 错误类型 (connection, timeout, auth, data_format, rate_limit)
- `severity`: 严重程度 (low, medium, high, critical)
- `status`: 处理状态 (new, investigating, resolved, ignored)
- `start_date`: 开始日期
- `end_date`: 结束日期

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "errors": [
      {
        "error_id": "ERR_20240811_001",
        "integration_id": 1003,
        "integration_name": "夜莺监控系统集成",
        "error_type": "connection",
        "severity": "high",
        "status": "new",
        "error_message": "连接超时：无法连接到 https://n9e.company.com/api/v1",
        "error_details": {
          "http_status": null,
          "response_time": 30000,
          "retry_count": 3,
          "last_retry": "2024-08-11T17:20:00Z"
        },
        "context": {
          "operation": "sync_alerts",
          "request_id": "req_20240811_001",
          "user_id": 1001
        },
        "first_occurred": "2024-08-11T17:15:00Z",
        "last_occurred": "2024-08-11T17:20:00Z",
        "occurrence_count": 3,
        "auto_retry_enabled": true,
        "next_retry": "2024-08-11T17:25:00Z"
      }
    ],
    "summary": {
      "total_errors": 25,
      "new_errors": 8,
      "investigating_errors": 5,
      "resolved_errors": 12,
      "error_rate_24h": 0.015
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 25,
      "pages": 2
    }
  }
}
```
#### 手动重试集成操作
- **路径**: `POST /api/v1/integrations/{integrationId}/retry`
- **REQ-ID**: REQ-012-008
- **平台**: Web
- **权限**: integration_retry
- **描述**: 手动重试失败的集成操作

**路径参数**:
- `integrationId`: 集成配置ID

**请求参数**:
```json
{
  "operation_type": "sync",
  "error_ids": ["ERR_20240811_001", "ERR_20240811_002"],
  "retry_config": {
    "max_retries": 3,
    "retry_interval": 300,
    "backoff_factor": 2
  },
  "force_retry": false
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "重试任务启动成功",
  "data": {
    "retry_task_id": "RETRY_20240811_001",
    "integration_id": 1003,
    "retry_operations": [
      {
        "error_id": "ERR_20240811_001",
        "operation": "sync_alerts",
        "status": "queued",
        "scheduled_time": "2024-08-11T17:30:00Z"
      }
    ],
    "estimated_completion": "2024-08-11T17:35:00Z"
  }
}
```
### 12.9 告警集成

#### 接收外部告警
- **路径**: `POST /api/v1/integrations/alerts/receive`
- **REQ-ID**: REQ-012-009
- **平台**: API
- **权限**: alert_receive
- **描述**: 接收外部监控系统告警并自动创建工单

**请求参数**:
```json
{
  "alert_source": "prometheus",
  "alert_id": "alert_20240811_001",
  "alert_name": "服务器CPU使用率过高",
  "alert_level": "critical",
  "alert_time": "2024-08-11T17:30:00Z",
  "alert_description": "Web服务器CPU使用率持续超过90%",
  "affected_resources": [
    {
      "resource_type": "server",
      "resource_id": "srv-web-01",
      "resource_name": "Web服务器01",
      "ip_address": "192.168.1.100"
    }
  ],
  "metrics": {
    "cpu_usage": 95.6,
    "memory_usage": 78.2,
    "disk_usage": 65.1
  },
  "labels": {
    "environment": "production",
    "service": "web",
    "team": "ops"
  },
  "annotations": {
    "runbook_url": "https://wiki.company.com/runbooks/high-cpu",
    "dashboard_url": "https://grafana.company.com/d/server-metrics"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "告警处理成功",
  "data": {
    "alert_id": "alert_20240811_001",
    "processing_result": {
      "action": "ticket_created",
      "ticket_id": 12346,
      "ticket_no": "TK202408110002",
      "title": "服务器CPU使用率过高告警",
      "priority": 1,
      "category": "性能问题",
      "assignee": {
        "engineer_id": 1001,
        "engineer_name": "李工程师"
      }
    },
    "mapping_applied": {
      "alert_level": "critical -> priority: 1",
      "resource_type": "server -> category: 硬件故障",
      "team": "ops -> assignee: 李工程师"
    },
    "processed_at": "2024-08-11T17:30:00Z"
  }
}
```
#### 配置告警映射规则
- **路径**: `POST /api/v1/integrations/alerts/mapping-rules`
- **REQ-ID**: REQ-012-009
- **平台**: Web
- **权限**: alert_mapping_config
- **描述**: 配置告警到工单的映射规则

**请求参数**:
```json
{
  "rule_name": "Prometheus告警映射规则",
  "alert_source": "prometheus",
  "mapping_rules": [
    {
      "condition": {
        "alert_level": "critical",
        "resource_type": "server"
      },
      "ticket_mapping": {
        "priority": 1,
        "category": "硬件故障",
        "urgency": "high",
        "impact": "high"
      },
      "assignment_rule": {
        "type": "skill_based",
        "required_skills": ["Linux服务器", "性能调优"],
        "team": "ops"
      }
    },
    {
      "condition": {
        "alert_level": "warning",
        "service": "database"
      },
      "ticket_mapping": {
        "priority": 2,
        "category": "数据库问题",
        "urgency": "medium",
        "impact": "medium"
      },
      "assignment_rule": {
        "type": "team_based",
        "team": "dba"
      }
    }
  ],
  "auto_assignment": true,
  "notification_config": {
    "notify_assignee": true,
    "notify_team_lead": true,
    "escalation_time": 1800
  },
  "is_active": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "告警映射规则创建成功",
  "data": {
    "rule_id": "RULE_20240811_001",
    "rule_name": "Prometheus告警映射规则",
    "status": "active",
    "created_at": "2024-08-11T17:45:00Z",
    "test_url": "/api/v1/integrations/alerts/mapping-rules/RULE_20240811_001/test"
  }
}
```
---

## 13. 智能分析模块 (REQ-013)

### 13.1 AI分析

#### 智能故障诊断
- **路径**: `POST /api/v1/ai/diagnosis`
- **REQ-ID**: REQ-013-001
- **平台**: Web, Mobile, API
- **权限**: ai_diagnosis
- **描述**: 基于AI的故障根因分析和解决方案推荐

**请求参数**:
```json
{
  "problem_description": "服务器CPU使用率持续100%，系统响应缓慢",
  "system_info": {
    "server_id": "srv-001",
    "os_type": "linux",
    "application": "web_server",
    "environment": "production"
  },
  "monitoring_data": {
    "cpu_usage": [95, 98, 100, 100, 99],
    "memory_usage": [78, 82, 85, 88, 90],
    "disk_io": [45, 52, 48, 55, 60],
    "network_io": [120, 135, 140, 145, 150]
  },
  "log_snippets": [
    "ERROR: Database connection timeout",
    "WARN: High memory usage detected",
    "ERROR: Too many open files"
  ],
  "context": {
    "incident_time": "2024-08-11T17:30:00Z",
    "affected_users": 150,
    "business_impact": "high"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "诊断完成",
  "data": {
    "diagnosis_id": "DIAG_20240811_001",
    "confidence_score": 92.5,
    "root_cause": {
      "primary": "数据库连接池耗尽导致连接超时",
      "secondary": ["内存泄漏", "磁盘I/O瓶颈"],
      "evidence": [
        "数据库连接错误日志频繁出现",
        "内存使用率持续上升",
        "文件描述符接近系统限制"
      ]
    },
    "impact_assessment": {
      "severity": "high",
      "affected_services": ["web_service", "api_service"],
      "estimated_downtime": "持续中",
      "business_impact": "影响150个用户正常使用"
    },
    "recommended_solutions": [
      {
        "priority": 1,
        "action": "重启数据库连接池",
        "description": "清理现有连接，重新初始化连接池",
        "estimated_time": "5分钟",
        "risk_level": "low",
        "success_probability": 85
      },
      {
        "priority": 2,
        "action": "检查并修复内存泄漏",
        "description": "分析应用程序内存使用，定位泄漏点",
        "estimated_time": "30分钟",
        "risk_level": "medium",
        "success_probability": 75
      },
      {
        "priority": 3,
        "action": "优化数据库查询",
        "description": "分析慢查询日志，优化SQL语句",
        "estimated_time": "2小时",
        "risk_level": "low",
        "success_probability": 90
      }
    ],
    "similar_cases": [
      {
        "case_id": 67890,
        "title": "Web服务器性能问题",
        "similarity": 0.89,
        "resolution": "重启服务并优化配置"
      }
    ],
    "analysis_time": "2024-08-11T17:32:00Z",
    "model_version": "v2.1.0"
  }
}
```
#### 工单智能分析
- **路径**: `POST /api/v1/ai/analyze/ticket`
- **REQ-ID**: REQ-013-001
- **平台**: Web, API
- **权限**: ai_analyze
- **描述**: 分析工单内容，提供智能建议

**请求参数**:
```json
{
  "ticket_id": 12345,
  "analysis_type": "comprehensive",
  "include_recommendations": true,
  "include_similar_cases": true,
  "context": {
    "customer_tier": "vip",
    "service_level": "premium"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "分析完成",
  "data": {
    "ticket_id": 12345,
    "analysis_result": {
      "category_prediction": {
        "predicted_category": "硬件故障",
        "confidence": 0.92,
        "alternative_categories": [
          {"category": "网络问题", "confidence": 0.15},
          {"category": "软件故障", "confidence": 0.08}
        ]
      },
      "priority_suggestion": {
        "suggested_priority": 2,
        "current_priority": 3,
        "reason": "VIP客户且影响业务关键系统",
        "confidence": 0.88
      },
      "complexity_assessment": {
        "complexity_level": "medium",
        "estimated_resolution_time": "4小时",
        "required_skills": ["Linux服务器", "硬件维护"],
        "confidence": 0.85
      },
      "similar_cases": [
        {
          "ticket_id": 67890,
          "title": "邮件服务器硬盘故障",
          "similarity": 0.89,
          "resolution_time": "3.5小时",
          "resolution_method": "更换硬盘"
        }
      ],
      "recommendations": [
        {
          "type": "assignment",
          "suggestion": "分配给李工程师（硬件专家）",
          "reason": "具有相关经验和技能",
          "confidence": 0.91
        },
        {
          "type": "escalation",
          "suggestion": "2小时内无进展则升级",
          "reason": "VIP客户且业务影响较大",
          "confidence": 0.87
        }
      ]
    },
    "analysis_time": "2024-08-11T17:35:00Z"
  }
}
```
#### 趋势预测分析
- **路径**: `POST /api/v1/ai/predict/trends`
- **REQ-ID**: REQ-013-002
- **平台**: Web
- **权限**: ai_predict
- **描述**: 基于历史数据预测业务趋势

**请求参数**:
```json
{
  "prediction_type": "ticket_volume",
  "time_range": {
    "start_date": "2024-08-01T00:00:00Z",
    "end_date": "2024-08-11T23:59:59Z"
  },
  "prediction_horizon": "7d",
  "factors": ["seasonal", "business_events", "historical_patterns"],
  "granularity": "daily",
  "confidence_level": 0.95
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "预测完成",
  "data": {
    "prediction_id": "PRED_20240811_001",
    "prediction_type": "ticket_volume",
    "time_horizon": "7天",
    "predictions": [
      {
        "date": "2024-08-12",
        "predicted_value": 45,
        "confidence_interval": {
          "lower": 38,
          "upper": 52
        },
        "factors": {
          "seasonal_effect": 1.1,
          "trend_effect": 0.95,
          "business_event_effect": 1.0
        }
      },
      {
        "date": "2024-08-13",
        "predicted_value": 42,
        "confidence_interval": {
          "lower": 35,
          "upper": 49
        },
        "factors": {
          "seasonal_effect": 0.9,
          "trend_effect": 0.95,
          "business_event_effect": 1.0
        }
      }
    ],
    "model_accuracy": {
      "mape": 8.5,
      "rmse": 3.2,
      "r_squared": 0.89
    },
    "insights": [
      "预计下周工单量将比本周减少约10%",
      "周二和周三通常是工单高峰期",
      "建议提前安排足够的工程师资源"
    ],
    "generated_at": "2024-08-11T17:40:00Z"
  }
}
```
#### 异常检测
- **路径**: `POST /api/v1/ai/detect/anomalies`
- **REQ-ID**: REQ-013-004
- **平台**: Web, API
- **权限**: ai_detect
- **描述**: 自动识别系统异常和性能问题

**请求参数**:
```json
{
  "data_source": "system_metrics",
  "metrics": [
    {
      "metric_name": "cpu_usage",
      "values": [45, 48, 52, 89, 95, 98, 100, 99, 97],
      "timestamps": ["2024-08-11T17:00:00Z", "2024-08-11T17:05:00Z", "2024-08-11T17:10:00Z"]
    },
    {
      "metric_name": "memory_usage",
      "values": [65, 67, 70, 75, 82, 88, 90, 89, 87],
      "timestamps": ["2024-08-11T17:00:00Z", "2024-08-11T17:05:00Z", "2024-08-11T17:10:00Z"]
    }
  ],
  "detection_config": {
    "sensitivity": "medium",
    "algorithm": "isolation_forest",
    "window_size": "1h",
    "threshold": 0.8
  },
  "context": {
    "system_id": "srv-web-01",
    "environment": "production"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "异常检测完成",
  "data": {
    "detection_id": "ANOM_20240811_001",
    "anomalies_detected": [
      {
        "anomaly_id": "ANOM_001",
        "metric_name": "cpu_usage",
        "anomaly_type": "spike",
        "severity": "high",
        "anomaly_score": 0.95,
        "time_range": {
          "start": "2024-08-11T17:15:00Z",
          "end": "2024-08-11T17:25:00Z"
        },
        "anomalous_values": [89, 95, 98, 100, 99],
        "expected_range": {
          "lower": 40,
          "upper": 60
        },
        "description": "CPU使用率异常飙升，超出正常范围",
        "potential_causes": [
          "进程异常占用CPU",
          "系统负载突增",
          "恶意软件活动"
        ],
        "recommended_actions": [
          "检查高CPU占用进程",
          "分析系统负载来源",
          "监控系统安全状态"
        ]
      }
    ],
    "summary": {
      "total_anomalies": 1,
      "high_severity": 1,
      "medium_severity": 0,
      "low_severity": 0,
      "detection_accuracy": 0.92
    },
    "baseline_info": {
      "baseline_period": "过去7天",
      "normal_patterns": {
        "cpu_usage": {
          "avg": 48,
          "std": 8,
          "typical_range": [35, 65]
        }
      }
    },
    "detected_at": "2024-08-11T17:45:00Z"
  }
}
```
### 13.2 预测性维护

#### 设备故障预测
- **路径**: `POST /api/v1/ai/predict/failures`
- **REQ-ID**: REQ-013-002
- **平台**: Web
- **权限**: ai_predict
- **描述**: 预测设备可能的故障时间和类型

**请求参数**:
```json
{
  "asset_id": "srv-web-01",
  "prediction_horizon": "30d",
  "historical_data": {
    "performance_metrics": [
      {
        "timestamp": "2024-08-11T17:00:00Z",
        "cpu_temp": 65,
        "disk_health": 95,
        "memory_errors": 0,
        "network_errors": 2
      }
    ],
    "maintenance_history": [
      {
        "date": "2024-07-15",
        "type": "preventive",
        "components": ["cpu_fan", "memory"]
      }
    ],
    "failure_history": [
      {
        "date": "2024-06-20",
        "component": "hard_disk",
        "failure_type": "mechanical"
      }
    ]
  },
  "asset_info": {
    "model": "Dell PowerEdge R740",
    "age_months": 36,
    "environment": "datacenter",
    "usage_pattern": "high_load"
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "预测完成",
  "data": {
    "asset_id": "srv-web-01",
    "prediction_summary": {
      "overall_health_score": 78,
      "risk_level": "medium",
      "predicted_mtbf": "180天",
      "next_maintenance_recommended": "2024-09-15"
    },
    "failure_predictions": [
      {
        "component": "hard_disk",
        "failure_probability": 0.25,
        "predicted_failure_window": {
          "earliest": "2024-09-01",
          "most_likely": "2024-09-15",
          "latest": "2024-10-01"
        },
        "failure_type": "mechanical_wear",
        "confidence": 0.82,
        "warning_signs": [
          "磁盘读取错误增加",
          "响应时间延长",
          "SMART指标异常"
        ],
        "recommended_actions": [
          "增加备份频率",
          "准备替换硬盘",
          "监控SMART指标"
        ]
      },
      {
        "component": "memory",
        "failure_probability": 0.15,
        "predicted_failure_window": {
          "earliest": "2024-10-15",
          "most_likely": "2024-11-01",
          "latest": "2024-11-15"
        },
        "failure_type": "bit_errors",
        "confidence": 0.75,
        "warning_signs": [
          "内存错误计数增加",
          "系统偶发重启"
        ],
        "recommended_actions": [
          "运行内存测试",
          "监控错误日志",
          "准备内存更换"
        ]
      }
    ],
    "maintenance_recommendations": [
      {
        "type": "preventive",
        "priority": "high",
        "scheduled_date": "2024-09-01",
        "description": "硬盘健康检查和备份验证",
        "estimated_duration": "2小时"
      },
      {
        "type": "condition_based",
        "priority": "medium",
        "scheduled_date": "2024-09-15",
        "description": "全面系统健康检查",
        "estimated_duration": "4小时"
      }
    ],
    "cost_analysis": {
      "preventive_maintenance_cost": 500,
      "predicted_failure_cost": 2500,
      "potential_savings": 2000
    },
    "generated_at": "2024-08-11T18:00:00Z"
  }
}
```
#### 性能趋势预测
- **路径**: `POST /api/v1/ai/predict/performance`
- **REQ-ID**: REQ-013-002
- **平台**: Web
- **权限**: ai_predict
- **描述**: 预测系统性能趋势和容量需求

**请求参数**:
```json
{
  "system_id": "web_cluster_01",
  "metrics": ["cpu_usage", "memory_usage", "disk_usage", "network_throughput"],
  "prediction_horizon": "90d",
  "historical_period": "180d",
  "business_context": {
    "expected_growth": 0.15,
    "seasonal_patterns": true,
    "upcoming_events": [
      {
        "event": "product_launch",
        "date": "2024-09-01",
        "expected_impact": 1.5
      }
    ]
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "性能预测完成",
  "data": {
    "system_id": "web_cluster_01",
    "predictions": {
      "cpu_usage": {
        "current_avg": 45,
        "predicted_avg_30d": 52,
        "predicted_avg_60d": 58,
        "predicted_avg_90d": 65,
        "capacity_threshold": 80,
        "threshold_breach_date": "2024-10-15",
        "confidence": 0.87
      },
      "memory_usage": {
        "current_avg": 68,
        "predicted_avg_30d": 72,
        "predicted_avg_60d": 76,
        "predicted_avg_90d": 82,
        "capacity_threshold": 85,
        "threshold_breach_date": "2024-11-01",
        "confidence": 0.89
      }
    },
    "capacity_recommendations": [
      {
        "resource": "cpu",
        "action": "scale_up",
        "recommended_date": "2024-10-01",
        "description": "建议增加2个CPU核心",
        "justification": "预计10月中旬CPU使用率将达到阈值"
      },
      {
        "resource": "memory",
        "action": "scale_up",
        "recommended_date": "2024-10-15",
        "description": "建议增加16GB内存",
        "justification": "预计11月初内存使用率将达到阈值"
      }
    ],
    "cost_optimization": {
      "current_monthly_cost": 5000,
      "predicted_cost_without_action": 8500,
      "predicted_cost_with_optimization": 6500,
      "potential_savings": 2000
    },
    "generated_at": "2024-08-11T18:15:00Z"
  }
}
```
### 13.3 智能问答系统

#### AI智能问答
- **路径**: `POST /api/v1/ai/chat`
- **REQ-ID**: REQ-013-003
- **平台**: Web, Mobile
- **权限**: ai_chat
- **描述**: 自然语言问答和知识推荐

**请求参数**:
```json
{
  "question": "如何配置Nginx负载均衡？",
  "context": {
    "user_role": "运维工程师",
    "system_environment": "linux",
    "previous_questions": [
      "什么是负载均衡？",
      "Nginx有哪些负载均衡算法？"
    ],
    "current_task": {
      "ticket_id": 12345,
      "category": "系统配置"
    }
  },
  "preferences": {
    "response_style": "detailed",
    "include_examples": true,
    "include_references": true
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "问答成功",
  "data": {
    "answer": "配置Nginx负载均衡需要以下步骤：\n\n1. **定义upstream块**\n在nginx.conf中定义后端服务器组：\n```nginx
\nupstream backend {\n    server 192.168.1.10:8080;\n    server 192.168.1.11:8080;\n    server 192.168.1.12:8080;\n}\n
```\n\n2. **配置server块**\n在server块中指向upstream：\n```nginx
\nserver {\n    listen 80;\n    location / {\n        proxy_pass http://backend;\n    }\n}\n
```\n\n3. **选择负载均衡算法**\n- round-robin（默认）：轮询\n- least_conn：最少连接\n- ip_hash：IP哈希\n- weight：权重分配\n\n4. **配置健康检查**\n```nginx
\nupstream backend {\n    server 192.168.1.10:8080 max_fails=3 fail_timeout=30s;\n    server 192.168.1.11:8080 max_fails=3 fail_timeout=30s;\n}\n
```\n\n5. **重启Nginx服务**\n```bash
\nsudo nginx -t  # 测试配置\nsudo systemctl reload nginx  # 重新加载配置\n
```",
    "confidence": 95.8,
    "answer_type": "procedural",
    "sources": [
      {
        "type": "knowledge_base",
        "title": "Nginx负载均衡配置指南",
        "url": "/knowledge/nginx-lb-guide",
        "relevance": 98.5,
        "excerpt": "详细介绍了Nginx负载均衡的配置方法..."
      },
      {
        "type": "documentation",
        "title": "Nginx官方文档 - 负载均衡",
        "url": "http://nginx.org/en/docs/http/load_balancing.html",
        "relevance": 96.2
      }
    ],
    "related_documents": [
      {
        "title": "Nginx性能优化指南",
        "url": "/knowledge/nginx-performance",
        "relevance": 85.3
      },
      {
        "title": "负载均衡最佳实践",
        "url": "/knowledge/load-balancing-best-practices",
        "relevance": 82.1
      }
    ],
    "follow_up_questions": [
      "如何配置Nginx健康检查？",
      "Nginx负载均衡算法有哪些？",
      "如何监控Nginx负载均衡状态？",
      "如何处理Nginx负载均衡故障？"
    ],
    "code_examples": [
      {
        "language": "nginx",
        "description": "基本负载均衡配置",
        "code": "upstream backend {\n    server 192.168.1.10:8080;\n    server 192.168.1.11:8080;\n}\n\nserver {\n    listen 80;\n    location / {\n        proxy_pass http://backend;\n    }\n}"
      }
    ],
    "response_time": "1.2s",
    "generated_at": "2024-08-11T18:30:00Z"
  }
}
```
#### AI智能知识推荐
- **路径**: `GET /api/v1/ai/recommendations/knowledge`
- **REQ-ID**: REQ-013-003
- **平台**: Web, Mobile
- **权限**: ai_recommend
- **描述**: 基于AI上下文分析的智能知识推荐

**查询参数**:
- `context_type`: 上下文类型 (ticket, task, search, learning)
- `context_id`: 上下文ID
- `user_role`: 用户角色
- `limit`: 推荐数量限制 (默认: 5)
- `include_trending`: 是否包含热门内容 (默认: true)

**响应示例**:
```json
{
  "code": 200,
  "message": "推荐成功",
  "data": {
    "recommendations": [
      {
        "recommendation_id": "REC_001",
        "type": "knowledge_article",
        "title": "Linux服务器性能调优指南",
        "category": "系统优化",
        "relevance_score": 94.5,
        "recommendation_reason": "基于您当前处理的性能问题工单",
        "content_summary": "详细介绍Linux服务器性能监控和调优方法",
        "url": "/knowledge/linux-performance-tuning",
        "author": "张工程师",
        "view_count": 1250,
        "like_count": 89,
        "last_updated": "2024-08-10T10:00:00Z",
        "estimated_read_time": "15分钟",
        "difficulty_level": "intermediate",
        "tags": ["Linux", "性能", "调优", "监控"]
      },
      {
        "recommendation_id": "REC_002",
        "type": "solution_template",
        "title": "CPU使用率过高问题解决模板",
        "category": "故障排查",
        "relevance_score": 91.2,
        "recommendation_reason": "与您的工单症状高度匹配",
        "content_summary": "标准化的CPU高使用率问题诊断和解决流程",
        "url": "/templates/cpu-high-usage",
        "usage_count": 156,
        "success_rate": 87,
        "avg_resolution_time": "45分钟",
        "last_used": "2024-08-11T15:30:00Z"
      },
      {
        "recommendation_id": "REC_003",
        "type": "training_material",
        "title": "系统监控工具使用培训",
        "category": "技能提升",
        "relevance_score": 88.7,
        "recommendation_reason": "提升相关技能，更好处理类似问题",
        "content_summary": "Prometheus、Grafana等监控工具的使用方法",
        "url": "/training/monitoring-tools",
        "duration": "2小时",
        "completion_rate": 92,
        "rating": 4.8
      }
    ],
    "trending_content": [
      {
        "title": "Docker容器性能优化",
        "url": "/knowledge/docker-performance",
        "trend_score": 95,
        "view_growth": "150%"
      }
    ],
    "personalized_insights": {
      "learning_path": "系统性能优化专家",
      "skill_gaps": ["容器技术", "云原生监控"],
      "recommended_next_steps": [
        "学习Kubernetes监控",
        "掌握微服务性能调优"
      ]
    },
    "generated_at": "2024-08-11T18:45:00Z"
  }
}
```
### 13.4 智能推荐

#### 获取解决方案推荐
- **路径**: `GET /api/v1/ai/recommendations/solutions/{ticketId}`
- **REQ-ID**: REQ-013-005
- **平台**: Web, Mobile
- **权限**: ai_recommend
- **描述**: 基于工单内容推荐解决方案

**路径参数**:
- `ticketId`: 工单ID

**查询参数**:
- `include_similar_cases`: 是否包含相似案例 (默认: true)
- `include_knowledge_base`: 是否包含知识库内容 (默认: true)
- `max_recommendations`: 最大推荐数量 (默认: 5)

**响应示例**:
```json
{
  "code": 200,
  "message": "推荐成功",
  "data": {
    "ticket_id": 12345,
    "ticket_summary": {
      "title": "邮件服务器故障",
      "category": "硬件故障",
      "priority": 2,
      "symptoms": ["无法发送邮件", "服务器响应慢"]
    },
    "solution_recommendations": [
      {
        "solution_id": "SOL_001",
        "title": "邮件服务器硬盘故障处理方案",
        "confidence": 92.5,
        "match_score": 94.8,
        "solution_type": "step_by_step",
        "estimated_time": "2小时",
        "difficulty": "medium",
        "success_rate": 89,
        "steps": [
          {
            "step": 1,
            "action": "检查硬盘状态",
            "command": "smartctl -a /dev/sda",
            "expected_result": "查看SMART信息确认硬盘健康状态"
          },
          {
            "step": 2,
            "action": "备份重要数据",
            "command": "rsync -av /var/mail/ /backup/mail/",
            "expected_result": "确保邮件数据安全"
          },
          {
            "step": 3,
            "action": "更换故障硬盘",
            "description": "物理更换硬盘并重新安装系统",
            "estimated_time": "1小时"
          }
        ],
        "prerequisites": ["root权限", "备用硬盘", "系统安装介质"],
        "risks": ["数据丢失风险", "服务中断"],
        "mitigation": ["提前备份", "准备回滚方案"]
      },
      {
        "solution_id": "SOL_002",
        "title": "邮件服务配置修复方案",
        "confidence": 78.3,
        "match_score": 82.1,
        "solution_type": "configuration",
        "estimated_time": "30分钟",
        "difficulty": "easy",
        "success_rate": 95,
        "description": "通过修复邮件服务配置解决发送问题",
        "config_changes": [
          {
            "file": "/etc/postfix/main.cf",
            "parameter": "relayhost",
            "value": "[smtp.company.com]:587"
          }
        ]
      }
    ],
    "similar_cases": [
      {
        "case_id": 67890,
        "title": "Web服务器邮件功能异常",
        "similarity": 0.89,
        "resolution": "重启postfix服务并更新配置",
        "resolution_time": "45分钟",
        "engineer": "李工程师",
        "customer_satisfaction": 4.8
      }
    ],
    "knowledge_references": [
      {
        "article_id": 1001,
        "title": "邮件服务器故障排查指南",
        "relevance": 96.5,
        "url": "/knowledge/email-server-troubleshooting"
      }
    ],
    "expert_contacts": [
      {
        "engineer_id": 1001,
        "name": "李工程师",
        "expertise": "邮件系统专家",
        "availability": "available",
        "similar_cases_resolved": 23
      }
    ],
    "generated_at": "2024-08-11T19:00:00Z"
  }
}
```
### 13.5 自动化决策

#### 创建自动化规则
- **路径**: `POST /api/v1/ai/automation/rules`
- **REQ-ID**: REQ-013-006
- **平台**: Web
- **权限**: ai_automation_config
- **描述**: 创建基于AI的自动化决策规则

**请求参数**:
```json
{
  "rule_name": "高CPU使用率自动处理规则",
  "description": "当检测到服务器CPU使用率持续过高时自动执行处理流程",
  "trigger_conditions": [
    {
      "type": "metric_threshold",
      "metric": "cpu_usage",
      "operator": "greater_than",
      "value": 90,
      "duration": "5m"
    },
    {
      "type": "anomaly_detection",
      "anomaly_type": "spike",
      "confidence_threshold": 0.8
    }
  ],
  "ai_decision_logic": {
    "model_type": "decision_tree",
    "decision_factors": [
      "historical_patterns",
      "system_load",
      "business_impact",
      "time_of_day"
    ],
    "confidence_threshold": 0.75
  },
  "automated_actions": [
    {
      "action_type": "diagnostic",
      "action": "collect_system_info",
      "parameters": {
        "metrics": ["cpu", "memory", "disk", "network"],
        "duration": "10m"
      }
    },
    {
      "action_type": "notification",
      "action": "send_alert",
      "parameters": {
        "recipients": ["ops-team@company.com"],
        "severity": "high",
        "include_diagnostics": true
      }
    },
    {
      "action_type": "remediation",
      "action": "restart_service",
      "parameters": {
        "service_name": "high_cpu_process",
        "max_attempts": 3,
        "require_approval": false
      },
      "conditions": [
        {
          "type": "confidence_check",
          "min_confidence": 0.9
        },
        {
          "type": "business_hours",
          "allowed": true
        }
      ]
    }
  ],
  "escalation_rules": [
    {
      "condition": "action_failed",
      "escalate_to": "senior_engineer",
      "delay": "15m"
    },
    {
      "condition": "low_confidence",
      "escalate_to": "human_review",
      "delay": "immediate"
    }
  ],
  "is_active": true
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "自动化规则创建成功",
  "data": {
    "rule_id": "AUTO_RULE_001",
    "rule_name": "高CPU使用率自动处理规则",
    "status": "active",
    "created_at": "2024-08-11T19:15:00Z",
    "test_mode": false,
    "estimated_trigger_frequency": "2-3次/周",
    "confidence_score": 0.87
  }
}
```
#### 获取自动化执行历史
- **路径**: `GET /api/v1/ai/automation/executions`
- **REQ-ID**: REQ-013-006
- **平台**: Web
- **权限**: ai_automation_read
- **描述**: 获取自动化决策执行历史

**查询参数**:
- `rule_id`: 规则ID筛选
- `status`: 执行状态 (success, failed, partial, pending)
- `start_date`: 开始日期
- `end_date`: 结束日期
- `page`: 页码
- `size`: 每页大小

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "executions": [
      {
        "execution_id": "EXEC_20240811_001",
        "rule_id": "AUTO_RULE_001",
        "rule_name": "高CPU使用率自动处理规则",
        "trigger_time": "2024-08-11T19:20:00Z",
        "status": "success",
        "trigger_event": {
          "type": "metric_threshold",
          "metric": "cpu_usage",
          "value": 95.6,
          "server": "srv-web-01"
        },
        "ai_decision": {
          "confidence": 0.92,
          "decision": "auto_remediate",
          "reasoning": "历史模式显示重启服务可解决此类问题",
          "risk_assessment": "low"
        },
        "actions_executed": [
          {
            "action": "collect_system_info",
            "status": "success",
            "duration": "30s",
            "result": "收集到系统诊断信息"
          },
          {
            "action": "send_alert",
            "status": "success",
            "duration": "5s",
            "result": "已通知运维团队"
          },
          {
            "action": "restart_service",
            "status": "success",
            "duration": "45s",
            "result": "服务重启成功，CPU使用率降至正常"
          }
        ],
        "outcome": {
          "problem_resolved": true,
          "resolution_time": "1分20秒",
          "cpu_usage_after": 45.2,
          "business_impact": "minimal"
        },
        "human_intervention": false,
        "completed_at": "2024-08-11T19:21:20Z"
      }
    ],
    "summary": {
      "total_executions": 156,
      "success_rate": 89.7,
      "avg_resolution_time": "2分15秒",
      "human_intervention_rate": 12.8
    },
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 156,
      "pages": 8
    }
  }
}
```
### 13.6 模型管理

#### 获取AI模型列表
- **路径**: `GET /api/v1/ai/models`
- **REQ-ID**: REQ-013-008
- **平台**: Web
- **权限**: ai_model_read
- **描述**: 获取AI模型列表和状态

**查询参数**:
- `model_type`: 模型类型 (diagnosis, prediction, classification, anomaly_detection)
- `status`: 模型状态 (training, active, deprecated, failed)
- `include_metrics`: 是否包含性能指标

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "models": [
      {
        "model_id": "MODEL_001",
        "model_name": "故障诊断模型",
        "model_type": "diagnosis",
        "version": "v2.1.0",
        "status": "active",
        "description": "基于历史工单数据训练的故障诊断模型",
        "training_data": {
          "dataset_size": 50000,
          "training_period": "2023-01-01 to 2024-08-01",
          "last_updated": "2024-08-01T10:00:00Z"
        },
        "performance_metrics": {
          "accuracy": 0.92,
          "precision": 0.89,
          "recall": 0.94,
          "f1_score": 0.91,
          "auc_roc": 0.96
        },
        "deployment_info": {
          "deployed_at": "2024-08-01T12:00:00Z",
          "inference_count": 15680,
          "avg_inference_time": "245ms",
          "success_rate": 99.2
        },
        "model_config": {
          "algorithm": "gradient_boosting",
          "features": 156,
          "hyperparameters": {
            "n_estimators": 100,
            "learning_rate": 0.1,
            "max_depth": 6
          }
        }
      },
      {
        "model_id": "MODEL_002",
        "model_name": "异常检测模型",
        "model_type": "anomaly_detection",
        "version": "v1.5.2",
        "status": "active",
        "description": "基于无监督学习的系统异常检测模型",
        "training_data": {
          "dataset_size": 1000000,
          "training_period": "2023-06-01 to 2024-08-01",
          "last_updated": "2024-07-15T10:00:00Z"
        },
        "performance_metrics": {
          "precision": 0.87,
          "recall": 0.91,
          "false_positive_rate": 0.05,
          "detection_latency": "30s"
        }
      }
    ],
    "summary": {
      "total_models": 8,
      "active_models": 6,
      "training_models": 1,
      "deprecated_models": 1
    }
  }
}
```
#### 训练AI模型
- **路径**: `POST /api/v1/ai/models/train`
- **REQ-ID**: REQ-013-008
- **平台**: Web
- **权限**: ai_model_train
- **描述**: 启动AI模型训练任务

**请求参数**:
```json
{
  "model_name": "工单分类模型v3.0",
  "model_type": "classification",
  "algorithm": "transformer",
  "training_config": {
    "dataset": {
      "source": "ticket_database",
      "date_range": {
        "start": "2023-01-01",
        "end": "2024-08-11"
      },
      "filters": {
        "status": ["resolved", "closed"],
        "min_quality_score": 0.8
      },
      "sample_size": 100000
    },
    "features": [
      "title_text",
      "description_text",
      "customer_info",
      "historical_patterns",
      "resolution_methods"
    ],
    "hyperparameters": {
      "learning_rate": 0.001,
      "batch_size": 32,
      "epochs": 50,
      "dropout_rate": 0.2
    },
    "validation": {
      "method": "k_fold",
      "k": 5,
      "test_split": 0.2
    }
  },
  "deployment_config": {
    "auto_deploy": false,
    "performance_threshold": {
      "min_accuracy": 0.85,
      "max_inference_time": 500
    }
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "模型训练任务启动成功",
  "data": {
    "training_job_id": "TRAIN_20240811_001",
    "model_name": "工单分类模型v3.0",
    "status": "initializing",
    "estimated_duration": "4-6小时",
    "progress_url": "/api/v1/ai/models/train/TRAIN_20240811_001/progress",
    "started_at": "2024-08-11T20:00:00Z",
    "resource_allocation": {
      "gpu_count": 2,
      "memory_gb": 32,
      "cpu_cores": 8
    }
  }
}
```
---

## 14. 工作流引擎模块 (REQ-014)

### 14.1 工作流定义管理

#### 获取工作流模板列表
- **路径**: `GET /api/v1/workflows/templates`
- **REQ-ID**: REQ-014-001
- **平台**: Web
- **权限**: workflow_template_read
- **描述**: 获取工作流模板列表

**查询参数**:
- `category`: 模板分类 (approval, automation, notification)
- `status`: 模板状态 (active, draft, archived)
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "templates": [
      {
        "template_id": 1001,
        "template_name": "工单审批流程",
        "category": "approval",
        "description": "高优先级工单需要经过主管审批",
        "version": "1.0",
        "status": "active",
        "steps_count": 3,
        "created_at": "2024-08-01T10:00:00Z"
      }
    ]
  }
}
```
#### 创建工作流模板
- **路径**: `POST /api/v1/workflows/templates`
- **REQ-ID**: REQ-014-001
- **平台**: Web
- **权限**: workflow_template_create
- **描述**: 创建新的工作流模板

**请求参数**:
```json
{
  "template_name": "设备维护审批流程",
  "category": "approval",
  "description": "设备维护申请的审批流程",
  "trigger_conditions": [
    {
      "field": "ticket.category",
      "operator": "equals",
      "value": "设备维护"
    },
    {
      "field": "ticket.priority",
      "operator": "in",
      "value": [1, 2]
    }
  ],
  "steps": [
    {
      "step_id": "step1",
      "step_name": "部门主管审批",
      "step_type": "approval",
      "assignee_type": "role",
      "assignee_value": "department_manager",
      "timeout_hours": 24,
      "auto_approve": false
    },
    {
      "step_id": "step2",
      "step_name": "技术总监审批",
      "step_type": "approval",
      "assignee_type": "role",
      "assignee_value": "technical_director",
      "timeout_hours": 48,
      "condition": "step1.result == 'approved'"
    },
    {
      "step_id": "step3",
      "step_name": "发送通知",
      "step_type": "notification",
      "action": "send_email",
      "recipients": ["submitter", "assignee"],
      "template": "maintenance_approved"
    }
  ]
}
```
#### 更新工作流模板
- **路径**: `PUT /api/v1/workflows/templates/{templateId}`
- **REQ-ID**: REQ-014-001
- **平台**: Web
- **权限**: workflow_template_update
- **描述**: 更新工作流模板

#### 发布工作流模板
- **路径**: `POST /api/v1/workflows/templates/{templateId}/publish`
- **REQ-ID**: REQ-014-001
- **平台**: Web
- **权限**: workflow_template_publish
- **描述**: 发布工作流模板使其生效

### 14.2 工作流实例管理

#### 获取工作流实例列表
- **路径**: `GET /api/v1/workflows/instances`
- **REQ-ID**: REQ-014-002
- **平台**: Web
- **权限**: workflow_instance_read
- **描述**: 获取工作流实例列表

**查询参数**:
- `template_id`: 模板ID筛选
- `status`: 实例状态 (running, completed, failed, cancelled)
- `assignee_id`: 当前处理人ID
- `date_range`: 创建时间范围

#### 启动工作流实例
- **路径**: `POST /api/v1/workflows/instances`
- **REQ-ID**: REQ-014-002
- **平台**: Web, API
- **权限**: workflow_instance_start
- **描述**: 启动新的工作流实例

**请求参数**:
```json
{
  "template_id": 1001,
  "business_key": "TICKET-12345",
  "business_type": "ticket",
  "initiator_id": 1001,
  "variables": {
    "ticket_id": 12345,
    "priority": 1,
    "category": "设备维护",
    "submitter_id": 1001,
    "department_id": 11
  }
}
```
#### 获取工作流实例详情
- **路径**: `GET /api/v1/workflows/instances/{instanceId}`
- **REQ-ID**: REQ-014-002
- **平台**: Web
- **权限**: workflow_instance_read
- **描述**: 获取工作流实例详细信息

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "instance_id": "WF-001",
    "template_id": 1001,
    "template_name": "设备维护审批流程",
    "business_key": "TICKET-12345",
    "status": "running",
    "current_step": "step1",
    "initiator_id": 1001,
    "initiator_name": "张三",
    "start_time": "2024-08-11T14:00:00Z",
    "variables": {
      "ticket_id": 12345,
      "priority": 1
    },
    "steps": [
      {
        "step_id": "step1",
        "step_name": "部门主管审批",
        "status": "pending",
        "assignee_id": 1002,
        "assignee_name": "李经理",
        "start_time": "2024-08-11T14:00:00Z",
        "due_time": "2024-08-12T14:00:00Z"
      }
    ]
  }
}
```
### 14.3 工作流任务处理

#### 获取待办任务列表
- **路径**: `GET /api/v1/workflows/tasks/pending`
- **REQ-ID**: REQ-014-003
- **平台**: Web, Mobile
- **权限**: workflow_task_read
- **描述**: 获取当前用户的待办工作流任务

#### 处理工作流任务
- **路径**: `POST /api/v1/workflows/tasks/{taskId}/complete`
- **REQ-ID**: REQ-014-003
- **平台**: Web, Mobile
- **权限**: workflow_task_complete
- **描述**: 完成工作流任务

**请求参数**:
```json
{
  "action": "approve",
  "comment": "审批通过，可以进行设备维护",
  "variables": {
    "approved_by": 1002,
    "approval_time": "2024-08-11T15:30:00Z"
  }
}
```
#### 委托工作流任务
- **路径**: `POST /api/v1/workflows/tasks/{taskId}/delegate`
- **REQ-ID**: REQ-014-003
- **平台**: Web
- **权限**: workflow_task_delegate
- **描述**: 委托工作流任务给其他人

#### 获取任务历史
- **路径**: `GET /api/v1/workflows/tasks/{taskId}/history`
- **REQ-ID**: REQ-014-003
- **平台**: Web
- **权限**: workflow_task_read
- **描述**: 获取任务处理历史

### 14.4 工作流监控

#### 获取工作流统计
- **路径**: `GET /api/v1/workflows/statistics`
- **REQ-ID**: REQ-014-004
- **平台**: Web
- **权限**: workflow_monitor
- **描述**: 获取工作流执行统计数据

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "summary": {
      "total_instances": 156,
      "running_instances": 23,
      "completed_instances": 128,
      "failed_instances": 5
    },
    "performance": {
      "average_completion_time": "2.5小时",
      "on_time_completion_rate": 92.5,
      "sla_breach_count": 3
    },
    "by_template": [
      {
        "template_name": "工单审批流程",
        "instance_count": 89,
        "success_rate": 95.5,
        "average_duration": "1.8小时"
      }
    ]
  }
}
```
#### 工作流性能分析
- **路径**: `GET /api/v1/workflows/performance`
- **REQ-ID**: REQ-014-004
- **平台**: Web
- **权限**: workflow_monitor
- **描述**: 获取工作流性能分析数据

#### 超时任务监控
- **路径**: `GET /api/v1/workflows/tasks/overdue`
- **REQ-ID**: REQ-014-004
- **平台**: Web
- **权限**: workflow_monitor
- **描述**: 获取超时的工作流任务

### 14.5 工作流配置

#### 获取工作流引擎配置
- **路径**: `GET /api/v1/workflows/config`
- **REQ-ID**: REQ-014-005
- **平台**: Web
- **权限**: workflow_config_read
- **描述**: 获取工作流引擎配置

#### 更新工作流引擎配置
- **路径**: `PUT /api/v1/workflows/config`
- **REQ-ID**: REQ-014-005
- **平台**: Web
- **权限**: workflow_config_update
- **描述**: 更新工作流引擎配置

**请求参数**:
```json
{
  "max_concurrent_instances": 1000,
  "default_task_timeout": 24,
  "auto_cleanup_days": 90,
  "notification_enabled": true,
  "escalation_enabled": true,
  "escalation_timeout_hours": 48
}
```
---

## 15. 用户体验增强模块 (REQ-015)

### 15.1 个性化设置

#### 获取用户偏好设置
- **路径**: `GET /api/v1/user/preferences`
- **REQ-ID**: REQ-015-001
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取当前用户的个性化偏好设置

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "ui_preferences": {
      "theme": "light",
      "language": "zh-CN",
      "timezone": "Asia/Shanghai",
      "date_format": "YYYY-MM-DD",
      "time_format": "24h"
    },
    "dashboard_layout": {
      "layout_type": "grid",
      "widgets": [
        {
          "widget_id": "pending_tickets",
          "position": {"x": 0, "y": 0, "w": 6, "h": 4},
          "visible": true
        },
        {
          "widget_id": "system_status",
          "position": {"x": 6, "y": 0, "w": 6, "h": 4},
          "visible": true
        }
      ]
    },
    "notification_preferences": {
      "email_enabled": true,
      "sms_enabled": false,
      "push_enabled": true,
      "notification_types": {
        "ticket_assigned": true,
        "ticket_updated": true,
        "system_alert": true,
        "maintenance_notice": false
      }
    },
    "work_preferences": {
      "default_ticket_view": "list",
      "items_per_page": 20,
      "auto_refresh_interval": 30,
      "show_resolved_tickets": false
    }
  }
}
```
#### 更新用户偏好设置
- **路径**: `PUT /api/v1/user/preferences`
- **REQ-ID**: REQ-015-001
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 更新用户个性化偏好设置

**请求参数**:
```json
{
  "ui_preferences": {
    "theme": "dark",
    "language": "en-US",
    "timezone": "Asia/Shanghai"
  },
  "notification_preferences": {
    "email_enabled": true,
    "push_enabled": true,
    "notification_types": {
      "ticket_assigned": true,
      "ticket_updated": false,
      "system_alert": true
    }
  }
}
```
### 15.2 界面定制

#### 获取界面主题列表
- **路径**: `GET /api/v1/ui/themes`
- **REQ-ID**: REQ-015-002
- **平台**: Web
- **权限**: 需要认证
- **描述**: 获取可用的界面主题列表

#### 获取自定义CSS
- **路径**: `GET /api/v1/ui/custom-css`
- **REQ-ID**: REQ-015-002
- **平台**: Web
- **权限**: ui_customize
- **描述**: 获取自定义CSS样式

#### 更新自定义CSS
- **路径**: `PUT /api/v1/ui/custom-css`
- **REQ-ID**: REQ-015-002
- **平台**: Web
- **权限**: ui_customize
- **描述**: 更新自定义CSS样式

### 15.3 快捷操作

#### 获取快捷操作列表
- **路径**: `GET /api/v1/user/shortcuts`
- **REQ-ID**: REQ-015-003
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取用户自定义快捷操作

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "shortcuts": [
      {
        "shortcut_id": 1,
        "name": "创建紧急工单",
        "icon": "alert-circle",
        "action_type": "navigate",
        "action_config": {
          "url": "/tickets/create",
          "params": {"priority": 1}
        },
        "sort_order": 1
      },
      {
        "shortcut_id": 2,
        "name": "我的待办",
        "icon": "clipboard-list",
        "action_type": "navigate",
        "action_config": {
          "url": "/tickets",
          "params": {"assignee": "me", "status": "pending"}
        },
        "sort_order": 2
      }
    ]
  }
}
```
#### 创建快捷操作
- **路径**: `POST /api/v1/user/shortcuts`
- **REQ-ID**: REQ-015-003
- **平台**: Web
- **权限**: 需要认证
- **描述**: 创建用户自定义快捷操作

#### 更新快捷操作
- **路径**: `PUT /api/v1/user/shortcuts/{shortcutId}`
- **REQ-ID**: REQ-015-003
- **平台**: Web
- **权限**: 需要认证
- **描述**: 更新快捷操作配置

### 15.4 搜索增强

#### 全局智能搜索
- **路径**: `GET /api/v1/search/global`
- **REQ-ID**: REQ-015-004
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 全局智能搜索功能

**查询参数**:
- `q`: 搜索关键词
- `type`: 搜索类型 (all, tickets, customers, knowledge, users)
- `limit`: 结果数量限制

**响应示例**:
```json
{
  "code": 200,
  "message": "搜索成功",
  "data": {
    "total_results": 25,
    "search_time": 0.15,
    "results": [
      {
        "type": "ticket",
        "id": 12345,
        "title": "邮件服务器故障",
        "highlight": "邮件<em>服务器</em>无法发送邮件",
        "url": "/tickets/12345",
        "relevance_score": 0.95
      },
      {
        "type": "knowledge",
        "id": 1001,
        "title": "邮件服务器故障排查指南",
        "highlight": "<em>邮件服务器</em>故障的常见原因和解决方案",
        "url": "/knowledge/1001",
        "relevance_score": 0.88
      }
    ],
    "suggestions": [
      "邮件服务器配置",
      "邮件服务器监控",
      "邮件服务器维护"
    ]
  }
}
```
#### 保存搜索历史
- **路径**: `POST /api/v1/search/history`
- **REQ-ID**: REQ-015-004
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 保存用户搜索历史

#### 获取搜索建议
- **路径**: `GET /api/v1/search/suggestions`
- **REQ-ID**: REQ-015-004
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 获取搜索建议和热门搜索

### 15.5 操作引导

#### 获取新手引导配置
- **路径**: `GET /api/v1/user/onboarding`
- **REQ-ID**: REQ-015-005
- **平台**: Web
- **权限**: 需要认证
- **描述**: 获取新手引导配置

#### 更新引导进度
- **路径**: `PUT /api/v1/user/onboarding/progress`
- **REQ-ID**: REQ-015-005
- **平台**: Web
- **权限**: 需要认证
- **描述**: 更新用户引导完成进度

**请求参数**:
```json
{
  "step_id": "dashboard_tour",
  "status": "completed",
  "completed_at": "2024-08-11T15:30:00Z"
}
```
#### 获取帮助提示
- **路径**: `GET /api/v1/ui/help-tips`
- **REQ-ID**: REQ-015-005
- **平台**: Web
- **权限**: 需要认证
- **描述**: 获取页面帮助提示信息

### 15.6 用户反馈

#### 提交用户反馈
- **路径**: `POST /api/v1/user/feedback`
- **REQ-ID**: REQ-015-006
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 提交用户体验反馈

**请求参数**:
```json
{
  "feedback_type": "feature_request",
  "title": "希望增加批量操作功能",
  "description": "在工单列表页面希望能够批量更新工单状态",
  "page_url": "/tickets",
  "rating": 4,
  "attachments": [
    {
      "filename": "screenshot.png",
      "url": "/uploads/feedback/screenshot.png"
    }
  ]
}
```
#### 获取反馈列表
- **路径**: `GET /api/v1/user/feedback`
- **REQ-ID**: REQ-015-006
- **平台**: Web
- **权限**: 需要认证
- **描述**: 获取用户提交的反馈列表

#### 反馈处理状态更新
- **路径**: `PUT /api/v1/user/feedback/{feedbackId}/status`
- **REQ-ID**: REQ-015-006
- **平台**: Web
- **权限**: feedback_manage
- **描述**: 更新反馈处理状态

### 15.7 使用统计

#### 获取用户使用统计
- **路径**: `GET /api/v1/user/usage-statistics`
- **REQ-ID**: REQ-015-007
- **平台**: Web
- **权限**: 需要认证
- **描述**: 获取用户使用统计数据

**响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "daily_stats": {
      "login_count": 1,
      "session_duration": 480,
      "page_views": 156,
      "actions_performed": 45
    },
    "weekly_stats": {
      "total_logins": 5,
      "avg_session_duration": 420,
      "most_used_features": [
        {"feature": "工单管理", "usage_count": 89},
        {"feature": "知识库", "usage_count": 34},
        {"feature": "客户管理", "usage_count": 23}
      ]
    },
    "productivity_insights": {
      "tickets_handled": 12,
      "avg_resolution_time": "2.5小时",
      "efficiency_score": 85
    }
  }
}
```
#### 记录用户行为
- **路径**: `POST /api/v1/user/behavior-tracking`
- **REQ-ID**: REQ-015-007
- **平台**: Web, Mobile
- **权限**: 需要认证
- **描述**: 记录用户行为数据（用于体验优化）

---

## 16. 客户关系管理模块 (REQ-016)

### 16.1 客户档案管理

#### 创建客户档案
- **路径**: `POST /api/v1/customers`
- **REQ-ID**: REQ-016-001
- **平台**: Web
- **权限**: customer_create

**请求参数**:
```json
{
  "customer_name": "ABC科技有限公司",
  "customer_code": "ABC_TECH",
  "industry": "信息技术",
  "scale": "中型企业",
  "contact_person": "张总",
  "contact_phone": "13800138000",
  "contact_email": "zhang@abc-tech.com",
  "address": "北京市朝阳区xxx路xxx号",
  "level": 2,
  "tags": ["VIP客户", "技术导向"]
}
```
#### 获取客户档案
- **路径**: `GET /api/v1/customers/{customerId}`
- **REQ-ID**: REQ-016-001
- **平台**: Web, Mobile
- **权限**: customer_read

#### 更新客户档案
- **路径**: `PUT /api/v1/customers/{customerId}`
- **REQ-ID**: REQ-016-001
- **平台**: Web
- **权限**: customer_update

#### 客户列表查询
- **路径**: `GET /api/v1/customers`
- **REQ-ID**: REQ-016-001
- **平台**: Web
- **权限**: customer_read

### 16.2 合同管理

#### 创建合同
- **路径**: `POST /api/v1/customers/{customerId}/contracts`
- **REQ-ID**: REQ-016-002
- **平台**: Web
- **权限**: contract_create

#### 获取合同列表
- **路径**: `GET /api/v1/customers/{customerId}/contracts`
- **REQ-ID**: REQ-016-002
- **平台**: Web
- **权限**: contract_read

#### 合同续约
- **路径**: `POST /api/v1/contracts/{contractId}/renew`
- **REQ-ID**: REQ-016-002
- **平台**: Web
- **权限**: contract_renew

### 16.3 客户分析

#### 客户价值分析
- **路径**: `GET /api/v1/customers/{customerId}/analysis`
- **REQ-ID**: REQ-016-004
- **平台**: Web
- **权限**: customer_analyze

**响应示例**:
```json
{
  "code": 200,
  "message": "分析成功",
  "data": {
    "customer_info": {
      "customer_id": 12345,
      "customer_name": "ABC科技有限公司",
      "level": 2,
      "status": 2
    },
    "service_statistics": {
      "total_tickets": 156,
      "resolved_tickets": 148,
      "average_resolution_time": "4.2小时",
      "satisfaction_score": 4.6
    },
    "financial_analysis": {
      "total_revenue": 120000,
      "monthly_revenue": 10000,
      "ltv": 360000,
      "profit_margin": 0.35
    },
    "risk_assessment": {
      "churn_risk": "低",
      "satisfaction_trend": "上升",
      "renewal_probability": 0.92
    }
  }
}
```
#### 客户健康度评估
- **路径**: `GET /api/v1/customers/{customerId}/health`
- **REQ-ID**: REQ-016-010
- **平台**: Web
- **权限**: customer_analyze

### 16.4 满意度管理

#### 创建满意度调查
- **路径**: `POST /api/v1/customers/{customerId}/surveys`
- **REQ-ID**: REQ-016-005
- **平台**: Web
- **权限**: survey_create

#### 获取满意度数据
- **路径**: `GET /api/v1/customers/{customerId}/satisfaction`
- **REQ-ID**: REQ-016-005
- **平台**: Web
- **权限**: survey_read

---

## 17. SLA管理模块 (REQ-017)

### 17.1 SLA定义管理

#### 创建SLA定义
- **路径**: `POST /api/v1/sla/definitions`
- **REQ-ID**: REQ-017-001
- **平台**: Web
- **权限**: sla_create

**请求参数**:
```json
{
  "sla_name": "工单响应时间SLA",
  "sla_code": "TICKET_RESPONSE_TIME",
  "customer_id": 12345,
  "service_type": "工单处理",
  "metric_type": "response_time",
  "target_value": 30,
  "warning_threshold": 25,
  "unit": "minutes",
  "calculation_period": "monthly",
  "business_hours_only": 1,
  "priority_filter": "1,2",
  "category_filter": "硬件故障,软件故障"
}
```
#### 获取SLA定义
- **路径**: `GET /api/v1/sla/definitions/{slaId}`
- **REQ-ID**: REQ-017-001
- **平台**: Web
- **权限**: sla_read

#### 更新SLA定义
- **路径**: `PUT /api/v1/sla/definitions/{slaId}`
- **REQ-ID**: REQ-017-001
- **平台**: Web
- **权限**: sla_update

#### SLA定义列表
- **路径**: `GET /api/v1/sla/definitions`
- **REQ-ID**: REQ-017-001
- **平台**: Web
- **权限**: sla_read

### 17.2 SLA监控

#### 获取SLA监控数据
- **路径**: `GET /api/v1/sla/monitoring/{slaId}`
- **REQ-ID**: REQ-017-002
- **平台**: Web, Mobile
- **权限**: sla_monitor

**响应示例**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "sla_id": 1001,
    "sla_name": "工单响应时间SLA",
    "current_period": "2024-08",
    "target_value": 30,
    "actual_value": 28.5,
    "achievement_rate": 95.2,
    "status": "达成",
    "trend": "稳定",
    "violations": 3,
    "warning_count": 8
  }
}
```
#### SLA实时状态
- **路径**: `GET /api/v1/sla/status/realtime`
- **REQ-ID**: REQ-017-002
- **平台**: Web, Mobile
- **权限**: sla_monitor

### 17.3 SLA告警

#### 获取SLA告警
- **路径**: `GET /api/v1/sla/alerts`
- **REQ-ID**: REQ-017-003
- **平台**: Web, Mobile
- **权限**: sla_alert

#### 处理SLA告警
- **路径**: `PUT /api/v1/sla/alerts/{alertId}/handle`
- **REQ-ID**: REQ-017-003
- **平台**: Web, Mobile
- **权限**: sla_alert_handle

### 17.4 SLA报告

#### 生成SLA报告
- **路径**: `POST /api/v1/sla/reports`
- **REQ-ID**: REQ-017-004
- **平台**: Web
- **权限**: sla_report

#### 获取SLA报告
- **路径**: `GET /api/v1/sla/reports/{reportId}`
- **REQ-ID**: REQ-017-004
- **平台**: Web
- **权限**: sla_report

---

## 18. 财务管理模块 (REQ-018)

### 18.1 计费管理

#### 生成账单
- **路径**: `POST /api/v1/billing/generate`
- **REQ-ID**: REQ-018-001
- **平台**: Web, API
- **权限**: billing_generate

**请求参数**:
```json
{
  "customer_id": 12345,
  "billing_period": "2024-08",
  "billing_type": "monthly",
  "include_usage": true,
  "include_sla_penalties": true
}
```
#### 获取账单详情
- **路径**: `GET /api/v1/billing/bills/{billId}`
- **REQ-ID**: REQ-018-001
- **平台**: Web
- **权限**: billing_read

#### 账单列表查询
- **路径**: `GET /api/v1/billing/bills`
- **REQ-ID**: REQ-018-001
- **平台**: Web
- **权限**: billing_read

### 18.2 支付管理

#### 创建支付订单
- **路径**: `POST /api/v1/payments/orders`
- **REQ-ID**: REQ-018-004
- **平台**: Web
- **权限**: payment_create

#### 支付状态查询
- **路径**: `GET /api/v1/payments/orders/{orderId}/status`
- **REQ-ID**: REQ-018-004
- **平台**: Web
- **权限**: payment_read

#### 支付回调处理
- **路径**: `POST /api/v1/payments/callback/{provider}`
- **REQ-ID**: REQ-018-004
- **平台**: API
- **权限**: 无需认证

### 18.3 合同展期

#### 申请合同展期
- **路径**: `POST /api/v1/contracts/{contractId}/extension`
- **REQ-ID**: REQ-018-011
- **平台**: Web
- **权限**: contract_extend

**请求参数**:
```json
{
  "extension_days": 30,
  "reason": "新合同审批中，申请临时展期",
  "billing_mode": "daily_rate",
  "auto_approve": false
}
```
#### 审批展期申请
- **路径**: `PUT /api/v1/contracts/extensions/{extensionId}/approve`
- **REQ-ID**: REQ-018-012
- **平台**: Web
- **权限**: contract_approve

#### 展期记录查询
- **路径**: `GET /api/v1/contracts/{contractId}/extensions`
- **REQ-ID**: REQ-018-014
- **平台**: Web
- **权限**: contract_read

### 18.4 财务分析

#### 现金流预测
- **路径**: `GET /api/v1/finance/cashflow/forecast`
- **REQ-ID**: REQ-018-009
- **平台**: Web
- **权限**: finance_analyze

#### 收入结构分析
- **路径**: `GET /api/v1/finance/revenue/structure`
- **REQ-ID**: REQ-018-010
- **平台**: Web
- **权限**: finance_analyze

#### 客户付费周期分析
- **路径**: `GET /api/v1/finance/customers/payment-cycles`
- **REQ-ID**: REQ-018-010
- **平台**: Web
- **权限**: finance_analyze

---

## 19. 客户自助服务模块 (REQ-019)

### 19.1 客户门户

#### 客户门户登录
- **路径**: `POST /api/v1/customer-portal/auth/login`
- **REQ-ID**: REQ-019-001
- **平台**: Web, Mobile
- **权限**: 无需认证

#### 获取门户配置
- **路径**: `GET /api/v1/customer-portal/config`
- **REQ-ID**: REQ-019-001
- **平台**: Web, Mobile
- **权限**: customer_user

### 19.2 智能问答

#### AI智能问答
- **路径**: `POST /api/v1/customer-portal/ai/chat`
- **REQ-ID**: REQ-019-003
- **平台**: Web, Mobile
- **权限**: customer_user

**请求参数**:
```json
{
  "question": "邮件服务器无法发送邮件怎么办？",
  "context": {
    "customer_id": 12345,
    "previous_questions": []
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "回答成功",
  "data": {
    "answer": "邮件服务器无法发送邮件可能的原因包括...",
    "confidence": 0.92,
    "related_articles": [
      {
        "id": 1001,
        "title": "邮件服务器故障排查指南",
        "url": "/knowledge/articles/1001"
      }
    ],
    "suggested_actions": [
      "检查网络连接",
      "验证SMTP配置",
      "查看错误日志"
    ]
  }
}
```
#### FAQ搜索
- **路径**: `GET /api/v1/customer-portal/faq/search`
- **REQ-ID**: REQ-019-002
- **平台**: Web, Mobile
- **权限**: customer_user

### 19.3 自助工单

#### 创建自助工单
- **路径**: `POST /api/v1/customer-portal/tickets`
- **REQ-ID**: REQ-019-005
- **平台**: Web, Mobile
- **权限**: customer_user

#### 查询工单状态
- **路径**: `GET /api/v1/customer-portal/tickets/{ticketId}`
- **REQ-ID**: REQ-019-006
- **平台**: Web, Mobile
- **权限**: customer_user

#### 客户工单列表
- **路径**: `GET /api/v1/customer-portal/tickets`
- **REQ-ID**: REQ-019-006
- **平台**: Web, Mobile
- **权限**: customer_user

### 19.4 服务状态

#### 获取服务状态
- **路径**: `GET /api/v1/customer-portal/service-status`
- **REQ-ID**: REQ-019-007
- **平台**: Web, Mobile
- **权限**: customer_user

#### 维护计划查询
- **路径**: `GET /api/v1/customer-portal/maintenance-schedule`
- **REQ-ID**: REQ-019-007
- **平台**: Web, Mobile
- **权限**: customer_user

---

## 20. 移动端应用模块 (REQ-020)

### 20.1 移动端认证

#### 移动端登录
- **路径**: `POST /api/v1/mobile/auth/login`
- **REQ-ID**: REQ-020-001
- **平台**: Mobile
- **权限**: 无需认证

**请求参数**:
```json
{
  "username": "engineer001",
  "password": "password123",
  "device_info": {
    "device_id": "iPhone_12345",
    "device_type": "ios",
    "device_model": "iPhone 13",
    "os_version": "iOS 15.0",
    "app_version": "1.0.0",
    "push_token": "abc123def456"
  }
}
```
#### 设备注册
- **路径**: `POST /api/v1/mobile/devices/register`
- **REQ-ID**: REQ-020-002
- **平台**: Mobile
- **权限**: 需要认证

### 20.2 移动端工单

#### 移动端工单列表
- **路径**: `GET /api/v1/mobile/tickets`
- **REQ-ID**: REQ-020-001
- **平台**: Mobile
- **权限**: ticket_read

#### 移动端更新工单
- **路径**: `PUT /api/v1/mobile/tickets/{ticketId}`
- **REQ-ID**: REQ-020-001
- **平台**: Mobile
- **权限**: ticket_update

### 20.3 推送通知

#### 发送推送通知
- **路径**: `POST /api/v1/mobile/push/send`
- **REQ-ID**: REQ-020-002
- **平台**: API
- **权限**: push_send

#### 更新推送Token
- **路径**: `PUT /api/v1/mobile/push/token`
- **REQ-ID**: REQ-020-002
- **平台**: Mobile
- **权限**: 需要认证

### 20.4 离线同步

#### 上传离线数据
- **路径**: `POST /api/v1/mobile/sync/upload`
- **REQ-ID**: REQ-020-004
- **平台**: Mobile
- **权限**: 需要认证

#### 下载同步数据
- **路径**: `GET /api/v1/mobile/sync/download`
- **REQ-ID**: REQ-020-004
- **平台**: Mobile
- **权限**: 需要认证

---

## 21. 资源权限管理模块 (REQ-021)

### 21.1 权限验证

#### 资源权限验证
- **路径**: `POST /api/v1/permissions/verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, Mobile, API
- **权限**: 需要认证

**请求参数**:
```json
{
  "subject": {
    "user_id": 1001,
    "roles": ["engineer", "senior_engineer"],
    "department": "ops_team",
    "attributes": {
      "security_level": "L2",
      "location": "beijing"
    }
  },
  "resource": {
    "resource_code": "ticket_management",
    "resource_type": "module",
    "attributes": {
      "data_classification": "internal",
      "customer_id": 12345
    }
  },
  "action": "read"
}
```
#### 批量权限验证
- **路径**: `POST /api/v1/permissions/batch-verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, API
- **权限**: 需要认证

### 21.2 权限分配

#### 分配资源权限
- **路径**: `POST /api/v1/permissions/assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 批量权限分配
- **路径**: `POST /api/v1/permissions/batch-assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 回收资源权限
- **路径**: `DELETE /api/v1/permissions/{permissionId}`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_revoke

### 21.3 临时授权

#### 创建临时授权
- **路径**: `POST /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_grant

#### 临时授权列表
- **路径**: `GET /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_view

### 21.4 权限审计

#### 权限操作日志
- **路径**: `GET /api/v1/permissions/audit-logs`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

#### 用户权限报告
- **路径**: `GET /api/v1/permissions/users/{userId}/report`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

---

## 22. 用户与权限管理模块 (REQ-022)

### 22.1 用户管理

#### 创建用户
- **路径**: `POST /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_create

**请求参数**:
```json
{
  "username": "newuser001",
  "email": "newuser@company.com",
  "phone": "13800138000",
  "real_name": "新用户",
  "employee_id": "EMP001",
  "department_id": 1001,
  "position": "初级工程师",
  "roles": ["engineer"],
  "password": "TempPassword123!",
  "force_password_change": true,
  "send_welcome_email": true
}
```
#### 获取用户信息
- **路径**: `GET /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 更新用户信息
- **路径**: `PUT /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_update

#### 用户列表查询
- **路径**: `GET /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 禁用/启用用户
- **路径**: `PUT /api/v1/users/{userId}/status`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_manage

### 22.2 角色管理

#### 创建角色
- **路径**: `POST /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_create

#### 获取角色列表
- **路径**: `GET /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_read

#### 分配角色权限
- **路径**: `PUT /api/v1/roles/{roleId}/permissions`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_permission

### 22.3 组织架构

#### 获取部门树
- **路径**: `GET /api/v1/departments/tree`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_read

#### 创建部门
- **路径**: `POST /api/v1/departments`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_create

#### 部门人员管理
- **路径**: `PUT /api/v1/departments/{deptId}/members`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_manage

### 22.4 外部身份源

#### LDAP集成配置
- **路径**: `POST /api/v1/auth/ldap/config`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_config

#### LDAP用户同步
- **路径**: `POST /api/v1/auth/ldap/sync`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_sync

### 22.5 会话管理

#### 获取用户会话
- **路径**: `GET /api/v1/sessions/user/{userId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_view

#### 强制下线用户
- **路径**: `DELETE /api/v1/sessions/{sessionId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_manage

---

## 23. 数据分析与商业智能模块 (REQ-023)

### 23.1 分析任务

#### 创建分析任务
- **路径**: `POST /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_create

**请求参数**:
```json
{
  "task_name": "月度运营效率分析",
  "task_type": "operational_analysis",
  "analysis_config": {
    "metrics": ["ticket_volume", "resolution_time", "satisfaction"],
    "dimensions": ["department", "priority", "category"],
    "time_range": "last_month",
    "comparison": "previous_month"
  },
  "schedule_config": {
    "frequency": "monthly",
    "day_of_month": 1,
    "time": "09:00"
  },
  "output_config": {
    "formats": ["dashboard", "report", "email"],
    "recipients": ["manager@company.com"]
  }
}
```
#### 获取分析结果
- **路径**: `GET /api/v1/analytics/results/{resultId}`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

#### 分析任务列表
- **路径**: `GET /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

### 23.2 趋势预测

#### 业务趋势预测
- **路径**: `POST /api/v1/analytics/predict/trends`
- **REQ-ID**: REQ-023-002
- **平台**: Web
- **权限**: analytics_predict

#### 客户流失预测
- **路径**: `POST /api/v1/analytics/predict/churn`
- **REQ-ID**: REQ-023-003
- **平台**: Web
- **权限**: analytics_predict

### 23.3 实时大屏

#### 获取大屏数据
- **路径**: `GET /api/v1/analytics/dashboard/realtime`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_dashboard

#### 大屏配置管理
- **路径**: `PUT /api/v1/analytics/dashboard/config`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_config

### 23.4 异常检测

#### 异常检测分析
- **路径**: `POST /api/v1/analytics/anomaly/detect`
- **REQ-ID**: REQ-023-007
- **平台**: Web, API
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*

 **路径**: `POST /api/v1/permissions/batch-verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, API
- **权限**: 需要认证

### 21.2 权限分配

#### 分配资源权限
- **路径**: `POST /api/v1/permissions/assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 批量权限分配
- **路径**: `POST /api/v1/permissions/batch-assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 回收资源权限
- **路径**: `DELETE /api/v1/permissions/{permissionId}`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_revoke

### 21.3 临时授权

#### 创建临时授权
- **路径**: `POST /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_grant

#### 临时授权列表
- **路径**: `GET /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_view

### 21.4 权限审计

#### 权限操作日志
- **路径**: `GET /api/v1/permissions/audit-logs`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

#### 用户权限报告
- **路径**: `GET /api/v1/permissions/users/{userId}/report`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

---

## 22. 用户与权限管理模块 (REQ-022)

### 22.1 用户管理

#### 创建用户
- **路径**: `POST /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_create

**请求参数**:
```json
{
  "username": "newuser001",
  "email": "newuser@company.com",
  "phone": "13800138000",
  "real_name": "新用户",
  "employee_id": "EMP001",
  "department_id": 1001,
  "position": "初级工程师",
  "roles": ["engineer"],
  "password": "TempPassword123!",
  "force_password_change": true,
  "send_welcome_email": true
}
```
#### 获取用户信息
- **路径**: `GET /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 更新用户信息
- **路径**: `PUT /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_update

#### 用户列表查询
- **路径**: `GET /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 禁用/启用用户
- **路径**: `PUT /api/v1/users/{userId}/status`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_manage

### 22.2 角色管理

#### 创建角色
- **路径**: `POST /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_create

#### 获取角色列表
- **路径**: `GET /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_read

#### 分配角色权限
- **路径**: `PUT /api/v1/roles/{roleId}/permissions`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_permission

### 22.3 组织架构

#### 获取部门树
- **路径**: `GET /api/v1/departments/tree`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_read

#### 创建部门
- **路径**: `POST /api/v1/departments`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_create

#### 部门人员管理
- **路径**: `PUT /api/v1/departments/{deptId}/members`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_manage

### 22.4 外部身份源

#### LDAP集成配置
- **路径**: `POST /api/v1/auth/ldap/config`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_config

#### LDAP用户同步
- **路径**: `POST /api/v1/auth/ldap/sync`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_sync

### 22.5 会话管理

#### 获取用户会话
- **路径**: `GET /api/v1/sessions/user/{userId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_view

#### 强制下线用户
- **路径**: `DELETE /api/v1/sessions/{sessionId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_manage

---

## 23. 数据分析与商业智能模块 (REQ-023)

### 23.1 分析任务

#### 创建分析任务
- **路径**: `POST /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_create

**请求参数**:
```json
{
  "task_name": "月度运营效率分析",
  "task_type": "operational_analysis",
  "analysis_config": {
    "metrics": ["ticket_volume", "resolution_time", "satisfaction"],
    "dimensions": ["department", "priority", "category"],
    "time_range": "last_month",
    "comparison": "previous_month"
  },
  "schedule_config": {
    "frequency": "monthly",
    "day_of_month": 1,
    "time": "09:00"
  },
  "output_config": {
    "formats": ["dashboard", "report", "email"],
    "recipients": ["manager@company.com"]
  }
}
```
#### 获取分析结果
- **路径**: `GET /api/v1/analytics/results/{resultId}`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

#### 分析任务列表
- **路径**: `GET /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

### 23.2 趋势预测

#### 业务趋势预测
- **路径**: `POST /api/v1/analytics/predict/trends`
- **REQ-ID**: REQ-023-002
- **平台**: Web
- **权限**: analytics_predict

#### 客户流失预测
- **路径**: `POST /api/v1/analytics/predict/churn`
- **REQ-ID**: REQ-023-003
- **平台**: Web
- **权限**: analytics_predict

### 23.3 实时大屏

#### 获取大屏数据
- **路径**: `GET /api/v1/analytics/dashboard/realtime`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_dashboard

#### 大屏配置管理
- **路径**: `PUT /api/v1/analytics/dashboard/config`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_config

### 23.4 异常检测

#### 异常检测分析
- **路径**: `POST /api/v1/analytics/anomaly/detect`
- **REQ-ID**: REQ-023-007
- **平台**: Web, API
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*

I
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*

 **路径**: `POST /api/v1/permissions/batch-verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, API
- **权限**: 需要认证

### 21.2 权限分配

#### 分配资源权限
- **路径**: `POST /api/v1/permissions/assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 批量权限分配
- **路径**: `POST /api/v1/permissions/batch-assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 回收资源权限
- **路径**: `DELETE /api/v1/permissions/{permissionId}`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_revoke

### 21.3 临时授权

#### 创建临时授权
- **路径**: `POST /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_grant

#### 临时授权列表
- **路径**: `GET /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_view

### 21.4 权限审计

#### 权限操作日志
- **路径**: `GET /api/v1/permissions/audit-logs`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

#### 用户权限报告
- **路径**: `GET /api/v1/permissions/users/{userId}/report`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

---

## 22. 用户与权限管理模块 (REQ-022)

### 22.1 用户管理

#### 创建用户
- **路径**: `POST /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_create

**请求参数**:
```json
{
  "username": "newuser001",
  "email": "newuser@company.com",
  "phone": "13800138000",
  "real_name": "新用户",
  "employee_id": "EMP001",
  "department_id": 1001,
  "position": "初级工程师",
  "roles": ["engineer"],
  "password": "TempPassword123!",
  "force_password_change": true,
  "send_welcome_email": true
}
```
#### 获取用户信息
- **路径**: `GET /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 更新用户信息
- **路径**: `PUT /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_update

#### 用户列表查询
- **路径**: `GET /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 禁用/启用用户
- **路径**: `PUT /api/v1/users/{userId}/status`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_manage

### 22.2 角色管理

#### 创建角色
- **路径**: `POST /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_create

#### 获取角色列表
- **路径**: `GET /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_read

#### 分配角色权限
- **路径**: `PUT /api/v1/roles/{roleId}/permissions`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_permission

### 22.3 组织架构

#### 获取部门树
- **路径**: `GET /api/v1/departments/tree`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_read

#### 创建部门
- **路径**: `POST /api/v1/departments`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_create

#### 部门人员管理
- **路径**: `PUT /api/v1/departments/{deptId}/members`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_manage

### 22.4 外部身份源

#### LDAP集成配置
- **路径**: `POST /api/v1/auth/ldap/config`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_config

#### LDAP用户同步
- **路径**: `POST /api/v1/auth/ldap/sync`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_sync

### 22.5 会话管理

#### 获取用户会话
- **路径**: `GET /api/v1/sessions/user/{userId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_view

#### 强制下线用户
- **路径**: `DELETE /api/v1/sessions/{sessionId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_manage

---

## 23. 数据分析与商业智能模块 (REQ-023)

### 23.1 分析任务

#### 创建分析任务
- **路径**: `POST /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_create

**请求参数**:
```json
{
  "task_name": "月度运营效率分析",
  "task_type": "operational_analysis",
  "analysis_config": {
    "metrics": ["ticket_volume", "resolution_time", "satisfaction"],
    "dimensions": ["department", "priority", "category"],
    "time_range": "last_month",
    "comparison": "previous_month"
  },
  "schedule_config": {
    "frequency": "monthly",
    "day_of_month": 1,
    "time": "09:00"
  },
  "output_config": {
    "formats": ["dashboard", "report", "email"],
    "recipients": ["manager@company.com"]
  }
}
```
#### 获取分析结果
- **路径**: `GET /api/v1/analytics/results/{resultId}`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

#### 分析任务列表
- **路径**: `GET /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

### 23.2 趋势预测

#### 业务趋势预测
- **路径**: `POST /api/v1/analytics/predict/trends`
- **REQ-ID**: REQ-023-002
- **平台**: Web
- **权限**: analytics_predict

#### 客户流失预测
- **路径**: `POST /api/v1/analytics/predict/churn`
- **REQ-ID**: REQ-023-003
- **平台**: Web
- **权限**: analytics_predict

### 23.3 实时大屏

#### 获取大屏数据
- **路径**: `GET /api/v1/analytics/dashboard/realtime`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_dashboard

#### 大屏配置管理
- **路径**: `PUT /api/v1/analytics/dashboard/config`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_config

### 23.4 异常检测

#### 异常检测分析
- **路径**: `POST /api/v1/analytics/anomaly/detect`
- **REQ-ID**: REQ-023-007
- **平台**: Web, API
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*

sionId}/approve`
- **REQ-ID**: REQ-018-012
- **平台**: Web
- **权限**: contract_approve

#### 展期记录查询
- **路径**: `GET /api/v1/contracts/{contractId}/extensions`
- **REQ-ID**: REQ-018-014
- **平台**: Web
- **权限**: contract_read

### 18.4 财务分析

#### 现金流预测
- **路径**: `GET /api/v1/finance/cashflow/forecast`
- **REQ-ID**: REQ-018-009
- **平台**: Web
- **权限**: finance_analyze

#### 收入结构分析
- **路径**: `GET /api/v1/finance/revenue/structure`
- **REQ-ID**: REQ-018-010
- **平台**: Web
- **权限**: finance_analyze

#### 客户付费周期分析
- **路径**: `GET /api/v1/finance/customers/payment-cycles`
- **REQ-ID**: REQ-018-010
- **平台**: Web
- **权限**: finance_analyze

---

## 19. 客户自助服务模块 (REQ-019)

### 19.1 客户门户

#### 客户门户登录
- **路径**: `POST /api/v1/customer-portal/auth/login`
- **REQ-ID**: REQ-019-001
- **平台**: Web, Mobile
- **权限**: 无需认证

#### 获取门户配置
- **路径**: `GET /api/v1/customer-portal/config`
- **REQ-ID**: REQ-019-001
- **平台**: Web, Mobile
- **权限**: customer_user

### 19.2 智能问答

#### AI智能问答
- **路径**: `POST /api/v1/customer-portal/ai/chat`
- **REQ-ID**: REQ-019-003
- **平台**: Web, Mobile
- **权限**: customer_user

**请求参数**:
```json
{
  "question": "邮件服务器无法发送邮件怎么办？",
  "context": {
    "customer_id": 12345,
    "previous_questions": []
  }
}
```
**响应示例**:
```json
{
  "code": 200,
  "message": "回答成功",
  "data": {
    "answer": "邮件服务器无法发送邮件可能的原因包括...",
    "confidence": 0.92,
    "related_articles": [
      {
        "id": 1001,
        "title": "邮件服务器故障排查指南",
        "url": "/knowledge/articles/1001"
      }
    ],
    "suggested_actions": [
      "检查网络连接",
      "验证SMTP配置",
      "查看错误日志"
    ]
  }
}
```
#### FAQ搜索
- **路径**: `GET /api/v1/customer-portal/faq/search`
- **REQ-ID**: REQ-019-002
- **平台**: Web, Mobile
- **权限**: customer_user

### 19.3 自助工单

#### 创建自助工单
- **路径**: `POST /api/v1/customer-portal/tickets`
- **REQ-ID**: REQ-019-005
- **平台**: Web, Mobile
- **权限**: customer_user

#### 查询工单状态
- **路径**: `GET /api/v1/customer-portal/tickets/{ticketId}`
- **REQ-ID**: REQ-019-006
- **平台**: Web, Mobile
- **权限**: customer_user

#### 客户工单列表
- **路径**: `GET /api/v1/customer-portal/tickets`
- **REQ-ID**: REQ-019-006
- **平台**: Web, Mobile
- **权限**: customer_user

### 19.4 服务状态

#### 获取服务状态
- **路径**: `GET /api/v1/customer-portal/service-status`
- **REQ-ID**: REQ-019-007
- **平台**: Web, Mobile
- **权限**: customer_user

#### 维护计划查询
- **路径**: `GET /api/v1/customer-portal/maintenance-schedule`
- **REQ-ID**: REQ-019-007
- **平台**: Web, Mobile
- **权限**: customer_user

---

## 20. 移动端应用模块 (REQ-020)

### 20.1 移动端认证

#### 移动端登录
- **路径**: `POST /api/v1/mobile/auth/login`
- **REQ-ID**: REQ-020-001
- **平台**: Mobile
- **权限**: 无需认证

**请求参数**:
```json
{
  "username": "engineer001",
  "password": "password123",
  "device_info": {
    "device_id": "iPhone_12345",
    "device_type": "ios",
    "device_model": "iPhone 13",
    "os_version": "iOS 15.0",
    "app_version": "1.0.0",
    "push_token": "abc123def456"
  }
}
```
#### 设备注册
- **路径**: `POST /api/v1/mobile/devices/register`
- **REQ-ID**: REQ-020-002
- **平台**: Mobile
- **权限**: 需要认证

### 20.2 移动端工单

#### 移动端工单列表
- **路径**: `GET /api/v1/mobile/tickets`
- **REQ-ID**: REQ-020-001
- **平台**: Mobile
- **权限**: ticket_read

#### 移动端更新工单
- **路径**: `PUT /api/v1/mobile/tickets/{ticketId}`
- **REQ-ID**: REQ-020-001
- **平台**: Mobile
- **权限**: ticket_update

### 20.3 推送通知

#### 发送推送通知
- **路径**: `POST /api/v1/mobile/push/send`
- **REQ-ID**: REQ-020-002
- **平台**: API
- **权限**: push_send

#### 更新推送Token
- **路径**: `PUT /api/v1/mobile/push/token`
- **REQ-ID**: REQ-020-002
- **平台**: Mobile
- **权限**: 需要认证

### 20.4 离线同步

#### 上传离线数据
- **路径**: `POST /api/v1/mobile/sync/upload`
- **REQ-ID**: REQ-020-004
- **平台**: Mobile
- **权限**: 需要认证

#### 下载同步数据
- **路径**: `GET /api/v1/mobile/sync/download`
- **REQ-ID**: REQ-020-004
- **平台**: Mobile
- **权限**: 需要认证

---

## 21. 资源权限管理模块 (REQ-021)

### 21.1 权限验证

#### 资源权限验证
- **路径**: `POST /api/v1/permissions/verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, Mobile, API
- **权限**: 需要认证

**请求参数**:
```json
{
  "subject": {
    "user_id": 1001,
    "roles": ["engineer", "senior_engineer"],
    "department": "ops_team",
    "attributes": {
      "security_level": "L2",
      "location": "beijing"
    }
  },
  "resource": {
    "resource_code": "ticket_management",
    "resource_type": "module",
    "attributes": {
      "data_classification": "internal",
      "customer_id": 12345
    }
  },
  "action": "read"
}
```
#### 批量权限验证
- **路径**: `POST /api/v1/permissions/batch-verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, API
- **权限**: 需要认证

### 21.2 权限分配

#### 分配资源权限
- **路径**: `POST /api/v1/permissions/assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 批量权限分配
- **路径**: `POST /api/v1/permissions/batch-assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 回收资源权限
- **路径**: `DELETE /api/v1/permissions/{permissionId}`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_revoke

### 21.3 临时授权

#### 创建临时授权
- **路径**: `POST /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_grant

#### 临时授权列表
- **路径**: `GET /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_view

### 21.4 权限审计

#### 权限操作日志
- **路径**: `GET /api/v1/permissions/audit-logs`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

#### 用户权限报告
- **路径**: `GET /api/v1/permissions/users/{userId}/report`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

---

## 22. 用户与权限管理模块 (REQ-022)

### 22.1 用户管理

#### 创建用户
- **路径**: `POST /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_create

**请求参数**:
```json
{
  "username": "newuser001",
  "email": "newuser@company.com",
  "phone": "13800138000",
  "real_name": "新用户",
  "employee_id": "EMP001",
  "department_id": 1001,
  "position": "初级工程师",
  "roles": ["engineer"],
  "password": "TempPassword123!",
  "force_password_change": true,
  "send_welcome_email": true
}
```
#### 获取用户信息
- **路径**: `GET /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 更新用户信息
- **路径**: `PUT /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_update

#### 用户列表查询
- **路径**: `GET /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 禁用/启用用户
- **路径**: `PUT /api/v1/users/{userId}/status`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_manage

### 22.2 角色管理

#### 创建角色
- **路径**: `POST /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_create

#### 获取角色列表
- **路径**: `GET /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_read

#### 分配角色权限
- **路径**: `PUT /api/v1/roles/{roleId}/permissions`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_permission

### 22.3 组织架构

#### 获取部门树
- **路径**: `GET /api/v1/departments/tree`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_read

#### 创建部门
- **路径**: `POST /api/v1/departments`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_create

#### 部门人员管理
- **路径**: `PUT /api/v1/departments/{deptId}/members`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_manage

### 22.4 外部身份源

#### LDAP集成配置
- **路径**: `POST /api/v1/auth/ldap/config`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_config

#### LDAP用户同步
- **路径**: `POST /api/v1/auth/ldap/sync`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_sync

### 22.5 会话管理

#### 获取用户会话
- **路径**: `GET /api/v1/sessions/user/{userId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_view

#### 强制下线用户
- **路径**: `DELETE /api/v1/sessions/{sessionId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_manage

---

## 23. 数据分析与商业智能模块 (REQ-023)

### 23.1 分析任务

#### 创建分析任务
- **路径**: `POST /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_create

**请求参数**:
```json
{
  "task_name": "月度运营效率分析",
  "task_type": "operational_analysis",
  "analysis_config": {
    "metrics": ["ticket_volume", "resolution_time", "satisfaction"],
    "dimensions": ["department", "priority", "category"],
    "time_range": "last_month",
    "comparison": "previous_month"
  },
  "schedule_config": {
    "frequency": "monthly",
    "day_of_month": 1,
    "time": "09:00"
  },
  "output_config": {
    "formats": ["dashboard", "report", "email"],
    "recipients": ["manager@company.com"]
  }
}
```
#### 获取分析结果
- **路径**: `GET /api/v1/analytics/results/{resultId}`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

#### 分析任务列表
- **路径**: `GET /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

### 23.2 趋势预测

#### 业务趋势预测
- **路径**: `POST /api/v1/analytics/predict/trends`
- **REQ-ID**: REQ-023-002
- **平台**: Web
- **权限**: analytics_predict

#### 客户流失预测
- **路径**: `POST /api/v1/analytics/predict/churn`
- **REQ-ID**: REQ-023-003
- **平台**: Web
- **权限**: analytics_predict

### 23.3 实时大屏

#### 获取大屏数据
- **路径**: `GET /api/v1/analytics/dashboard/realtime`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_dashboard

#### 大屏配置管理
- **路径**: `PUT /api/v1/analytics/dashboard/config`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_config

### 23.4 异常检测

#### 异常检测分析
- **路径**: `POST /api/v1/analytics/anomaly/detect`
- **REQ-ID**: REQ-023-007
- **平台**: Web, API
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*

 **路径**: `POST /api/v1/permissions/batch-verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, API
- **权限**: 需要认证

### 21.2 权限分配

#### 分配资源权限
- **路径**: `POST /api/v1/permissions/assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 批量权限分配
- **路径**: `POST /api/v1/permissions/batch-assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 回收资源权限
- **路径**: `DELETE /api/v1/permissions/{permissionId}`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_revoke

### 21.3 临时授权

#### 创建临时授权
- **路径**: `POST /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_grant

#### 临时授权列表
- **路径**: `GET /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_view

### 21.4 权限审计

#### 权限操作日志
- **路径**: `GET /api/v1/permissions/audit-logs`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

#### 用户权限报告
- **路径**: `GET /api/v1/permissions/users/{userId}/report`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

---

## 22. 用户与权限管理模块 (REQ-022)

### 22.1 用户管理

#### 创建用户
- **路径**: `POST /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_create

**请求参数**:
```json
{
  "username": "newuser001",
  "email": "newuser@company.com",
  "phone": "13800138000",
  "real_name": "新用户",
  "employee_id": "EMP001",
  "department_id": 1001,
  "position": "初级工程师",
  "roles": ["engineer"],
  "password": "TempPassword123!",
  "force_password_change": true,
  "send_welcome_email": true
}
```
#### 获取用户信息
- **路径**: `GET /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 更新用户信息
- **路径**: `PUT /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_update

#### 用户列表查询
- **路径**: `GET /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 禁用/启用用户
- **路径**: `PUT /api/v1/users/{userId}/status`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_manage

### 22.2 角色管理

#### 创建角色
- **路径**: `POST /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_create

#### 获取角色列表
- **路径**: `GET /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_read

#### 分配角色权限
- **路径**: `PUT /api/v1/roles/{roleId}/permissions`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_permission

### 22.3 组织架构

#### 获取部门树
- **路径**: `GET /api/v1/departments/tree`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_read

#### 创建部门
- **路径**: `POST /api/v1/departments`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_create

#### 部门人员管理
- **路径**: `PUT /api/v1/departments/{deptId}/members`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_manage

### 22.4 外部身份源

#### LDAP集成配置
- **路径**: `POST /api/v1/auth/ldap/config`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_config

#### LDAP用户同步
- **路径**: `POST /api/v1/auth/ldap/sync`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_sync

### 22.5 会话管理

#### 获取用户会话
- **路径**: `GET /api/v1/sessions/user/{userId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_view

#### 强制下线用户
- **路径**: `DELETE /api/v1/sessions/{sessionId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_manage

---

## 23. 数据分析与商业智能模块 (REQ-023)

### 23.1 分析任务

#### 创建分析任务
- **路径**: `POST /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_create

**请求参数**:
```json
{
  "task_name": "月度运营效率分析",
  "task_type": "operational_analysis",
  "analysis_config": {
    "metrics": ["ticket_volume", "resolution_time", "satisfaction"],
    "dimensions": ["department", "priority", "category"],
    "time_range": "last_month",
    "comparison": "previous_month"
  },
  "schedule_config": {
    "frequency": "monthly",
    "day_of_month": 1,
    "time": "09:00"
  },
  "output_config": {
    "formats": ["dashboard", "report", "email"],
    "recipients": ["manager@company.com"]
  }
}
```
#### 获取分析结果
- **路径**: `GET /api/v1/analytics/results/{resultId}`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

#### 分析任务列表
- **路径**: `GET /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

### 23.2 趋势预测

#### 业务趋势预测
- **路径**: `POST /api/v1/analytics/predict/trends`
- **REQ-ID**: REQ-023-002
- **平台**: Web
- **权限**: analytics_predict

#### 客户流失预测
- **路径**: `POST /api/v1/analytics/predict/churn`
- **REQ-ID**: REQ-023-003
- **平台**: Web
- **权限**: analytics_predict

### 23.3 实时大屏

#### 获取大屏数据
- **路径**: `GET /api/v1/analytics/dashboard/realtime`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_dashboard

#### 大屏配置管理
- **路径**: `PUT /api/v1/analytics/dashboard/config`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_config

### 23.4 异常检测

#### 异常检测分析
- **路径**: `POST /api/v1/analytics/anomaly/detect`
- **REQ-ID**: REQ-023-007
- **平台**: Web, API
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*

I
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*

 **路径**: `POST /api/v1/permissions/batch-verify`
- **REQ-ID**: REQ-021-001
- **平台**: Web, API
- **权限**: 需要认证

### 21.2 权限分配

#### 分配资源权限
- **路径**: `POST /api/v1/permissions/assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 批量权限分配
- **路径**: `POST /api/v1/permissions/batch-assign`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_assign

#### 回收资源权限
- **路径**: `DELETE /api/v1/permissions/{permissionId}`
- **REQ-ID**: REQ-021-006
- **平台**: Web
- **权限**: permission_revoke

### 21.3 临时授权

#### 创建临时授权
- **路径**: `POST /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_grant

#### 临时授权列表
- **路径**: `GET /api/v1/permissions/temporary`
- **REQ-ID**: REQ-021-007
- **平台**: Web
- **权限**: permission_temp_view

### 21.4 权限审计

#### 权限操作日志
- **路径**: `GET /api/v1/permissions/audit-logs`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

#### 用户权限报告
- **路径**: `GET /api/v1/permissions/users/{userId}/report`
- **REQ-ID**: REQ-021-008
- **平台**: Web
- **权限**: permission_audit

---

## 22. 用户与权限管理模块 (REQ-022)

### 22.1 用户管理

#### 创建用户
- **路径**: `POST /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_create

**请求参数**:
```json
{
  "username": "newuser001",
  "email": "newuser@company.com",
  "phone": "13800138000",
  "real_name": "新用户",
  "employee_id": "EMP001",
  "department_id": 1001,
  "position": "初级工程师",
  "roles": ["engineer"],
  "password": "TempPassword123!",
  "force_password_change": true,
  "send_welcome_email": true
}
```
#### 获取用户信息
- **路径**: `GET /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 更新用户信息
- **路径**: `PUT /api/v1/users/{userId}`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_update

#### 用户列表查询
- **路径**: `GET /api/v1/users`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_read

#### 禁用/启用用户
- **路径**: `PUT /api/v1/users/{userId}/status`
- **REQ-ID**: REQ-022-001
- **平台**: Web
- **权限**: user_manage

### 22.2 角色管理

#### 创建角色
- **路径**: `POST /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_create

#### 获取角色列表
- **路径**: `GET /api/v1/roles`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_read

#### 分配角色权限
- **路径**: `PUT /api/v1/roles/{roleId}/permissions`
- **REQ-ID**: REQ-022-003
- **平台**: Web
- **权限**: role_permission

### 22.3 组织架构

#### 获取部门树
- **路径**: `GET /api/v1/departments/tree`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_read

#### 创建部门
- **路径**: `POST /api/v1/departments`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_create

#### 部门人员管理
- **路径**: `PUT /api/v1/departments/{deptId}/members`
- **REQ-ID**: REQ-022-004
- **平台**: Web
- **权限**: dept_manage

### 22.4 外部身份源

#### LDAP集成配置
- **路径**: `POST /api/v1/auth/ldap/config`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_config

#### LDAP用户同步
- **路径**: `POST /api/v1/auth/ldap/sync`
- **REQ-ID**: REQ-022-005
- **平台**: Web
- **权限**: auth_sync

### 22.5 会话管理

#### 获取用户会话
- **路径**: `GET /api/v1/sessions/user/{userId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_view

#### 强制下线用户
- **路径**: `DELETE /api/v1/sessions/{sessionId}`
- **REQ-ID**: REQ-022-009
- **平台**: Web
- **权限**: session_manage

---

## 23. 数据分析与商业智能模块 (REQ-023)

### 23.1 分析任务

#### 创建分析任务
- **路径**: `POST /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_create

**请求参数**:
```json
{
  "task_name": "月度运营效率分析",
  "task_type": "operational_analysis",
  "analysis_config": {
    "metrics": ["ticket_volume", "resolution_time", "satisfaction"],
    "dimensions": ["department", "priority", "category"],
    "time_range": "last_month",
    "comparison": "previous_month"
  },
  "schedule_config": {
    "frequency": "monthly",
    "day_of_month": 1,
    "time": "09:00"
  },
  "output_config": {
    "formats": ["dashboard", "report", "email"],
    "recipients": ["manager@company.com"]
  }
}
```

#### 获取分析结果
- **路径**: `GET /api/v1/analytics/results/{resultId}`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

#### 分析任务列表
- **路径**: `GET /api/v1/analytics/tasks`
- **REQ-ID**: REQ-023-001
- **平台**: Web
- **权限**: analytics_read

### 23.2 趋势预测

#### 业务趋势预测
- **路径**: `POST /api/v1/analytics/predict/trends`
- **REQ-ID**: REQ-023-002
- **平台**: Web
- **权限**: analytics_predict

#### 客户流失预测
- **路径**: `POST /api/v1/analytics/predict/churn`
- **REQ-ID**: REQ-023-003
- **平台**: Web
- **权限**: analytics_predict

### 23.3 实时大屏

#### 获取大屏数据
- **路径**: `GET /api/v1/analytics/dashboard/realtime`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_dashboard

#### 大屏配置管理
- **路径**: `PUT /api/v1/analytics/dashboard/config`
- **REQ-ID**: REQ-023-005
- **平台**: Web
- **权限**: analytics_config

### 23.4 异常检测

#### 异常检测分析
- **路径**: `POST /api/v1/analytics/anomaly/detect`
- **REQ-ID**: REQ-023-007
- **平台**: Web, API
- **权限**: analytics_detect

#### 异常告警配置
- **路径**: `POST /api/v1/analytics/anomaly/alerts`
- **REQ-ID**: REQ-023-007
- **平台**: Web
- **权限**: analytics_alert

---

## 附录

### A. 权限代码说明

| 权限代码 | 描述 | 适用模块 |
|---------|------|---------|
| ticket_create | 创建工单 | REQ-003 |
| ticket_read | 查看工单 | REQ-003 |
| ticket_update | 更新工单 | REQ-003 |
| ticket_delete | 删除工单 | REQ-003 |
| customer_create | 创建客户 | REQ-016 |
| customer_read | 查看客户 | REQ-016 |
| sla_create | 创建SLA | REQ-017 |
| sla_monitor | 监控SLA | REQ-017 |
| billing_generate | 生成账单 | REQ-018 |
| analytics_create | 创建分析任务 | REQ-023 |

### B. 错误码详细说明

| 错误码 | 错误信息 | 解决方案 |
|--------|----------|----------|
| 40001 | 参数验证失败 | 检查请求参数格式和必填项 |
| 40101 | 认证失败 | 检查Token是否有效 |
| 40301 | 权限不足 | 联系管理员分配相应权限 |
| 40401 | 资源不存在 | 检查资源ID是否正确 |
| 50001 | 服务器内部错误 | 联系技术支持 |

### C. 版本更新记录

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v4.5 | 2024-08-11 | 完整API文档初版，覆盖23个模块 |

---

*本文档由IT运维门户系统开发团队维护，如有疑问请联系技术支持。*


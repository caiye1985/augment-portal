openapi: 3.0.3
info:
  title: 工单管理系统 API
  version: 1.0.0
  description: 工单管理系统模块 - 负责工单全生命周期管理、智能派单、SLA监控等核心业务功能
tags:
- name: tickets
  description: 工单管理
- name: ticket-status
  description: 工单状态管理
- name: ticket-batch
  description: 工单批量操作
- name: ticket-search
  description: 工单查询统计
- name: ticket-attachments
  description: 工单附件管理
paths:
  /api/v1/tickets:
    post:
      tags:
      - tickets
      summary: 创建工单
      description: 创建新的工单，支持手动创建、自动创建、批量创建三种模式
      operationId: ticket_create
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketCreateRequest'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketCreateResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
    get:
      tags:
      - tickets
      summary: 查询工单列表
      description: 分页查询工单列表，支持多条件筛选和排序
      operationId: ticket_list
      parameters:
      - name: page
        in: query
        description: 页码
        schema:
          type: integer
          minimum: 1
          default: 1
          example: 1
      - name: size
        in: query
        description: 每页大小
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          example: 20
      - name: status
        in: query
        description: 工单状态
        schema:
          type: array
          items:
            type: string
      - name: priority
        in: query
        description: 优先级
        schema:
          type: array
          items:
            type: string
      - name: category
        in: query
        description: 问题分类
        schema:
          type: string
          example: 硬件故障
      - name: assigned_to
        in: query
        description: 分配给工程师ID
        schema:
          type: integer
          example: 12345
      - name: customer_id
        in: query
        description: 客户ID
        schema:
          type: integer
          example: 67890
      - name: created_start
        in: query
        description: 创建时间开始
        schema:
          type: string
          format: date-time
          example: '2024-08-01T00:00:00Z'
      - name: created_end
        in: query
        description: 创建时间结束
        schema:
          type: string
          format: date-time
          example: '2024-08-31T23:59:59Z'
      - name: keyword
        in: query
        description: 关键词搜索（标题、描述）
        schema:
          type: string
          example: 邮件服务器
      - name: sort
        in: query
        description: 排序字段
        schema:
          type: string
          enum:
          - created_at
          - updated_at
          - priority
          - status
          default: created_at
          example: created_at
      - name: order
        in: query
        description: 排序方向
        schema:
          type: string
          enum:
          - asc
          - desc
          default: desc
          example: desc
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/PagedResponse
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        items:
                          type: array
                          items:
                            $ref: '#/components/schemas/TicketListItem'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{id}:
    get:
      tags:
      - tickets
      summary: 获取工单详情
      description: 根据工单ID获取工单详细信息，包括处理记录和附件
      operationId: ticket_detail
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketDetail'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
    put:
      tags:
      - tickets
      summary: 更新工单
      description: 更新工单信息，支持部分字段更新
      operationId: ticket_update
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketUpdateRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketDetail'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '409':
          $ref: ../../global-api-index.yaml#/components/responses/Conflict
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
    delete:
      tags:
      - tickets
      summary: 删除工单
      description: 软删除工单，保留历史记录
      operationId: ticket_delete
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{id}/status:
    put:
      tags:
      - ticket-status
      summary: 更新工单状态
      description: 更新工单状态，支持状态流转验证
      operationId: ticket_status_update
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketStatusUpdateRequest'
      responses:
        '200':
          description: 状态更新成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketStatusUpdateResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '409':
          $ref: ../../global-api-index.yaml#/components/responses/Conflict
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{id}/assign:
    post:
      tags:
      - ticket-status
      summary: 派单操作
      description: 将工单分配给指定工程师
      operationId: ticket_assign
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketAssignRequest'
      responses:
        '200':
          description: 派单成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketAssignResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{id}/accept:
    post:
      tags:
      - ticket-status
      summary: 接单操作
      description: 工程师接受分配的工单
      operationId: ticket_accept
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketAcceptRequest'
      responses:
        '200':
          description: 接单成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketAcceptResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{id}/escalate:
    post:
      tags:
      - ticket-status
      summary: 升级操作
      description: 将工单升级到高级工程师或专家
      operationId: ticket_escalate
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketEscalateRequest'
      responses:
        '200':
          description: 升级成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketEscalateResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{id}/resolve:
    post:
      tags:
      - ticket-status
      summary: 解决操作
      description: 标记工单为已解决状态
      operationId: ticket_resolve
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketResolveRequest'
      responses:
        '200':
          description: 解决成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketResolveResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/batch:
    post:
      tags:
      - ticket-batch
      summary: 批量创建工单
      description: 批量创建多个工单，支持Excel导入和API批量创建
      operationId: ticket_batch_create
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketBatchCreateRequest'
      responses:
        '200':
          description: 批量创建成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketBatchCreateResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
    put:
      tags:
      - ticket-batch
      summary: 批量更新工单
      description: 批量修改工单状态、优先级、分类等字段
      operationId: ticket_batch_update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketBatchUpdateRequest'
      responses:
        '200':
          description: 批量更新成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketBatchUpdateResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/batch/assign:
    post:
      tags:
      - ticket-batch
      summary: 批量派单
      description: 一次性分配多个工单给指定工程师
      operationId: ticket_batch_assign
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketBatchAssignRequest'
      responses:
        '200':
          description: 批量派单成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketBatchAssignResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/batch/close:
    post:
      tags:
      - ticket-batch
      summary: 批量关闭工单
      description: 批量关闭已解决的工单
      operationId: ticket_batch_close
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketBatchCloseRequest'
      responses:
        '200':
          description: 批量关闭成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketBatchCloseResponse'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/search:
    get:
      tags:
      - ticket-search
      summary: 高级搜索
      description: 基于Elasticsearch的全文检索和高级搜索
      operationId: ticket_search
      parameters:
      - name: q
        in: query
        description: 搜索关键词
        schema:
          type: string
          example: 邮件服务器故障
      - name: fields
        in: query
        description: 搜索字段
        schema:
          type: array
          items:
            type: string
            enum:
            - title
            - description
            - customer_name
          example:
          - title
          - description
      - name: filters
        in: query
        description: 过滤条件（JSON格式）
        schema:
          type: string
          example: '{"status":["IN_PROGRESS","ASSIGNED"],"priority":[1,2]}'
      - name: page
        in: query
        description: 页码
        schema:
          type: integer
          minimum: 1
          default: 1
          example: 1
      - name: size
        in: query
        description: 每页大小
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          example: 20
      responses:
        '200':
          description: 搜索成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/PagedResponse
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        items:
                          type: array
                          items:
                            $ref: '#/components/schemas/TicketSearchResult'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/statistics:
    get:
      tags:
      - ticket-search
      summary: 统计数据
      description: 获取工单统计数据，包括状态分布、趋势分析等
      operationId: ticket_statistics
      parameters:
      - name: type
        in: query
        description: 统计类型
        schema:
          type: string
          enum:
          - status
          - priority
          - category
          - trend
          - engineer
          - customer
          default: status
          example: status
      - name: start_date
        in: query
        description: 开始日期
        schema:
          type: string
          format: date
          example: '2024-08-01'
      - name: end_date
        in: query
        description: 结束日期
        schema:
          type: string
          format: date
          example: '2024-08-31'
      - name: group_by
        in: query
        description: 分组维度
        schema:
          type: string
          enum:
          - day
          - week
          - month
          - year
          default: day
          example: day
      responses:
        '200':
          description: 统计成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketStatistics'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/export:
    get:
      tags:
      - ticket-search
      summary: 导出数据
      description: 导出工单数据，支持Excel、PDF、CSV格式
      operationId: ticket_export
      parameters:
      - name: format
        in: query
        description: 导出格式
        schema:
          type: string
          enum:
          - excel
          - pdf
          - csv
          default: excel
          example: excel
      - name: filters
        in: query
        description: 过滤条件（JSON格式）
        schema:
          type: string
          example: '{"status":["CLOSED"],"created_start":"2024-08-01T00:00:00Z"}'
      - name: fields
        in: query
        description: 导出字段
        schema:
          type: array
          items:
            type: string
          example:
          - ticket_no
          - title
          - status
          - priority
          - created_at
      responses:
        '200':
          description: 导出成功
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/dashboard:
    get:
      tags:
      - ticket-search
      summary: 仪表板数据
      description: 获取工单仪表板数据，用于首页展示
      operationId: ticket_dashboard
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketDashboard'
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{id}/attachments:
    post:
      tags:
      - ticket-attachments
      summary: 上传附件
      description: 为工单上传附件文件
      operationId: ticket_attachment_upload
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: 附件文件
                description:
                  type: string
                  description: 附件描述
                  example: 错误日志文件
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      $ref: '#/components/schemas/TicketAttachment'
        '400':
          $ref: ../../global-api-index.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
    get:
      tags:
      - ticket-attachments
      summary: 获取附件列表
      description: 获取工单的所有附件列表
      operationId: ticket_attachment_list
      parameters:
      - name: id
        in: path
        required: true
        description: 工单ID
        schema:
          type: integer
          example: 12345
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '#/components/schemas/TicketAttachment'
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
  /api/v1/tickets/{ticket_id}/attachments/{attachment_id}:
    delete:
      tags:
      - ticket-attachments
      summary: 删除附件
      description: 删除工单的指定附件
      operationId: ticket_attachment_delete
      parameters:
      - name: ticket_id
        in: path
        required: true
        description: 工单ID
        schema:
          type: string
      - name: attachment_id
        in: path
        required: true
        description: 附件ID
        schema:
          type: integer
          example: 67890
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: ../../global-api-index.yaml#/components/schemas/ApiResponse
        '401':
          $ref: ../../global-api-index.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../global-api-index.yaml#/components/responses/Forbidden
        '404':
          $ref: ../../global-api-index.yaml#/components/responses/NotFound
        '500':
          $ref: ../../global-api-index.yaml#/components/responses/InternalServerError
components:
  schemas:
    TicketCreateRequest:
      type: object
      required:
      - title
      - description
      - customer_id
      - priority
      properties:
        title:
          type: string
          maxLength: 200
          description: 工单标题
          example: 邮件服务器故障
        description:
          type: string
          description: 问题描述
          example: 邮件服务器无法发送邮件，影响公司正常业务运营
        category:
          type: string
          maxLength: 50
          description: 问题分类
          example: 硬件故障
        priority:
          type: integer
          minimum: 1
          maximum: 4
          description: 优先级：1-紧急，2-高，3-中，4-低
          example: 2
        source:
          type: string
          enum:
          - WEB
          - EMAIL
          - API
          - MONITORING
          - PHONE
          default: WEB
          description: 工单来源
          example: WEB
        customer_id:
          type: integer
          description: 客户ID
          example: 12345
        customer_name:
          type: string
          maxLength: 100
          description: 客户姓名
          example: 张三
        customer_phone:
          type: string
          maxLength: 20
          description: 客户电话
          example: '13800138000'
        customer_email:
          type: string
          maxLength: 100
          format: email
          description: 客户邮箱
          example: zhangsan@company.com
        tags:
          type: array
          items:
            type: string
          description: 标签数组
          example:
          - 邮件
          - 服务器
          - 紧急
        custom_fields:
          type: object
          description: 自定义字段
          example:
            server_ip: 192.168.1.100
            affected_users: 50
            business_impact: high
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/AttachmentInfo'
          description: 附件信息
    TicketCreateResponse:
      type: object
      properties:
        ticket_id:
          type: integer
          description: 工单ID
          example: 12345
        ticket_no:
          type: string
          description: 工单编号
          example: TK-20240814-0001
        status:
          type: string
          enum:
          - NEW
          - PENDING
          - ASSIGNED
          - IN_PROGRESS
          - SUSPENDED
          - ESCALATED
          - PENDING_VERIFICATION
          - RESOLVED
          - CLOSED
          - CANCELLED
          description: 工单状态
          example: NEW
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: '2024-08-14T10:30:00Z'
        estimated_resolve_time:
          type: string
          format: date-time
          description: 预计解决时间
          example: '2024-08-14T18:30:00Z'
    TicketListItem:
      type: object
      properties:
        id:
          type: integer
          description: 工单ID
          example: 12345
        tenant_id:
          type: integer
          format: int64
          description: 租户ID
          example: 1001
        ticket_no:
          type: string
          description: 工单编号
          example: TK-20240814-0001
        title:
          type: string
          description: 工单标题
          example: 邮件服务器故障
        status:
          type: string
          enum:
          - NEW
          - PENDING
          - ASSIGNED
          - IN_PROGRESS
          - SUSPENDED
          - ESCALATED
          - PENDING_VERIFICATION
          - RESOLVED
          - CLOSED
          - CANCELLED
          description: 工单状态
          example: IN_PROGRESS
        priority:
          type: integer
          minimum: 1
          maximum: 4
          description: 优先级
          example: 2
        category:
          type: string
          description: 问题分类
          example: 硬件故障
        customer_name:
          type: string
          description: 客户姓名
          example: 张三
        assigned_to_name:
          type: string
          description: 分配给工程师姓名
          example: 李工程师
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: '2024-08-14T10:30:00Z'
        updated_at:
          type: string
          format: date-time
          description: 更新时间
          example: '2024-08-14T15:30:00Z'
        response_due_time:
          type: string
          format: date-time
          description: 响应截止时间
          example: '2024-08-14T11:00:00Z'
        resolve_due_time:
          type: string
          format: date-time
          description: 解决截止时间
          example: '2024-08-14T18:30:00Z'
        sla_status:
          type: string
          enum:
          - NORMAL
          - WARNING
          - OVERDUE
          description: SLA状态
          example: NORMAL
    TicketDetail:
      allOf:
      - $ref: '#/components/schemas/TicketListItem'
      - type: object
        properties:
          description:
            type: string
            description: 问题描述
            example: 邮件服务器无法发送邮件，影响公司正常业务运营
          source:
            type: string
            enum:
            - WEB
            - EMAIL
            - API
            - MONITORING
            - PHONE
            description: 工单来源
            example: WEB
          customer_id:
            type: integer
            description: 客户ID
            example: 12345
          customer_phone:
            type: string
            description: 客户电话
            example: '13800138000'
          customer_email:
            type: string
            description: 客户邮箱
            example: zhangsan@company.com
          assigned_to:
            type: integer
            description: 分配给工程师ID
            example: 67890
          assigned_at:
            type: string
            format: date-time
            description: 分配时间
            example: '2024-08-14T10:35:00Z'
          started_at:
            type: string
            format: date-time
            description: 开始处理时间
            example: '2024-08-14T10:40:00Z'
          resolved_at:
            type: string
            format: date-time
            description: 解决时间
            example: '2024-08-14T16:30:00Z'
          closed_at:
            type: string
            format: date-time
            description: 关闭时间
            example: '2024-08-14T17:00:00Z'
          sla_level:
            type: string
            description: SLA等级
            example: GOLD
          satisfaction_score:
            type: integer
            minimum: 1
            maximum: 5
            description: 满意度评分
            example: 5
          satisfaction_comment:
            type: string
            description: 满意度评价
            example: 服务及时，问题解决彻底
          tags:
            type: array
            items:
              type: string
            description: 标签数组
            example:
            - 邮件
            - 服务器
            - 紧急
          custom_fields:
            type: object
            description: 自定义字段
            example:
              server_ip: 192.168.1.100
              affected_users: 50
              business_impact: high
          logs:
            type: array
            items:
              $ref: '#/components/schemas/TicketLog'
            description: 处理记录
          attachments:
            type: array
            items:
              $ref: '#/components/schemas/TicketAttachment'
            description: 附件列表
          version:
            type: integer
            description: 版本号（乐观锁）
            example: 1
    TicketUpdateRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 200
          description: 工单标题
          example: 邮件服务器故障（已修复）
        description:
          type: string
          description: 问题描述
          example: 邮件服务器无法发送邮件，影响公司正常业务运营。已重启服务解决。
        category:
          type: string
          maxLength: 50
          description: 问题分类
          example: 硬件故障
        priority:
          type: integer
          minimum: 1
          maximum: 4
          description: 优先级
          example: 3
        customer_phone:
          type: string
          maxLength: 20
          description: 客户电话
          example: '13800138001'
        customer_email:
          type: string
          maxLength: 100
          format: email
          description: 客户邮箱
          example: zhangsan@company.com
        tags:
          type: array
          items:
            type: string
          description: 标签数组
          example:
          - 邮件
          - 服务器
          - 已解决
        custom_fields:
          type: object
          description: 自定义字段
          example:
            server_ip: 192.168.1.100
            affected_users: 0
            business_impact: low
        version:
          type: integer
          description: 版本号（乐观锁）
          example: 1
    TicketStatusUpdateRequest:
      type: object
      required:
      - status
      properties:
        status:
          type: string
          enum:
          - NEW
          - PENDING
          - ASSIGNED
          - IN_PROGRESS
          - SUSPENDED
          - ESCALATED
          - PENDING_VERIFICATION
          - RESOLVED
          - CLOSED
          - CANCELLED
          description: 目标状态
          example: IN_PROGRESS
        comment:
          type: string
          description: 状态变更说明
          example: 开始处理邮件服务器故障问题
        estimated_resolve_time:
          type: string
          format: date-time
          description: 预计解决时间
          example: '2024-08-14T18:30:00Z'
    TicketStatusUpdateResponse:
      type: object
      properties:
        ticket_id:
          type: integer
          description: 工单ID
          example: 12345
        old_status:
          type: string
          description: 原状态
          example: ASSIGNED
        new_status:
          type: string
          description: 新状态
          example: IN_PROGRESS
        updated_at:
          type: string
          format: date-time
          description: 更新时间
          example: '2024-08-14T10:40:00Z'
    TicketAssignRequest:
      type: object
      required:
      - assigned_to
      properties:
        assigned_to:
          type: integer
          description: 分配给工程师ID
          example: 67890
        comment:
          type: string
          description: 派单说明
          example: 根据技能匹配分配给李工程师处理
        priority:
          type: integer
          minimum: 1
          maximum: 4
          description: 调整优先级
          example: 2
    TicketAssignResponse:
      type: object
      properties:
        ticket_id:
          type: integer
          description: 工单ID
          example: 12345
        assigned_to:
          type: integer
          description: 分配给工程师ID
          example: 67890
        assigned_to_name:
          type: string
          description: 工程师姓名
          example: 李工程师
        assigned_at:
          type: string
          format: date-time
          description: 分配时间
          example: '2024-08-14T10:35:00Z'
        response_due_time:
          type: string
          format: date-time
          description: 响应截止时间
          example: '2024-08-14T11:05:00Z'
    TicketAcceptRequest:
      type: object
      properties:
        comment:
          type: string
          description: 接单说明
          example: 已接单，开始处理邮件服务器故障
        estimated_resolve_time:
          type: string
          format: date-time
          description: 预计解决时间
          example: '2024-08-14T18:30:00Z'
    TicketAcceptResponse:
      type: object
      properties:
        ticket_id:
          type: integer
          description: 工单ID
          example: 12345
        status:
          type: string
          description: 工单状态
          example: IN_PROGRESS
        started_at:
          type: string
          format: date-time
          description: 开始处理时间
          example: '2024-08-14T10:40:00Z'
        estimated_resolve_time:
          type: string
          format: date-time
          description: 预计解决时间
          example: '2024-08-14T18:30:00Z'
    TicketEscalateRequest:
      type: object
      required:
      - escalate_type
      - reason
      properties:
        escalate_type:
          type: string
          enum:
          - TECHNICAL
          - TIMEOUT
          - CUSTOMER_COMPLAINT
          description: 升级类型
          example: TECHNICAL
        reason:
          type: string
          description: 升级原因
          example: 技术难度超出当前工程师能力范围
        escalate_to:
          type: integer
          description: 升级到工程师ID（可选）
          example: 78901
        comment:
          type: string
          description: 升级说明
          example: 需要高级工程师协助处理复杂的邮件服务器配置问题
    TicketEscalateResponse:
      type: object
      properties:
        ticket_id:
          type: integer
          description: 工单ID
          example: 12345
        escalate_type:
          type: string
          description: 升级类型
          example: TECHNICAL
        escalated_to:
          type: integer
          description: 升级到工程师ID
          example: 78901
        escalated_to_name:
          type: string
          description: 升级到工程师姓名
          example: 王高级工程师
        escalated_at:
          type: string
          format: date-time
          description: 升级时间
          example: '2024-08-14T14:30:00Z'
    TicketResolveRequest:
      type: object
      required:
      - solution
      properties:
        solution:
          type: string
          description: 解决方案
          example: 重启邮件服务器，重新配置SMTP设置，问题已解决
        resolution_time:
          type: string
          format: date-time
          description: 解决时间
          example: '2024-08-14T16:30:00Z'
        comment:
          type: string
          description: 解决说明
          example: 邮件服务器已恢复正常，建议客户定期检查服务器状态
    TicketResolveResponse:
      type: object
      properties:
        ticket_id:
          type: integer
          description: 工单ID
          example: 12345
        status:
          type: string
          description: 工单状态
          example: RESOLVED
        resolved_at:
          type: string
          format: date-time
          description: 解决时间
          example: '2024-08-14T16:30:00Z'
        solution:
          type: string
          description: 解决方案
          example: 重启邮件服务器，重新配置SMTP设置，问题已解决
    TicketBatchCreateRequest:
      type: object
      required:
      - tickets
      properties:
        tickets:
          type: array
          maxItems: 1000
          items:
            $ref: '#/components/schemas/TicketCreateRequest'
          description: 工单列表
        auto_assign:
          type: boolean
          default: false
          description: 是否自动派单
          example: true
    TicketBatchCreateResponse:
      type: object
      properties:
        total:
          type: integer
          description: 总数量
          example: 100
        success_count:
          type: integer
          description: 成功数量
          example: 98
        failed_count:
          type: integer
          description: 失败数量
          example: 2
        results:
          type: array
          items:
            type: object
            properties:
              index:
                type: integer
                description: 索引
                example: 0
              success:
                type: boolean
                description: 是否成功
                example: true
              ticket_id:
                type: integer
                description: 工单ID（成功时）
                example: 12345
              ticket_no:
                type: string
                description: 工单编号（成功时）
                example: TK-20240814-0001
              error:
                type: string
                description: 错误信息（失败时）
                example: 标题不能为空
    TicketBatchUpdateRequest:
      type: object
      required:
      - ticket_ids
      - updates
      properties:
        ticket_ids:
          type: array
          maxItems: 1000
          items:
            type: integer
          description: 工单ID列表
          example:
          - 12345
          - 12346
          - 12347
        updates:
          type: object
          description: 更新字段
          properties:
            status:
              type: string
              enum:
              - NEW
              - PENDING
              - ASSIGNED
              - IN_PROGRESS
              - SUSPENDED
              - ESCALATED
              - PENDING_VERIFICATION
              - RESOLVED
              - CLOSED
              - CANCELLED
              description: 状态
              example: CLOSED
            priority:
              type: integer
              minimum: 1
              maximum: 4
              description: 优先级
              example: 3
            category:
              type: string
              description: 分类
              example: 软件故障
            assigned_to:
              type: integer
              description: 分配给工程师ID
              example: 67890
            tags:
              type: array
              items:
                type: string
              description: 标签
              example:
              - 批量处理
              - 已解决
    TicketBatchUpdateResponse:
      type: object
      properties:
        total:
          type: integer
          description: 总数量
          example: 50
        success_count:
          type: integer
          description: 成功数量
          example: 48
        failed_count:
          type: integer
          description: 失败数量
          example: 2
        results:
          type: array
          items:
            type: object
            properties:
              ticket_id:
                type: integer
                description: 工单ID
                example: 12345
              success:
                type: boolean
                description: 是否成功
                example: true
              error:
                type: string
                description: 错误信息（失败时）
                example: 工单不存在
    TicketBatchAssignRequest:
      type: object
      required:
      - ticket_ids
      - assigned_to
      properties:
        ticket_ids:
          type: array
          maxItems: 1000
          items:
            type: integer
          description: 工单ID列表
          example:
          - 12345
          - 12346
          - 12347
        assigned_to:
          type: integer
          description: 分配给工程师ID
          example: 67890
        comment:
          type: string
          description: 派单说明
          example: 批量分配给李工程师处理
    TicketBatchAssignResponse:
      type: object
      properties:
        total:
          type: integer
          description: 总数量
          example: 30
        success_count:
          type: integer
          description: 成功数量
          example: 28
        failed_count:
          type: integer
          description: 失败数量
          example: 2
        assigned_to:
          type: integer
          description: 分配给工程师ID
          example: 67890
        assigned_to_name:
          type: string
          description: 工程师姓名
          example: 李工程师
        results:
          type: array
          items:
            type: object
            properties:
              ticket_id:
                type: integer
                description: 工单ID
                example: 12345
              success:
                type: boolean
                description: 是否成功
                example: true
              error:
                type: string
                description: 错误信息（失败时）
                example: 工单状态不允许派单
    TicketBatchCloseRequest:
      type: object
      required:
      - ticket_ids
      properties:
        ticket_ids:
          type: array
          maxItems: 1000
          items:
            type: integer
          description: 工单ID列表
          example:
          - 12345
          - 12346
          - 12347
        comment:
          type: string
          description: 关闭说明
          example: 批量关闭已解决的工单
    TicketBatchCloseResponse:
      type: object
      properties:
        total:
          type: integer
          description: 总数量
          example: 20
        success_count:
          type: integer
          description: 成功数量
          example: 18
        failed_count:
          type: integer
          description: 失败数量
          example: 2
        results:
          type: array
          items:
            type: object
            properties:
              ticket_id:
                type: integer
                description: 工单ID
                example: 12345
              success:
                type: boolean
                description: 是否成功
                example: true
              error:
                type: string
                description: 错误信息（失败时）
                example: 工单状态不允许关闭
    TicketSearchResult:
      allOf:
      - $ref: '#/components/schemas/TicketListItem'
      - type: object
        properties:
          highlight:
            type: object
            description: 高亮字段
            properties:
              title:
                type: array
                items:
                  type: string
                description: 标题高亮
                example:
                - <em>邮件</em>服务器故障
              description:
                type: array
                items:
                  type: string
                description: 描述高亮
                example:
                - <em>邮件</em>服务器无法发送邮件
          score:
            type: number
            description: 相关性评分
            example: 0.95
    TicketStatistics:
      type: object
      properties:
        type:
          type: string
          description: 统计类型
          example: status
        period:
          type: object
          description: 统计周期
          properties:
            start_date:
              type: string
              format: date
              description: 开始日期
              example: '2024-08-01'
            end_date:
              type: string
              format: date
              description: 结束日期
              example: '2024-08-31'
        data:
          type: array
          items:
            type: object
            properties:
              label:
                type: string
                description: 标签
                example: IN_PROGRESS
              value:
                type: integer
                description: 数值
                example: 25
              percentage:
                type: number
                description: 百分比
                example: 35.7
          description: 统计数据
        trend:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
                description: 日期
                example: '2024-08-14'
              count:
                type: integer
                description: 数量
                example: 15
          description: 趋势数据
    TicketDashboard:
      type: object
      properties:
        summary:
          type: object
          description: 概要统计
          properties:
            total_tickets:
              type: integer
              description: 总工单数
              example: 1567
            open_tickets:
              type: integer
              description: 未关闭工单数
              example: 234
            overdue_tickets:
              type: integer
              description: 超期工单数
              example: 12
            avg_resolution_time:
              type: number
              description: 平均解决时间（小时）
              example: 4.5
        status_distribution:
          type: array
          items:
            type: object
            properties:
              status:
                type: string
                description: 状态
                example: IN_PROGRESS
              count:
                type: integer
                description: 数量
                example: 89
              percentage:
                type: number
                description: 百分比
                example: 38.0
          description: 状态分布
        priority_distribution:
          type: array
          items:
            type: object
            properties:
              priority:
                type: integer
                description: 优先级
                example: 1
              priority_name:
                type: string
                description: 优先级名称
                example: 紧急
              count:
                type: integer
                description: 数量
                example: 15
          description: 优先级分布
        recent_tickets:
          type: array
          items:
            $ref: '#/components/schemas/TicketListItem'
          description: 最近工单
        sla_performance:
          type: object
          description: SLA表现
          properties:
            response_rate:
              type: number
              description: 响应达标率
              example: 96.5
            resolution_rate:
              type: number
              description: 解决达标率
              example: 92.3
            avg_response_time:
              type: number
              description: 平均响应时间（分钟）
              example: 18.5
    AttachmentInfo:
      type: object
      properties:
        file_name:
          type: string
          description: 文件名
          example: error_log.txt
        file_path:
          type: string
          description: 文件路径
          example: /uploads/2024/08/error_log.txt
        file_size:
          type: integer
          description: 文件大小（字节）
          example: 1024
        file_type:
          type: string
          description: 文件类型
          example: text/plain
    TicketAttachment:
      allOf:
      - $ref: '#/components/schemas/AttachmentInfo'
      - type: object
        properties:
          id:
            type: integer
            description: 附件ID
            example: 67890
          ticket_id:
            type: integer
            description: 工单ID
            example: 12345
          file_hash:
            type: string
            description: 文件哈希值
            example: d41d8cd98f00b204e9800998ecf8427e
          scan_status:
            type: string
            enum:
            - PENDING
            - CLEAN
            - INFECTED
            - ERROR
            description: 病毒扫描状态
            example: CLEAN
          upload_by:
            type: integer
            description: 上传人ID
            example: 78901
          upload_by_name:
            type: string
            description: 上传人姓名
            example: 张三
          created_at:
            type: string
            format: date-time
            description: 上传时间
            example: '2024-08-14T10:32:00Z'
          download_url:
            type: string
            description: 下载链接
            example: https://api.example.com/v1/tickets/12345/attachments/67890/download
    TicketLog:
      type: object
      properties:
        id:
          type: integer
          description: 记录ID
          example: 98765
        tenant_id:
          type: integer
          format: int64
          description: 租户ID
          example: 1001
        ticket_id:
          type: integer
          description: 工单ID
          example: 12345
        action_type:
          type: string
          enum:
          - CREATE
          - UPDATE
          - ASSIGN
          - ACCEPT
          - REJECT
          - ESCALATE
          - RESOLVE
          - CLOSE
          - REOPEN
          - COMMENT
          - ATTACH
          description: 操作类型
          example: ASSIGN
        action_description:
          type: string
          description: 操作描述
          example: 工单已分配给李工程师
        old_value:
          type: string
          description: 变更前值
          example: 'null'
        new_value:
          type: string
          description: 变更后值
          example: '67890'
        operator_id:
          type: integer
          description: 操作人ID
          example: 11111
        operator_name:
          type: string
          description: 操作人姓名
          example: 管理员
        operator_role:
          type: string
          description: 操作人角色
          example: ADMIN
        ip_address:
          type: string
          description: 操作IP地址
          example: 192.168.1.100
        created_at:
          type: string
          format: date-time
          description: 操作时间
          example: '2024-08-14T10:35:00Z'

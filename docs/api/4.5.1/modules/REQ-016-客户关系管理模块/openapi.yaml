openapi: 3.0.3
info:
  title: IT运维门户系统 API
  version: 1.0.0
  description: 客户关系管理模块 API 规范

tags:
  - name: customer-profile
    description: 客户档案管理
  - name: customer-contacts
    description: 客户联系人管理
  - name: customer-contracts
    description: 客户合同管理
  - name: customer-health
    description: 客户健康度管理
  - name: customer-success
    description: 客户成功管理
  - name: customer-communications
    description: 客户沟通管理
  - name: customer-analysis
    description: 客户分析
  - name: customer-portal
    description: 客户门户

paths:
  # 客户档案管理API
  /api/v1/customers:
    post:
      tags:
        - customer-profile
      summary: 创建客户档案
      description: 创建新的客户档案，包括基本信息和联系人信息
      operationId: customer_create
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerCreateRequest'
      responses:
        '200':
          description: 客户创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerCreateResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '409':
          description: 客户信息重复
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

    get:
      tags:
        - customer-profile
      summary: 获取客户列表
      description: 分页查询客户列表，支持多条件筛选和排序
      operationId: customer_list
      parameters:
        - name: page
          in: query
          description: 页码，从1开始
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: size
          in: query
          description: 每页数量
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
        - name: status
          in: query
          description: 客户状态筛选
          required: false
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2, 3]
            example: [1, 2]
        - name: level
          in: query
          description: 客户等级筛选
          required: false
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2, 3, 4]
            example: [3, 4]
        - name: industry
          in: query
          description: 行业筛选
          required: false
          schema:
            type: string
            example: "软件开发"
        - name: assigned_manager_id
          in: query
          description: 客户经理ID筛选
          required: false
          schema:
            type: integer
            format: int64
            example: 1001
        - name: health_score_min
          in: query
          description: 最低健康度评分
          required: false
          schema:
            type: number
            format: float
            minimum: 0
            maximum: 100
            example: 70.0
        - name: health_score_max
          in: query
          description: 最高健康度评分
          required: false
          schema:
            type: number
            format: float
            minimum: 0
            maximum: 100
            example: 100.0
        - name: keyword
          in: query
          description: 关键词搜索（客户名称、编码）
          required: false
          schema:
            type: string
            example: "ABC科技"
        - name: sort
          in: query
          description: 排序字段
          required: false
          schema:
            type: string
            enum: [created_at, updated_at, health_score, ltv, next_renewal_date]
            default: created_at
            example: "health_score"
        - name: order
          in: query
          description: 排序方向
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
            example: "desc"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/PagedResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/CustomerListItem'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/{id}:
    get:
      tags:
        - customer-profile
      summary: 获取客户详情
      description: 获取指定客户的详细信息，包括联系人、标签等
      operationId: customer_get_detail
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerDetailResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

    put:
      tags:
        - customer-profile
      summary: 更新客户信息
      description: 更新指定客户的基本信息
      operationId: customer_update
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerUpdateRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Customer'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '409':
          description: 客户信息重复
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

    delete:
      tags:
        - customer-profile
      summary: 删除客户
      description: 删除指定客户（软删除）
      operationId: customer_delete
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/search:
    get:
      tags:
        - customer-profile
      summary: 客户搜索
      description: 基于关键词进行客户全文搜索
      operationId: customer_search
      parameters:
        - name: q
          in: query
          description: 搜索关键词
          required: true
          schema:
            type: string
            example: "ABC科技"
        - name: page
          in: query
          description: 页码，从1开始
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: size
          in: query
          description: 每页数量
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
      responses:
        '200':
          description: 搜索成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/PagedResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/CustomerListItem'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/batch:
    post:
      tags:
        - customer-profile
      summary: 批量创建客户
      description: 批量创建多个客户档案
      operationId: customer_batch_create
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                customers:
                  type: array
                  items:
                    $ref: '#/components/schemas/CustomerCreateRequest'
                  example:
                    - customer_name: "ABC科技有限公司"
                      customer_type: 1
                      industry: "软件开发"
                    - customer_name: "XYZ制造有限公司"
                      customer_type: 1
                      industry: "制造业"
      responses:
        '200':
          description: 批量创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          success_count:
                            type: integer
                            description: 成功创建数量
                            example: 2
                          failed_count:
                            type: integer
                            description: 失败数量
                            example: 0
                          results:
                            type: array
                            items:
                              type: object
                              properties:
                                index:
                                  type: integer
                                  description: 原始数组索引
                                  example: 0
                                success:
                                  type: boolean
                                  description: 是否成功
                                  example: true
                                customer_id:
                                  type: integer
                                  format: int64
                                  description: 客户ID（成功时）
                                  example: 12345
                                error_message:
                                  type: string
                                  description: 错误信息（失败时）
                                  example: null
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

    put:
      tags:
        - customer-profile
      summary: 批量更新客户
      description: 批量更新多个客户信息
      operationId: customer_batch_update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                updates:
                  type: array
                  items:
                    allOf:
                      - type: object
                        properties:
                          customer_id:
                            type: integer
                            format: int64
                            description: 客户ID
                            example: 12345
                      - $ref: '#/components/schemas/CustomerUpdateRequest'
      responses:
        '200':
          description: 批量更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          success_count:
                            type: integer
                            description: 成功更新数量
                            example: 2
                          failed_count:
                            type: integer
                            description: 失败数量
                            example: 0
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/export:
    get:
      tags:
        - customer-profile
      summary: 导出客户数据
      description: 导出客户数据为Excel文件
      operationId: customer_export
      parameters:
        - name: format
          in: query
          description: 导出格式
          required: false
          schema:
            type: string
            enum: [excel, csv]
            default: excel
            example: "excel"
        - name: status
          in: query
          description: 客户状态筛选
          required: false
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2, 3]
            example: [1, 2]
        - name: level
          in: query
          description: 客户等级筛选
          required: false
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2, 3, 4]
            example: [3, 4]
      responses:
        '200':
          description: 导出成功
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
            text/csv:
              schema:
                type: string
                format: binary
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  # 客户联系人管理API
  /api/v1/customers/{id}/contacts:
    post:
      tags:
        - customer-contacts
      summary: 添加客户联系人
      description: 为指定客户添加新的联系人
      operationId: customer_contact_create
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerContactCreateRequest'
      responses:
        '200':
          description: 联系人添加成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerContact'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

    get:
      tags:
        - customer-contacts
      summary: 获取客户联系人列表
      description: 获取指定客户的所有联系人
      operationId: customer_contact_list
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/CustomerContact'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/{id}/contacts/{contactId}:
    put:
      tags:
        - customer-contacts
      summary: 更新客户联系人
      description: 更新指定客户的联系人信息
      operationId: customer_contact_update
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
        - name: contactId
          in: path
          description: 联系人ID
          required: true
          schema:
            type: integer
            format: int64
            example: 1001
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerContactUpdateRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerContact'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户或联系人不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

    delete:
      tags:
        - customer-contacts
      summary: 删除客户联系人
      description: 删除指定客户的联系人
      operationId: customer_contact_delete
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
        - name: contactId
          in: path
          description: 联系人ID
          required: true
          schema:
            type: integer
            format: int64
            example: 1001
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户或联系人不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/{id}/contacts/{contactId}/primary:
    put:
      tags:
        - customer-contacts
      summary: 设置主联系人
      description: 将指定联系人设置为客户的主联系人
      operationId: customer_contact_set_primary
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
        - name: contactId
          in: path
          description: 联系人ID
          required: true
          schema:
            type: integer
            format: int64
            example: 1001
      responses:
        '200':
          description: 设置成功
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户或联系人不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  # 客户健康度管理API
  /api/v1/customers/{id}/health-score/calculate:
    post:
      tags:
        - customer-health
      summary: 计算客户健康度
      description: 基于AI算法计算指定客户的健康度评分
      operationId: customer_health_score_calculate
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      responses:
        '200':
          description: 健康度计算成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerHealthScoreResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 健康度计算失败
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/{id}/health-score:
    get:
      tags:
        - customer-health
      summary: 获取客户健康度
      description: 获取指定客户的当前健康度评分
      operationId: customer_health_score_get
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerHealthScore'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/{id}/health-score/trend:
    get:
      tags:
        - customer-health
      summary: 获取客户健康度趋势
      description: 获取指定客户的健康度历史趋势数据
      operationId: customer_health_score_trend
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
        - name: period
          in: query
          description: 时间周期
          required: false
          schema:
            type: string
            enum: [1m, 3m, 6m, 1y]
            default: 6m
            example: "6m"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerHealthScoreTrendResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  # 客户成功任务管理API
  /api/v1/customers/{id}/success-tasks:
    post:
      tags:
        - customer-success
      summary: 创建客户成功任务
      description: 为指定客户创建客户成功任务
      operationId: customer_success_task_create
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerSuccessTaskCreateRequest'
      responses:
        '200':
          description: 任务创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerSuccessTask'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  /api/v1/customers/success-tasks:
    get:
      tags:
        - customer-success
      summary: 获取客户成功任务列表
      description: 分页查询客户成功任务列表，支持筛选
      operationId: customer_success_task_list
      parameters:
        - name: assigned_to
          in: query
          description: 分配给（员工ID）
          required: false
          schema:
            type: integer
            format: int64
            example: 1001
        - name: status
          in: query
          description: 任务状态筛选
          required: false
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2, 3, 4]
            example: [1, 2]
        - name: priority
          in: query
          description: 优先级筛选
          required: false
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2, 3, 4]
            example: [3, 4]
        - name: task_type
          in: query
          description: 任务类型筛选
          required: false
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2, 3, 4]
            example: [1, 2]
        - name: page
          in: query
          description: 页码，从1开始
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: size
          in: query
          description: 每页数量
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/PagedResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/CustomerSuccessTaskListItem'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

  # 客户分析API
  /api/v1/customers/{id}/analysis/value:
    get:
      tags:
        - customer-analysis
      summary: 客户价值分析
      description: 获取指定客户的价值分析报告
      operationId: customer_analysis_value
      parameters:
        - name: id
          in: path
          description: 客户ID
          required: true
          schema:
            type: integer
            format: int64
            example: 12345
      responses:
        '200':
          description: 分析成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../global-api-index.yaml#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomerValueAnalysisResponse'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '404':
          description: 客户不存在
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '../../global-api-index.yaml#/components/schemas/ErrorResponse'

components:
  schemas:
    # 客户档案相关Schema
    Customer:
      type: object
      description: 客户档案信息
      properties:
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        tenant_id:
          type: integer
          format: int64
          description: 租户ID
          example: 1
        customer_code:
          type: string
          description: 客户编码
          example: "CUST-20250815-0001"
        customer_name:
          type: string
          description: 客户名称
          example: "ABC科技有限公司"
        customer_type:
          type: integer
          description: 客户类型：1-企业，2-政府，3-个人
          enum: [1, 2, 3]
          example: 1
        industry:
          type: string
          description: 所属行业
          example: "软件开发"
        scale:
          type: string
          description: 企业规模
          example: "中型企业"
        address:
          type: string
          description: 客户地址
          example: "北京市朝阳区xxx路xxx号"
        website:
          type: string
          format: uri
          description: 官方网站
          example: "https://www.abc-tech.com"
        description:
          type: string
          description: 客户描述
          example: "专注于企业级软件开发的科技公司"
        status:
          type: integer
          description: 状态：1-潜在客户，2-正式客户，3-流失客户
          enum: [1, 2, 3]
          example: 2
        level:
          type: integer
          description: 客户等级：1-普通，2-重要，3-VIP，4-战略
          enum: [1, 2, 3, 4]
          example: 3
        source:
          type: string
          description: 客户来源
          example: "网络推广"
        assigned_manager_id:
          type: integer
          format: int64
          description: 客户经理ID
          example: 1001
        health_score:
          type: number
          format: float
          description: 健康度评分
          minimum: 0
          maximum: 100
          example: 85.50
        ltv:
          type: number
          format: float
          description: 客户生命周期价值
          example: 360000.00
        last_contact_date:
          type: string
          format: date-time
          description: 最后联系时间
          example: "2025-08-10T15:30:00Z"
        next_renewal_date:
          type: string
          format: date
          description: 下次续约时间
          example: "2025-12-31"
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-08-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          description: 更新时间
          example: "2025-08-15T14:30:00Z"

    CustomerCreateRequest:
      type: object
      description: 创建客户请求
      required:
        - customer_name
        - customer_type
      properties:
        customer_name:
          type: string
          description: 客户名称
          minLength: 1
          maxLength: 200
          example: "ABC科技有限公司"
        customer_type:
          type: integer
          description: 客户类型：1-企业，2-政府，3-个人
          enum: [1, 2, 3]
          example: 1
        industry:
          type: string
          description: 所属行业
          maxLength: 100
          example: "软件开发"
        scale:
          type: string
          description: 企业规模
          maxLength: 50
          example: "中型企业"
        address:
          type: string
          description: 客户地址
          example: "北京市朝阳区xxx路xxx号"
        website:
          type: string
          format: uri
          description: 官方网站
          example: "https://www.abc-tech.com"
        description:
          type: string
          description: 客户描述
          example: "专注于企业级软件开发的科技公司"
        level:
          type: integer
          description: 客户等级：1-普通，2-重要，3-VIP，4-战略
          enum: [1, 2, 3, 4]
          default: 1
          example: 2
        source:
          type: string
          description: 客户来源
          maxLength: 50
          example: "网络推广"
        assigned_manager_id:
          type: integer
          format: int64
          description: 客户经理ID
          example: 1001
        contacts:
          type: array
          description: 联系人列表
          items:
            $ref: '#/components/schemas/CustomerContactCreateRequest'

    CustomerUpdateRequest:
      type: object
      description: 更新客户请求
      properties:
        customer_name:
          type: string
          description: 客户名称
          minLength: 1
          maxLength: 200
          example: "ABC科技有限公司"
        customer_type:
          type: integer
          description: 客户类型：1-企业，2-政府，3-个人
          enum: [1, 2, 3]
          example: 1
        industry:
          type: string
          description: 所属行业
          maxLength: 100
          example: "软件开发"
        scale:
          type: string
          description: 企业规模
          maxLength: 50
          example: "中型企业"
        address:
          type: string
          description: 客户地址
          example: "北京市朝阳区xxx路xxx号"
        website:
          type: string
          format: uri
          description: 官方网站
          example: "https://www.abc-tech.com"
        description:
          type: string
          description: 客户描述
          example: "专注于企业级软件开发的科技公司"
        status:
          type: integer
          description: 状态：1-潜在客户，2-正式客户，3-流失客户
          enum: [1, 2, 3]
          example: 2
        level:
          type: integer
          description: 客户等级：1-普通，2-重要，3-VIP，4-战略
          enum: [1, 2, 3, 4]
          example: 3
        source:
          type: string
          description: 客户来源
          maxLength: 50
          example: "网络推广"
        assigned_manager_id:
          type: integer
          format: int64
          description: 客户经理ID
          example: 1001

    CustomerCreateResponse:
      type: object
      description: 创建客户响应
      properties:
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        customer_code:
          type: string
          description: 客户编码
          example: "CUST-20250815-0001"
        customer_name:
          type: string
          description: 客户名称
          example: "ABC科技有限公司"
        status:
          type: integer
          description: 状态
          example: 1
        health_score:
          type: number
          format: float
          description: 健康度评分
          example: 75.00
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-08-15T14:30:00Z"

    CustomerListItem:
      type: object
      description: 客户列表项
      properties:
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        customer_code:
          type: string
          description: 客户编码
          example: "CUST-20250815-0001"
        customer_name:
          type: string
          description: 客户名称
          example: "ABC科技有限公司"
        customer_type:
          type: integer
          description: 客户类型
          example: 1
        industry:
          type: string
          description: 所属行业
          example: "软件开发"
        level:
          type: integer
          description: 客户等级
          example: 3
        status:
          type: integer
          description: 状态
          example: 2
        health_score:
          type: number
          format: float
          description: 健康度评分
          example: 85.50
        ltv:
          type: number
          format: float
          description: 客户生命周期价值
          example: 360000.00
        assigned_manager:
          type: object
          description: 客户经理信息
          properties:
            id:
              type: integer
              format: int64
              example: 1001
            name:
              type: string
              example: "李经理"
        last_contact_date:
          type: string
          format: date-time
          description: 最后联系时间
          example: "2025-08-10T15:30:00Z"
        next_renewal_date:
          type: string
          format: date
          description: 下次续约时间
          example: "2025-12-31"

    CustomerDetailResponse:
      type: object
      description: 客户详情响应
      properties:
        customer_info:
          $ref: '#/components/schemas/Customer'
        contacts:
          type: array
          description: 联系人列表
          items:
            $ref: '#/components/schemas/CustomerContact'
        tags:
          type: array
          description: 客户标签
          items:
            $ref: '#/components/schemas/CustomerTag'

    # 客户联系人相关Schema
    CustomerContact:
      type: object
      description: 客户联系人信息
      properties:
        contact_id:
          type: integer
          format: int64
          description: 联系人ID
          example: 1001
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        contact_name:
          type: string
          description: 联系人姓名
          example: "张总"
        position:
          type: string
          description: 职位
          example: "总经理"
        department:
          type: string
          description: 部门
          example: "管理层"
        phone:
          type: string
          description: 电话
          example: "010-12345678"
        mobile:
          type: string
          description: 手机
          example: "13800138000"
        email:
          type: string
          format: email
          description: 邮箱
          example: "zhang@abc-tech.com"
        wechat:
          type: string
          description: 微信
          example: "zhang_ceo"
        is_primary:
          type: integer
          description: 是否主要联系人：0-否，1-是
          enum: [0, 1]
          example: 1
        is_decision_maker:
          type: integer
          description: 是否决策人：0-否，1-是
          enum: [0, 1]
          example: 1
        influence_level:
          type: integer
          description: 影响力等级：1-低，2-中，3-高
          enum: [1, 2, 3]
          example: 3
        last_contact_date:
          type: string
          format: date-time
          description: 最后联系时间
          example: "2025-08-10T15:30:00Z"
        contact_preference:
          type: string
          description: 联系偏好
          example: "邮件"
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-08-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          description: 更新时间
          example: "2025-08-15T14:30:00Z"

    CustomerContactCreateRequest:
      type: object
      description: 创建联系人请求
      required:
        - contact_name
      properties:
        contact_name:
          type: string
          description: 联系人姓名
          minLength: 1
          maxLength: 100
          example: "张总"
        position:
          type: string
          description: 职位
          maxLength: 100
          example: "总经理"
        department:
          type: string
          description: 部门
          maxLength: 100
          example: "管理层"
        phone:
          type: string
          description: 电话
          maxLength: 20
          example: "010-12345678"
        mobile:
          type: string
          description: 手机
          maxLength: 20
          example: "13800138000"
        email:
          type: string
          format: email
          description: 邮箱
          maxLength: 100
          example: "zhang@abc-tech.com"
        wechat:
          type: string
          description: 微信
          maxLength: 100
          example: "zhang_ceo"
        is_primary:
          type: integer
          description: 是否主要联系人：0-否，1-是
          enum: [0, 1]
          default: 0
          example: 1
        is_decision_maker:
          type: integer
          description: 是否决策人：0-否，1-是
          enum: [0, 1]
          default: 0
          example: 1
        influence_level:
          type: integer
          description: 影响力等级：1-低，2-中，3-高
          enum: [1, 2, 3]
          default: 1
          example: 3
        contact_preference:
          type: string
          description: 联系偏好
          maxLength: 50
          example: "邮件"

    CustomerContactUpdateRequest:
      type: object
      description: 更新联系人请求
      properties:
        contact_name:
          type: string
          description: 联系人姓名
          minLength: 1
          maxLength: 100
          example: "张总"
        position:
          type: string
          description: 职位
          maxLength: 100
          example: "总经理"
        department:
          type: string
          description: 部门
          maxLength: 100
          example: "管理层"
        phone:
          type: string
          description: 电话
          maxLength: 20
          example: "010-12345678"
        mobile:
          type: string
          description: 手机
          maxLength: 20
          example: "13800138000"
        email:
          type: string
          format: email
          description: 邮箱
          maxLength: 100
          example: "zhang@abc-tech.com"
        wechat:
          type: string
          description: 微信
          maxLength: 100
          example: "zhang_ceo"
        is_decision_maker:
          type: integer
          description: 是否决策人：0-否，1-是
          enum: [0, 1]
          example: 1
        influence_level:
          type: integer
          description: 影响力等级：1-低，2-中，3-高
          enum: [1, 2, 3]
          example: 3
        contact_preference:
          type: string
          description: 联系偏好
          maxLength: 50
          example: "邮件"

    # 客户健康度相关Schema
    CustomerHealthScore:
      type: object
      description: 客户健康度信息
      properties:
        id:
          type: integer
          format: int64
          description: 健康度记录ID
          example: 5001
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        score_date:
          type: string
          format: date
          description: 评分日期
          example: "2025-08-15"
        overall_score:
          type: number
          format: float
          description: 总体健康度评分
          minimum: 0
          maximum: 100
          example: 85.50
        satisfaction_score:
          type: number
          format: float
          description: 满意度评分
          minimum: 0
          maximum: 100
          example: 88.00
        activity_score:
          type: number
          format: float
          description: 活跃度评分
          minimum: 0
          maximum: 100
          example: 82.00
        financial_score:
          type: number
          format: float
          description: 财务健康度评分
          minimum: 0
          maximum: 100
          example: 90.00
        contract_score:
          type: number
          format: float
          description: 合同稳定性评分
          minimum: 0
          maximum: 100
          example: 83.00
        risk_level:
          type: integer
          description: 风险等级：1-低，2-中，3-高，4-极高
          enum: [1, 2, 3, 4]
          example: 1
        churn_probability:
          type: number
          format: float
          description: 流失概率
          minimum: 0
          maximum: 1
          example: 0.0850
        factors:
          type: object
          description: 影响因素详情
          properties:
            positive_factors:
              type: array
              description: 正面因素
              items:
                type: string
              example: ["付款及时性良好", "服务满意度高", "使用频率稳定"]
            negative_factors:
              type: array
              description: 负面因素
              items:
                type: string
              example: ["近期登录频率下降", "工单数量增加"]
        recommendations:
          type: array
          description: 改进建议
          items:
            type: string
          example: ["建议主动联系客户了解使用情况", "提供产品使用培训", "关注工单处理质量"]
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-08-15T10:30:00Z"

    CustomerHealthScoreResponse:
      type: object
      description: 客户健康度计算响应
      properties:
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        score_date:
          type: string
          format: date
          description: 评分日期
          example: "2025-08-15"
        overall_score:
          type: number
          format: float
          description: 总体健康度评分
          example: 85.50
        satisfaction_score:
          type: number
          format: float
          description: 满意度评分
          example: 88.00
        activity_score:
          type: number
          format: float
          description: 活跃度评分
          example: 82.00
        financial_score:
          type: number
          format: float
          description: 财务健康度评分
          example: 90.00
        contract_score:
          type: number
          format: float
          description: 合同稳定性评分
          example: 83.00
        risk_level:
          type: integer
          description: 风险等级
          example: 1
        churn_probability:
          type: number
          format: float
          description: 流失概率
          example: 0.0850
        factors:
          type: object
          description: 影响因素详情
          properties:
            positive_factors:
              type: array
              items:
                type: string
              example: ["付款及时性良好", "服务满意度高", "使用频率稳定"]
            negative_factors:
              type: array
              items:
                type: string
              example: ["近期登录频率下降", "工单数量增加"]
        recommendations:
          type: array
          description: 改进建议
          items:
            type: string
          example: ["建议主动联系客户了解使用情况", "提供产品使用培训", "关注工单处理质量"]

    CustomerHealthScoreTrendResponse:
      type: object
      description: 客户健康度趋势响应
      properties:
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        period:
          type: string
          description: 时间周期
          example: "6m"
        trend_data:
          type: array
          description: 趋势数据
          items:
            type: object
            properties:
              score_date:
                type: string
                format: date
                description: 评分日期
                example: "2025-03-15"
              overall_score:
                type: number
                format: float
                description: 总体健康度评分
                example: 78.50
              risk_level:
                type: integer
                description: 风险等级
                example: 2
        trend_analysis:
          type: object
          description: 趋势分析
          properties:
            direction:
              type: string
              description: 趋势方向
              enum: [上升, 下降, 稳定]
              example: "上升"
            change_rate:
              type: number
              format: float
              description: 变化率
              example: 0.089
            stability:
              type: string
              description: 稳定性
              enum: [稳定, 波动, 剧烈波动]
              example: "稳定"

    # 客户标签相关Schema
    CustomerTag:
      type: object
      description: 客户标签信息
      properties:
        tag_id:
          type: integer
          format: int64
          description: 标签ID
          example: 2001
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        tag_name:
          type: string
          description: 标签名称
          example: "高价值客户"
        tag_type:
          type: integer
          description: 标签类型：1-手动，2-自动，3-系统
          enum: [1, 2, 3]
          example: 2
        tag_category:
          type: string
          description: 标签分类
          example: "价值分类"
        tag_value:
          type: string
          description: 标签值
          example: "VIP"
        confidence:
          type: number
          format: float
          description: 置信度（自动标签）
          minimum: 0
          maximum: 1
          example: 0.95
        created_by:
          type: integer
          format: int64
          description: 创建人
          example: 1001
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-08-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          description: 更新时间
          example: "2025-08-15T14:30:00Z"

    # 客户成功任务相关Schema
    CustomerSuccessTask:
      type: object
      description: 客户成功任务信息
      properties:
        task_id:
          type: integer
          format: int64
          description: 任务ID
          example: 5001
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        task_title:
          type: string
          description: 任务标题
          example: "客户健康度改善计划"
        task_description:
          type: string
          description: 任务描述
          example: "针对客户健康度下降，制定改善计划"
        task_type:
          type: integer
          description: 任务类型：1-健康度改善，2-续约跟进，3-满意度提升，4-问题解决
          enum: [1, 2, 3, 4]
          example: 1
        priority:
          type: integer
          description: 优先级：1-低，2-中，3-高，4-紧急
          enum: [1, 2, 3, 4]
          example: 3
        status:
          type: integer
          description: 状态：1-待处理，2-进行中，3-已完成，4-已取消
          enum: [1, 2, 3, 4]
          example: 1
        assigned_to:
          type: integer
          format: int64
          description: 分配给
          example: 1001
        due_date:
          type: string
          format: date-time
          description: 截止时间
          example: "2025-08-25T18:00:00Z"
        completion_date:
          type: string
          format: date-time
          description: 完成时间
          example: null
        result:
          type: string
          description: 执行结果
          example: null
        effectiveness_score:
          type: number
          format: float
          description: 效果评分
          minimum: 0
          maximum: 5
          example: null
        auto_generated:
          type: integer
          description: 是否自动生成：0-否，1-是
          enum: [0, 1]
          example: 0
        trigger_condition:
          type: string
          description: 触发条件
          example: null
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-08-15T16:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: 更新时间
          example: "2025-08-15T16:00:00Z"

    CustomerSuccessTaskCreateRequest:
      type: object
      description: 创建客户成功任务请求
      required:
        - task_title
        - task_type
        - assigned_to
      properties:
        task_title:
          type: string
          description: 任务标题
          minLength: 1
          maxLength: 200
          example: "客户健康度改善计划"
        task_description:
          type: string
          description: 任务描述
          example: "针对客户健康度下降，制定改善计划"
        task_type:
          type: integer
          description: 任务类型：1-健康度改善，2-续约跟进，3-满意度提升，4-问题解决
          enum: [1, 2, 3, 4]
          example: 1
        priority:
          type: integer
          description: 优先级：1-低，2-中，3-高，4-紧急
          enum: [1, 2, 3, 4]
          default: 2
          example: 3
        assigned_to:
          type: integer
          format: int64
          description: 分配给
          example: 1001
        due_date:
          type: string
          format: date-time
          description: 截止时间
          example: "2025-08-25T18:00:00Z"

    CustomerSuccessTaskListItem:
      type: object
      description: 客户成功任务列表项
      properties:
        task_id:
          type: integer
          format: int64
          description: 任务ID
          example: 5001
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        customer_name:
          type: string
          description: 客户名称
          example: "ABC科技有限公司"
        task_title:
          type: string
          description: 任务标题
          example: "客户健康度改善计划"
        task_type:
          type: integer
          description: 任务类型
          example: 1
        priority:
          type: integer
          description: 优先级
          example: 3
        status:
          type: integer
          description: 状态
          example: 1
        due_date:
          type: string
          format: date-time
          description: 截止时间
          example: "2025-08-25T18:00:00Z"
        auto_generated:
          type: integer
          description: 是否自动生成
          example: 0

    # 客户分析相关Schema
    CustomerValueAnalysisResponse:
      type: object
      description: 客户价值分析响应
      properties:
        customer_id:
          type: integer
          format: int64
          description: 客户ID
          example: 12345
        value_analysis:
          type: object
          description: 价值分析
          properties:
            ltv:
              type: number
              format: float
              description: 客户生命周期价值
              example: 360000.00
            arpu:
              type: number
              format: float
              description: 用户平均收入
              example: 10000.00
            profit_margin:
              type: number
              format: float
              description: 利润率
              example: 0.35
            revenue_trend:
              type: string
              description: 收入趋势
              enum: [上升, 下降, 稳定]
              example: "上升"
            value_rank:
              type: string
              description: 价值排名
              example: "前10%"
        financial_metrics:
          type: object
          description: 财务指标
          properties:
            total_revenue:
              type: number
              format: float
              description: 总收入
              example: 120000.00
            monthly_revenue:
              type: number
              format: float
              description: 月收入
              example: 10000.00
            payment_punctuality:
              type: number
              format: float
              description: 付款及时性
              minimum: 0
              maximum: 1
              example: 0.95
            contract_stability:
              type: number
              format: float
              description: 合同稳定性
              minimum: 0
              maximum: 1
              example: 0.88
        growth_potential:
          type: object
          description: 增长潜力
          properties:
            upsell_probability:
              type: number
              format: float
              description: 向上销售概率
              minimum: 0
              maximum: 1
              example: 0.75
            expansion_opportunities:
              type: array
              description: 扩展机会
              items:
                type: string
              example: ["增加用户数量", "升级服务等级", "购买附加模块"]
            estimated_growth:
              type: number
              format: float
              description: 预估增长率
              example: 0.30

# REQ-020: 移动端应用模块

**补充:** 移动端应用模块为IT运维门户系统提供移动设备访问能力，支持工程师和客户在移动设备上进行运维操作和服务管理。

## 1. 业务描述
移动端应用模块为IT运维门户系统提供移动设备访问能力，包括iOS和Android的 Flutter原生应用。模块支持工程师移动办公、客户移动自助服务、实时通知推送、离线数据同步等功能。通过移动端应用，工程师可以随时随地处理工单、查看系统状态、接收派单通知；客户可以便捷地提交工单、查询服务状态、获取技术支持。

## 2. KPI / 核心目标
- **移动端用户活跃度**：≥70%，工程师和客户积极使用移动端
- **移动端工单处理率**：≥40%，工单通过移动端处理的比例
- **应用响应时间**：≤2秒，移动端操作响应时间
- **离线数据同步成功率**：≥99%，离线数据同步的成功率
- **用户满意度**：≥4.5/5分，移动端用户体验满意度
- **推送到达率**：≥95%，重要通知的推送到达率

## 3. 功能需求表

| 功能编号 | 功能名称 | 优先级 | 功能描述 | 验收标准 |
|---------|----------|--------|----------|----------|
| REQ-020-001 | 移动端工单管理 | P0 | 查看、处理、更新工单状态 | 功能完整，操作便捷 |
| REQ-020-002 | 实时通知推送 | P0 | 工单派发、状态变更、紧急告警推送 | 推送及时，到达率高 |
| REQ-020-003 | 移动端客户自助 | P0 | 客户移动端提交工单、查询状态 | 界面友好，功能完整 |
| REQ-020-004 | 离线数据同步 | P1 | 支持离线查看和操作，联网后同步 | 同步准确，数据一致 |
| REQ-020-005 | 地理位置服务 | P1 | 基于位置的工程师派单和签到 | 定位准确，隐私保护 |
| REQ-020-006 | 多媒体支持 | P1 | 拍照、录音、视频记录故障现象 | 质量清晰，上传稳定 |
| REQ-020-007 | 语音输入支持 | P2 | 语音转文字，快速记录工单信息 | 识别准确，响应快速 |
| REQ-020-008 | 扫码功能 | P2 | 扫描设备二维码快速创建工单 | 识别准确，操作便捷 |

## 4. 用户故事

**故事1：工程师的移动办公**
- **角色**：运维工程师
- **需求**：作为工程师，我希望在移动设备上接收工单通知并能快速响应
- **场景**：外出时接收紧急工单通知，通过手机查看详情并开始处理
- **验收标准**：通知及时准确，移动端功能完整便捷

**故事2：客户的移动自助服务**
- **角色**：客户用户
- **需求**：作为客户，我希望通过手机应用随时提交工单和查询处理进度
- **场景**：发现问题时用手机拍照并提交工单，随时查询处理状态
- **验收标准**：提交便捷，状态查询及时准确

**故事3：现场工程师的多媒体记录**
- **角色**：现场工程师
- **需求**：作为现场工程师，我希望能拍照记录设备状态并上传到工单系统
- **场景**：现场处理故障时拍照记录问题现象和解决过程
- **验收标准**：拍照清晰，上传稳定，记录完整

## 5. 用户交互与流程（正常流 / 异常流）

**正常流程：移动端工单处理流程**
1. 工程师接收工单推送通知
2. 点击通知打开移动应用
3. 查看工单详细信息
4. 接受工单并开始处理
5. 现场拍照记录问题现象
6. 更新工单处理进度
7. 完成处理并提交结果

**异常流程：离线操作同步**
1. 工程师在无网络环境下操作
2. 应用自动保存操作到本地
3. 显示离线状态提示
4. 网络恢复后自动同步数据
5. 检查同步结果和冲突
6. 解决数据冲突并确认同步
7. 通知用户同步完成

**补充:** 离线功能确保工程师在网络不稳定的环境下仍能正常工作。

## 6. 非功能需求

**性能需求**
- **启动时间**：应用冷启动时间≤3秒，热启动≤1秒
- **响应时间**：界面操作响应时间≤2秒
- **数据同步**：离线数据同步时间≤30秒
- **推送延迟**：重要通知推送延迟≤10秒

**兼容性需求**
- **iOS兼容性**：支持iOS 12+系统版本
- **Android兼容性**：支持Android 8.0+系统版本
- **设备适配**：支持主流手机和平板设备
- **网络适配**：支持4G/5G/WiFi网络环境

**用户体验需求**
- **界面设计**：遵循iOS和Android设计规范
- **操作便捷**：减少操作步骤，提升效率
- **无障碍访问**：支持视觉和听觉障碍用户
- **多语言支持**：支持中英文界面切换

## 7. 数据模型（字段级）

**移动设备表（mobile_devices）**
```sql
CREATE TABLE mobile_devices (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id BIGINT NOT NULL COMMENT '租户ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    device_id VARCHAR(100) UNIQUE NOT NULL COMMENT '设备唯一标识',
    device_type VARCHAR(20) NOT NULL COMMENT '设备类型：ios,android',
    device_model VARCHAR(100) COMMENT '设备型号',
    os_version VARCHAR(50) COMMENT '系统版本',
    app_version VARCHAR(50) COMMENT '应用版本',
    push_token VARCHAR(255) COMMENT '推送令牌',
    last_active_time DATETIME COMMENT '最后活跃时间',
    location_enabled TINYINT DEFAULT 0 COMMENT '是否启用位置服务',
    notification_enabled TINYINT DEFAULT 1 COMMENT '是否启用通知',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，2-停用',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_tenant_user (tenant_id, user_id),
    INDEX idx_device_type (device_type),
    INDEX idx_last_active (last_active_time)
);
```

**离线数据表（offline_data）**
```sql
CREATE TABLE offline_data (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id BIGINT NOT NULL COMMENT '租户ID',
    device_id VARCHAR(100) NOT NULL COMMENT '设备ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    operation_type VARCHAR(50) NOT NULL COMMENT '操作类型',
    operation_data JSON NOT NULL COMMENT '操作数据',
    local_timestamp DATETIME NOT NULL COMMENT '本地时间戳',
    sync_status TINYINT DEFAULT 0 COMMENT '同步状态：0-待同步，1-已同步，2-冲突',
    sync_time DATETIME COMMENT '同步时间',
    conflict_data JSON COMMENT '冲突数据',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_tenant_device (tenant_id, device_id),
    INDEX idx_sync_status (sync_status),
    INDEX idx_local_timestamp (local_timestamp)
);
```

## 8. 核心 API 示例

**移动端登录API**
```http
POST /api/v1/mobile/auth/login
Content-Type: application/json

{
    "username": "engineer001",
    "password": "password123",
    "device_info": {
        "device_id": "iPhone_12345",
        "device_type": "ios",
        "device_model": "iPhone 13",
        "os_version": "iOS 15.0",
        "app_version": "1.0.0",
        "push_token": "abc123def456"
    }
}

Response:
{
    "code": 200,
    "message": "登录成功",
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "expires_in": 7200,
        "user_info": {
            "user_id": 1001,
            "username": "engineer001",
            "real_name": "张工程师",
            "role": "engineer"
        },
        "app_config": {
            "push_enabled": true,
            "location_enabled": true,
            "offline_sync_interval": 300
        }
    }
}
```

**离线数据同步API**
```http
POST /api/v1/mobile/sync/upload
Authorization: Bearer {access_token}
Content-Type: application/json

{
    "device_id": "iPhone_12345",
    "sync_data": [
        {
            "operation_type": "ticket_update",
            "operation_data": {
                "ticket_id": 12345,
                "status": "in_progress",
                "notes": "已到达现场，开始排查问题"
            },
            "local_timestamp": "2024-08-11 14:30:00"
        }
    ]
}

Response:
{
    "code": 200,
    "message": "同步成功",
    "data": {
        "synced_count": 1,
        "failed_count": 0,
        "conflicts": [],
        "server_timestamp": "2024-08-11 14:30:15"
    }
}
```

## 9. 异常与边界场景

**网络异常场景**
- **网络中断**：自动切换到离线模式，保存操作到本地
- **网络不稳定**：智能重试机制，避免数据丢失
- **同步冲突**：提供冲突解决界面，用户选择保留版本
- **推送失败**：使用备用推送渠道或应用内通知

**设备异常场景**
- **存储空间不足**：清理缓存数据，提示用户释放空间
- **权限被拒绝**：引导用户开启必要权限
- **应用崩溃**：自动重启并恢复用户状态
- **版本不兼容**：提示用户升级应用版本

## 10. 性能 / 容量规划

**数据容量规划**
- **设备数据**：支持10000+移动设备，每设备约2KB
- **离线数据**：每设备最大离线数据10MB，总计100GB
- **推送数据**：年推送消息1000万条，每条约1KB
- **多媒体数据**：年上传图片/视频100TB

**性能优化策略**
- **数据压缩**：离线数据和多媒体文件压缩存储
- **CDN加速**：应用更新包和静态资源CDN分发
- **智能缓存**：常用数据本地缓存，减少网络请求
- **推送优化**：批量推送和智能推送时机选择

## 11. 安全与合规

**数据安全**
- **传输加密**：所有数据传输使用HTTPS/TLS加密
- **本地加密**：敏感数据本地加密存储
- **身份认证**：支持生物识别和PIN码认证
- **会话管理**：安全的会话管理和自动登出

**隐私保护**
- **位置隐私**：位置数据仅在必要时收集和使用
- **设备信息**：最小化收集设备信息
- **用户控制**：用户可控制数据收集和使用
- **数据清理**：应用卸载时清理本地数据

## 12. 测试与验收标准

**功能测试**
- **核心功能**：测试工单管理、通知推送等核心功能
- **离线功能**：测试离线操作和数据同步功能
- **多媒体功能**：测试拍照、录音、视频等功能
- **地理位置**：测试位置服务和基于位置的功能

**兼容性测试**
- **设备兼容性**：在不同设备上测试应用兼容性
- **系统版本**：测试不同操作系统版本的兼容性
- **网络环境**：测试不同网络环境下的表现
- **性能测试**：测试应用在低配置设备上的性能

## 13. 模块依赖

**依赖模块**
- **基础架构模块（REQ-001）**：用户认证、权限控制、数据存储
- **工单管理模块（REQ-003）**：移动端工单操作
- **通知消息模块（REQ-011）**：推送通知服务
- **客户自助服务（REQ-019）**：移动端客户服务

**被依赖模块**
- **智能派单模块（REQ-004）**：基于位置的智能派单
- **数据分析模块（REQ-023）**：移动端使用数据分析

**外部依赖**
- **推送服务**：APNs（iOS）、FCM（Android）推送服务
- **地图服务**：高德地图、百度地图等位置服务
- **云存储**：阿里云OSS、腾讯云COS等文件存储
- **CDN服务**：应用分发和静态资源加速

# REQ-019: 客户自助服务模块

**补充:** 客户自助服务门户是客户（甲方用户）直接与运维平台交互的前端入口，旨在通过自助知识检索、AI问答、工单自建与跟踪、服务状态可视化等功能，降低人工客服压力、缩短问题解决时间、提升客户满意度。

## 1. 业务描述
为客户提供7x24小时自助服务能力，减少人工服务成本。客户自助服务门户是客户（甲方用户）直接与运维平台交互的前端入口，旨在通过**自助知识检索、AI 问答、工单自建与跟踪、服务状态可视化**等功能，降低人工客服压力、缩短问题解决时间、提升客户满意度。模块需与**知识库管理系统（REQ-005）**、**智能分析与AI功能（REQ-013）**紧密集成，支持基于 AI 推荐的 FAQ 与智能问答功能；并与工单管理系统对接，实现自助提交与查询工单，以及服务状态跟踪。支持多终端访问（WEB、移动端），多租户隔离下的客户门户品牌化（LOGO、颜色、域名）。

## 2. KPI / 核心目标
- **自助服务使用率**：≥60%，客户优先选择自助服务解决问题
- **人工工单请求减少率**：≥40%，通过自助服务减少人工干预
- **知识复用率**：≥75%，知识库内容被有效利用
- **AI推荐采纳率**：≥80%，AI推荐的解决方案被客户采纳
- **自助服务满意度**：≥4.5/5分，客户对自助服务体验满意
- **问题解决效率**：自助解决问题平均时间≤10分钟

## 3. 功能需求表

| 功能编号 | 功能名称 | 优先级 | 功能描述 | 验收标准 |
|---------|----------|--------|----------|----------|
| REQ-019-001 | 客户专属登录门户 | P0 | 多租户隔离、品牌化自定义 | 门户独立，品牌一致 |
| REQ-019-002 | 智能FAQ系统 | P0 | 按类别/标签浏览FAQ，支持在线搜索 | 搜索准确，分类清晰 |
| REQ-019-003 | AI智能问答 | P0 | 接入REQ-013大模型接口，支持自然语言问答 | 回答准确，响应及时 |
| REQ-019-004 | 知识库搜索与推荐 | P0 | 基于REQ-005知识库全文检索和AI推荐 | 推荐相关，检索精准 |
| REQ-019-005 | 自助工单创建 | P0 | 支持在线提交工单并上传附件 | 提交便捷，信息完整 |
| REQ-019-006 | 工单状态查询 | P0 | 查询工单处理进度与历史 | 状态准确，更新及时 |
| REQ-019-007 | 服务状态可视化 | P1 | 展示系统运行状态、维护计划 | 信息透明，展示直观 |
| REQ-019-008 | 文档下载中心 | P2 | 提供产品手册、运维指南下载 | 文档齐全，下载便捷 |
| REQ-019-009 | 反馈与评价 | P1 | 提交问题解决后的评分和反馈 | 反馈便捷，统计准确 |

## 4. 用户故事

**故事1：客户的智能问答体验**
- **角色**：客户用户
- **需求**：作为客户，我希望在门户中用自然语言描述问题，系统能直接给出解决方案
- **场景**：遇到技术问题时，通过AI问答快速获得解决方案或相关知识推荐
- **验收标准**：AI回答准确相关，解决方案实用有效

**故事2：客户的自助工单管理**
- **角色**：客户用户
- **需求**：作为客户，我希望能在线提交工单并即时收到确认通知，无需打电话
- **场景**：在线填写工单信息，上传相关附件，实时跟踪处理进度
- **验收标准**：提交流程简单，状态跟踪透明，通知及时

**故事3：客户成功经理的反馈收集**
- **角色**：客户成功经理
- **需求**：作为客户成功经理，我希望通过自助门户收集客户反馈，持续优化知识库
- **场景**：分析客户使用数据，收集满意度反馈，优化服务内容
- **验收标准**：数据统计准确，反馈收集完整，优化建议有价值

## 5. 用户交互与流程（正常流 / 异常流）

**正常流程：客户自助问题解决流程**
1. 客户登录专属自助服务门户
2. 在搜索框输入问题描述
3. 系统AI分析问题并推荐相关FAQ
4. 客户浏览推荐内容寻找解决方案
5. 如果找到解决方案，标记为有用
6. 如果未找到，可以创建工单求助
7. 系统记录客户行为和反馈

**异常流程：AI推荐失效处理**
1. 客户输入问题但AI推荐不准确
2. 系统提供备用搜索和分类浏览
3. 客户通过关键词搜索知识库
4. 如果仍未找到答案，引导创建工单
5. 记录AI推荐失效的问题类型
6. 用于后续AI模型优化训练

**补充:** 多层次的问题解决机制确保客户总能找到合适的解决途径。

## 6. 非功能需求

**性能需求**
- **响应时间**：页面加载时间≤3秒，搜索响应≤2秒
- **AI问答性能**：AI回答生成时间≤5秒
- **并发支持**：支持1000+客户同时访问
- **搜索性能**：知识库搜索响应时间≤2秒

**可用性需求**
- **系统可用性**：7×24小时服务，可用性≥99.5%
- **多终端支持**：支持PC、手机、平板等多种设备
- **多语言支持**：支持中英文界面切换
- **无障碍访问**：支持视觉障碍用户的辅助功能

**用户体验需求**
- **界面友好**：简洁直观的用户界面设计
- **品牌一致性**：支持客户品牌定制化
- **操作便捷**：减少用户操作步骤，提升效率
- **智能引导**：提供智能化的操作引导和帮助

## 7. 数据模型（字段级）

**self_service_session（自助会话表）**

| 字段名 | 类型 | 可空 | 描述 | 约束/索引 |
|--------|------|------|------|-----------|
| session_id | bigint | N | 会话ID | PK |
| tenant_id | bigint | N | 租户ID | idx_tenant |
| customer_id | bigint | N | 客户ID | idx_customer |
| question | text | N | 用户提问/搜索内容 | fulltext |
| ai_response | text | Y | AI回答内容 |  |
| feedback | varchar(20) | Y | 反馈（solved/unsolved） |  |
| created_at | timestamp | N | 创建时间 | idx_created |

**客户门户配置表（customer_portal_configs）**
```sql
CREATE TABLE customer_portal_configs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id BIGINT NOT NULL COMMENT '租户ID',
    customer_id BIGINT NOT NULL COMMENT '客户ID',
    portal_domain VARCHAR(100) COMMENT '门户域名',
    portal_title VARCHAR(100) COMMENT '门户标题',
    logo_url VARCHAR(255) COMMENT 'LOGO地址',
    theme_color VARCHAR(20) COMMENT '主题色',
    welcome_message TEXT COMMENT '欢迎信息',
    contact_info JSON COMMENT '联系信息',
    enabled_features JSON COMMENT '启用功能列表',
    custom_css TEXT COMMENT '自定义样式',
    status TINYINT DEFAULT 1 COMMENT '状态：1-启用，2-禁用',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_tenant_customer (tenant_id, customer_id),
    INDEX idx_portal_domain (portal_domain)
);
```

**客户反馈表（customer_feedback）**
```sql
CREATE TABLE customer_feedback (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id BIGINT NOT NULL COMMENT '租户ID',
    customer_id BIGINT NOT NULL COMMENT '客户ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    feedback_type VARCHAR(50) NOT NULL COMMENT '反馈类型',
    related_id VARCHAR(100) COMMENT '关联ID（工单、知识等）',
    rating TINYINT COMMENT '评分：1-5分',
    feedback_content TEXT COMMENT '反馈内容',
    suggestions TEXT COMMENT '改进建议',
    contact_required TINYINT DEFAULT 0 COMMENT '是否需要回访',
    status TINYINT DEFAULT 1 COMMENT '状态：1-待处理，2-已处理',
    processed_by BIGINT COMMENT '处理人ID',
    processed_at DATETIME COMMENT '处理时间',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_tenant_customer (tenant_id, customer_id),
    INDEX idx_feedback_type (feedback_type),
    INDEX idx_rating (rating),
    INDEX idx_status (status)
);
```

## 8. 核心 API 示例

**AI智能问答API**
```http
POST /api/v1/customer-portal/ai-chat
Authorization: Bearer {access_token}
Content-Type: application/json

{
    "customer_id": 12345,
    "question": "服务器连接不上怎么办？",
    "context": {
        "previous_questions": [],
        "user_role": "IT管理员"
    }
}

Response:
{
    "code": 200,
    "message": "问答成功",
    "data": {
        "answer": "服务器连接问题可能由以下原因导致：1. 网络连接异常 2. 服务器服务停止 3. 防火墙阻拦。建议您先检查网络连接，然后查看服务器状态。",
        "confidence": 0.92,
        "related_articles": [
            {
                "id": 1001,
                "title": "服务器连接故障排查指南",
                "url": "/knowledge/1001",
                "relevance": 0.95
            }
        ],
        "suggested_actions": [
            "检查网络连接",
            "查看服务器状态",
            "检查防火墙设置"
        ]
    }
}
```

**自助工单创建API**
```http
POST /api/v1/customer-portal/tickets
Authorization: Bearer {access_token}
Content-Type: application/json

{
    "customer_id": 12345,
    "title": "邮件服务器无法发送邮件",
    "description": "从昨天开始，公司邮件服务器无法发送邮件，但可以正常接收",
    "category": "邮件系统",
    "priority": 2,
    "contact_person": "张三",
    "contact_phone": "13800138000",
    "attachments": [
        {
            "filename": "error_log.txt",
            "url": "https://files.example.com/error_log.txt"
        }
    ]
}

Response:
{
    "code": 200,
    "message": "工单创建成功",
    "data": {
        "ticket_id": 67890,
        "ticket_no": "TK202408110001",
        "status": "待处理",
        "estimated_response_time": "2小时内",
        "tracking_url": "/customer-portal/tickets/67890"
    }
}
```

## 9. 异常与边界场景

**AI服务异常场景**
- **AI服务不可用**：AI服务异常时，降级到传统关键词搜索
- **回答质量差**：AI回答不准确时，提供人工客服入口
- **响应超时**：AI响应超时时，显示等待提示并提供备选方案
- **语言识别错误**：语言识别错误时，提供语言选择选项

**用户操作异常场景**
- **登录失败**：多次登录失败时，提供密码重置和联系客服选项
- **文件上传失败**：文件上传失败时，提供重试和格式说明
- **网络中断**：网络中断时，保存用户输入并提供离线提示
- **权限不足**：访问权限不足时，提供权限申请流程

## 10. 性能 / 容量规划

**数据容量规划**
- **客户门户配置**：1000个客户门户，每个约10KB，总计10MB
- **客户反馈数据**：年反馈10万条，每条约5KB，总计500MB
- **访问日志**：年访问日志1000万条，每条约2KB，总计20GB
- **缓存数据**：热点内容缓存约1GB

**性能优化策略**
- **CDN加速**：静态资源使用CDN分发，提升加载速度
- **智能缓存**：常用FAQ和知识内容缓存
- **搜索优化**：使用Elasticsearch提升搜索性能
- **AI模型优化**：优化AI模型推理速度，减少响应时间

## 11. 安全与合规

**数据安全**
- **客户数据隔离**：严格的多租户数据隔离
- **敏感信息保护**：客户敏感信息加密存储
- **访问控制**：基于客户身份的访问权限控制
- **操作审计**：记录所有客户操作和数据访问

**隐私保护**
- **个人信息保护**：符合GDPR、PIPL等隐私保护法规
- **数据最小化**：只收集必要的客户信息
- **透明度**：向客户说明数据使用目的和方式
- **用户控制**：客户可以查看、修改、删除个人数据

## 12. 测试与验收标准

**功能测试**
- **门户功能**：测试客户门户的各项功能
- **AI问答**：测试AI问答的准确性和响应速度
- **工单流程**：测试自助工单创建和跟踪流程
- **搜索功能**：测试知识库搜索的准确性

**用户体验测试**
- **易用性测试**：测试界面的易用性和友好性
- **响应性测试**：测试在不同设备上的响应性
- **可访问性测试**：测试无障碍访问功能
- **性能测试**：测试页面加载和响应性能

## 13. 模块依赖

**依赖模块**
- **基础架构模块（REQ-001）**：用户认证、权限控制、数据存储
- **知识库管理（REQ-005）**：知识内容检索和推荐
- **工单管理模块（REQ-003）**：自助工单创建和查询
- **智能分析与AI（REQ-013）**：AI问答和智能推荐
- **客户关系管理（REQ-016）**：客户信息和门户配置
- **通知消息模块（REQ-011）**：工单状态通知

**被依赖模块**
- **移动端应用（REQ-020）**：提供移动端自助服务
- **数据分析模块（REQ-023）**：客户行为分析和服务优化

**外部依赖**
- **AI服务平台**：大语言模型API服务
- **搜索引擎**：Elasticsearch全文搜索
- **CDN服务**：静态资源加速分发
- **文件存储**：客户上传文件的存储服务

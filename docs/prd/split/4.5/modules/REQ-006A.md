# REQ-006A: 工程师基础管理

## 1. 业务描述
工程师基础管理模块是人力资源管理的核心组件，负责运维团队人员的基础信息管理，包括工程师档案、技能管理、排班调度、工作状态跟踪等功能。该模块为智能派单、绩效评估、资源调配等业务提供基础数据支撑，确保人力资源的合理配置和高效利用。通过标准化的人员管理流程，提升团队管理效率和服务质量。

**核心价值：**
- 作为智能派单（REQ-004）的主要数据源，提供档案/技能/排班/实时状态的高质量数据
- 保证多租户数据隔离，确保数据安全
- 支持Web与移动端，工程师可自助维护档案与在线状态
- 管理员支持批量导入/修改，提升管理效率

## 2. 核心目标与KPI

### 2.1 业务目标
- **信息完整率**：工程师档案信息完整率≥95%，技能信息准确率≥90%
- **排班效率**：排班冲突率≤5%，排班覆盖率≥95%
- **状态准确性**：工程师状态更新及时率≥90%，状态准确率≥95%
- **资源利用率**：工程师工作时间利用率≥80%，技能匹配率≥85%

### 2.2 技术目标
- **管理效率**：人员信息查询响应时间≤2秒，批量操作成功率≥95%
- **数据质量**：数据一致性≥99%，历史记录完整率100%
- **同步性能**：状态变更传播延迟≤30秒（P95），数据同步准确率≥99.9%

## 3. 功能需求

### 3.1 功能清单

| 功能编号 | 功能名称 | 优先级 | 功能描述 | 验收标准 |
|---------|----------|--------|----------|----------|
| REQ-006A-001 | 工程师档案管理 | P0 | 基本信息、联系方式、入职信息管理 | 信息完整准确，支持批量导入 |
| REQ-006A-002 | 技能管理 | P0 | 技能录入、等级评定、认证管理 | 技能体系完善，评定标准明确 |
| REQ-006A-003 | 排班管理 | P0 | 班次设置、排班计划、调班申请 | 排班合理，冲突检测有效 |
| REQ-006A-004 | 状态跟踪 | P0 | 在线状态、工作状态、位置信息 | 状态实时准确，更新及时 |
| REQ-006A-005 | 组织架构管理 | P1 | 部门设置、层级关系、角色分配 | 架构清晰，权限明确 |
| REQ-006A-006 | 考勤管理 | P1 | 签到签退、请假申请、加班记录 | 考勤准确，流程规范 |
| REQ-006A-007 | 联系管理 | P1 | 通讯录、紧急联系人、沟通记录 | 联系信息完整，沟通便捷 |
| REQ-006A-008 | 数据统计分析 | P2 | 人员统计、技能分布、工作量分析 | 统计准确，图表直观 |
| REQ-006A-009 | 批量数据管理 | P1 | 批量导入/导出/更新 | 导入导出模板校验，错误清单生成 |
| REQ-006A-010 | 历史记录与审计 | P1 | 档案/技能变更审计追踪 | 变更可追溯，可查询导出 |
| REQ-006A-011 | 移动端支持 | P2 | 工程师移动端更新状态/技能 | 端到端延迟≤30秒，易用性通过评测 |

### 3.2 技术实现要点
- **状态同步机制**：共享状态缓存（Redis）+ 事件总线（MQ）即时广播，≤30秒全网可见
- **多租户隔离**：基于tenant_id的数据隔离，确保租户间数据安全
- **权限控制**：基于RBAC的细粒度权限控制

## 4. 用户故事

### 4.1 人事管理员场景
**故事1：工程师档案管理**
- **角色**：人事管理员
- **需求**：作为管理员，我希望能够方便地管理工程师的基本信息和技能档案
- **场景**：录入新员工信息，更新技能认证，维护组织架构
- **验收标准**：操作便捷，数据准确，支持批量处理

### 4.2 运维工程师场景
**故事2：个人信息维护**
- **角色**：运维工程师
- **需求**：作为工程师，我希望能够更新自己的技能信息和工作状态
- **场景**：更新技能等级，设置工作状态，申请调班
- **验收标准**：界面友好，操作简单，更新及时

### 4.3 调度管理员场景
**故事3：排班管理**
- **角色**：调度管理员
- **需求**：作为调度员，我希望能够合理安排工程师的工作班次
- **场景**：制定排班计划，处理调班申请，监控排班执行
- **验收标准**：排班合理，冲突检测，执行监控

## 5. 业务流程

### 5.1 正常业务流程

#### 5.1.1 工程师入职流程
1. 人事管理员创建工程师档案
2. 录入基本信息和联系方式
3. 设置技能信息和等级
4. 分配部门和角色权限
5. 创建系统账号和初始密码
6. 发送入职通知和账号信息
7. 工程师首次登录完善个人信息

#### 5.1.2 技能认证流程
1. 工程师申请技能认证
2. 上传相关证明材料
3. 管理员审核认证申请
4. 更新技能等级和认证状态
5. 通知工程师认证结果

### 5.2 异常处理流程

#### 5.2.1 排班冲突处理
1. 系统检测到排班时间冲突
2. 自动标记冲突的排班记录
3. 通知调度管理员处理冲突
4. 管理员调整排班安排
5. 系统重新验证排班合理性
6. 通知相关工程师排班变更

#### 5.2.2 数据异常处理
- **导入格式错误**：拒绝导入并生成错误报告
- **状态同步失败**：进入重试队列，3次失败通知管理员
- **认证文件不合规**：驳回并发送重新上传通知

## 6. 非功能需求

### 6.1 性能需求
- **查询性能**：人员信息查询响应时间≤2秒，支持复杂条件筛选
- **批量操作**：支持1000+人员批量导入，处理时间≤5分钟
- **并发支持**：支持100+管理员同时操作，无性能瓶颈
- **数据同步**：状态信息实时同步，延迟≤30秒（P95）

### 6.2 可用性需求
- **界面友好**：操作界面简洁直观，新用户快速上手
- **移动支持**：支持移动端查看和简单操作
- **数据导入**：支持Excel、CSV等格式的批量导入
- **权限控制**：基于RBAC的细粒度数据访问权限控制

### 6.3 可靠性需求
- **数据一致性**：确保人员信息在各模块间的一致性≥99%
- **备份恢复**：定期备份人员数据，支持快速恢复（RTO≤1小时）
- **审计追踪**：记录所有人员信息变更操作，保留5年
- **容错处理**：系统异常时保证数据完整性，自动回滚机制

## 7. 数据模型

### 7.1 核心数据表

#### 7.1.1 工程师档案表（engineers）
```sql
CREATE TABLE engineers (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    tenant_id BIGINT NOT NULL COMMENT '租户ID',
    employee_no VARCHAR(50) NOT NULL COMMENT '工号',
    user_id BIGINT COMMENT '关联用户ID',
    real_name VARCHAR(50) NOT NULL COMMENT '真实姓名',
    gender TINYINT COMMENT '性别：1-男，2-女',
    birth_date DATE COMMENT '出生日期',
    id_card VARCHAR(20) COMMENT '身份证号（加密存储）',
    phone VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    address TEXT COMMENT '联系地址',
    emergency_contact VARCHAR(50) COMMENT '紧急联系人',
    emergency_phone VARCHAR(20) COMMENT '紧急联系电话',
    department_id BIGINT COMMENT '部门ID',
    position VARCHAR(100) COMMENT '职位',
    level TINYINT DEFAULT 1 COMMENT '级别：1-初级，2-中级，3-高级，4-专家',
    hire_date DATE COMMENT '入职日期',
    status TINYINT DEFAULT 1 COMMENT '状态：1-在职，2-离职，3-停职',
    work_location VARCHAR(200) COMMENT '工作地点',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_tenant_employee_no (tenant_id, employee_no),
    INDEX idx_department_id (department_id),
    INDEX idx_status (status),
    INDEX idx_tenant_id (tenant_id)
);
```

#### 7.1.2 排班计划表（work_schedules）
```sql
CREATE TABLE work_schedules (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    tenant_id BIGINT NOT NULL COMMENT '租户ID',
    engineer_id BIGINT NOT NULL COMMENT '工程师ID',
    schedule_date DATE NOT NULL COMMENT '排班日期',
    shift_type VARCHAR(20) NOT NULL COMMENT '班次类型：day-白班，night-夜班，standby-待命',
    start_time TIME NOT NULL COMMENT '开始时间',
    end_time TIME NOT NULL COMMENT '结束时间',
    work_location VARCHAR(200) COMMENT '工作地点',
    status TINYINT DEFAULT 1 COMMENT '状态：1-计划，2-执行中，3-已完成，4-已取消',
    created_by BIGINT COMMENT '创建人',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_tenant_engineer_date (tenant_id, engineer_id, schedule_date),
    INDEX idx_schedule_date (schedule_date),
    INDEX idx_shift_type (shift_type),
    INDEX idx_tenant_id (tenant_id)
);
```

## 8. 核心API接口

### 8.1 工程师档案管理API

#### 8.1.1 创建工程师档案
```http
POST /api/v1/engineers
Authorization: Bearer {access_token}
Content-Type: application/json

{
    "employee_no": "ENG001",
    "real_name": "张三",
    "gender": 1,
    "birth_date": "1990-05-15",
    "phone": "13800138000",
    "email": "zhangsan@company.com",
    "department_id": 101,
    "position": "运维工程师",
    "level": 2,
    "hire_date": "2024-08-01",
    "work_location": "北京总部",
    "skills": [
        {
            "skill_code": "linux",
            "skill_level": 3,
            "experience_years": 3.5
        }
    ]
}

Response:
{
    "code": 200,
    "message": "创建成功",
    "data": {
        "engineer_id": 1001,
        "employee_no": "ENG001",
        "real_name": "张三",
        "status": 1,
        "created_at": "2024-08-11T14:30:00Z"
    }
}
```

#### 8.1.2 查询工程师列表
```http
GET /api/v1/engineers?department_id=101&status=1&page=1&size=20
Authorization: Bearer {access_token}

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "total": 45,
        "page": 1,
        "size": 20,
        "items": [
            {
                "engineer_id": 1001,
                "employee_no": "ENG001",
                "real_name": "张三",
                "department_name": "运维部",
                "position": "运维工程师",
                "level": 2,
                "phone": "13800138000",
                "status": 1,
                "current_workload": 3,
                "online_status": "online"
            }
        ]
    }
}
```

### 8.2 状态管理API

#### 8.2.1 更新工程师状态
```http
PUT /api/v1/engineers/{id}/status
Authorization: Bearer {access_token}
Content-Type: application/json

{
    "status": "online",
    "location": {
        "latitude": 39.9042,
        "longitude": 116.4074
    }
}

Response:
{
    "code": 200,
    "message": "状态更新成功",
    "data": {
        "engineer_id": 1001,
        "status": "online",
        "updated_at": "2024-08-11T14:30:00Z"
    }
}

错误响应：
{
    "code": 40001,
    "message": "非法状态值",
    "data": null
}

错误码说明：
- 40001: 非法状态值
- 40401: 工程师不存在
- 50001: 状态更新失败（内部错误）
```

## 9. 异常与边界场景

### 9.1 数据异常场景
- **信息重复**：工号或身份证号重复时，提示用户检查并修正
- **数据不完整**：必填字段缺失时，阻止保存并提示补充
- **格式错误**：手机号、邮箱格式错误时，提供格式校验和提示
- **关联数据异常**：部门被删除时，提示重新分配工程师部门

### 9.2 排班异常场景
- **时间冲突**：同一工程师同一时间段重复排班，自动检测并提示
- **人员不足**：某时段无人值班时，发出告警并建议调整
- **请假冲突**：已请假时间段被排班，系统自动标记冲突
- **加班超限**：连续工作时间超过限制，提示调整排班

### 9.3 系统异常场景
- **多终端同时修改技能**：按最后提交时间覆盖并记录版本
- **批量导入部分失败**：成功的入库，失败的导出错误列表
- **状态丢失（缓存过期）**：实时从数据库回源
- **网络中断**：本地缓存机制，网络恢复后自动同步

## 10. 性能与容量规划

### 10.1 数据容量规划
- **人员数据**：支持10,000+工程师档案，每人档案约5KB
- **排班数据**：年排班记录约100万条，每条记录1KB
- **技能数据**：每人平均10个技能，总计10万条技能记录
- **历史数据**：保留5年历史数据，总容量约10GB

### 10.2 性能优化策略
- **索引优化**：关键查询字段建立索引，提升查询性能
- **缓存策略**：常用数据Redis缓存，减少数据库压力
- **分页查询**：大数据量查询使用分页，避免内存溢出
- **异步处理**：批量操作异步处理，提升用户体验

### 10.3 扩展性设计
- **水平扩展**：支持数据库分片，按租户ID分片
- **读写分离**：读操作使用从库，写操作使用主库
- **缓存分层**：本地缓存+分布式缓存，提升访问速度

## 11. 安全与合规

### 11.1 数据安全
- **敏感信息保护**：身份证号、联系方式等敏感信息AES-256加密存储
- **访问控制**：基于RBAC的数据访问权限控制，支持字段级权限
- **数据脱敏**：非必要场景下对敏感数据进行脱敏显示
- **审计日志**：记录所有人员信息变更操作，保留5年

### 11.2 隐私保护
- **最小化原则**：只收集必要的个人信息
- **用途限制**：个人信息仅用于业务管理目的
- **同意机制**：收集个人信息前获得明确同意
- **删除权利**：支持个人信息的删除和更正

### 11.3 合规要求
- **数据本地化**：支持数据本地化存储，满足监管要求
- **备份加密**：数据备份采用加密存储
- **传输安全**：API通信采用HTTPS+TLS1.3协议

## 12. 测试与验收标准

### 12.1 功能测试
- **档案管理**：测试工程师档案的增删改查功能，验证数据完整性
- **技能管理**：测试技能录入、更新、评级功能，验证技能体系完整性
- **排班管理**：测试排班计划、冲突检测、调班功能，验证业务逻辑正确性
- **状态跟踪**：测试工作状态的实时更新和同步，验证状态一致性

### 12.2 性能测试
- **并发测试**：100+用户同时操作，响应时间≤2秒
- **压力测试**：1000+人员批量导入，处理时间≤5分钟
- **稳定性测试**：7×24小时稳定运行，无内存泄漏

### 12.3 安全测试
- **权限测试**：验证RBAC权限控制有效性
- **数据加密测试**：验证敏感数据加密存储
- **SQL注入测试**：验证API接口安全性

## 13. 模块依赖关系

### 13.1 依赖的模块
- **基础架构模块（REQ-001）**：用户认证、权限控制、数据存储
- **系统管理模块（REQ-010）**：组织架构、角色权限管理
- **通知消息模块（REQ-011）**：排班通知、状态变更通知

### 13.2 被依赖的模块
- **智能派单模块（REQ-004）**：依赖工程师技能和状态信息
- **工程师高级管理（REQ-006B）**：依赖基础档案信息
- **绩效评估模块**：依赖工程师基础信息和工作记录
- **薪酬管理模块**：依赖考勤和排班数据

### 13.3 外部系统集成
- **人事系统**：与企业人事系统集成，同步人员信息
- **考勤系统**：与考勤设备集成，自动记录考勤数据
- **地理位置服务**：获取工程师位置信息
- **通讯录服务**：同步企业通讯录信息

### 13.4 接口规范
- **数据同步接口**：支持增量同步和全量同步
- **状态推送接口**：实时推送工程师状态变更
- **权限验证接口**：统一的权限验证机制
